(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9768],{1822:function(Qe,O,y){"use strict";var z=y(67294),b=y(16521),p=y(27199),X=y(30731),U=y(4874),Y=function(he,Z){var Ie={};for(var Le in he)Object.prototype.hasOwnProperty.call(he,Le)&&Z.indexOf(Le)<0&&(Ie[Le]=he[Le]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var rt=0,Le=Object.getOwnPropertySymbols(he);rt<Le.length;rt++)Z.indexOf(Le[rt])<0&&Object.prototype.propertyIsEnumerable.call(he,Le[rt])&&(Ie[Le[rt]]=he[Le[rt]]);return Ie},$=(0,z.forwardRef)(function(he,Z){var Ie=he.style,Le=Ie===void 0?{height:"inherit"}:Ie,rt=he.className,$t=he.loading,zt=he.loadingTemplate,Lt=he.errorTemplate,Ht=Y(he,["style","className","loading","loadingTemplate","errorTemplate"]),Ct=(0,p.Z)(b.aC,Ht),yt=Ct.chart,ft=Ct.container;return(0,z.useImperativeHandle)(Z,function(){return{getChart:function(){return yt.current}}}),z.createElement(X.Z,{errorTemplate:Lt},$t&&z.createElement(U.Z,{loadingTemplate:zt}),z.createElement("div",{className:rt,style:Le,ref:ft}))});O.Z=$},28614:function(Qe,O,y){"use strict";var z=y(67294),b=y(16521),p=y(27199),X=y(30731),U=y(4874),Y=function(he,Z){var Ie={};for(var Le in he)Object.prototype.hasOwnProperty.call(he,Le)&&Z.indexOf(Le)<0&&(Ie[Le]=he[Le]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var rt=0,Le=Object.getOwnPropertySymbols(he);rt<Le.length;rt++)Z.indexOf(Le[rt])<0&&Object.prototype.propertyIsEnumerable.call(he,Le[rt])&&(Ie[Le[rt]]=he[Le[rt]]);return Ie},$=(0,z.forwardRef)(function(he,Z){var Ie=he.style,Le=Ie===void 0?{height:"inherit"}:Ie,rt=he.className,$t=he.loading,zt=he.loadingTemplate,Lt=he.errorTemplate,Ht=Y(he,["style","className","loading","loadingTemplate","errorTemplate"]),Ct=(0,p.Z)(b.Kj,Ht),yt=Ct.chart,ft=Ct.container;return(0,z.useImperativeHandle)(Z,function(){return{getChart:function(){return yt.current}}}),z.createElement(X.Z,{errorTemplate:Lt},$t&&z.createElement(U.Z,{loadingTemplate:zt}),z.createElement("div",{className:rt,style:Le,ref:ft}))});O.Z=$},98093:function(Qe,O,y){"use strict";var z=y(67294),b=y(16521),p=y(27199),X=y(30731),U=y(4874),Y=function(he,Z){var Ie={};for(var Le in he)Object.prototype.hasOwnProperty.call(he,Le)&&Z.indexOf(Le)<0&&(Ie[Le]=he[Le]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var rt=0,Le=Object.getOwnPropertySymbols(he);rt<Le.length;rt++)Z.indexOf(Le[rt])<0&&Object.prototype.propertyIsEnumerable.call(he,Le[rt])&&(Ie[Le[rt]]=he[Le[rt]]);return Ie},$=(0,z.forwardRef)(function(he,Z){var Ie=he.style,Le=Ie===void 0?{height:"inherit"}:Ie,rt=he.className,$t=he.loading,zt=he.loadingTemplate,Lt=he.errorTemplate,Ht=Y(he,["style","className","loading","loadingTemplate","errorTemplate"]),Ct=(0,p.Z)(b.TZ,Ht),yt=Ct.chart,ft=Ct.container;return(0,z.useImperativeHandle)(Z,function(){return{getChart:function(){return yt.current}}}),z.createElement(X.Z,{errorTemplate:Lt},$t&&z.createElement(U.Z,{loadingTemplate:zt}),z.createElement("div",{className:rt,style:Le,ref:ft}))});O.Z=$},57611:function(Qe,O,y){"use strict";var z=y(67294),b=y(16521),p=y(27199),X=y(30731),U=y(4874),Y=function(he,Z){var Ie={};for(var Le in he)Object.prototype.hasOwnProperty.call(he,Le)&&Z.indexOf(Le)<0&&(Ie[Le]=he[Le]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var rt=0,Le=Object.getOwnPropertySymbols(he);rt<Le.length;rt++)Z.indexOf(Le[rt])<0&&Object.prototype.propertyIsEnumerable.call(he,Le[rt])&&(Ie[Le[rt]]=he[Le[rt]]);return Ie},$=(0,z.forwardRef)(function(he,Z){var Ie=he.style,Le=Ie===void 0?{height:"inherit"}:Ie,rt=he.className,$t=he.loading,zt=he.loadingTemplate,Lt=he.errorTemplate,Ht=Y(he,["style","className","loading","loadingTemplate","errorTemplate"]),Ct=(0,p.Z)(b.m,Ht),yt=Ct.chart,ft=Ct.container;return(0,z.useImperativeHandle)(Z,function(){return{getChart:function(){return yt.current}}}),z.createElement(X.Z,{errorTemplate:Lt},$t&&z.createElement(U.Z,{loadingTemplate:zt}),z.createElement("div",{className:rt,style:Le,ref:ft}))});O.Z=$},99525:function(Qe,O,y){"use strict";var z=y(67294),b=y(16521),p=y(27199),X=y(30731),U=y(4874),Y=function(he,Z){var Ie={};for(var Le in he)Object.prototype.hasOwnProperty.call(he,Le)&&Z.indexOf(Le)<0&&(Ie[Le]=he[Le]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var rt=0,Le=Object.getOwnPropertySymbols(he);rt<Le.length;rt++)Z.indexOf(Le[rt])<0&&Object.prototype.propertyIsEnumerable.call(he,Le[rt])&&(Ie[Le[rt]]=he[Le[rt]]);return Ie},$=(0,z.forwardRef)(function(he,Z){var Ie=he.style,Le=Ie===void 0?{height:"inherit"}:Ie,rt=he.className,$t=he.loading,zt=he.loadingTemplate,Lt=he.errorTemplate,Ht=Y(he,["style","className","loading","loadingTemplate","errorTemplate"]),Ct=(0,p.Z)(b.kB,Ht),yt=Ct.chart,ft=Ct.container;return(0,z.useImperativeHandle)(Z,function(){return{getChart:function(){return yt.current}}}),z.createElement(X.Z,{errorTemplate:Lt},$t&&z.createElement(U.Z,{loadingTemplate:zt}),z.createElement("div",{className:rt,style:Le,ref:ft}))});O.Z=$},64335:function(Qe,O,y){"use strict";var z=y(67294),b=(0,z.createContext)({});O.Z=b},21349:function(Qe,O,y){"use strict";var z=y(84305),b=y(69224),p=y(53645),X=y.n(p),U=y(67294),Y=y(94184),$=y.n(Y),he=y(64335),Z=function(Le){var rt=(0,U.useContext)(he.Z),$t=Le.children,zt=Le.contentWidth,Lt=Le.className,Ht=Le.style,Ct=(0,U.useContext)(b.ZP.ConfigContext),yt=Ct.getPrefixCls,ft=Le.prefixCls||yt("pro"),sr=zt||rt.contentWidth,re="".concat(ft,"-grid-content");return U.createElement("div",{className:$()(re,Lt,{wide:sr==="Fixed"}),style:Ht},U.createElement("div",{className:"".concat(ft,"-grid-content-children")},$t))};O.Z=Z},46343:function(Qe,O,y){"use strict";y.d(O,{zj:function(){return Ut},oI:function(){return Qi},ni:function(){return _e},gg:function(){return _n}});var z=y(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function b(ur,ge,Pe,Ge){function Re(Nt){return Nt instanceof Pe?Nt:new Pe(function(ar){ar(Nt)})}return new(Pe||(Pe=Promise))(function(Nt,ar){function yr(Fr){try{fr(Ge.next(Fr))}catch(C){ar(C)}}function Lr(Fr){try{fr(Ge.throw(Fr))}catch(C){ar(C)}}function fr(Fr){Fr.done?Nt(Fr.value):Re(Fr.value).then(yr,Lr)}fr((Ge=Ge.apply(ur,ge||[])).next())})}function p(ur,ge){var Pe={label:0,sent:function(){if(Nt[0]&1)throw Nt[1];return Nt[1]},trys:[],ops:[]},Ge,Re,Nt,ar;return ar={next:yr(0),throw:yr(1),return:yr(2)},typeof Symbol=="function"&&(ar[Symbol.iterator]=function(){return this}),ar;function yr(fr){return function(Fr){return Lr([fr,Fr])}}function Lr(fr){if(Ge)throw new TypeError("Generator is already executing.");for(;Pe;)try{if(Ge=1,Re&&(Nt=fr[0]&2?Re.return:fr[0]?Re.throw||((Nt=Re.return)&&Nt.call(Re),0):Re.next)&&!(Nt=Nt.call(Re,fr[1])).done)return Nt;switch(Re=0,Nt&&(fr=[fr[0]&2,Nt.value]),fr[0]){case 0:case 1:Nt=fr;break;case 4:return Pe.label++,{value:fr[1],done:!1};case 5:Pe.label++,Re=fr[1],fr=[0];continue;case 7:fr=Pe.ops.pop(),Pe.trys.pop();continue;default:if(Nt=Pe.trys,!(Nt=Nt.length>0&&Nt[Nt.length-1])&&(fr[0]===6||fr[0]===2)){Pe=0;continue}if(fr[0]===3&&(!Nt||fr[1]>Nt[0]&&fr[1]<Nt[3])){Pe.label=fr[1];break}if(fr[0]===6&&Pe.label<Nt[1]){Pe.label=Nt[1],Nt=fr;break}if(Nt&&Pe.label<Nt[2]){Pe.label=Nt[2],Pe.ops.push(fr);break}Nt[2]&&Pe.ops.pop(),Pe.trys.pop();continue}fr=ge.call(ur,Pe)}catch(Fr){fr=[6,Fr],Re=0}finally{Ge=Nt=0}if(fr[0]&5)throw fr[1];return{value:fr[0]?fr[1]:void 0,done:!0}}}function X(ur,ge){var Pe=typeof Symbol=="function"&&ur[Symbol.iterator];if(!Pe)return ur;var Ge=Pe.call(ur),Re,Nt=[],ar;try{for(;(ge===void 0||ge-- >0)&&!(Re=Ge.next()).done;)Nt.push(Re.value)}catch(yr){ar={error:yr}}finally{try{Re&&!Re.done&&(Pe=Ge.return)&&Pe.call(Ge)}finally{if(ar)throw ar.error}}return Nt}function U(){for(var ur=[],ge=0;ge<arguments.length;ge++)ur=ur.concat(X(arguments[ge]));return ur}function Y(ur){return ur&&ur.__esModule&&Object.prototype.hasOwnProperty.call(ur,"default")?ur.default:ur}function $(ur,ge){return ge={exports:{}},ur(ge,ge.exports),ge.exports}var he=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Pe;function Pe(Ge){return Ge&&typeof Ge.length=="number"&&Ge.length>=0&&Ge.length%1==0}ur.exports=ge.default});Y(he);var Z=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=function(Pe){return function(){for(var Ge=[],Re=arguments.length;Re--;)Ge[Re]=arguments[Re];var Nt=Ge.pop();return Pe.call(this,Ge,Nt)}},ur.exports=ge.default});Y(Z);var Ie=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.fallback=Re,ge.wrap=Nt;var Pe=ge.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ge=ge.hasNextTick=typeof z=="object"&&typeof z.nextTick=="function";function Re(yr){setTimeout(yr,0)}function Nt(yr){return function(Lr){for(var fr=[],Fr=arguments.length-1;Fr-- >0;)fr[Fr]=arguments[Fr+1];return yr(function(){return Lr.apply(void 0,fr)})}}var ar;Pe?ar=setImmediate:Ge?ar=z.nextTick:ar=Re,ge.default=Nt(ar)});Y(Ie);var Le=Ie.fallback,rt=Ie.wrap,$t=Ie.hasSetImmediate,zt=Ie.hasNextTick,Lt=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Nt;var Pe=Re(Z),Ge=Re(Ie);function Re(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}function Nt(Lr){return(0,Ht.isAsync)(Lr)?function(){for(var fr=[],Fr=arguments.length;Fr--;)fr[Fr]=arguments[Fr];var C=fr.pop(),G=Lr.apply(this,fr);return ar(G,C)}:(0,Pe.default)(function(fr,Fr){var C;try{C=Lr.apply(this,fr)}catch(G){return Fr(G)}if(C&&typeof C.then=="function")return ar(C,Fr);Fr(null,C)})}function ar(Lr,fr){return Lr.then(function(Fr){yr(fr,null,Fr)},function(Fr){yr(fr,Fr&&Fr.message?Fr:new Error(Fr))})}function yr(Lr,fr,Fr){try{Lr(fr,Fr)}catch(C){(0,Ge.default)(function(G){throw G},C)}}ur.exports=ge.default});Y(Lt);var Ht=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.isAsyncIterable=ge.isAsyncGenerator=ge.isAsync=void 0;var Pe=Ge(Lt);function Ge(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}function Re(Lr){return Lr[Symbol.toStringTag]==="AsyncFunction"}function Nt(Lr){return Lr[Symbol.toStringTag]==="AsyncGenerator"}function ar(Lr){return typeof Lr[Symbol.asyncIterator]=="function"}function yr(Lr){if(typeof Lr!="function")throw new Error("expected a function");return Re(Lr)?(0,Pe.default)(Lr):Lr}ge.default=yr,ge.isAsync=Re,ge.isAsyncGenerator=Nt,ge.isAsyncIterable=ar});Y(Ht);var Ct=Ht.isAsyncIterable,yt=Ht.isAsyncGenerator,ft=Ht.isAsync,sr=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Pe;function Pe(Ge,Re){if(Re===void 0&&(Re=Ge.length),!Re)throw new Error("arity is undefined");function Nt(){for(var ar=this,yr=[],Lr=arguments.length;Lr--;)yr[Lr]=arguments[Lr];return typeof yr[Re-1]=="function"?Ge.apply(this,yr):new Promise(function(fr,Fr){yr[Re-1]=function(C){for(var G=[],Ze=arguments.length-1;Ze-- >0;)G[Ze]=arguments[Ze+1];if(C)return Fr(C);fr(G.length>1?G:G[0])},Ge.apply(ar,yr)})}return Object.defineProperty(Nt,"name",{configurable:!0,value:"awaitable("+Ge.name+")"}),Nt}ur.exports=ge.default});Y(sr);var re=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe=Nt(he),Ge=Nt(Ht),Re=Nt(sr);function Nt(ar){return ar&&ar.__esModule?ar:{default:ar}}ge.default=(0,Re.default)(function(ar,yr,Lr){var fr=(0,Pe.default)(yr)?[]:{};ar(yr,function(Fr,C,G){(0,Ge.default)(Fr)(function(Ze){for(var tt,lt=[],Pt=arguments.length-1;Pt-- >0;)lt[Pt]=arguments[Pt+1];lt.length<2&&(tt=lt,lt=tt[0]),fr[C]=lt,G(Ze)})},function(Fr){return Lr(Fr,fr)})},3),ur.exports=ge.default});Y(re);var nr=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Pe;function Pe(Ge){function Re(){for(var Nt=[],ar=arguments.length;ar--;)Nt[ar]=arguments[ar];if(Ge!==null){var yr=Ge;Ge=null,yr.apply(this,Nt)}}return Object.assign(Re,Ge),Re}ur.exports=ge.default});Y(nr);var Tt=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=function(Pe){return Pe[Symbol.iterator]&&Pe[Symbol.iterator]()},ur.exports=ge.default});Y(Tt);var $e=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Lr;var Pe=Re(he),Ge=Re(Tt);function Re(fr){return fr&&fr.__esModule?fr:{default:fr}}function Nt(fr){var Fr=-1,C=fr.length;return function(){return++Fr<C?{value:fr[Fr],key:Fr}:null}}function ar(fr){var Fr=-1;return function(){var G=fr.next();return G.done?null:(Fr++,{value:G.value,key:Fr})}}function yr(fr){var Fr=fr?Object.keys(fr):[],C=-1,G=Fr.length;return function(){var tt=Fr[++C];return C<G?{value:fr[tt],key:tt}:null}}function Lr(fr){if((0,Pe.default)(fr))return Nt(fr);var Fr=(0,Ge.default)(fr);return Fr?ar(Fr):yr(fr)}ur.exports=ge.default});Y($e);var Mt=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Pe;function Pe(Ge){return function(){for(var Re=[],Nt=arguments.length;Nt--;)Re[Nt]=arguments[Nt];if(Ge===null)throw new Error("Callback was already called.");var ar=Ge;Ge=null,ar.apply(this,Re)}}ur.exports=ge.default});Y(Mt);var Ve=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe={};ge.default=Pe,ur.exports=ge.default});Y(Ve);var Ot=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Re;var Pe=Ge(Ve);function Ge(Nt){return Nt&&Nt.__esModule?Nt:{default:Nt}}function Re(Nt,ar,yr,Lr){var fr=!1,Fr=!1,C=!1,G=0,Ze=0;function tt(){G>=ar||C||fr||(C=!0,Nt.next().then(function(q){var kt=q.value,Er=q.done;if(!(Fr||fr)){if(C=!1,Er){fr=!0,G<=0&&Lr(null);return}G++,yr(kt,Ze,lt),Ze++,tt()}}).catch(Pt))}function lt(q,kt){if(G-=1,!Fr){if(q)return Pt(q);if(q===!1){fr=!0,Fr=!0;return}if(kt===Pe.default||fr&&G<=0)return fr=!0,Lr(null);tt()}}function Pt(q){Fr||(C=!1,fr=!0,Lr(q))}tt()}ur.exports=ge.default});Y(Ot);var pr=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe=yr(nr),Ge=yr($e),Re=yr(Mt),Nt=yr(Ot),ar=yr(Ve);function yr(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}ge.default=function(Lr){return function(fr,Fr,C){if(C=(0,Pe.default)(C),Lr<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!fr)return C(null);if((0,Ht.isAsyncGenerator)(fr))return(0,Nt.default)(fr,Lr,Fr,C);if((0,Ht.isAsyncIterable)(fr))return(0,Nt.default)(fr[Symbol.asyncIterator](),Lr,Fr,C);var G=(0,Ge.default)(fr),Ze=!1,tt=!1,lt=0,Pt=!1;function q(Er,Mr){if(!tt)if(lt-=1,Er)Ze=!0,C(Er);else if(Er===!1)Ze=!0,tt=!0;else{if(Mr===ar.default||Ze&&lt<=0)return Ze=!0,C(null);Pt||kt()}}function kt(){for(Pt=!0;lt<Lr&&!Ze;){var Er=G();if(Er===null){Ze=!0,lt<=0&&C(null);return}lt+=1,Fr(Er.value,Er.key,(0,Re.default)(q))}Pt=!1}kt()}},ur.exports=ge.default});Y(pr);var qt=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe=Nt(pr),Ge=Nt(Ht),Re=Nt(sr);function Nt(yr){return yr&&yr.__esModule?yr:{default:yr}}function ar(yr,Lr,fr,Fr){return(0,Pe.default)(Lr)(yr,(0,Ge.default)(fr),Fr)}ge.default=(0,Re.default)(ar,4),ur.exports=ge.default});Y(qt);var W=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe=Re(qt),Ge=Re(sr);function Re(ar){return ar&&ar.__esModule?ar:{default:ar}}function Nt(ar,yr,Lr){return(0,Pe.default)(ar,1,yr,Lr)}ge.default=(0,Ge.default)(Nt,3),ur.exports=ge.default});Y(W);var se=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Nt;var Pe=Re(re),Ge=Re(W);function Re(ar){return ar&&ar.__esModule?ar:{default:ar}}function Nt(ar,yr){return(0,Pe.default)(Ge.default,ar,yr)}ur.exports=ge.default}),ke=Y(se),_e=function(){function ur(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];this.args=[],this.tasks=[]}return ur.prototype.call=function(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];return this.args=Pe,ke(this.tasks)},ur.prototype.tap=function(ge,Pe){var Ge=this;this.tasks.push(function(Re){Pe.apply(void 0,U(Ge.args)),Re(null,ge)})},ur}(),Et=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe=fr(he),Ge=fr(Ve),Re=fr(qt),Nt=fr(nr),ar=fr(Mt),yr=fr(Ht),Lr=fr(sr);function fr(Ze){return Ze&&Ze.__esModule?Ze:{default:Ze}}function Fr(Ze,tt,lt){lt=(0,Nt.default)(lt);var Pt=0,q=0,kt=Ze.length,Er=!1;kt===0&&lt(null);function Mr(Je,ct){Je===!1&&(Er=!0),Er!==!0&&(Je?lt(Je):(++q===kt||ct===Ge.default)&&lt(null))}for(;Pt<kt;Pt++)tt(Ze[Pt],Pt,(0,ar.default)(Mr))}function C(Ze,tt,lt){return(0,Re.default)(Ze,Infinity,tt,lt)}function G(Ze,tt,lt){var Pt=(0,Pe.default)(Ze)?Fr:C;return Pt(Ze,(0,yr.default)(tt),lt)}ge.default=(0,Lr.default)(G,3),ur.exports=ge.default});Y(Et);var gt=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Nt;var Pe=Re(Et),Ge=Re(re);function Re(ar){return ar&&ar.__esModule?ar:{default:ar}}function Nt(ar,yr){return(0,Ge.default)(Pe.default,ar,yr)}ur.exports=ge.default}),jt=Y(gt),Ut=function(){function ur(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];this.tasks=[]}return ur.prototype.promise=function(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];return jt(this.tasks)},ur.prototype.tapPromise=function(ge,Pe){var Ge=this;this.tasks.push(function(Re){return b(Ge,void 0,void 0,function(){return p(this,function(Nt){switch(Nt.label){case 0:return[4,Pe()];case 1:return Nt.sent(),Re(null,ge),[2]}})})})},ur}(),zr=$(function(ur,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Pe=ar(nr),Ge=ar(Mt),Re=ar(Ht),Nt=ar(sr);function ar(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}function yr(Lr,fr){if(fr=(0,Pe.default)(fr),!Array.isArray(Lr))return fr(new Error("First argument to waterfall must be an array of functions"));if(!Lr.length)return fr();var Fr=0;function C(Ze){var tt=(0,Re.default)(Lr[Fr++]);tt.apply(void 0,Ze.concat([(0,Ge.default)(G)]))}function G(Ze){for(var tt=[],lt=arguments.length-1;lt-- >0;)tt[lt]=arguments[lt+1];if(Ze!==!1){if(Ze||Fr===Lr.length)return fr.apply(void 0,[Ze].concat(tt));C(tt)}}C([])}ge.default=(0,Nt.default)(yr),ur.exports=ge.default}),dn=Y(zr),_n=function(){function ur(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];this.tasks=[]}return ur.prototype.call=function(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];return dn(this.tasks)},ur.prototype.tap=function(ge,Pe){this.tasks.length===0?this.tasks.push(function(Ge){var Re=Pe();Ge(Re?null:!1,Re)}):this.tasks.push(function(Ge,Re){var Nt=Pe();Re(Nt?null:!1,ge)})},ur}(),Qi=function(){function ur(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];this.tasks=[]}return ur.prototype.call=function(){for(var ge=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=ge[Ge];return ke(this.tasks)},ur.prototype.tap=function(ge,Pe){this.tasks.push(function(Ge){var Re=Pe();Ge(Re,ge)})},ur}()},58881:function(Qe,O,y){"use strict";y.d(O,{nC:function(){return z.ZP},Hp:function(){return z.Hp},e7:function(){return z.e7},yT:function(){return z.yT},vK:function(){return p.v},BlendType:function(){return U.h},AttributeType:function(){return Y.GC},ScaleTypes:function(){return Y.vY},StyleScaleType:function(){return Y.ee},MapServiceEvent:function(){return Z.I},CoordinateSystem:function(){return Ie.l},CoordinateUniform:function(){return Ie.k},CameraUniform:function(){return $t.l},SceneEventList:function(){return Ht.P},PositionType:function(){return Tt.d},gl:function(){return ar.gl}});var z=y(12250),b=y(69530),p=y(72302),X=y(76915),U=y(77252),Y=y(31251),$=y(8628),he=y.n($);y.o($,"CameraUniform")&&y.d(O,{CameraUniform:function(){return $.CameraUniform}}),y.o($,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return $.CityBuildingLayer}}),y.o($,"CoordinateSystem")&&y.d(O,{CoordinateSystem:function(){return $.CoordinateSystem}}),y.o($,"CoordinateUniform")&&y.d(O,{CoordinateUniform:function(){return $.CoordinateUniform}}),y.o($,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return $.HeatmapLayer}}),y.o($,"ImageLayer")&&y.d(O,{ImageLayer:function(){return $.ImageLayer}}),y.o($,"LineLayer")&&y.d(O,{LineLayer:function(){return $.LineLayer}}),y.o($,"MapServiceEvent")&&y.d(O,{MapServiceEvent:function(){return $.MapServiceEvent}}),y.o($,"Marker")&&y.d(O,{Marker:function(){return $.Marker}}),y.o($,"PointLayer")&&y.d(O,{PointLayer:function(){return $.PointLayer}}),y.o($,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return $.PolygonLayer}}),y.o($,"Popup")&&y.d(O,{Popup:function(){return $.Popup}}),y.o($,"PositionType")&&y.d(O,{PositionType:function(){return $.PositionType}}),y.o($,"RasterLayer")&&y.d(O,{RasterLayer:function(){return $.RasterLayer}}),y.o($,"Scene")&&y.d(O,{Scene:function(){return $.Scene}}),y.o($,"SceneEventList")&&y.d(O,{SceneEventList:function(){return $.SceneEventList}}),y.o($,"gl")&&y.d(O,{gl:function(){return $.gl}});var Z=y(16606),Ie=y(47282),Le=y(41906),rt=y.n(Le);y.o(Le,"CameraUniform")&&y.d(O,{CameraUniform:function(){return Le.CameraUniform}}),y.o(Le,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Le.CityBuildingLayer}}),y.o(Le,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Le.HeatmapLayer}}),y.o(Le,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Le.ImageLayer}}),y.o(Le,"LineLayer")&&y.d(O,{LineLayer:function(){return Le.LineLayer}}),y.o(Le,"Marker")&&y.d(O,{Marker:function(){return Le.Marker}}),y.o(Le,"PointLayer")&&y.d(O,{PointLayer:function(){return Le.PointLayer}}),y.o(Le,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Le.PolygonLayer}}),y.o(Le,"Popup")&&y.d(O,{Popup:function(){return Le.Popup}}),y.o(Le,"PositionType")&&y.d(O,{PositionType:function(){return Le.PositionType}}),y.o(Le,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Le.RasterLayer}}),y.o(Le,"Scene")&&y.d(O,{Scene:function(){return Le.Scene}}),y.o(Le,"SceneEventList")&&y.d(O,{SceneEventList:function(){return Le.SceneEventList}}),y.o(Le,"gl")&&y.d(O,{gl:function(){return Le.gl}});var $t=y(4594),zt=y(1910),Lt=y.n(zt);y.o(zt,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return zt.CityBuildingLayer}}),y.o(zt,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return zt.HeatmapLayer}}),y.o(zt,"ImageLayer")&&y.d(O,{ImageLayer:function(){return zt.ImageLayer}}),y.o(zt,"LineLayer")&&y.d(O,{LineLayer:function(){return zt.LineLayer}}),y.o(zt,"Marker")&&y.d(O,{Marker:function(){return zt.Marker}}),y.o(zt,"PointLayer")&&y.d(O,{PointLayer:function(){return zt.PointLayer}}),y.o(zt,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return zt.PolygonLayer}}),y.o(zt,"Popup")&&y.d(O,{Popup:function(){return zt.Popup}}),y.o(zt,"PositionType")&&y.d(O,{PositionType:function(){return zt.PositionType}}),y.o(zt,"RasterLayer")&&y.d(O,{RasterLayer:function(){return zt.RasterLayer}}),y.o(zt,"Scene")&&y.d(O,{Scene:function(){return zt.Scene}}),y.o(zt,"SceneEventList")&&y.d(O,{SceneEventList:function(){return zt.SceneEventList}}),y.o(zt,"gl")&&y.d(O,{gl:function(){return zt.gl}});var Ht=y(19793),Ct=y(93102),yt=y.n(Ct);y.o(Ct,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Ct.CityBuildingLayer}}),y.o(Ct,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Ct.HeatmapLayer}}),y.o(Ct,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Ct.ImageLayer}}),y.o(Ct,"LineLayer")&&y.d(O,{LineLayer:function(){return Ct.LineLayer}}),y.o(Ct,"Marker")&&y.d(O,{Marker:function(){return Ct.Marker}}),y.o(Ct,"PointLayer")&&y.d(O,{PointLayer:function(){return Ct.PointLayer}}),y.o(Ct,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Ct.PolygonLayer}}),y.o(Ct,"Popup")&&y.d(O,{Popup:function(){return Ct.Popup}}),y.o(Ct,"PositionType")&&y.d(O,{PositionType:function(){return Ct.PositionType}}),y.o(Ct,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Ct.RasterLayer}}),y.o(Ct,"Scene")&&y.d(O,{Scene:function(){return Ct.Scene}}),y.o(Ct,"gl")&&y.d(O,{gl:function(){return Ct.gl}});var ft=y(64532),sr=y.n(ft);y.o(ft,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return ft.CityBuildingLayer}}),y.o(ft,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return ft.HeatmapLayer}}),y.o(ft,"ImageLayer")&&y.d(O,{ImageLayer:function(){return ft.ImageLayer}}),y.o(ft,"LineLayer")&&y.d(O,{LineLayer:function(){return ft.LineLayer}}),y.o(ft,"Marker")&&y.d(O,{Marker:function(){return ft.Marker}}),y.o(ft,"PointLayer")&&y.d(O,{PointLayer:function(){return ft.PointLayer}}),y.o(ft,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return ft.PolygonLayer}}),y.o(ft,"Popup")&&y.d(O,{Popup:function(){return ft.Popup}}),y.o(ft,"PositionType")&&y.d(O,{PositionType:function(){return ft.PositionType}}),y.o(ft,"RasterLayer")&&y.d(O,{RasterLayer:function(){return ft.RasterLayer}}),y.o(ft,"Scene")&&y.d(O,{Scene:function(){return ft.Scene}}),y.o(ft,"gl")&&y.d(O,{gl:function(){return ft.gl}});var re=y(2811),nr=y.n(re);y.o(re,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return re.CityBuildingLayer}}),y.o(re,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return re.HeatmapLayer}}),y.o(re,"ImageLayer")&&y.d(O,{ImageLayer:function(){return re.ImageLayer}}),y.o(re,"LineLayer")&&y.d(O,{LineLayer:function(){return re.LineLayer}}),y.o(re,"Marker")&&y.d(O,{Marker:function(){return re.Marker}}),y.o(re,"PointLayer")&&y.d(O,{PointLayer:function(){return re.PointLayer}}),y.o(re,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return re.PolygonLayer}}),y.o(re,"Popup")&&y.d(O,{Popup:function(){return re.Popup}}),y.o(re,"PositionType")&&y.d(O,{PositionType:function(){return re.PositionType}}),y.o(re,"RasterLayer")&&y.d(O,{RasterLayer:function(){return re.RasterLayer}}),y.o(re,"Scene")&&y.d(O,{Scene:function(){return re.Scene}}),y.o(re,"gl")&&y.d(O,{gl:function(){return re.gl}});var Tt=y(66690),$e=y(81732),Mt=y.n($e);y.o($e,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return $e.CityBuildingLayer}}),y.o($e,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return $e.HeatmapLayer}}),y.o($e,"ImageLayer")&&y.d(O,{ImageLayer:function(){return $e.ImageLayer}}),y.o($e,"LineLayer")&&y.d(O,{LineLayer:function(){return $e.LineLayer}}),y.o($e,"Marker")&&y.d(O,{Marker:function(){return $e.Marker}}),y.o($e,"PointLayer")&&y.d(O,{PointLayer:function(){return $e.PointLayer}}),y.o($e,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return $e.PolygonLayer}}),y.o($e,"Popup")&&y.d(O,{Popup:function(){return $e.Popup}}),y.o($e,"RasterLayer")&&y.d(O,{RasterLayer:function(){return $e.RasterLayer}}),y.o($e,"Scene")&&y.d(O,{Scene:function(){return $e.Scene}}),y.o($e,"gl")&&y.d(O,{gl:function(){return $e.gl}});var Ve=y(84007),Ot=y.n(Ve);y.o(Ve,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Ve.CityBuildingLayer}}),y.o(Ve,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Ve.HeatmapLayer}}),y.o(Ve,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Ve.ImageLayer}}),y.o(Ve,"LineLayer")&&y.d(O,{LineLayer:function(){return Ve.LineLayer}}),y.o(Ve,"Marker")&&y.d(O,{Marker:function(){return Ve.Marker}}),y.o(Ve,"PointLayer")&&y.d(O,{PointLayer:function(){return Ve.PointLayer}}),y.o(Ve,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Ve.PolygonLayer}}),y.o(Ve,"Popup")&&y.d(O,{Popup:function(){return Ve.Popup}}),y.o(Ve,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Ve.RasterLayer}}),y.o(Ve,"Scene")&&y.d(O,{Scene:function(){return Ve.Scene}}),y.o(Ve,"gl")&&y.d(O,{gl:function(){return Ve.gl}});var pr=y(89648),qt=y(90919),W=y.n(qt);y.o(qt,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return qt.CityBuildingLayer}}),y.o(qt,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return qt.HeatmapLayer}}),y.o(qt,"ImageLayer")&&y.d(O,{ImageLayer:function(){return qt.ImageLayer}}),y.o(qt,"LineLayer")&&y.d(O,{LineLayer:function(){return qt.LineLayer}}),y.o(qt,"Marker")&&y.d(O,{Marker:function(){return qt.Marker}}),y.o(qt,"PointLayer")&&y.d(O,{PointLayer:function(){return qt.PointLayer}}),y.o(qt,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return qt.PolygonLayer}}),y.o(qt,"Popup")&&y.d(O,{Popup:function(){return qt.Popup}}),y.o(qt,"RasterLayer")&&y.d(O,{RasterLayer:function(){return qt.RasterLayer}}),y.o(qt,"Scene")&&y.d(O,{Scene:function(){return qt.Scene}}),y.o(qt,"gl")&&y.d(O,{gl:function(){return qt.gl}});var se=y(75925),ke=y.n(se);y.o(se,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return se.CityBuildingLayer}}),y.o(se,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return se.HeatmapLayer}}),y.o(se,"ImageLayer")&&y.d(O,{ImageLayer:function(){return se.ImageLayer}}),y.o(se,"LineLayer")&&y.d(O,{LineLayer:function(){return se.LineLayer}}),y.o(se,"Marker")&&y.d(O,{Marker:function(){return se.Marker}}),y.o(se,"PointLayer")&&y.d(O,{PointLayer:function(){return se.PointLayer}}),y.o(se,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return se.PolygonLayer}}),y.o(se,"Popup")&&y.d(O,{Popup:function(){return se.Popup}}),y.o(se,"RasterLayer")&&y.d(O,{RasterLayer:function(){return se.RasterLayer}}),y.o(se,"Scene")&&y.d(O,{Scene:function(){return se.Scene}}),y.o(se,"gl")&&y.d(O,{gl:function(){return se.gl}});var _e=y(85040),Et=y.n(_e);y.o(_e,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return _e.CityBuildingLayer}}),y.o(_e,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return _e.HeatmapLayer}}),y.o(_e,"ImageLayer")&&y.d(O,{ImageLayer:function(){return _e.ImageLayer}}),y.o(_e,"LineLayer")&&y.d(O,{LineLayer:function(){return _e.LineLayer}}),y.o(_e,"Marker")&&y.d(O,{Marker:function(){return _e.Marker}}),y.o(_e,"PointLayer")&&y.d(O,{PointLayer:function(){return _e.PointLayer}}),y.o(_e,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return _e.PolygonLayer}}),y.o(_e,"Popup")&&y.d(O,{Popup:function(){return _e.Popup}}),y.o(_e,"RasterLayer")&&y.d(O,{RasterLayer:function(){return _e.RasterLayer}}),y.o(_e,"Scene")&&y.d(O,{Scene:function(){return _e.Scene}}),y.o(_e,"gl")&&y.d(O,{gl:function(){return _e.gl}});var gt=y(8594),jt=y.n(gt);y.o(gt,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return gt.CityBuildingLayer}}),y.o(gt,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return gt.HeatmapLayer}}),y.o(gt,"ImageLayer")&&y.d(O,{ImageLayer:function(){return gt.ImageLayer}}),y.o(gt,"LineLayer")&&y.d(O,{LineLayer:function(){return gt.LineLayer}}),y.o(gt,"Marker")&&y.d(O,{Marker:function(){return gt.Marker}}),y.o(gt,"PointLayer")&&y.d(O,{PointLayer:function(){return gt.PointLayer}}),y.o(gt,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return gt.PolygonLayer}}),y.o(gt,"Popup")&&y.d(O,{Popup:function(){return gt.Popup}}),y.o(gt,"RasterLayer")&&y.d(O,{RasterLayer:function(){return gt.RasterLayer}}),y.o(gt,"Scene")&&y.d(O,{Scene:function(){return gt.Scene}}),y.o(gt,"gl")&&y.d(O,{gl:function(){return gt.gl}});var Ut=y(67571),zr=y.n(Ut);y.o(Ut,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Ut.CityBuildingLayer}}),y.o(Ut,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Ut.HeatmapLayer}}),y.o(Ut,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Ut.ImageLayer}}),y.o(Ut,"LineLayer")&&y.d(O,{LineLayer:function(){return Ut.LineLayer}}),y.o(Ut,"Marker")&&y.d(O,{Marker:function(){return Ut.Marker}}),y.o(Ut,"PointLayer")&&y.d(O,{PointLayer:function(){return Ut.PointLayer}}),y.o(Ut,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Ut.PolygonLayer}}),y.o(Ut,"Popup")&&y.d(O,{Popup:function(){return Ut.Popup}}),y.o(Ut,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Ut.RasterLayer}}),y.o(Ut,"Scene")&&y.d(O,{Scene:function(){return Ut.Scene}}),y.o(Ut,"gl")&&y.d(O,{gl:function(){return Ut.gl}});var dn=y(66718),_n=y.n(dn);y.o(dn,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return dn.CityBuildingLayer}}),y.o(dn,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return dn.HeatmapLayer}}),y.o(dn,"ImageLayer")&&y.d(O,{ImageLayer:function(){return dn.ImageLayer}}),y.o(dn,"LineLayer")&&y.d(O,{LineLayer:function(){return dn.LineLayer}}),y.o(dn,"Marker")&&y.d(O,{Marker:function(){return dn.Marker}}),y.o(dn,"PointLayer")&&y.d(O,{PointLayer:function(){return dn.PointLayer}}),y.o(dn,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return dn.PolygonLayer}}),y.o(dn,"Popup")&&y.d(O,{Popup:function(){return dn.Popup}}),y.o(dn,"RasterLayer")&&y.d(O,{RasterLayer:function(){return dn.RasterLayer}}),y.o(dn,"Scene")&&y.d(O,{Scene:function(){return dn.Scene}}),y.o(dn,"gl")&&y.d(O,{gl:function(){return dn.gl}});var Qi=y(92364),ur=y(78010),ge=y.n(ur);y.o(ur,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return ur.CityBuildingLayer}}),y.o(ur,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return ur.HeatmapLayer}}),y.o(ur,"ImageLayer")&&y.d(O,{ImageLayer:function(){return ur.ImageLayer}}),y.o(ur,"LineLayer")&&y.d(O,{LineLayer:function(){return ur.LineLayer}}),y.o(ur,"Marker")&&y.d(O,{Marker:function(){return ur.Marker}}),y.o(ur,"PointLayer")&&y.d(O,{PointLayer:function(){return ur.PointLayer}}),y.o(ur,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return ur.PolygonLayer}}),y.o(ur,"Popup")&&y.d(O,{Popup:function(){return ur.Popup}}),y.o(ur,"RasterLayer")&&y.d(O,{RasterLayer:function(){return ur.RasterLayer}}),y.o(ur,"Scene")&&y.d(O,{Scene:function(){return ur.Scene}}),y.o(ur,"gl")&&y.d(O,{gl:function(){return ur.gl}});var Pe=y(68116),Ge=y.n(Pe);y.o(Pe,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Pe.CityBuildingLayer}}),y.o(Pe,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Pe.HeatmapLayer}}),y.o(Pe,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Pe.ImageLayer}}),y.o(Pe,"LineLayer")&&y.d(O,{LineLayer:function(){return Pe.LineLayer}}),y.o(Pe,"Marker")&&y.d(O,{Marker:function(){return Pe.Marker}}),y.o(Pe,"PointLayer")&&y.d(O,{PointLayer:function(){return Pe.PointLayer}}),y.o(Pe,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Pe.PolygonLayer}}),y.o(Pe,"Popup")&&y.d(O,{Popup:function(){return Pe.Popup}}),y.o(Pe,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Pe.RasterLayer}}),y.o(Pe,"Scene")&&y.d(O,{Scene:function(){return Pe.Scene}}),y.o(Pe,"gl")&&y.d(O,{gl:function(){return Pe.gl}});var Re=y(23067),Nt=y.n(Re);y.o(Re,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Re.CityBuildingLayer}}),y.o(Re,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Re.HeatmapLayer}}),y.o(Re,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Re.ImageLayer}}),y.o(Re,"LineLayer")&&y.d(O,{LineLayer:function(){return Re.LineLayer}}),y.o(Re,"Marker")&&y.d(O,{Marker:function(){return Re.Marker}}),y.o(Re,"PointLayer")&&y.d(O,{PointLayer:function(){return Re.PointLayer}}),y.o(Re,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Re.PolygonLayer}}),y.o(Re,"Popup")&&y.d(O,{Popup:function(){return Re.Popup}}),y.o(Re,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Re.RasterLayer}}),y.o(Re,"Scene")&&y.d(O,{Scene:function(){return Re.Scene}}),y.o(Re,"gl")&&y.d(O,{gl:function(){return Re.gl}});var ar=y(7648)},12250:function(Qe,O,y){"use strict";y.d(O,{e7:function(){return Ci},Hp:function(){return vi},ZP:function(){return xi},yT:function(){return aa}});var z=y(28660),b=y(26729),p=y.n(b),X=y(86700),U=y(84879),Y=y(72302),$=y(6610),he=y(5991),Z=y(96156),Ie=y(6901),Le=y(49296),rt=y.n(Le);function $t(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function zt(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?$t(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):$t(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function Lt(ie,ne){var L=typeof Symbol!="undefined"&&ie[Symbol.iterator]||ie["@@iterator"];if(!L){if(Array.isArray(ie)||(L=Ht(ie))||ne&&ie&&typeof ie.length=="number"){L&&(ie=L);var B=0,ce=function(){};return{s:ce,n:function(){return B>=ie.length?{done:!0}:{done:!1,value:ie[B++]}},e:function(hr){throw hr},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,_t=!1,Rt;return{s:function(){L=L.call(ie)},n:function(){var hr=L.next();return Ae=hr.done,hr},e:function(hr){_t=!0,Rt=hr},f:function(){try{!Ae&&L.return!=null&&L.return()}finally{if(_t)throw Rt}}}}function Ht(ie,ne){if(!!ie){if(typeof ie=="string")return Ct(ie,ne);var L=Object.prototype.toString.call(ie).slice(8,-1);if(L==="Object"&&ie.constructor&&(L=ie.constructor.name),L==="Map"||L==="Set")return Array.from(ie);if(L==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(L))return Ct(ie,ne)}}function Ct(ie,ne){(ne==null||ne>ie.length)&&(ne=ie.length);for(var L=0,B=new Array(ne);L<ne;L++)B[L]=ie[L];return B}var yt=30;function ft(ie){var ne=ie.characterSet,L=ie.getFontWidth,B=ie.fontHeight,ce=ie.buffer,Ae=ie.maxCanvasWidth,_t=ie.mapping,Rt=_t===void 0?{}:_t,wt=ie.xOffset,hr=wt===void 0?0:wt,Xr=ie.yOffset,Qn=Xr===void 0?0:Xr,Wn=0,fi=hr;Array.from(ne).forEach(function(Li,oa){if(!Rt[Li]){var pa=L(Li,oa);fi+yt>Ae&&(fi=0,Wn++),Rt[Li]={x:fi,y:Qn+Wn*yt,width:yt,height:yt,advance:pa},fi+=yt}});var mi=B+ce*2;return{mapping:Rt,xOffset:fi,yOffset:Qn+Wn*mi,canvasHeight:nr(Qn+(Wn+1)*mi)}}function sr(ie,ne,L){var B=0,ce=0,Ae=0,_t=[],Rt={},wt=Lt(ie),hr;try{for(wt.s();!(hr=wt.n()).done;){var Xr=hr.value;if(!Rt[Xr.id]){var Qn=Xr.size;B+Qn+ne>L&&(re(Rt,_t,ce),B=0,ce=Ae+ce+ne,Ae=0,_t=[]),_t.push({icon:Xr,xOffset:B}),B=B+Qn+ne,Ae=Math.max(Ae,Qn)}}}catch(fi){wt.e(fi)}finally{wt.f()}_t.length>0&&re(Rt,_t,ce);var Wn=nr(Ae+ce+ne);return{mapping:Rt,canvasHeight:Wn}}function re(ie,ne,L){var B=Lt(ne),ce;try{for(B.s();!(ce=B.n()).done;){var Ae=ce.value,_t=Ae.icon,Rt=Ae.xOffset;ie[_t.id]=zt(zt({},_t),{},{x:Rt,y:L,image:_t.image,width:_t.width,height:_t.height})}}catch(wt){B.e(wt)}finally{B.f()}}function nr(ie){return Math.pow(2,Math.ceil(Math.log2(ie)))}var Tt,$e;function Mt(ie,ne){var L=typeof Symbol!="undefined"&&ie[Symbol.iterator]||ie["@@iterator"];if(!L){if(Array.isArray(ie)||(L=Ve(ie))||ne&&ie&&typeof ie.length=="number"){L&&(ie=L);var B=0,ce=function(){};return{s:ce,n:function(){return B>=ie.length?{done:!0}:{done:!1,value:ie[B++]}},e:function(hr){throw hr},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,_t=!1,Rt;return{s:function(){L=L.call(ie)},n:function(){var hr=L.next();return Ae=hr.done,hr},e:function(hr){_t=!0,Rt=hr},f:function(){try{!Ae&&L.return!=null&&L.return()}finally{if(_t)throw Rt}}}}function Ve(ie,ne){if(!!ie){if(typeof ie=="string")return Ot(ie,ne);var L=Object.prototype.toString.call(ie).slice(8,-1);if(L==="Object"&&ie.constructor&&(L=ie.constructor.name),L==="Map"||L==="Set")return Array.from(ie);if(L==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(L))return Ot(ie,ne)}}function Ot(ie,ne){(ne==null||ne>ie.length)&&(ne=ie.length);for(var L=0,B=new Array(ne);L<ne;L++)B[L]=ie[L];return B}function pr(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function qt(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?pr(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):pr(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}var W=ur(),se="sans-serif",ke="normal",_e=24,Et=3,gt=.25,jt=8,Ut=1024,zr=1,dn=1,_n=3,Qi=null;function ur(){for(var ie=[],ne=32;ne<128;ne++)ie.push(String.fromCharCode(ne));return ie}function ge(ie,ne,L,B){ie.font="".concat(B," ").concat(L,"px ").concat(ne),ie.fillStyle="black",ie.textBaseline="middle"}function Pe(ie,ne){for(var L=0;L<ie.length;L++)ne.data[4*L+3]=ie[L]}var Ge=(Tt=(0,X.b2)(),Tt($e=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"fontAtlas",void 0),(0,Z.Z)(this,"iconFontMap",void 0),(0,Z.Z)(this,"iconFontGlyphs",{}),(0,Z.Z)(this,"fontOptions",void 0),(0,Z.Z)(this,"key",void 0),(0,Z.Z)(this,"cache",new Ie.z6(_n))}return(0,he.Z)(ie,[{key:"scale",get:function(){return dn}},{key:"canvas",get:function(){var L=this.cache.get(this.key);return L&&L.data}},{key:"mapping",get:function(){var L=this.cache.get(this.key);return L&&L.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:se,fontWeight:ke,characterSet:W,fontSize:_e,buffer:Et,sdf:!0,cutoff:gt,radius:jt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(L){var B=this;L.forEach(function(ce){B.iconFontGlyphs[ce.name]=ce.unicode})}},{key:"addIconFont",value:function(L,B){this.iconFontMap.set(L,B)}},{key:"getIconFontKey",value:function(L){return this.iconFontMap.get(L)||L}},{key:"getGlyph",value:function(L){return this.iconFontGlyphs[L]?String.fromCharCode(parseInt(this.iconFontGlyphs[L],16)):""}},{key:"setFontOptions",value:function(L){this.fontOptions=qt(qt({},this.fontOptions),L),this.key=this.getKey();var B=this.getNewChars(this.key,this.fontOptions.characterSet),ce=this.cache.get(this.key);if(!(ce&&B.length===0)){var Ae=this.generateFontAtlas(this.key,B,ce);this.fontAtlas=Ae,this.cache.set(this.key,Ae)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(L,B,ce){var Ae=this.fontOptions,_t=Ae.fontFamily,Rt=Ae.fontWeight,wt=Ae.fontSize,hr=Ae.buffer,Xr=Ae.sdf,Qn=Ae.radius,Wn=Ae.cutoff,fi=Ae.iconfont,mi=ce&&ce.data;mi||(mi=document.createElement("canvas"),mi.width=Ut);var Li=mi.getContext("2d");ge(Li,_t,wt,Rt);var oa=ft(qt({getFontWidth:function(Iu){return Li.measureText(Iu).width},fontHeight:wt*dn,buffer:hr,characterSet:B,maxCanvasWidth:Ut},ce&&{mapping:ce.mapping,xOffset:ce.xOffset,yOffset:ce.yOffset})),pa=oa.mapping,Sa=oa.canvasHeight,vo=oa.xOffset,wa=oa.yOffset,Fo=Li.getImageData(0,0,mi.width,mi.height);if(mi.height=Sa,Li.putImageData(Fo,0,0),ge(Li,_t,wt,Rt),Xr){var Fa=new(rt())(wt,hr,Qn,Wn,_t,Rt),ji=Li.getImageData(0,0,Fa.size,Fa.size),da=Mt(B),Ka;try{for(da.s();!(Ka=da.n()).done;){var mo=Ka.value;if(fi){var Mi=String.fromCharCode(parseInt(mo.replace("&#x","").replace(";",""),16)),ao=Fa.draw(Mi);Pe(ao,ji)}else Pe(Fa.draw(mo),ji);Li.putImageData(ji,pa[mo].x,pa[mo].y)}}catch(Bs){da.e(Bs)}finally{da.f()}}else{var Ga=Mt(B),Gs;try{for(Ga.s();!(Gs=Ga.n()).done;){var Zl=Gs.value;Li.fillText(Zl,pa[Zl].x,pa[Zl].y+wt*zr)}}catch(Bs){Ga.e(Bs)}finally{Ga.f()}}return{xOffset:vo,yOffset:wa,mapping:pa,data:mi,width:mi.width,height:mi.height}}},{key:"getKey",value:function(){return"key";var L,B,ce,Ae,_t,Rt,wt,hr}},{key:"getNewChars",value:function(L,B){var ce=this.cache.get(L);if(!ce)return B;var Ae=[],_t=ce.mapping,Rt=new Set(Object.keys(_t)),wt=new Set(B);return wt.forEach(function(hr){Rt.has(hr)||Ae.push(hr)}),Ae}}]),ie}())||$e),Re=y(63349),Nt=y(10379),ar=y(46070),yr=y(77608),Lr,fr;function Fr(ie){var ne=C();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var G=3,Ze=1024,tt=64,lt=(Lr=(0,X.b2)(),Lr(fr=function(ie){(0,Nt.Z)(L,ie);var ne=Fr(L);function L(){var B;(0,$.Z)(this,L);for(var ce=arguments.length,Ae=new Array(ce),_t=0;_t<ce;_t++)Ae[_t]=arguments[_t];return B=ne.call.apply(ne,[this].concat(Ae)),(0,Z.Z)((0,Re.Z)(B),"canvasHeight",128),(0,Z.Z)((0,Re.Z)(B),"texture",void 0),(0,Z.Z)((0,Re.Z)(B),"canvas",void 0),(0,Z.Z)((0,Re.Z)(B),"iconData",void 0),(0,Z.Z)((0,Re.Z)(B),"iconMap",void 0),(0,Z.Z)((0,Re.Z)(B),"ctx",void 0),(0,Z.Z)((0,Re.Z)(B),"loadingImageCount",0),B}return(0,he.Z)(L,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ce,Ae){var _t=this,Rt=new Image;if(this.loadingImageCount++,this.hasImage(ce))throw new Error("Image Id already exists");this.iconData.push({id:ce,size:tt}),this.updateIconMap(),this.loadImage(Ae).then(function(wt){Rt=wt;var hr=_t.iconData.find(function(Xr){return Xr.id===ce});hr&&(hr.image=Rt,hr.width=Rt.width,hr.height=Rt.height),_t.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ce){return this.iconMap.hasOwnProperty(ce)}},{key:"removeImage",value:function(ce){this.hasImage(ce)&&(this.iconData=this.iconData.filter(function(Ae){return Ae.id!==ce}),delete this.iconMap[ce],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ce=this;this.canvas.width=Ze,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(Ae){var _t=ce.iconMap[Ae],Rt=_t.x,wt=_t.y,hr=_t.image,Xr=_t.width,Qn=Xr===void 0?64:Xr,Wn=_t.height,fi=Wn===void 0?64:Wn,mi=Math.max(Qn,fi),Li=mi/tt,oa=fi/Li,pa=Qn/Li;hr&&ce.ctx.drawImage(hr,Rt+(tt-pa)/2,wt+(tt-oa)/2,pa,oa)})}},{key:"updateIconMap",value:function(){var ce=sr(this.iconData,G,Ze),Ae=ce.mapping,_t=ce.canvasHeight;this.iconMap=Ae,this.canvasHeight=_t}},{key:"loadImage",value:function(ce){return new Promise(function(Ae,_t){if(ce instanceof HTMLImageElement){Ae(ce);return}var Rt=new Image;Rt.crossOrigin="anonymous",Rt.onload=function(){Ae(Rt)},Rt.onerror=function(){_t(new Error("Could not load image at "+ce))},Rt.src=ce instanceof File?URL.createObjectURL(ce):ce})}}]),L}(b.EventEmitter))||fr),Pt=y(28481),q=y(85975),kt,Er,Mr=(kt=(0,X.b2)(),kt(Er=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"viewport",void 0),(0,Z.Z)(this,"overridedViewProjectionMatrix",void 0),(0,Z.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,Z.Z)(this,"jitteredProjectionMatrix",void 0),(0,Z.Z)(this,"viewMatrixInverse",void 0),(0,Z.Z)(this,"cameraPosition",void 0)}return(0,he.Z)(ie,[{key:"init",value:function(){}},{key:"update",value:function(L){this.viewport=L,this.viewMatrixInverse=q.create(),q.invert(this.viewMatrixInverse,L.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var L=this.viewport.getCenter(),B=(0,Pt.Z)(L,2),ce=B[0],Ae=B[1];return[ce,Ae]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(L,B){return this.viewport.projectFlat(L,B)}},{key:"setViewProjectionMatrix",value:function(L){this.overridedViewProjectionMatrix=L}},{key:"jitterProjectionMatrix",value:function(L,B){var ce=q.fromTranslation(q.create(),[L,B,0]);this.jitteredProjectionMatrix=q.multiply(q.create(),ce,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=q.multiply(q.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),ie}())||Er),Je,ct;function It(ie,ne){var L=typeof Symbol!="undefined"&&ie[Symbol.iterator]||ie["@@iterator"];if(!L){if(Array.isArray(ie)||(L=Bt(ie))||ne&&ie&&typeof ie.length=="number"){L&&(ie=L);var B=0,ce=function(){};return{s:ce,n:function(){return B>=ie.length?{done:!0}:{done:!1,value:ie[B++]}},e:function(hr){throw hr},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,_t=!1,Rt;return{s:function(){L=L.call(ie)},n:function(){var hr=L.next();return Ae=hr.done,hr},e:function(hr){_t=!0,Rt=hr},f:function(){try{!Ae&&L.return!=null&&L.return()}finally{if(_t)throw Rt}}}}function Bt(ie,ne){if(!!ie){if(typeof ie=="string")return br(ie,ne);var L=Object.prototype.toString.call(ie).slice(8,-1);if(L==="Object"&&ie.constructor&&(L=ie.constructor.name),L==="Map"||L==="Set")return Array.from(ie);if(L==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(L))return br(ie,ne)}}function br(ie,ne){(ne==null||ne>ie.length)&&(ne=ie.length);for(var L=0,B=new Array(ne);L<ne;L++)B[L]=ie[L];return B}var Tr=(Je=(0,X.b2)(),Je(ct=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"container",void 0),(0,Z.Z)(this,"controlCorners",void 0),(0,Z.Z)(this,"controlContainer",void 0),(0,Z.Z)(this,"scene",void 0),(0,Z.Z)(this,"mapsService",void 0),(0,Z.Z)(this,"controls",[]),(0,Z.Z)(this,"unAddControls",[])}return(0,he.Z)(ie,[{key:"init",value:function(L,B){this.container=L.container,this.scene=B,this.mapsService=B.get(Y.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(L,B){var ce=B.get(Y.v.IMapService);ce.map?(L.addTo(this.scene),this.controls.push(L)):this.unAddControls.push(L)}},{key:"getControlByName",value:function(L){return this.controls.find(function(B){return B.controlOption.name===L})}},{key:"removeControl",value:function(L){var B=this.controls.indexOf(L);return B>-1&&this.controls.splice(B,1),L.remove(),this}},{key:"addControls",value:function(){var L=this;this.unAddControls.forEach(function(B){B.addTo(L.scene),L.controls.push(B)}),this.unAddControls=[]}},{key:"destroy",value:function(){var L=It(this.controls),B;try{for(L.s();!(B=L.n()).done;){var ce=B.value;ce.remove()}}catch(Ae){L.e(Ae)}finally{L.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var L=this.controlCorners={},B="l7-",ce=this.controlContainer=Ie.SO.create("div",B+"control-container",this.container);function Ae(){var _t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Rt=_t.map(function(wt){return B+wt}).join(" ");L[_t.join("")]=Ie.SO.create("div",Rt,ce)}Ae(["top","left"]),Ae(["top","right"]),Ae(["bottom","left"]),Ae(["bottom","right"]),Ae(["top","center"]),Ae(["right","center"]),Ae(["left","center"]),Ae(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var L in this.controlCorners)this.controlCorners[L]&&Ie.SO.remove(this.controlCorners[L]);this.controlContainer&&Ie.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),ie}())||ct),qe,Gr,Yr=(qe=(0,X.b2)(),qe(Gr=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"container",void 0),(0,Z.Z)(this,"scene",void 0),(0,Z.Z)(this,"mapsService",void 0),(0,Z.Z)(this,"markers",[]),(0,Z.Z)(this,"markerLayers",[]),(0,Z.Z)(this,"unAddMarkers",[]),(0,Z.Z)(this,"unAddMarkerLayers",[])}return(0,he.Z)(ie,[{key:"addMarkerLayer",value:function(L){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(L),L.addTo(this.scene)):this.unAddMarkerLayers.push(L)}},{key:"removeMarkerLayer",value:function(L){L.destroy(),this.markerLayers.indexOf(L);var B=this.markerLayers.indexOf(L);B>-1&&this.markerLayers.splice(B,1)}},{key:"addMarker",value:function(L){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(L),L.addTo(this.scene)):this.unAddMarkers.push(L)}},{key:"addMarkers",value:function(){var L=this;this.unAddMarkers.forEach(function(B){B.addTo(L.scene),L.markers.push(B)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var L=this;this.unAddMarkerLayers.forEach(function(B){L.markerLayers.push(B),B.addTo(L.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(L){L.remove(),this.markers.indexOf(L);var B=this.markers.indexOf(L);B>-1&&this.markers.splice(B,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(L){this.scene=L,this.mapsService=L.get(Y.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(L){L.remove()}),this.markers=[],this.markerLayers.forEach(function(L){L.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(L){L.destroy()}}]),ie}())||Gr),An,vr,Or=(An=(0,X.b2)(),An(vr=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"scene",void 0),(0,Z.Z)(this,"popup",void 0),(0,Z.Z)(this,"mapsService",void 0),(0,Z.Z)(this,"unAddPopup",void 0)}return(0,he.Z)(ie,[{key:"removePopup",value:function(L){L.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(L){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(L.addTo(this.scene),this.popup=L):this.unAddPopup=L}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(L){this.scene=L,this.mapsService=L.get(Y.v.IMapService)}}]),ie}())||vr),St=y(82492),Kn=y.n(St),Ln={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Ur=Ln,ee,fe;function me(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function N(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?me(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):me(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}var ae={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},de={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Te=(ee=(0,X.b2)(),ee(fe=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"sceneConfigCache",{}),(0,Z.Z)(this,"layerConfigCache",{})}return(0,he.Z)(ie,[{key:"getSceneConfig",value:function(L){return this.sceneConfigCache[L]}},{key:"getSceneWarninfo",value:function(L){return Ur[L]}},{key:"setSceneConfig",value:function(L,B){this.sceneConfigCache[L]=N(N({},ae),B)}},{key:"getLayerConfig",value:function(L){return this.layerConfigCache[L]}},{key:"setLayerConfig",value:function(L,B,ce){this.layerConfigCache[B]=N({},Kn()({},this.sceneConfigCache[L],de,ce))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),ie}())||fe),ue=y(55770),xe=y(3473),pt=y(98333),Cr=Math.PI/180,Kt=512,rr=4003e4;function Zr(ie){var ne=ie.latitude,L=ne===void 0?0:ne,B=ie.zoom,ce=B===void 0?0:B,Ae=ie.scale,_t=ie.highPrecision,Rt=_t===void 0?!1:_t,wt=ie.flipY,hr=wt===void 0?!1:wt;Ae=Ae!==void 0?Ae:Math.pow(2,ce);var Xr={},Qn=Kt*Ae,Wn=Math.cos(L*Cr),fi=Qn/360,mi=fi/Wn,Li=Qn/rr/Wn;if(Xr.pixelsPerMeter=[Li,-Li,Li],Xr.metersPerPixel=[1/Li,-1/Li,1/Li],Xr.pixelsPerDegree=[fi,-mi,Li],Xr.degreesPerPixel=[1/fi,-1/mi,1/Li],Rt){var oa=Cr*Math.tan(L*Cr)/Wn,pa=fi*oa/2,Sa=Qn/rr*oa,vo=Sa/mi*Li;Xr.pixelsPerDegree2=[0,-pa,Sa],Xr.pixelsPerMeter2=[vo,0,vo],hr&&(Xr.pixelsPerDegree2[1]=-Xr.pixelsPerDegree2[1],Xr.pixelsPerMeter2[1]=-Xr.pixelsPerMeter2[1])}return hr&&(Xr.pixelsPerMeter[1]=-Xr.pixelsPerMeter[1],Xr.metersPerPixel[1]=-Xr.metersPerPixel[1],Xr.pixelsPerDegree[1]=-Xr.pixelsPerDegree[1],Xr.degreesPerPixel[1]=-Xr.degreesPerPixel[1]),Xr}var Nn=y(47282),Bn,tr,In,hn,yn,Ni=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Tn=(Bn=(0,X.b2)(),tr=(0,X.f3)(Y.v.ICameraService),Bn(In=(hn=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"needRefresh",!0),(0,ue.Z)(this,"cameraService",yn,this),(0,Z.Z)(this,"coordinateSystem",void 0),(0,Z.Z)(this,"viewportCenter",void 0),(0,Z.Z)(this,"viewportCenterProjection",void 0),(0,Z.Z)(this,"pixelsPerDegree",void 0),(0,Z.Z)(this,"pixelsPerDegree2",void 0),(0,Z.Z)(this,"pixelsPerMeter",void 0)}return(0,he.Z)(ie,[{key:"refresh",value:function(){var L=this.cameraService.getZoom(),B=this.cameraService.getZoomScale(),ce=this.cameraService.getCenter(),Ae=Zr({latitude:ce[1],zoom:L}),_t=Ae.pixelsPerMeter,Rt=Ae.pixelsPerDegree;this.viewportCenter=ce,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=_t,this.pixelsPerDegree=Rt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Nn.l.LNGLAT||this.coordinateSystem===Nn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Nn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ce,L):this.coordinateSystem===Nn.l.P20_OFFSET&&this.calculateLnglatOffset(ce,L,B,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(L){this.coordinateSystem=L}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(L,B,ce,Ae){var _t=Zr({latitude:L[1],zoom:B,scale:ce,flipY:Ae,highPrecision:!0}),Rt=_t.pixelsPerMeter,wt=_t.pixelsPerDegree,hr=_t.pixelsPerDegree2,Xr=this.cameraService.getViewMatrix(),Qn=this.cameraService.getProjectionMatrix(),Wn=q.multiply([],Qn,Xr),fi=this.cameraService.projectFlat([Math.fround(L[0]),Math.fround(L[1])],Math.pow(2,B));this.viewportCenterProjection=pt.fF([],[fi[0],fi[1],0,1],Wn),Xr=this.cameraService.getViewMatrixUncentered()||Xr,Wn=q.multiply([],Qn,Xr),Wn=q.multiply([],Wn,Ni),this.cameraService.setViewProjectionMatrix(Wn),this.pixelsPerMeter=Rt,this.pixelsPerDegree=wt,this.pixelsPerDegree2=hr}}]),ie}(),yn=(0,xe.Z)(hn.prototype,"cameraService",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hn))||In),Di=y(50840),ra=y.n(Di),hi=y(89648),na,Xi,Ii,ma,Da;function Yi(ie){var ne=zi();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function zi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Ki={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},to=(na=(0,X.b2)(),Xi=(0,X.f3)(Y.v.IMapService),na(Ii=(ma=function(ie){(0,Nt.Z)(L,ie);var ne=Yi(L);function L(){var B;(0,$.Z)(this,L);for(var ce=arguments.length,Ae=new Array(ce),_t=0;_t<ce;_t++)Ae[_t]=arguments[_t];return B=ne.call.apply(ne,[this].concat(Ae)),(0,ue.Z)((0,Re.Z)(B),"mapService",Da,(0,Re.Z)(B)),(0,Z.Z)((0,Re.Z)(B),"hammertime",void 0),(0,Z.Z)((0,Re.Z)(B),"lastClickTime",0),(0,Z.Z)((0,Re.Z)(B),"lastClickXY",[-1,-1]),(0,Z.Z)((0,Re.Z)(B),"clickTimer",void 0),(0,Z.Z)((0,Re.Z)(B),"$containter",void 0),(0,Z.Z)((0,Re.Z)(B),"onDrag",function(Rt){var wt=B.interactionEvent(Rt);wt.type=Ki[wt.type],B.emit(hi.s.Drag,wt)}),(0,Z.Z)((0,Re.Z)(B),"onHammer",function(Rt){Rt.srcEvent.stopPropagation();var wt=B.interactionEvent(Rt);B.emit(hi.s.Hover,wt)}),(0,Z.Z)((0,Re.Z)(B),"onTouch",function(Rt){var wt=Rt.touches[0];B.onHover({x:wt.pageX,y:wt.pageY,type:"touch"})}),(0,Z.Z)((0,Re.Z)(B),"onHover",function(Rt){var wt=Rt.clientX,hr=Rt.clientY,Xr=wt,Qn=hr,Wn=Rt.type,fi=B.mapService.getMapContainer();if(fi){var mi=fi.getBoundingClientRect(),Li=mi.top,oa=mi.left;Xr=Xr-oa-fi.clientLeft,Qn=Qn-Li-fi.clientTop}var pa=B.mapService.containerToLngLat([Xr,Qn]);if(Wn==="click"){if("ontouchstart"in document.documentElement)return;B.isDoubleTap(Xr,Qn,pa);return}if(Wn==="touch"){B.isDoubleTap(Xr,Qn,pa);return}Wn!=="click"&&Wn!=="dblclick"&&B.emit(hi.s.Hover,{x:Xr,y:Qn,lngLat:pa,type:Wn,target:Rt})}),B}return(0,he.Z)(L,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(hi.s.Hover)}},{key:"triggerHover",value:function(ce){var Ae=ce.x,_t=ce.y;this.emit(hi.s.Hover,{x:Ae,y:_t})}},{key:"triggerSelect",value:function(ce){this.emit(hi.s.Select,{featureId:ce})}},{key:"triggerActive",value:function(ce){this.emit(hi.s.Active,{featureId:ce})}},{key:"addEventListenerOnMap",value:function(){var ce=this.mapService.getMapContainer();if(ce){var Ae=new(ra()).Manager(ce);Ae.add(new(ra()).Tap({event:"dblclick",taps:2})),Ae.add(new(ra()).Tap({event:"click"})),Ae.add(new(ra()).Pan({threshold:0,pointers:0})),Ae.add(new(ra()).Press({})),Ae.on("dblclick click",this.onHammer),Ae.on("panstart panmove panend pancancel",this.onDrag),ce.addEventListener("mousemove",this.onHover),ce.addEventListener("mousedown",this.onHover,!0),ce.addEventListener("mouseup",this.onHover),ce.addEventListener("contextmenu",this.onHover),this.hammertime=Ae}}},{key:"removeEventListenerOnMap",value:function(){var ce=this.mapService.getMapContainer();ce&&(ce.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ce.removeEventListener("mousedown",this.onHover),ce.removeEventListener("mouseup",this.onHover),ce.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ce){var Ae=ce.type,_t=ce.pointerType,Rt,wt;_t==="touch"?(wt=Math.floor(ce.pointers[0].clientY),Rt=Math.floor(ce.pointers[0].clientX)):(wt=Math.floor(ce.srcEvent.y),Rt=Math.floor(ce.srcEvent.x));var hr=this.mapService.getMapContainer();if(hr){var Xr=hr.getBoundingClientRect(),Qn=Xr.top,Wn=Xr.left;Rt-=Wn,wt-=Qn}var fi=this.mapService.containerToLngLat([Rt,wt]);return{x:Rt,y:wt,lngLat:fi,type:Ae,target:ce.srcEvent}}},{key:"isDoubleTap",value:function(ce,Ae,_t){var Rt=this,wt=new Date().getTime(),hr="click";wt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ce)<10&&Math.abs(this.lastClickXY[1]-Ae)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),hr="dblclick",this.emit(hi.s.Hover,{x:ce,y:Ae,lngLat:_t,type:hr})):(this.lastClickTime=wt,this.lastClickXY=[ce,Ae],this.clickTimer=setTimeout(function(){hr="click",Rt.emit(hi.s.Hover,{x:ce,y:Ae,lngLat:_t,type:hr})},400))}}]),L}(p()),Da=(0,xe.Z)(ma.prototype,"mapService",[Xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ma))||Ii),$o=y(92137),Ba=y(87757),qi=y.n(Ba),su=window.document.documentElement.style,Au=0;function $i(ie){var ne=ie;if(typeof ie=="string"&&(ne=document.getElementById(ie)),ne){var L=document.createElement("div");return L.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,L.id="l7-scene-".concat(Au++),L.classList.add("l7-scene"),ne.appendChild(L),L}return null}function yo(ie){var ne,L,B=!0;return ie==null||(ne=ie.target)===null||ne===void 0||(L=ne.path)===null||L===void 0||L.map(function(ce){if(ce!=null&&ce.classList){var Ae;ce==null||(Ae=ce.classList)===null||Ae===void 0||Ae.forEach(function(_t){(_t==="l7-marker"||_t==="l7-popup")&&(B=!1)})}}),B}var Ji=y(7648),Wa,Jo,ba,Lo,Ro,Rs,ho,Vo,ka,so,as;function Do(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Ee(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?Do(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):Do(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}var Be=(Wa=(0,X.b2)(),Jo=(0,X.f3)(Y.v.IRendererService),ba=(0,X.f3)(Y.v.IGlobalConfigService),Lo=(0,X.f3)(Y.v.IInteractionService),Ro=(0,X.f3)(Y.v.ILayerService),Wa(Rs=(ho=function(){function ie(){var ne=this;(0,$.Z)(this,ie),(0,ue.Z)(this,"rendererService",Vo,this),(0,ue.Z)(this,"configService",ka,this),(0,ue.Z)(this,"interactionService",so,this),(0,ue.Z)(this,"layerService",as,this),(0,Z.Z)(this,"pickingFBO",void 0),(0,Z.Z)(this,"width",0),(0,Z.Z)(this,"height",0),(0,Z.Z)(this,"alreadyInPicking",!1),(0,Z.Z)(this,"pickBufferScale",1),(0,Z.Z)(this,"pickFromPickingFBO",function(L,B){var ce,Ae=B.x,_t=B.y,Rt=B.lngLat,wt=B.type,hr=B.target,Xr=!1,Qn=ne.rendererService,Wn=Qn.getViewportSize,fi=Qn.readPixels,mi=Qn.getContainer,Li=mi().getBoundingClientRect(),oa=Li.width,pa=Li.height;oa*=Ie.SO.DPR,pa*=Ie.SO.DPR;var Sa=L.getLayerConfig(),vo=Sa.enableHighlight,wa=Sa.enableSelect,Fo=Ae*Ie.SO.DPR,Fa=_t*Ie.SO.DPR;if(Fo>oa-1*Ie.SO.DPR||Fo<0||Fa>pa-1*Ie.SO.DPR||Fa<0)return!1;var ji;if(ji=fi({x:Math.floor(Fo/ne.pickBufferScale),y:Math.floor((pa-(_t+1)*Ie.SO.DPR)/ne.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:ne.pickingFBO}),ji[0]!==0||ji[1]!==0||ji[2]!==0){var da=(0,Ie.W0)(ji),Ka=L.getSource().getFeatureById(da);da!==L.getCurrentPickId()&&wt==="mousemove"&&(wt="mouseenter");var mo={x:Ae,y:_t,type:wt,lngLat:Rt,featureId:da,feature:Ka,target:hr};Ka&&(Xr=!0,L.setCurrentPickId(da),ne.triggerHoverOnLayer(L,mo))}else{var Mi={x:Ae,y:_t,lngLat:Rt,type:L.getCurrentPickId()!==null&&wt==="mousemove"?"mouseout":"un"+wt,featureId:null,target:hr,feature:null};ne.triggerHoverOnLayer(L,Ee(Ee({},Mi),{},{type:"unpick"})),ne.triggerHoverOnLayer(L,Mi),L.setCurrentPickId(null)}if(vo&&ne.highlightPickedFeature(L,ji),wa&&wt==="click"&&((ce=ji)===null||ce===void 0?void 0:ce.toString())!==[0,0,0,0].toString()){var ao=(0,Ie.W0)(ji);L.getCurrentSelectedId()===null||ao!==L.getCurrentSelectedId()?(ne.selectFeature(L,ji),L.setCurrentSelectedId(ao)):(ne.selectFeature(L,new Uint8Array([0,0,0,0])),L.setCurrentSelectedId(null))}return Xr})}return(0,he.Z)(ie,[{key:"init",value:function(L){var B=this.rendererService,ce=B.createTexture2D,Ae=B.createFramebuffer,_t=B.getViewportSize,Rt=B.getContainer,wt=Rt().getBoundingClientRect(),hr=wt.width,Xr=wt.height;hr*=Ie.SO.DPR,Xr*=Ie.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(L).pickBufferScale||1,this.pickingFBO=Ae({color:ce({width:Math.round(hr/this.pickBufferScale),height:Math.round(Xr/this.pickBufferScale),wrapS:Ji.gl.CLAMP_TO_EDGE,wrapT:Ji.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var ne=(0,$o.Z)(qi().mark(function B(ce,Ae,_t){var Rt=this,wt,hr,Xr,Qn;return qi().wrap(function(fi){for(;;)switch(fi.prev=fi.next){case 0:wt=this.rendererService,hr=wt.useFramebuffer,Xr=wt.clear,Qn=wt.getContainer,this.resizePickingFBO(),hr(this.pickingFBO,function(){Xr({framebuffer:Rt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ce.hooks.beforePickingEncode.call(),ce.renderModels(),ce.hooks.afterPickingEncode.call();var mi=Rt.pickBox(ce,Ae);_t(mi)});case 3:case"end":return fi.stop()}},B,this)}));function L(B,ce,Ae){return ne.apply(this,arguments)}return L}()},{key:"pickBox",value:function(L,B){var ce=this,Ae=B.map(function(Mi){var ao=Mi<0?0:Mi;return Math.floor(ao*Ie.SO.DPR/ce.pickBufferScale)}),_t=(0,Pt.Z)(Ae,4),Rt=_t[0],wt=_t[1],hr=_t[2],Xr=_t[3],Qn=this.rendererService,Wn=Qn.getViewportSize,fi=Qn.readPixels,mi=Qn.getContainer,Li=mi().getBoundingClientRect(),oa=Li.width,pa=Li.height;if(oa*=Ie.SO.DPR,pa*=Ie.SO.DPR,Rt>(oa-1)*Ie.SO.DPR/this.pickBufferScale||hr<0||wt>(pa-1)*Ie.SO.DPR/this.pickBufferScale||Xr<0)return[];var Sa,vo=Math.min(oa/this.pickBufferScale,hr)-Rt,wa=Math.min(pa/this.pickBufferScale,Xr)-wt;Sa=fi({x:Rt,y:Math.floor(pa/this.pickBufferScale-(Xr+1)),width:vo,height:wa,data:new Uint8Array(vo*wa*4),framebuffer:this.pickingFBO});for(var Fo=[],Fa={},ji=0;ji<Sa.length/4;ji=ji+1){var da=Sa.slice(ji*4,ji*4+4),Ka=(0,Ie.W0)(da);if(Ka!==-1&&!Fa[Ka]){var mo=L.getSource().getFeatureById(Ka);Fo.push(mo),Fa[Ka]=!0}}return Fo}},{key:"pickingAllLayer",value:function(){var ne=(0,$o.Z)(qi().mark(function B(ce){return qi().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){_t.next=2;break}return _t.abrupt("return");case 2:return this.alreadyInPicking=!0,_t.next=5,this.pickingLayers(ce);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return _t.stop()}},B,this)}));function L(B){return ne.apply(this,arguments)}return L}()},{key:"resizePickingFBO",value:function(){var L=this.rendererService.getContainer,B=L().getBoundingClientRect(),ce=B.width,Ae=B.height;ce*=Ie.SO.DPR,Ae*=Ie.SO.DPR,(this.width!==ce||this.height!==Ae)&&(this.pickingFBO.resize({width:Math.round(ce/this.pickBufferScale),height:Math.round(Ae/this.pickBufferScale)}),this.width=ce,this.height=Ae)}},{key:"pickingLayers",value:function(){var ne=(0,$o.Z)(qi().mark(function B(ce){var Ae=this,_t,Rt,wt,hr,Xr;return qi().wrap(function(Wn){for(;;)switch(Wn.prev=Wn.next){case 0:_t=this.rendererService,Rt=_t.getViewportSize,wt=_t.useFramebuffer,hr=_t.clear,Xr=_t.getContainer,this.resizePickingFBO(),wt(this.pickingFBO,function(){var fi=Ae.layerService.getLayers();fi.filter(function(mi){return mi.needPick(ce.type)}).reverse().some(function(mi){hr({framebuffer:Ae.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),mi.hooks.beforePickingEncode.call(),mi.renderModels(),mi.hooks.afterPickingEncode.call();var Li=Ae.pickFromPickingFBO(mi,ce);return Li&&!mi.getLayerConfig().enablePropagation})});case 3:case"end":return Wn.stop()}},B,this)}));function L(B){return ne.apply(this,arguments)}return L}()},{key:"triggerHoverOnLayer",value:function(L,B){yo(B)&&L.emit(B.type,B)}},{key:"highlightPickedFeature",value:function(L,B){var ce=(0,Pt.Z)(B,3),Ae=ce[0],_t=ce[1],Rt=ce[2];L.hooks.beforeHighlight.call([Ae,_t,Rt])}},{key:"selectFeature",value:function(L,B){var ce=(0,Pt.Z)(B,3),Ae=ce[0],_t=ce[1],Rt=ce[2];L.hooks.beforeSelect.call([Ae,_t,Rt])}}]),ie}(),Vo=(0,xe.Z)(ho.prototype,"rendererService",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka=(0,xe.Z)(ho.prototype,"configService",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=(0,xe.Z)(ho.prototype,"interactionService",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),as=(0,xe.Z)(ho.prototype,"layerService",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho))||Rs),mt=function(){function ie(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,$.Z)(this,ie),(0,Z.Z)(this,"autoStart",void 0),(0,Z.Z)(this,"startTime",0),(0,Z.Z)(this,"oldTime",0),(0,Z.Z)(this,"running",!1),(0,Z.Z)(this,"elapsedTime",0),this.autoStart=ne}return(0,he.Z)(ie,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var L=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var B=(typeof performance=="undefined"?Date:performance).now();L=(B-this.oldTime)/1e3,this.oldTime=B,this.elapsedTime+=L}return L}}]),ie}(),R,qr,oi,Ai,uo,Xa,ja,os,uu,Tu=(R=(0,X.b2)(),qr=(0,X.f3)(Y.v.IRendererService),oi=(0,X.f3)(Y.v.IMapService),Ai=(0,X.f3)(Y.v.IGlobalConfigService),R(uo=(Xa=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"clock",new mt),(0,Z.Z)(this,"alreadyInRendering",!1),(0,Z.Z)(this,"layers",[]),(0,Z.Z)(this,"layerRenderID",void 0),(0,Z.Z)(this,"sceneInited",!1),(0,Z.Z)(this,"animateInstanceCount",0),(0,Z.Z)(this,"lastRenderType",void 0),(0,Z.Z)(this,"lastPickRenderTime",void 0),(0,ue.Z)(this,"renderService",ja,this),(0,ue.Z)(this,"mapService",os,this),(0,ue.Z)(this,"configService",uu,this)}return(0,he.Z)(ie,[{key:"add",value:function(L){this.sceneInited&&L.init(),this.layers.push(L)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(L){L.inited||L.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(L){return this.layers.find(function(B){return B.id===L})}},{key:"getLayerByName",value:function(L){return this.layers.find(function(B){return B.name===L})}},{key:"remove",value:function(L){var B=this.layers.indexOf(L);B>-1&&this.layers.splice(B,1),L.emit("remove",null),L.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(L){!this.renderTest(L)||this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(B){return B.inited}).filter(function(B){return B.isVisible()}).forEach(function(B){B.hooks.beforeRenderData.call(),B.hooks.beforeRender.call(),B.render(),B.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(L,B){return L.zIndex-B.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(L){return L.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"renderTest",value:function(L){var B=new Date().getTime(),ce=B-this.lastPickRenderTime;if(L==="picking"&&(this.lastPickRenderTime=new Date().getTime()),L)switch(L){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",ce>48):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){var L=(0,Ie.CI)(this.mapService.bgColor);this.renderService.clear({color:L,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers("animate"),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),ie}(),ja=(0,xe.Z)(Xa.prototype,"renderService",[qr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=(0,xe.Z)(Xa.prototype,"mapService",[oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uu=(0,xe.Z)(Xa.prototype,"configService",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa))||uo),Ku=y(81253),Qo=y(85061),qo=y(14293),ss=y.n(qo),ws=function(){function ie(ne){var L=this;(0,$.Z)(this,ie),(0,Z.Z)(this,"name",void 0),(0,Z.Z)(this,"type",void 0),(0,Z.Z)(this,"scale",void 0),(0,Z.Z)(this,"descriptor",void 0),(0,Z.Z)(this,"featureBufferLayout",[]),(0,Z.Z)(this,"needRescale",!1),(0,Z.Z)(this,"needRemapping",!1),(0,Z.Z)(this,"needRegenerateVertices",!1),(0,Z.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,Z.Z)(this,"vertexAttribute",void 0),(0,Z.Z)(this,"defaultCallback",function(B){if(B.length===0){var ce;return((ce=L.scale)===null||ce===void 0?void 0:ce.defaultValues)||[]}return B.map(function(Ae,_t){var Rt,wt=(Rt=L.scale)===null||Rt===void 0?void 0:Rt.scalers[_t].func,hr=wt(Ae);return hr})}),this.setProps(ne)}return(0,he.Z)(ie,[{key:"setProps",value:function(L){Object.assign(this,L)}},{key:"mapping",value:function(L){var B;if((B=this.scale)!==null&&B!==void 0&&B.callback){var ce,Ae=(ce=this.scale)===null||ce===void 0?void 0:ce.callback.apply(ce,(0,Qo.Z)(L));if(!ss()(Ae))return[Ae]}return this.defaultCallback(L)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),ie}(),us,zs,Xs,As,Ca,Co;function vl(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function ml(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?vl(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):vl(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function $u(ie){return new Promise(function(ne){return setTimeout(ne,ie)})}var Jl=(us={},(0,Z.Z)(us,Ji.gl.FLOAT,4),(0,Z.Z)(us,Ji.gl.UNSIGNED_BYTE,1),(0,Z.Z)(us,Ji.gl.UNSIGNED_SHORT,2),us),gl=(zs=(0,X.b2)(),Xs=(0,X.f3)(Y.v.IRendererService),zs(As=(Ca=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"attributesAndIndices",void 0),(0,ue.Z)(this,"rendererService",Co,this),(0,Z.Z)(this,"attributes",[]),(0,Z.Z)(this,"triangulation",void 0),(0,Z.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,he.Z)(ie,[{key:"registerStyleAttribute",value:function(L){var B=this.getLayerStyleAttribute(L.name||"");return B?B.setProps(L):(B=new ws(L),this.attributes.push(B)),B}},{key:"updateStyleAttribute",value:function(L,B,ce){var Ae=this.getLayerStyleAttribute(L);Ae||(Ae=this.registerStyleAttribute(ml(ml({},B),{},{name:L})));var _t=B.scale;_t&&Ae&&(Ae.scale=_t,Ae.needRescale=!0,Ae.needRemapping=!0,Ae.needRegenerateVertices=!0,ce&&ce.featureRange&&(Ae.featureRange=ce.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(L){return this.attributes.find(function(B){return B.name===L})}},{key:"getLayerAttributeScale",value:function(L){var B,ce=this.getLayerStyleAttribute(L),Ae=ce==null||(B=ce.scale)===null||B===void 0?void 0:B.scalers;return Ae&&Ae[0]?Ae[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(L,B){var ce=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Ae=arguments.length>3?arguments[3]:void 0,_t=this.attributes.find(function(wa){return wa.name===L});if(_t&&_t.descriptor){var Rt=_t.descriptor,wt=Rt.update,hr=Rt.buffer,Xr=Rt.size,Qn=Xr===void 0?0:Xr,Wn=Jl[hr.type||Ji.gl.FLOAT];if(wt){var fi=this.featureLayout,mi=fi.elements,Li=fi.sizePerElement,oa=mi.slice(ce,Ae);if(!oa.length)return;var pa=oa[0].offset,Sa=pa*Qn*Wn,vo=oa.map(function(wa,Fo){for(var Fa=wa.featureIdx,ji=wa.vertices,da=wa.normals,Ka=ji.length/Li,mo=[],Mi=0;Mi<Ka;Mi++){var ao=da?da.slice(Mi*3,Mi*3+3):[];mo.push.apply(mo,(0,Qo.Z)(wt(B[Fa],Fa,ji.slice(Mi*Li,Mi*Li+Li),Fo,ao)))}return mo}).reduce(function(wa,Fo){return wa.push.apply(wa,(0,Qo.Z)(Fo)),wa},[]);_t.vertexAttribute.updateBuffer({data:vo,offset:Sa})}}}},{key:"createAttributesAndIndices",value:function(L,B,ce){var Ae=this;this.featureLayout={sizePerElement:0,elements:[]},B&&(this.triangulation=B);var _t=this.attributes.map(function(Sa){return Sa.resetDescriptor(),Sa.descriptor}),Rt=0,wt=[],hr=[],Xr=[],Qn=3;L.forEach(function(Sa,vo){var wa=Ae.triangulation(Sa,ce),Fo=wa.indices,Fa=wa.vertices,ji=wa.normals,da=wa.size;Fo.forEach(function(ao){hr.push(ao+Rt)}),Qn=da;var Ka=Fa.length/da;Ae.featureLayout.sizePerElement=Qn,Ae.featureLayout.elements.push({featureIdx:vo,vertices:Fa,normals:ji,offset:Rt}),Rt+=Ka;for(var mo=function(Ga){var Gs=(ji==null?void 0:ji.slice(Ga*3,Ga*3+3))||[],Zl=Fa.slice(Ga*da,Ga*da+da);_t.forEach(function(Bs,Iu){if(Bs&&Bs.update){var Ou;(Ou=Bs.buffer.data).push.apply(Ou,(0,Qo.Z)(Bs.update(Sa,vo,Zl,Ga,Gs)))}})},Mi=0;Mi<Ka;Mi++)mo(Mi)});var Wn=this.rendererService,fi=Wn.createAttribute,mi=Wn.createBuffer,Li=Wn.createElements,oa={};_t.forEach(function(Sa,vo){if(Sa){var wa=Sa.buffer,Fo=Sa.update,Fa=Sa.name,ji=(0,Ku.Z)(Sa,["buffer","update","name"]),da=fi(ml({buffer:mi(wa)},ji));oa[Sa.name||""]=da,Ae.attributes[vo].vertexAttribute=da}});var pa=Li({data:hr,type:Ji.gl.UNSIGNED_INT,count:hr.length});return this.attributesAndIndices={attributes:oa,elements:pa},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var L;this.attributes.forEach(function(B){B.vertexAttribute&&B.vertexAttribute.destroy()}),(L=this.attributesAndIndices)===null||L===void 0||L.elements.destroy(),this.attributes=[]}}]),ie}(),Co=(0,xe.Z)(Ca.prototype,"rendererService",[Xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ca))||As),Lu=y(46343),Us=y(67709),yl=y.n(Us),m,w,j,I,pe,De,ht,Vt,Wt,kr,Kr,cn,Oi,Ei,ha,Pa,ga,_i,po,wo,Ys,lu,Ks,Ru,Go,ys,ro,Ia,$s,_l,_s,Dl,Js;function Qs(ie){var ne=yc();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Du=(m=(0,X.b2)(),w=(0,X.f3)(Y.v.SceneID),j=(0,X.f3)(Y.v.IIconService),I=(0,X.f3)(Y.v.IFontService),pe=(0,X.f3)(Y.v.IControlService),De=(0,X.f3)(Y.v.IGlobalConfigService),ht=(0,X.f3)(Y.v.IMapService),Vt=(0,X.f3)(Y.v.ICoordinateSystemService),Wt=(0,X.f3)(Y.v.IRendererService),kr=(0,X.f3)(Y.v.ILayerService),Kr=(0,X.f3)(Y.v.ICameraService),cn=(0,X.f3)(Y.v.IInteractionService),Oi=(0,X.f3)(Y.v.IPickingService),Ei=(0,X.f3)(Y.v.IShaderModuleService),ha=(0,X.f3)(Y.v.IMarkerService),Pa=(0,X.f3)(Y.v.IPopupService),m(ga=(_i=function(ie){(0,Nt.Z)(L,ie);var ne=Qs(L);function L(){var B;return(0,$.Z)(this,L),B=ne.call(this),(0,Z.Z)((0,Re.Z)(B),"destroyed",!1),(0,Z.Z)((0,Re.Z)(B),"loaded",!1),(0,Z.Z)((0,Re.Z)(B),"loadFont",!1),(0,Z.Z)((0,Re.Z)(B),"fontFamily",""),(0,ue.Z)((0,Re.Z)(B),"id",po,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"iconService",wo,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"fontService",Ys,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"controlService",lu,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"configService",Ks,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"map",Ru,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"coordinateSystemService",Go,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"rendererService",ys,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"layerService",ro,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"cameraService",Ia,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"interactionService",$s,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"pickingService",_l,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"shaderModuleService",_s,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"markerService",Dl,(0,Re.Z)(B)),(0,ue.Z)((0,Re.Z)(B),"popupService",Js,(0,Re.Z)(B)),(0,Z.Z)((0,Re.Z)(B),"inited",!1),(0,Z.Z)((0,Re.Z)(B),"initPromise",void 0),(0,Z.Z)((0,Re.Z)(B),"rendering",!1),(0,Z.Z)((0,Re.Z)(B),"$container",void 0),(0,Z.Z)((0,Re.Z)(B),"canvas",void 0),(0,Z.Z)((0,Re.Z)(B),"markerContainer",void 0),(0,Z.Z)((0,Re.Z)(B),"hooks",void 0),(0,Z.Z)((0,Re.Z)(B),"handleWindowResized",function(){B.emit("resize"),B.$container&&(B.initContainer(),Ie.SO.triggerResize(),B.coordinateSystemService.needRefresh=!0,B.render())}),(0,Z.Z)((0,Re.Z)(B),"handleMapCameraChanged",function(ce){B.cameraService.update(ce),B.render("mapRender")}),B.hooks={init:new Lu.zj},B}return(0,he.Z)(L,[{key:"init",value:function(ce){var Ae=this;this.configService.setSceneConfig(this.id,ce),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,$o.Z)(qi().mark(function _t(){return qi().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:return wt.next=2,new Promise(function(hr){Ae.map.onCameraChanged(function(Xr){Ae.cameraService.init(),Ae.cameraService.update(Xr),Ae.map.version!=="GAODE2.x"&&hr()}),Ae.map.version!=="GAODE2.x"?Ae.map.init():hr()});case 2:if(!(Ae.map.version==="GAODE2.x"&&Ae.map.initViewPort)){wt.next=6;break}return wt.next=5,Ae.map.init();case 5:Ae.map.initViewPort();case 6:Ae.map.onCameraChanged(Ae.handleMapCameraChanged),Ae.map.addMarkerContainer(),Ae.markerService.addMarkers(),Ae.markerService.addMarkerLayers(),Ae.popupService.initPopup(),Ae.interactionService.init(),Ae.interactionService.on(hi.s.Drag,Ae.addSceneEvent.bind(Ae));case 13:case"end":return wt.stop()}},_t)}))),this.hooks.init.tapPromise("initRenderer",(0,$o.Z)(qi().mark(function _t(){var Rt;return qi().wrap(function(hr){for(;;)switch(hr.prev=hr.next){case 0:if(Rt=$i(Ae.configService.getSceneConfig(Ae.id).id||""),Ae.$container=Rt,!Rt){hr.next=11;break}return Ae.canvas=Ie.SO.create("canvas","",Rt),Ae.setCanvas(),hr.next=7,Ae.rendererService.init(Ae.canvas,Ae.configService.getSceneConfig(Ae.id));case 7:yl()(Ae.$container,Ae.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(Ae.handleWindowResized),hr.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:Ae.pickingService.init(Ae.id);case 13:case"end":return hr.stop()}},_t)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ce){this.layerService.add(ce),this.render()}},{key:"render",value:function(){var B=(0,$o.Z)(qi().mark(function Ae(_t){return qi().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:if(!(this.rendering||this.destroyed)){wt.next=2;break}return wt.abrupt("return");case 2:if(this.rendering=!0,this.inited){wt.next=15;break}return wt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){wt.next=10;break}return wt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(_t),this.rendering=!1;case 17:case"end":return wt.stop()}},Ae,this)}));function ce(Ae){return B.apply(this,arguments)}return ce}()},{key:"addFontFace",value:function(ce,Ae){this.fontFamily=ce;var _t=document.createElement("style");_t.type="text/css",_t.innerText=`
        @font-face{
            font-family: '`.concat(ce,`';
            src: url('`).concat(Ae,`') format('woff2'),
            url('`).concat(Ae,`') format('woff'),
            url('`).concat(Ae,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(_t),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ce){var Ae,_t=(Ae=this.$container)===null||Ae===void 0?void 0:Ae.getElementsByTagName("canvas")[0];this.render();var Rt=ce==="jpg"?_t==null?void 0:_t.toDataURL("image/jpeg"):_t==null?void 0:_t.toDataURL("image/png");return Rt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ce=this.$container.parentElement;ce!==null&&(this.markerContainer=Ie.SO.create("div","l7-marker-container",ce))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var ce,Ae;if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(ce=this.$container)===null||ce===void 0||(Ae=ce.parentNode)===null||Ae===void 0||Ae.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Us.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ce,Ae,_t=Ie.SO.DPR,Rt=((ce=this.$container)===null||ce===void 0?void 0:ce.clientWidth)||400,wt=((Ae=this.$container)===null||Ae===void 0?void 0:Ae.clientHeight)||300,hr=this.canvas;hr&&(hr.width=Rt*_t,hr.height=wt*_t,hr.style.width="".concat(Rt,"px"),hr.style.height="".concat(wt,"px")),this.rendererService.viewport({x:0,y:0,width:_t*Rt,height:_t*wt})}},{key:"setCanvas",value:function(){var ce,Ae,_t=Ie.SO.DPR,Rt=((ce=this.$container)===null||ce===void 0?void 0:ce.clientWidth)||400,wt=((Ae=this.$container)===null||Ae===void 0?void 0:Ae.clientHeight)||300,hr=this.canvas;hr.width=Rt*_t,hr.height=wt*_t,hr.style.width="".concat(Rt,"px"),hr.style.height="".concat(wt,"px")}},{key:"addSceneEvent",value:function(ce){this.emit(ce.type,ce)}}]),L}(b.EventEmitter),po=(0,xe.Z)(_i.prototype,"id",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wo=(0,xe.Z)(_i.prototype,"iconService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys=(0,xe.Z)(_i.prototype,"fontService",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lu=(0,xe.Z)(_i.prototype,"controlService",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=(0,xe.Z)(_i.prototype,"configService",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru=(0,xe.Z)(_i.prototype,"map",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Go=(0,xe.Z)(_i.prototype,"coordinateSystemService",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ys=(0,xe.Z)(_i.prototype,"rendererService",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ro=(0,xe.Z)(_i.prototype,"layerService",[kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=(0,xe.Z)(_i.prototype,"cameraService",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=(0,xe.Z)(_i.prototype,"interactionService",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=(0,xe.Z)(_i.prototype,"pickingService",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_s=(0,xe.Z)(_i.prototype,"shaderModuleService",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=(0,xe.Z)(_i.prototype,"markerService",[ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=(0,xe.Z)(_i.prototype,"popupService",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i))||ga),Oa=y(44908),xl=y.n(Oa);function Kc(ie){var ne=0;switch(ie){case"vec2":case"ivec2":ne=2;break;case"vec3":case"ivec3":ne=3;break;case"vec4":case"ivec4":case"mat2":ne=4;break;case"mat3":ne=9;break;case"mat4":ne=16;break;default:}return ne}var ku=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function bl(ie){var ne={};return ie=ie.replace(ku,function(L,B,ce){var Ae=ce.split(":"),_t=Ae[0].trim(),Rt="";switch(Ae.length>1&&(Rt=Ae[1].trim()),B){case"bool":Rt=Rt==="true";break;case"float":case"int":Rt=Number(Rt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Rt?Rt=Rt.replace("[","").replace("]","").split(",").reduce(function(wt,hr){return wt.push(Number(hr.trim())),wt},[]):Rt=new Array(Kc(B)).fill(0);break;default:}return ne[_t]=Rt,"uniform ".concat(B," ").concat(_t,`;
`)}),{content:ie,uniforms:ne}}var $c,Ju;function Ql(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Pu(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?Ql(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):Ql(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}var Qu="#define PI 3.14159265359",Sl=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,El=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,qu=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Cl=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,el=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,qs=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ql=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Fu=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Oc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,tl=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,wl=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,kl=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,_c=/precision\s+(high|low|medium)p\s+float/,Fl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Lc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,ec=($c=(0,X.b2)(),$c(Ju=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"moduleCache",{}),(0,Z.Z)(this,"rawContentCache",{})}return(0,he.Z)(ie,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Qu,fs:Qu}),this.registerModule("decode",{vs:Sl,fs:""}),this.registerModule("projection",{vs:ql,fs:""}),this.registerModule("project",{vs:qs,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Fu}),this.registerModule("lighting",{vs:qu,fs:""}),this.registerModule("light",{vs:El,fs:""}),this.registerModule("picking",{vs:el,fs:Cl}),this.registerModule("styleMapping",{vs:Oc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:tl,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:wl,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:kl,fs:""})}},{key:"registerModule",value:function(L,B){if(!this.rawContentCache[L]){var ce=B.vs,Ae=B.fs,_t=B.uniforms,Rt=bl(ce),wt=Rt.content,hr=Rt.uniforms,Xr=bl(Ae),Qn=Xr.content,Wn=Xr.uniforms;this.rawContentCache[L]={fs:Qn,uniforms:Pu(Pu(Pu({},hr),Wn),_t),vs:wt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(L){var B=this;if(this.moduleCache[L])return this.moduleCache[L];var ce=this.rawContentCache[L].vs,Ae=this.rawContentCache[L].fs,_t=this.processModule(ce,[],"vs"),Rt=_t.content,wt=_t.includeList,hr=this.processModule(Ae,[],"fs"),Xr=hr.content,Qn=hr.includeList,Wn=Xr,fi=xl()(wt.concat(Qn).concat(L)).reduce(function(mi,Li){return Pu(Pu({},mi),B.rawContentCache[Li].uniforms)},{});return _c.test(Xr)||(Wn=Fl+Xr),this.moduleCache[L]={fs:Wn.trim(),uniforms:fi,vs:Rt.trim()},this.moduleCache[L]}},{key:"processModule",value:function(L,B,ce){var Ae=this,_t=L.replace(Lc,function(Rt,wt){var hr=wt.split(" "),Xr=hr[0].replace(/"/g,"");if(B.indexOf(Xr)>-1)return"";var Qn=Ae.rawContentCache[Xr][ce];B.push(Xr);var Wn=Ae.processModule(Qn,B,ce),fi=Wn.content;return fi});return{content:_t,includeList:B}}}]),ie}())||Ju),Zs=y(66213),no=y(92364),_o,Bu,Ds,Bl,tc,gu=(_o=(0,X.b2)(),Bu=(0,X.f3)(Y.v.IShaderModuleService),_o(Ds=(Bl=function(){function ie(){(0,$.Z)(this,ie),(0,ue.Z)(this,"shaderModuleService",tc,this),(0,Z.Z)(this,"rendererService",void 0),(0,Z.Z)(this,"cameraService",void 0),(0,Z.Z)(this,"mapService",void 0),(0,Z.Z)(this,"interactionService",void 0),(0,Z.Z)(this,"layerService",void 0),(0,Z.Z)(this,"config",void 0)}return(0,he.Z)(ie,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return no.G.Normal}},{key:"init",value:function(L,B){this.config=B,this.rendererService=L.getContainer().get(Y.v.IRendererService),this.cameraService=L.getContainer().get(Y.v.ICameraService),this.mapService=L.getContainer().get(Y.v.IMapService),this.interactionService=L.getContainer().get(Y.v.IInteractionService),this.layerService=L.getContainer().get(Y.v.ILayerService)}},{key:"render",value:function(L){}}]),ie}(),tc=(0,xe.Z)(Bl.prototype,"shaderModuleService",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bl))||Ds),rc,Nu;function io(ie){var ne=Nl();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function Nl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var js=(rc=(0,X.b2)(),rc(Nu=function(ie){(0,Nt.Z)(L,ie);var ne=io(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ce,Ae){(0,Zs.Z)((0,yr.Z)(L.prototype),"init",this).call(this,ce,Ae)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),L}(gu))||Nu),cu,la,Pi,xs,fu;function rl(ie,ne){var L=typeof Symbol!="undefined"&&ie[Symbol.iterator]||ie["@@iterator"];if(!L){if(Array.isArray(ie)||(L=es(ie))||ne&&ie&&typeof ie.length=="number"){L&&(ie=L);var B=0,ce=function(){};return{s:ce,n:function(){return B>=ie.length?{done:!0}:{done:!1,value:ie[B++]}},e:function(hr){throw hr},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,_t=!1,Rt;return{s:function(){L=L.call(ie)},n:function(){var hr=L.next();return Ae=hr.done,hr},e:function(hr){_t=!0,Rt=hr},f:function(){try{!Ae&&L.return!=null&&L.return()}finally{if(_t)throw Rt}}}}function es(ie,ne){if(!!ie){if(typeof ie=="string")return Jc(ie,ne);var L=Object.prototype.toString.call(ie).slice(8,-1);if(L==="Object"&&ie.constructor&&(L=ie.constructor.name),L==="Map"||L==="Set")return Array.from(ie);if(L==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(L))return Jc(ie,ne)}}function Jc(ie,ne){(ne==null||ne>ie.length)&&(ne=ie.length);for(var L=0,B=new Array(ne);L<ne;L++)B[L]=ie[L];return B}var Rc=(cu=(0,X.b2)(),la=(0,X.f3)(Y.v.IPostProcessor),cu(Pi=(xs=function(){function ie(){(0,$.Z)(this,ie),(0,Z.Z)(this,"passes",[]),(0,ue.Z)(this,"postProcessor",fu,this),(0,Z.Z)(this,"layer",void 0),(0,Z.Z)(this,"renderFlag",void 0),(0,Z.Z)(this,"width",0),(0,Z.Z)(this,"height",0)}return(0,he.Z)(ie,[{key:"setLayer",value:function(L){this.layer=L}},{key:"setRenderFlag",value:function(L){this.renderFlag=L}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var ne=(0,$o.Z)(qi().mark(function B(){var ce,Ae,_t;return qi().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:ce=rl(this.passes),wt.prev=1,ce.s();case 3:if((Ae=ce.n()).done){wt.next=9;break}return _t=Ae.value,wt.next=7,_t.render(this.layer);case 7:wt.next=3;break;case 9:wt.next=14;break;case 11:wt.prev=11,wt.t0=wt.catch(1),ce.e(wt.t0);case 14:return wt.prev=14,ce.f(),wt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return wt.stop()}},B,this,[[1,11,14,17]])}));function L(){return ne.apply(this,arguments)}return L}()},{key:"resize",value:function(L,B){(this.width!==L||this.height!==B)&&(this.width=L,this.height=B)}},{key:"add",value:function(L,B){L.getType()===no.G.PostProcessing?this.postProcessor.add(L,this.layer,B):(L.init(this.layer,B),this.passes.push(L))}},{key:"insert",value:function(L,B,ce){L.init(this.layer,B),this.passes.splice(ce,0,L)}},{key:"destroy",value:function(){this.passes.length=0}}]),ie}(),fu=(0,xe.Z)(xs.prototype,"postProcessor",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xs))||Pi),Al,zl;function yu(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Ao(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?yu(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):yu(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function zu(ie){var ne=Tl();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function Tl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var To=(Al=(0,X.b2)(),Al(zl=function(ie){(0,Nt.Z)(L,ie);var ne=zu(L);function L(){var B;(0,$.Z)(this,L);for(var ce=arguments.length,Ae=new Array(ce),_t=0;_t<ce;_t++)Ae[_t]=arguments[_t];return B=ne.call.apply(ne,[this].concat(Ae)),(0,Z.Z)((0,Re.Z)(B),"pickingFBO",void 0),(0,Z.Z)((0,Re.Z)(B),"layer",void 0),(0,Z.Z)((0,Re.Z)(B),"width",0),(0,Z.Z)((0,Re.Z)(B),"height",0),(0,Z.Z)((0,Re.Z)(B),"alreadyInRendering",!1),(0,Z.Z)((0,Re.Z)(B),"pickFromPickingFBO",function(Rt){var wt=Rt.x,hr=Rt.y,Xr=Rt.lngLat,Qn=Rt.type;if(!(!B.layer.isVisible()||!B.layer.needPick(Qn))){var Wn=B.rendererService,fi=Wn.getViewportSize,mi=Wn.readPixels,Li=Wn.useFramebuffer,oa=fi(),pa=oa.width,Sa=oa.height,vo=B.layer.getLayerConfig(),wa=vo.enableHighlight,Fo=vo.enableSelect,Fa=wt*Ie.SO.DPR,ji=hr*Ie.SO.DPR;if(!(Fa>pa||Fa<0||ji>Sa||ji<0)){var da;Li(B.pickingFBO,function(){var Ka;if(da=mi({x:Math.round(Fa),y:Math.round(Sa-(hr+1)*Ie.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:B.pickingFBO}),da[0]!==0||da[1]!==0||da[2]!==0){var mo=(0,Ie.W0)(da),Mi=B.layer.getSource().getFeatureById(mo),ao={x:wt,y:hr,type:Qn,lngLat:Xr,featureId:mo,feature:Mi};Mi&&(B.layer.setCurrentPickId(mo),B.triggerHoverOnLayer(ao))}else{var Ga={x:wt,y:hr,lngLat:Xr,type:B.layer.getCurrentPickId()===null?"un"+Qn:"mouseout",featureId:null,feature:null};B.triggerHoverOnLayer(Ao(Ao({},Ga),{},{type:"unpick"})),B.triggerHoverOnLayer(Ga),B.layer.setCurrentPickId(null)}wa&&B.highlightPickedFeature(da),Fo&&Qn==="click"&&((Ka=da)===null||Ka===void 0?void 0:Ka.toString())!==[0,0,0,0].toString()&&B.selectFeature(da)})}}}),B}return(0,he.Z)(L,[{key:"getType",value:function(){return no.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ce,Ae){(0,Zs.Z)((0,yr.Z)(L.prototype),"init",this).call(this,ce,Ae),this.layer=ce;var _t=this.rendererService,Rt=_t.createTexture2D,wt=_t.createFramebuffer,hr=_t.getViewportSize,Xr=hr(),Qn=Xr.width,Wn=Xr.height;this.pickingFBO=wt({color:Rt({width:Qn,height:Wn,wrapS:Ji.gl.CLAMP_TO_EDGE,wrapT:Ji.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickFromPickingFBO),this.interactionService.on(hi.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(hi.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ce){var Ae=this;if(!this.alreadyInRendering){var _t=this.rendererService,Rt=_t.getViewportSize,wt=_t.useFramebuffer,hr=_t.clear,Xr=Rt(),Qn=Xr.width,Wn=Xr.height;this.alreadyInRendering=!0,(this.width!==Qn||this.height!==Wn)&&(this.pickingFBO.resize({width:Qn,height:Wn}),this.width=Qn,this.height=Wn),wt(this.pickingFBO,function(){hr({framebuffer:Ae.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var fi=Ae.layer.multiPassRenderer.getRenderFlag();Ae.layer.multiPassRenderer.setRenderFlag(!1),ce.hooks.beforePickingEncode.call(),ce.render(),ce.hooks.afterPickingEncode.call(),Ae.layer.multiPassRenderer.setRenderFlag(fi),Ae.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ce){this.layer.emit(ce.type,ce)}},{key:"highlightPickedFeature",value:function(ce){var Ae=(0,Pt.Z)(ce,3),_t=Ae[0],Rt=Ae[1],wt=Ae[2];this.layer.hooks.beforeHighlight.call([_t,Rt,wt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ce){var Ae=(0,Pt.Z)(ce,3),_t=Ae[0],Rt=Ae[1],wt=Ae[2];this.layer.hooks.beforeSelect.call([_t,Rt,wt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ce){var Ae=ce.featureId,_t=(0,Ie.Z6)(Ae);this.selectFeature(new Uint8Array(_t))}},{key:"highlightFeatureHandle",value:function(ce){var Ae=ce.featureId,_t=(0,Ie.Z6)(Ae);this.highlightPickedFeature(new Uint8Array(_t))}}]),L}(gu))||zl),Rn=y(69530),lo,_u;function Uu(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Ya(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?Uu(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):Uu(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function ks(ie){var ne=xc();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Sn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Mu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bc=(lo=(0,X.b2)(),lo(_u=function(ie){(0,Nt.Z)(L,ie);var ne=ks(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Mu,fs:Sn});var ce=this.shaderModuleService.getModule("blur-pass"),Ae=ce.vs,_t=ce.fs,Rt=ce.uniforms,wt=this.rendererService.getViewportSize(),hr=wt.width,Xr=wt.height;return{vs:Ae,fs:_t,uniforms:Ya(Ya({},Rt),{},{u_ViewportSize:[hr,Xr]})}}},{key:"convertOptionsToUniforms",value:function(ce){var Ae={};return ss()(ce.blurRadius)||(Ae.u_BlurDir=[ce.blurRadius,0]),Ae}}]),L}(Rn.Z))||_u),eu,Ua;function bs(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Pl(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?bs(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):bs(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function tu(ie){var ne=Ts();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var xu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Qc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nc=(eu=(0,X.b2)(),eu(Ua=function(ie){(0,Nt.Z)(L,ie);var ne=tu(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Qc,fs:xu});var ce=this.shaderModuleService.getModule("blur-pass"),Ae=ce.vs,_t=ce.fs,Rt=ce.uniforms,wt=this.rendererService.getViewportSize(),hr=wt.width,Xr=wt.height;return{vs:Ae,fs:_t,uniforms:Pl(Pl({},Rt),{},{u_ViewportSize:[hr,Xr]})}}},{key:"convertOptionsToUniforms",value:function(ce){var Ae={};return ss()(ce.blurRadius)||(Ae.u_BlurDir=[0,ce.blurRadius]),Ae}}]),L}(Rn.Z))||Ua),ic,ko;function Vs(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Po(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?Vs(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):Vs(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function ta(ie){var ne=Zu();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function Zu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var hu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ho=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nl=(ic=(0,X.b2)(),ic(ko=function(ie){(0,Nt.Z)(L,ie);var ne=ta(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ho,fs:hu});var ce=this.shaderModuleService.getModule("colorhalftone-pass"),Ae=ce.vs,_t=ce.fs,Rt=ce.uniforms,wt=this.rendererService.getViewportSize(),hr=wt.width,Xr=wt.height;return{vs:Ae,fs:_t,uniforms:Po(Po({},Rt),{},{u_ViewportSize:[hr,Xr]})}}}]),L}(Rn.Z))||ko),bu,bi;function co(ie){var ne=Ml();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function Ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Vn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Gn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,il=(bu=(0,X.b2)(),bu(bi=function(ie){(0,Nt.Z)(L,ie);var ne=co(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Gn,fs:Vn}),this.shaderModuleService.getModule("copy-pass")}}]),L}(Rn.Z))||bi),ts,ls;function Mo(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function ru(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?Mo(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):Mo(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function Dc(ie){var ne=ac();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function ac(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Wi=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Zi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qc=(ts=(0,X.b2)(),ts(ls=function(ie){(0,Nt.Z)(L,ie);var ne=Dc(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Zi,fs:Wi});var ce=this.shaderModuleService.getModule("hexagonalpixelate-pass"),Ae=ce.vs,_t=ce.fs,Rt=ce.uniforms,wt=this.rendererService.getViewportSize(),hr=wt.width,Xr=wt.height;return{vs:Ae,fs:_t,uniforms:ru(ru({},Rt),{},{u_ViewportSize:[hr,Xr]})}}}]),L}(Rn.Z))||ls),Ps,Il;function Ms(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Va(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?Ms(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):Ms(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function nu(ie){var ne=Ss();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function Ss(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var ju=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,al=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ol=(Ps=(0,X.b2)(),Ps(Il=function(ie){(0,Nt.Z)(L,ie);var ne=nu(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:al,fs:ju});var ce=this.shaderModuleService.getModule("ink-pass"),Ae=ce.vs,_t=ce.fs,Rt=ce.uniforms,wt=this.rendererService.getViewportSize(),hr=wt.width,Xr=wt.height;return{vs:Ae,fs:_t,uniforms:Va(Va({},Rt),{},{u_ViewportSize:[hr,Xr]})}}}]),L}(Rn.Z))||Il),oc,ol;function sl(ie){var ne=ul();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Su=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Vu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Sc=(oc=(0,X.b2)(),oc(ol=function(ie){(0,Nt.Z)(L,ie);var ne=sl(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Vu,fs:Su}),this.shaderModuleService.getModule("noise-pass")}}]),L}(Rn.Z))||ol),Eu,Fs;function kc(ie){var ne=sc();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function sc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Ul=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ll=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,i=(Eu=(0,X.b2)(),Eu(Fs=function(ie){(0,Nt.Z)(L,ie);var ne=kc(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Ul,fs:ll}),this.shaderModuleService.getModule("sepia-pass")}}]),L}(Rn.Z))||Fs),u,o,h,_,E,T,k=(u=(0,X.b2)(),o=(0,X.f3)(Y.v.IRendererService),h=(0,X.zY)(),u(_=(E=function(){function ie(){(0,$.Z)(this,ie),(0,ue.Z)(this,"rendererService",T,this),(0,Z.Z)(this,"passes",[]),(0,Z.Z)(this,"readFBO",void 0),(0,Z.Z)(this,"writeFBO",void 0)}return(0,he.Z)(ie,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var ne=(0,$o.Z)(qi().mark(function B(ce){var Ae,_t;return qi().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:Ae=0;case 1:if(!(Ae<this.passes.length)){wt.next=10;break}return _t=this.passes[Ae],_t.setRenderToScreen(this.isLastEnabledPass(Ae)),wt.next=6,_t.render(ce);case 6:Ae!==this.passes.length-1&&this.swap();case 7:Ae++,wt.next=1;break;case 10:case"end":return wt.stop()}},B,this)}));function L(B){return ne.apply(this,arguments)}return L}()},{key:"resize",value:function(L,B){this.readFBO.resize({width:L,height:B}),this.writeFBO.resize({width:L,height:B})}},{key:"add",value:function(L,B,ce){L.init(B,ce),this.passes.push(L)}},{key:"insert",value:function(L,B,ce,Ae){L.init(ce,Ae),this.passes.splice(B,0,L)}},{key:"getPostProcessingPassByName",value:function(L){return this.passes.find(function(B){return B.getName()===L})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(L){for(var B=L+1;B<this.passes.length;B++)if(this.passes[B].isEnabled())return!1;return!0}},{key:"swap",value:function(){var L=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=L}}]),ie}(),T=(0,xe.Z)(E.prototype,"rendererService",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,xe.Z)(E.prototype,"init",[h],Object.getOwnPropertyDescriptor(E.prototype,"init"),E.prototype),E))||_),K,le;function Ce(ie){var ne=we();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function we(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var Me=(K=(0,X.b2)(),K(le=function(ie){(0,Nt.Z)(L,ie);var ne=Ce(L);function L(){return(0,$.Z)(this,L),ne.apply(this,arguments)}return(0,he.Z)(L,[{key:"getType",value:function(){return no.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ce,Ae){(0,Zs.Z)((0,yr.Z)(L.prototype),"init",this).call(this,ce,Ae)}},{key:"render",value:function(ce){var Ae=this.rendererService,_t=Ae.useFramebuffer,Rt=Ae.clear;_t(null,function(){Rt({color:[0,0,0,0],depth:1,stencil:0}),ce.multiPassRenderer.setRenderFlag(!1),ce.render(),ce.multiPassRenderer.setRenderFlag(!0)})}}]),L}(gu))||le),Ye,Xe,st,je,ut;function At(ie,ne){var L=Object.keys(ie);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ie);ne&&(B=B.filter(function(ce){return Object.getOwnPropertyDescriptor(ie,ce).enumerable})),L.push.apply(L,B)}return L}function Yt(ie){for(var ne=1;ne<arguments.length;ne++){var L=arguments[ne]!=null?arguments[ne]:{};ne%2?At(Object(L),!0).forEach(function(B){(0,Z.Z)(ie,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(L)):At(Object(L)).forEach(function(B){Object.defineProperty(ie,B,Object.getOwnPropertyDescriptor(L,B))})}return ie}function Sr(ie){var ne=dr();return function(){var B=(0,yr.Z)(ie),ce;if(ne){var Ae=(0,yr.Z)(this).constructor;ce=Reflect.construct(B,arguments,Ae)}else ce=B.apply(this,arguments);return(0,ar.Z)(this,ce)}}function dr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var wr=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Wr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,fn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function nn(ie,ne){for(var L=0,B=1/ne,ce=ie;ce>0;)L=L+B*(ce%ne),ce=Math.floor(ce/ne),B=B/ne;return L}var jn=1,ui=(Ye=(0,X.b2)(),Xe=(0,X.f3)(Y.v.IShaderModuleService),Ye(st=(je=function(ie){(0,Nt.Z)(L,ie);var ne=Sr(L);function L(){var B;(0,$.Z)(this,L);for(var ce=arguments.length,Ae=new Array(ce),_t=0;_t<ce;_t++)Ae[_t]=arguments[_t];return B=ne.call.apply(ne,[this].concat(Ae)),(0,ue.Z)((0,Re.Z)(B),"shaderModuleService",ut,(0,Re.Z)(B)),(0,Z.Z)((0,Re.Z)(B),"haltonSequence",[]),(0,Z.Z)((0,Re.Z)(B),"accumulatingId",0),(0,Z.Z)((0,Re.Z)(B),"frame",0),(0,Z.Z)((0,Re.Z)(B),"timer",void 0),(0,Z.Z)((0,Re.Z)(B),"sampleRenderTarget",void 0),(0,Z.Z)((0,Re.Z)(B),"prevRenderTarget",void 0),(0,Z.Z)((0,Re.Z)(B),"outputRenderTarget",void 0),(0,Z.Z)((0,Re.Z)(B),"copyRenderTarget",void 0),(0,Z.Z)((0,Re.Z)(B),"blendModel",void 0),(0,Z.Z)((0,Re.Z)(B),"outputModel",void 0),(0,Z.Z)((0,Re.Z)(B),"copyModel",void 0),B}return(0,he.Z)(L,[{key:"getType",value:function(){return no.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ce,Ae){(0,Zs.Z)((0,yr.Z)(L.prototype),"init",this).call(this,ce,Ae);var _t=this.rendererService,Rt=_t.createFramebuffer,wt=_t.createTexture2D;this.sampleRenderTarget=Rt({color:wt({width:1,height:1,wrapS:Ji.gl.CLAMP_TO_EDGE,wrapT:Ji.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Rt({color:wt({width:1,height:1,wrapS:Ji.gl.CLAMP_TO_EDGE,wrapT:Ji.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Rt({color:wt({width:1,height:1,wrapS:Ji.gl.CLAMP_TO_EDGE,wrapT:Ji.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Rt({color:wt({width:1,height:1,wrapS:Ji.gl.CLAMP_TO_EDGE,wrapT:Ji.gl.CLAMP_TO_EDGE})});for(var hr=0;hr<30;hr++)this.haltonSequence.push([nn(hr,2),nn(hr,3)]);this.blendModel=this.createTriangleModel("blend-pass",wr),this.outputModel=this.createTriangleModel("copy-pass",Wr,{blend:{enable:!0,func:{srcRGB:Ji.gl.ONE,dstRGB:Ji.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Ji.gl.ONE,dstAlpha:Ji.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Ji.gl.FUNC_ADD,alpha:Ji.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Wr)}},{key:"render",value:function(ce){var Ae=this,_t=this.rendererService,Rt=_t.clear,wt=_t.getViewportSize,hr=_t.useFramebuffer,Xr=wt(),Qn=Xr.width,Wn=Xr.height;this.sampleRenderTarget.resize({width:Qn,height:Wn}),this.prevRenderTarget.resize({width:Qn,height:Wn}),this.outputRenderTarget.resize({width:Qn,height:Wn}),this.copyRenderTarget.resize({width:Qn,height:Wn}),this.resetFrame(),this.stopAccumulating();var fi=ce.multiPassRenderer.getPostProcessor().getReadFBO();hr(fi,function(){Rt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:fi}),ce.multiPassRenderer.setRenderFlag(!1),ce.render(),ce.multiPassRenderer.setRenderFlag(!0)});var mi=function Li(oa){!Ae.accumulatingId||oa!==Ae.accumulatingId||Ae.isFinished()||(Ae.doRender(ce),requestAnimationFrame(function(){Li(oa)}))};this.accumulatingId=jn++,this.timer=window.setTimeout(function(){mi(Ae.accumulatingId)},50)}},{key:"doRender",value:function(ce){var Ae=this,_t=this.rendererService,Rt=_t.clear,wt=_t.getViewportSize,hr=_t.useFramebuffer,Xr=wt(),Qn=Xr.width,Wn=Xr.height,fi=ce.getLayerConfig(),mi=fi.jitterScale,Li=mi===void 0?1:mi,oa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((oa[0]*2-1)/Qn*Li,(oa[1]*2-1)/Wn*Li),ce.multiPassRenderer.setRenderFlag(!1),ce.hooks.beforeRender.call(),hr(this.sampleRenderTarget,function(){Rt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Ae.sampleRenderTarget}),ce.render()}),ce.hooks.afterRender.call(),ce.multiPassRenderer.setRenderFlag(!0);var pa=ce.getLayerConfig();hr(this.outputRenderTarget,function(){Ae.blendModel.draw({uniforms:{u_opacity:pa.opacity||1,u_MixRatio:Ae.frame===0?1:.9,u_Diffuse1:Ae.sampleRenderTarget,u_Diffuse2:Ae.frame===0?ce.multiPassRenderer.getPostProcessor().getReadFBO():Ae.prevRenderTarget}})}),this.frame===0&&Rt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(hr(this.copyRenderTarget,function(){Ae.outputModel.draw({uniforms:{u_Texture:Ae.outputRenderTarget}})}),hr(ce.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Ae.copyModel.draw({uniforms:{u_Texture:Ae.copyRenderTarget}})}),ce.multiPassRenderer.getPostProcessor().render(ce));var Sa=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Sa,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ce,Ae,_t){this.shaderModuleService.registerModule(ce,{vs:fn,fs:Ae});var Rt=this.shaderModuleService.getModule(ce),wt=Rt.vs,hr=Rt.fs,Xr=Rt.uniforms,Qn=this.rendererService,Wn=Qn.createAttribute,fi=Qn.createBuffer,mi=Qn.createModel;return mi(Yt({vs:wt,fs:hr,attributes:{a_Position:Wn({buffer:fi({data:[-4,-4,4,-4,0,4],type:Ji.gl.FLOAT}),size:2})},uniforms:Yt({},Xr),depth:{enable:!1},count:3},_t))}}]),L}(gu),ut=(0,xe.Z)(je.prototype,"shaderModuleService",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je))||st),li=new X.W2;li.bind(Y.v.IGlobalConfigService).to(Te).inSingletonScope(),li.bind(Y.v.IShaderModuleService).to(ec).inSingletonScope(),(0,X.GW)((0,X.b2)(),b.EventEmitter),li.bind(Y.v.IEventEmitter).to(b.EventEmitter);var mn=(0,U.Z)(li,!1),aa=function(ne){var L=mn.lazyInject(ne);return function(B,ce,Ae){L.call(this,B,ce),Ae&&(Ae.initializer=function(){return B[ce]})}},Hn=function(ne){var L=mn.lazyMultiInject(ne);return function(B,ce,Ae){L.call(this,B,ce),Ae&&(Ae.initializer=function(){return B[ce]})}},xi=li,Gi=0;function vi(){var ie=new X.W2;return ie.parent=li,ie.bind(Y.v.SceneID).toConstantValue("".concat(Gi++)),ie.bind(Y.v.ILayerService).to(Tu).inSingletonScope(),ie.bind(Y.v.ISceneService).to(Du).inSingletonScope(),ie.bind(Y.v.ICameraService).to(Mr).inSingletonScope(),ie.bind(Y.v.ICoordinateSystemService).to(Tn).inSingletonScope(),ie.bind(Y.v.IInteractionService).to(to).inSingletonScope(),ie.bind(Y.v.IPickingService).to(Be).inSingletonScope(),ie.bind(Y.v.IControlService).to(Tr).inSingletonScope(),ie.bind(Y.v.IMarkerService).to(Yr).inSingletonScope(),ie.bind(Y.v.IIconService).to(lt).inSingletonScope(),ie.bind(Y.v.IFontService).to(Ge).inSingletonScope(),ie.bind(Y.v.IPopupService).to(Or).inSingletonScope(),ie.bind(Y.v.INormalPass).to(js).whenTargetNamed("clear"),ie.bind(Y.v.INormalPass).to(To).whenTargetNamed("pixelPicking"),ie.bind(Y.v.INormalPass).to(Me).whenTargetNamed("render"),ie.bind(Y.v.INormalPass).to(ui).whenTargetNamed("taa"),ie.bind(Y.v.IFactoryNormalPass).toFactory(function(ne){return function(L){return ne.container.getNamed(Y.v.INormalPass,L)}}),ie.bind(Y.v.IPostProcessingPass).to(il).whenTargetNamed("copy"),ie.bind(Y.v.IPostProcessingPass).to(bc).whenTargetNamed("blurH"),ie.bind(Y.v.IPostProcessingPass).to(nc).whenTargetNamed("blurV"),ie.bind(Y.v.IPostProcessingPass).to(Sc).whenTargetNamed("noise"),ie.bind(Y.v.IPostProcessingPass).to(i).whenTargetNamed("sepia"),ie.bind(Y.v.IPostProcessingPass).to(nl).whenTargetNamed("colorHalftone"),ie.bind(Y.v.IPostProcessingPass).to(qc).whenTargetNamed("hexagonalPixelate"),ie.bind(Y.v.IPostProcessingPass).to(Ol).whenTargetNamed("ink"),ie.bind(Y.v.IFactoryPostProcessingPass).toFactory(function(ne){return function(L){var B=ne.container.getNamed(Y.v.IPostProcessingPass,L);return B.setName(L),B}}),ie}function Ci(ie){var ne=new X.W2;return ne.parent=ie,ne.bind(Y.v.IStyleAttributeService).to(gl).inSingletonScope(),ne.bind(Y.v.IMultiPassRenderer).to(Rc).inSingletonScope(),ne.bind(Y.v.IPostProcessor).to(k).inSingletonScope(),ne}},2811:function(){},64532:function(){},4594:function(Qe,O,y){"use strict";y.d(O,{l:function(){return z}});var z={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(Qe,O,y){"use strict";y.d(O,{d:function(){return z}});var z;(function(b){b.TOPRIGHT="topright",b.TOPLEFT="topleft",b.BOTTOMRIGHT="bottomright",b.BOTTOMLEFT="bottomleft",b.TOPCENTER="topcenter",b.BOTTOMCENTER="bottomcenter",b.LEFTCENTER="leftcenter",b.RIGHTCENTER="rightcenter"})(z||(z={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(Qe,O,y){"use strict";y.d(O,{l:function(){return z},k:function(){return b}});var z;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(z||(z={}));var b={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(Qe,O,y){"use strict";y.d(O,{s:function(){return z}});var z;(function(b){b.Hover="hover",b.Click="click",b.Select="select",b.Active="active",b.Drag="drag"})(z||(z={}))},90919:function(){},77252:function(Qe,O,y){"use strict";y.d(O,{h:function(){return z}});var z;(function(b){b.normal="normal",b.additive="additive",b.subtractive="subtractive",b.min="min",b.max="max",b.none="none"})(z||(z={}))},31251:function(Qe,O,y){"use strict";y.d(O,{vY:function(){return z},ee:function(){return b},GC:function(){return p}});var z;(function(X){X.LINEAR="linear",X.POWER="power",X.LOG="log",X.IDENTITY="identity",X.TIME="time",X.QUANTILE="quantile",X.QUANTIZE="quantize",X.THRESHOLD="threshold",X.CAT="cat"})(z||(z={}));var b;(function(X){X.CONSTANT="constant",X.VARIABLE="variable"})(b||(b={}));var p;(function(X){X[X.Attribute=0]="Attribute",X[X.InstancedAttribute=1]="InstancedAttribute",X[X.Uniform=2]="Uniform"})(p||(p={}))},16606:function(Qe,O,y){"use strict";y.d(O,{I:function(){return z}});var z=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(Qe,O,y){"use strict";y.d(O,{G:function(){return z}});var z;(function(b){b.Normal="normal",b.PostProcessing="post-processing"})(z||(z={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(Qe,O,y){"use strict";y.d(O,{gl:function(){return z}});var z;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",b[b.POINTS=0]="POINTS",b[b.LINES=1]="LINES",b[b.LINE_LOOP=2]="LINE_LOOP",b[b.LINE_STRIP=3]="LINE_STRIP",b[b.TRIANGLES=4]="TRIANGLES",b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN",b[b.ZERO=0]="ZERO",b[b.ONE=1]="ONE",b[b.SRC_COLOR=768]="SRC_COLOR",b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",b[b.SRC_ALPHA=770]="SRC_ALPHA",b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",b[b.DST_ALPHA=772]="DST_ALPHA",b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",b[b.DST_COLOR=774]="DST_COLOR",b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",b[b.FUNC_ADD=32774]="FUNC_ADD",b[b.BLEND_EQUATION=32777]="BLEND_EQUATION",b[b.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",b[b.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",b[b.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",b[b.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",b[b.MAX_EXT=32776]="MAX_EXT",b[b.MIN_EXT=32775]="MIN_EXT",b[b.BLEND_DST_RGB=32968]="BLEND_DST_RGB",b[b.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",b[b.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",b[b.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR",b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",b[b.BLEND_COLOR=32773]="BLEND_COLOR",b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER",b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",b[b.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",b[b.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",b[b.STREAM_DRAW=35040]="STREAM_DRAW",b[b.STATIC_DRAW=35044]="STATIC_DRAW",b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",b[b.BUFFER_SIZE=34660]="BUFFER_SIZE",b[b.BUFFER_USAGE=34661]="BUFFER_USAGE",b[b.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",b[b.FRONT=1028]="FRONT",b[b.BACK=1029]="BACK",b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK",b[b.CULL_FACE=2884]="CULL_FACE",b[b.BLEND=3042]="BLEND",b[b.DITHER=3024]="DITHER",b[b.STENCIL_TEST=2960]="STENCIL_TEST",b[b.DEPTH_TEST=2929]="DEPTH_TEST",b[b.SCISSOR_TEST=3089]="SCISSOR_TEST",b[b.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",b[b.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",b[b.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",b[b.NO_ERROR=0]="NO_ERROR",b[b.INVALID_ENUM=1280]="INVALID_ENUM",b[b.INVALID_VALUE=1281]="INVALID_VALUE",b[b.INVALID_OPERATION=1282]="INVALID_OPERATION",b[b.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",b[b.CW=2304]="CW",b[b.CCW=2305]="CCW",b[b.LINE_WIDTH=2849]="LINE_WIDTH",b[b.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",b[b.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",b[b.CULL_FACE_MODE=2885]="CULL_FACE_MODE",b[b.FRONT_FACE=2886]="FRONT_FACE",b[b.DEPTH_RANGE=2928]="DEPTH_RANGE",b[b.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",b[b.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",b[b.DEPTH_FUNC=2932]="DEPTH_FUNC",b[b.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",b[b.STENCIL_FUNC=2962]="STENCIL_FUNC",b[b.STENCIL_FAIL=2964]="STENCIL_FAIL",b[b.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",b[b.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",b[b.STENCIL_REF=2967]="STENCIL_REF",b[b.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",b[b.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",b[b.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",b[b.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",b[b.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",b[b.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",b[b.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",b[b.VIEWPORT=2978]="VIEWPORT",b[b.SCISSOR_BOX=3088]="SCISSOR_BOX",b[b.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",b[b.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",b[b.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",b[b.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",b[b.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",b[b.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",b[b.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",b[b.RED_BITS=3410]="RED_BITS",b[b.GREEN_BITS=3411]="GREEN_BITS",b[b.BLUE_BITS=3412]="BLUE_BITS",b[b.ALPHA_BITS=3413]="ALPHA_BITS",b[b.DEPTH_BITS=3414]="DEPTH_BITS",b[b.STENCIL_BITS=3415]="STENCIL_BITS",b[b.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",b[b.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",b[b.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",b[b.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",b[b.SAMPLES=32937]="SAMPLES",b[b.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",b[b.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",b[b.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",b[b.DONT_CARE=4352]="DONT_CARE",b[b.FASTEST=4353]="FASTEST",b[b.NICEST=4354]="NICEST",b[b.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",b[b.BYTE=5120]="BYTE",b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",b[b.SHORT=5122]="SHORT",b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",b[b.INT=5124]="INT",b[b.UNSIGNED_INT=5125]="UNSIGNED_INT",b[b.FLOAT=5126]="FLOAT",b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",b[b.ALPHA=6406]="ALPHA",b[b.RGB=6407]="RGB",b[b.RGBA=6408]="RGBA",b[b.LUMINANCE=6409]="LUMINANCE",b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",b[b.VERTEX_SHADER=35633]="VERTEX_SHADER",b[b.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",b[b.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",b[b.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",b[b.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",b[b.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",b[b.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",b[b.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",b[b.SHADER_TYPE=35663]="SHADER_TYPE",b[b.DELETE_STATUS=35712]="DELETE_STATUS",b[b.LINK_STATUS=35714]="LINK_STATUS",b[b.VALIDATE_STATUS=35715]="VALIDATE_STATUS",b[b.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",b[b.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",b[b.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",b[b.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",b[b.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",b[b.NEVER=512]="NEVER",b[b.LESS=513]="LESS",b[b.EQUAL=514]="EQUAL",b[b.LEQUAL=515]="LEQUAL",b[b.GREATER=516]="GREATER",b[b.NOTEQUAL=517]="NOTEQUAL",b[b.GEQUAL=518]="GEQUAL",b[b.ALWAYS=519]="ALWAYS",b[b.KEEP=7680]="KEEP",b[b.REPLACE=7681]="REPLACE",b[b.INCR=7682]="INCR",b[b.DECR=7683]="DECR",b[b.INVERT=5386]="INVERT",b[b.INCR_WRAP=34055]="INCR_WRAP",b[b.DECR_WRAP=34056]="DECR_WRAP",b[b.VENDOR=7936]="VENDOR",b[b.RENDERER=7937]="RENDERER",b[b.VERSION=7938]="VERSION",b[b.NEAREST=9728]="NEAREST",b[b.LINEAR=9729]="LINEAR",b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",b[b.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",b[b.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",b[b.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",b[b.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",b[b.TEXTURE_2D=3553]="TEXTURE_2D",b[b.TEXTURE=5890]="TEXTURE",b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",b[b.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",b[b.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",b[b.TEXTURE0=33984]="TEXTURE0",b[b.TEXTURE1=33985]="TEXTURE1",b[b.TEXTURE2=33986]="TEXTURE2",b[b.TEXTURE3=33987]="TEXTURE3",b[b.TEXTURE4=33988]="TEXTURE4",b[b.TEXTURE5=33989]="TEXTURE5",b[b.TEXTURE6=33990]="TEXTURE6",b[b.TEXTURE7=33991]="TEXTURE7",b[b.TEXTURE8=33992]="TEXTURE8",b[b.TEXTURE9=33993]="TEXTURE9",b[b.TEXTURE10=33994]="TEXTURE10",b[b.TEXTURE11=33995]="TEXTURE11",b[b.TEXTURE12=33996]="TEXTURE12",b[b.TEXTURE13=33997]="TEXTURE13",b[b.TEXTURE14=33998]="TEXTURE14",b[b.TEXTURE15=33999]="TEXTURE15",b[b.TEXTURE16=34e3]="TEXTURE16",b[b.TEXTURE17=34001]="TEXTURE17",b[b.TEXTURE18=34002]="TEXTURE18",b[b.TEXTURE19=34003]="TEXTURE19",b[b.TEXTURE20=34004]="TEXTURE20",b[b.TEXTURE21=34005]="TEXTURE21",b[b.TEXTURE22=34006]="TEXTURE22",b[b.TEXTURE23=34007]="TEXTURE23",b[b.TEXTURE24=34008]="TEXTURE24",b[b.TEXTURE25=34009]="TEXTURE25",b[b.TEXTURE26=34010]="TEXTURE26",b[b.TEXTURE27=34011]="TEXTURE27",b[b.TEXTURE28=34012]="TEXTURE28",b[b.TEXTURE29=34013]="TEXTURE29",b[b.TEXTURE30=34014]="TEXTURE30",b[b.TEXTURE31=34015]="TEXTURE31",b[b.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",b[b.REPEAT=10497]="REPEAT",b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",b[b.FLOAT_VEC2=35664]="FLOAT_VEC2",b[b.FLOAT_VEC3=35665]="FLOAT_VEC3",b[b.FLOAT_VEC4=35666]="FLOAT_VEC4",b[b.INT_VEC2=35667]="INT_VEC2",b[b.INT_VEC3=35668]="INT_VEC3",b[b.INT_VEC4=35669]="INT_VEC4",b[b.BOOL=35670]="BOOL",b[b.BOOL_VEC2=35671]="BOOL_VEC2",b[b.BOOL_VEC3=35672]="BOOL_VEC3",b[b.BOOL_VEC4=35673]="BOOL_VEC4",b[b.FLOAT_MAT2=35674]="FLOAT_MAT2",b[b.FLOAT_MAT3=35675]="FLOAT_MAT3",b[b.FLOAT_MAT4=35676]="FLOAT_MAT4",b[b.SAMPLER_2D=35678]="SAMPLER_2D",b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE",b[b.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",b[b.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",b[b.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",b[b.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",b[b.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",b[b.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",b[b.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",b[b.COMPILE_STATUS=35713]="COMPILE_STATUS",b[b.LOW_FLOAT=36336]="LOW_FLOAT",b[b.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",b[b.HIGH_FLOAT=36338]="HIGH_FLOAT",b[b.LOW_INT=36339]="LOW_INT",b[b.MEDIUM_INT=36340]="MEDIUM_INT",b[b.HIGH_INT=36341]="HIGH_INT",b[b.FRAMEBUFFER=36160]="FRAMEBUFFER",b[b.RENDERBUFFER=36161]="RENDERBUFFER",b[b.RGBA4=32854]="RGBA4",b[b.RGB5_A1=32855]="RGB5_A1",b[b.RGB565=36194]="RGB565",b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",b[b.STENCIL_INDEX=6401]="STENCIL_INDEX",b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8",b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL",b[b.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",b[b.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",b[b.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",b[b.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",b[b.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",b[b.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",b[b.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",b[b.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",b[b.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",b[b.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",b[b.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",b[b.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",b[b.NONE=0]="NONE",b[b.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",b[b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",b[b.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",b[b.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",b[b.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",b[b.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",b[b.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",b[b.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",b[b.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",b[b.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",b[b.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",b[b.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(z||(z={}))},69530:function(Qe,O,y){"use strict";y.d(O,{Z:function(){return Ve}});var z=y(55770),b=y(6610),p=y(5991),X=y(96156),U=y(3473),Y=y(11700),$=y.n(Y),he=y(14293),Z=y.n(he),Ie=y(68929),Le=y.n(Ie),rt=y(86700),$t=y(28660),zt=y.n($t),Lt=y(7648),Ht=y(72302),Ct=y(92364),yt,ft,sr,re,nr;function Tt(Ot,pr){var qt=Object.keys(Ot);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(Ot);pr&&(W=W.filter(function(se){return Object.getOwnPropertyDescriptor(Ot,se).enumerable})),qt.push.apply(qt,W)}return qt}function $e(Ot){for(var pr=1;pr<arguments.length;pr++){var qt=arguments[pr]!=null?arguments[pr]:{};pr%2?Tt(Object(qt),!0).forEach(function(W){(0,X.Z)(Ot,W,qt[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ot,Object.getOwnPropertyDescriptors(qt)):Tt(Object(qt)).forEach(function(W){Object.defineProperty(Ot,W,Object.getOwnPropertyDescriptor(qt,W))})}return Ot}var Mt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ve=(yt=(0,rt.b2)(),ft=(0,rt.f3)(Ht.v.IShaderModuleService),yt(sr=(re=function(){function Ot(){(0,b.Z)(this,Ot),(0,z.Z)(this,"shaderModuleService",nr,this),(0,X.Z)(this,"rendererService",void 0),(0,X.Z)(this,"config",void 0),(0,X.Z)(this,"quad",Mt),(0,X.Z)(this,"enabled",!0),(0,X.Z)(this,"renderToScreen",!1),(0,X.Z)(this,"model",void 0),(0,X.Z)(this,"name",void 0),(0,X.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(Ot,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(qt){this.name=qt}},{key:"getType",value:function(){return Ct.G.PostProcessing}},{key:"init",value:function(qt,W){this.config=W,this.rendererService=qt.getContainer().get(Ht.v.IRendererService);var se=this.rendererService,ke=se.createAttribute,_e=se.createBuffer,Et=se.createModel,gt=this.setupShaders(),jt=gt.vs,Ut=gt.fs,zr=gt.uniforms;this.model=Et({vs:jt,fs:Ut,attributes:{a_Position:ke({buffer:_e({data:[-4,-4,4,-4,0,4],type:Lt.gl.FLOAT}),size:2})},uniforms:$e($e({u_Texture:null},zr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(qt){var W=this,se=qt.multiPassRenderer.getPostProcessor(),ke=this.rendererService,_e=ke.useFramebuffer,Et=ke.getViewportSize,gt=ke.clear,jt=Et(),Ut=jt.width,zr=jt.height;_e(this.renderToScreen?null:se.getWriteFBO(),function(){gt({framebuffer:se.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),W.model.draw({uniforms:$e({u_Texture:se.getReadFBO(),u_ViewportSize:[Ut,zr]},W.convertOptionsToUniforms(W.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(qt){this.enabled=qt}},{key:"setRenderToScreen",value:function(qt){this.renderToScreen=qt}},{key:"updateOptions",value:function(qt){this.optionsToUpdate=$e($e({},this.optionsToUpdate),qt)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(qt){var W={};return Object.keys(qt).forEach(function(se){Z()(qt[se])||(W["u_".concat($()(Le()(se)))]=qt[se])}),W}}]),Ot}(),nr=(0,U.Z)(re.prototype,"shaderModuleService",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re))||sr)},19793:function(Qe,O,y){"use strict";y.d(O,{P:function(){return z}});var z=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(Qe,O,y){"use strict";y.d(O,{v:function(){return z}});var z={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(Qe,O,y){"use strict";var z=y(74691),b=null;function p(Ve){return b.indexOf(Ve)}var X=2,U=4,Y=64,$=128,he=256,Z=512,Ie=8192,Le=16384,rt=32768,$t=null,zt=131072,Lt=262144,Ht=524288,Ct=1048576,yt=2097152,ft=4194304,sr=8388608,re=16777216,nr=null;function Tt(Ve,Ot){return Ve=_clamp(Math.floor(Ve),0,255),Ot=_clamp(Math.floor(Ot),0,255),256*Ve+Ot}function $e(Ve){var Ot=Ve.color,pr=Ve.radius,qt=Ve.tileX,W=Ve.tileY,se=Ve.shape,ke=Ve.opacity,_e=Ve.stroke,Et=Ve.strokeWidth,gt=Ve.strokeOpacity,jt=[],Ut=[],zr=[],dn=[Tt(Ot[0],Ot[1]),Tt(Ot[2],Ot[3])],_n=[Tt(_e[0],_e[1]),Tt(_e[2],_e[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Qi){var ur=_slicedToArray(Qi,2),ge=ur[0],Pe=ur[1];jt.push([].concat(dn,[(ge+1)*sr+(Pe+1)*yt+getShapeIndex(se)*zt+pr,(qt+512)*Ht+(W+512)*Y])),Ut.push([].concat(_n,[Et,gt])),zr.push([ke,0,0,0])}),{packedBuffer:jt,packedBuffer2:Ut,packedBuffer3:zr}}function Mt(Ve,Ot){if(Ve===0&&!Ot)return 0;if(Ve===1&&Ot)return 4294967295;var pr=Ot?1:0,qt=Math.floor(Ve*127);return qt*nr+pr*re+qt*zt+pr*$t+qt*Z+pr*he+qt*X+pr}},37427:function(Qe,O,y){"use strict";y.d(O,{zP:function(){return Og},JE:function(){return O0},ns:function(){return Ig}});var z=y(67294),b=(0,z.createContext)({});function p(){return(0,z.useContext)(b)}var X={},U={},Y=function(c){return U[c]},$=function(c,a){U[c]=a},he=function(c){return X[c]},Z=function(c,a){X[c]=a},Ie={},Le={},rt=34,$t=10,zt=13;function Lt(n){return new Function("d","return {"+n.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function Ht(n,c){var a=Lt(n);return function(s,l){return c(a(s),l,n)}}function Ct(n){var c=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function yt(n,c){var a=n+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function ft(n){return n<0?"-"+yt(-n,6):n>9999?"+"+yt(n,6):yt(n,4)}function sr(n){var c=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":ft(n.getUTCFullYear(),4)+"-"+yt(n.getUTCMonth()+1,2)+"-"+yt(n.getUTCDate(),2)+(l?"T"+yt(c,2)+":"+yt(a,2)+":"+yt(s,2)+"."+yt(l,3)+"Z":s?"T"+yt(c,2)+":"+yt(a,2)+":"+yt(s,2)+"Z":a||c?"T"+yt(c,2)+":"+yt(a,2)+"Z":"")}function re(n){var c=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s(J,ye){var ze,dt,Ft=l(J,function(gr,Ar){if(ze)return ze(gr,Ar-1);dt=gr,ze=ye?Ht(gr,ye):Lt(gr)});return Ft.columns=dt||[],Ft}function l(J,ye){var ze=[],dt=J.length,Ft=0,gr=0,Ar,Vr=dt<=0,vn=!1;J.charCodeAt(dt-1)===$t&&--dt,J.charCodeAt(dt-1)===zt&&--dt;function bn(){if(Vr)return Le;if(vn)return vn=!1,Ie;var ri,ii=Ft,Si;if(J.charCodeAt(ii)===rt){for(;Ft++<dt&&J.charCodeAt(Ft)!==rt||J.charCodeAt(++Ft)===rt;);return(ri=Ft)>=dt?Vr=!0:(Si=J.charCodeAt(Ft++))===$t?vn=!0:Si===zt&&(vn=!0,J.charCodeAt(Ft)===$t&&++Ft),J.slice(ii+1,ri-1).replace(/""/g,'"')}for(;Ft<dt;){if((Si=J.charCodeAt(ri=Ft++))===$t)vn=!0;else if(Si===zt)vn=!0,J.charCodeAt(Ft)===$t&&++Ft;else if(Si!==a)continue;return J.slice(ii,ri)}return Vr=!0,J.slice(ii,dt)}for(;(Ar=bn())!==Le;){for(var zn=[];Ar!==Ie&&Ar!==Le;)zn.push(Ar),Ar=bn();ye&&(zn=ye(zn,gr++))==null||ze.push(zn)}return ze}function d(J,ye){return J.map(function(ze){return ye.map(function(dt){return te(ze[dt])}).join(n)})}function x(J,ye){return ye==null&&(ye=Ct(J)),[ye.map(te).join(n)].concat(d(J,ye)).join(`
`)}function A(J,ye){return ye==null&&(ye=Ct(J)),d(J,ye).join(`
`)}function M(J){return J.map(D).join(`
`)}function D(J){return J.map(te).join(n)}function te(J){return J==null?"":J instanceof Date?sr(J):c.test(J+="")?'"'+J.replace(/"/g,'""')+'"':J}return{parse:s,parseRows:l,format:x,formatBody:A,formatRows:M,formatRow:D,formatValue:te}}var nr=re(","),Tt=nr.parse,$e=nr.parseRows,Mt=nr.format,Ve=nr.formatBody,Ot=nr.formatRows,pr=nr.formatRow,qt=nr.formatValue,W=y(96156),se=y(85061),ke=y(6563),_e=y.n(ke);function Et(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function gt(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Et(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Et(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function jt(n,c){var a=c.x,s=c.y,l=c.x1,d=c.y1,x=c.coordinates,A=[];return n.forEach(function(M,D){var te=[];if(a&&s&&(te=[parseFloat(M[a]),parseFloat(M[s])]),a&&s&&l&&d){var J=[parseFloat(M[a]),parseFloat(M[s])],ye=[parseFloat(M[l]),parseFloat(M[d])];te=[J,ye]}if(x){var ze="Polygon";Array.isArray(x[0])||(ze="Point"),Array.isArray(x[0])&&!Array.isArray(x[0][0])&&(ze="LineString");var dt={type:ze,coordinates:(0,se.Z)(M[x])};_e()(dt,!0),te=dt.coordinates}var Ft=gt(gt({},M),{},{_id:D,coordinates:te});A.push(Ft)}),{dataArray:A}}var Ut=[{lng1:100,lat1:30,lng2:130,lat2:30}],zr={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function dn(n,c){var a=Tt(n);return jt(a,c)}var _n=y(40271);function Qi(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ur(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ge(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return ge(n[0]);throw new Error("coordinates must only contain numbers")}function Pe(n,c,a){if(!c||!a)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.type)}function Ge(n,c,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.geometry.type)}function Re(n,c,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+d.geometry.type)}}function Nt(n){return n.type==="Feature"?n.geometry:n}function ar(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function yr(n,c,a){if(n!==null)for(var s,l,d,x,A,M,D,te=0,J=0,ye,ze=n.type,dt=ze==="FeatureCollection",Ft=ze==="Feature",gr=dt?n.features.length:1,Ar=0;Ar<gr;Ar++){D=dt?n.features[Ar].geometry:Ft?n.geometry:n,ye=D?D.type==="GeometryCollection":!1,A=ye?D.geometries.length:1;for(var Vr=0;Vr<A;Vr++){var vn=0,bn=0;if(x=ye?D.geometries[Vr]:D,x!==null){M=x.coordinates;var zn=x.type;switch(te=a&&(zn==="Polygon"||zn==="MultiPolygon")?1:0,zn){case null:break;case"Point":if(c(M,J,Ar,vn,bn)===!1)return!1;J++,vn++;break;case"LineString":case"MultiPoint":for(s=0;s<M.length;s++){if(c(M[s],J,Ar,vn,bn)===!1)return!1;J++,zn==="MultiPoint"&&vn++}zn==="LineString"&&vn++;break;case"Polygon":case"MultiLineString":for(s=0;s<M.length;s++){for(l=0;l<M[s].length-te;l++){if(c(M[s][l],J,Ar,vn,bn)===!1)return!1;J++}zn==="MultiLineString"&&vn++,zn==="Polygon"&&bn++}zn==="Polygon"&&vn++;break;case"MultiPolygon":for(s=0;s<M.length;s++){for(bn=0,l=0;l<M[s].length;l++){for(d=0;d<M[s][l].length-te;d++){if(c(M[s][l][d],J,Ar,vn,bn)===!1)return!1;J++}bn++}vn++}break;case"GeometryCollection":for(s=0;s<x.geometries.length;s++)if(yr(x.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Lr(n,c,a,s){var l=a;return yr(n,function(d,x,A,M,D){x===0&&a===void 0?l=d:l=c(l,d,x,A,M,D)},s),l}function fr(n,c){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&c(n.features[a].properties,a)!==!1;a++);break;case"Feature":c(n.properties,0);break}}function Fr(n,c,a){var s=a;return fr(n,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function C(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&c(n.features[a],a)!==!1;a++);}function G(n,c,a){var s=a;return C(n,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function Ze(n){var c=[];return yr(n,function(a){c.push(a)}),c}function tt(n,c){var a,s,l,d,x,A,M,D,te,J,ye=0,ze=n.type==="FeatureCollection",dt=n.type==="Feature",Ft=ze?n.features.length:1;for(a=0;a<Ft;a++){for(A=ze?n.features[a].geometry:dt?n.geometry:n,D=ze?n.features[a].properties:dt?n.properties:{},te=ze?n.features[a].bbox:dt?n.bbox:void 0,J=ze?n.features[a].id:dt?n.id:void 0,M=A?A.type==="GeometryCollection":!1,x=M?A.geometries.length:1,l=0;l<x;l++){if(d=M?A.geometries[l]:A,d===null){if(c(null,ye,D,te,J)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,ye,D,te,J)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],ye,D,te,J)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ye++}}function lt(n,c,a){var s=a;return tt(n,function(l,d,x,A,M){d===0&&a===void 0?s=l:s=c(s,l,d,x,A,M)}),s}function Pt(n,c){tt(n,function(a,s,l,d,x){var A=a===null?null:a.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return c((0,_n.zL)(a,l,{bbox:d,id:x}),s,0)===!1?!1:void 0}var M;switch(A){case"MultiPoint":M="Point";break;case"MultiLineString":M="LineString";break;case"MultiPolygon":M="Polygon";break}for(var D=0;D<a.coordinates.length;D++){var te=a.coordinates[D],J={type:M,coordinates:te};if(c((0,_n.zL)(J,l),s,D)===!1)return!1}})}function q(n,c,a){var s=a;return Pt(n,function(l,d,x){d===0&&x===0&&a===void 0?s=l:s=c(s,l,d,x)}),s}function kt(n,c){Pt(n,function(a,s,l){var d=0;if(!!a.geometry){var x=a.geometry.type;if(!(x==="Point"||x==="MultiPoint")){var A,M=0,D=0,te=0;if(yr(a,function(J,ye,ze,dt,Ft){if(A===void 0||s>M||dt>D||Ft>te){A=J,M=s,D=dt,te=Ft,d=0;return}var gr=lineString([A,J],a.properties);if(c(gr,s,l,Ft,d)===!1)return!1;d++,A=J})===!1)return!1}}})}function Er(n,c,a){var s=a,l=!1;return kt(n,function(d,x,A,M,D){l===!1&&a===void 0?s=d:s=c(s,d,x,A,M,D),l=!0}),s}function Mr(n,c){if(!n)throw new Error("geojson is required");Pt(n,function(a,s,l){if(a.geometry!==null){var d=a.geometry.type,x=a.geometry.coordinates;switch(d){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<x.length;A++)if(c(lineString(x[A],a.properties),s,l,A)===!1)return!1;break}}})}function Je(n,c,a){var s=a;return Mr(n,function(l,d,x,A){d===0&&a===void 0?s=l:s=c(s,l,d,x,A)}),s}function ct(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,x=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),x=x||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":x=x||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=M.length+d-1),lineString([M[d],M[d+1]],x,c);case"Polygon":return l<0&&(l=M.length+l),d<0&&(d=M[l].length+d-1),lineString([M[l][d],M[l][d+1]],x,c);case"MultiLineString":return s<0&&(s=M.length+s),d<0&&(d=M[s].length+d-1),lineString([M[s][d],M[s][d+1]],x,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),d<0&&(d=M[s][l].length-d-1),lineString([M[s][l][d],M[s][l][d+1]],x,c)}throw new Error("geojson is invalid")}function It(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,x=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),x=x||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":x=x||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":return point(M,x,c);case"MultiPoint":return s<0&&(s=M.length+s),point(M[s],x,c);case"LineString":return d<0&&(d=M.length+d),point(M[d],x,c);case"Polygon":return l<0&&(l=M.length+l),d<0&&(d=M[l].length+d),point(M[l][d],x,c);case"MultiLineString":return s<0&&(s=M.length+s),d<0&&(d=M[s].length+d),point(M[s][d],x,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),d<0&&(d=M[s][l].length-d),point(M[s][l][d],x,c)}throw new Error("geojson is invalid")}function Bt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function br(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Bt(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Bt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Tr(n,c){var a=[],s={};if(n.features=n.features.filter(function(d){var x=d.geometry;return d!=null&&x&&x.type&&x.coordinates&&x.coordinates.length>0}),_e()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Pt(n,function(d,x){var A=ur(d),M=x,D=br(br({},d.properties),{},{coordinates:A,_id:M});a.push(D)}),{dataArray:a,featureKeys:s}}var qe=y(6901);function Gr(n,c){var a=c.extent,s=a===void 0?[121.168,30.2828,121.384,30.4219]:a,l=new Promise(function(x){Yr(n,function(A){x(A)})}),d={images:l,_id:1,dataArray:[{_id:0,coordinates:[[s[0],s[1]],[s[2],s[3]]]}]};return d}function Yr(n,c){var a=n,s=[];if(typeof a=="string")(0,qe.gJ)({url:a},function(x,A){s.push(A),c(s)});else{var l=a.length,d=0;a.forEach(function(x){(0,qe.gJ)({url:x},function(A,M){d++,s.push(M),d===l&&c(s)})})}return Gr}function An(n,c){var a=c.extent,s=c.width,l=c.height,d=c.min,x=c.max,A={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:d,max:x,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return A}var vr=y(6610),Or=y(5991),St=y(63349),Kn=y(10379),Ln=y(46070),Ur=y(77608),ee=y(30236),fe=y.n(ee),me=y(47037),N=y.n(me),ae=y(23560),de=y.n(ae),Te=y(50361),ue=y.n(Te),xe=y(46343),pt=y(26729),Cr=y(69848),Kt=y.n(Cr);function rr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Zr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?rr(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):rr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Nn(n,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,d=l===void 0?18:l,x=c.minZoom,A=x===void 0?0:x,M=c.zoom,D=M===void 0?2:M;if(n.pointIndex){var te=n.pointIndex.getClusters(n.extent,Math.floor(D));return n.dataArray=Bn(te),n}var J=new(Kt())({radius:s,minZoom:A,maxZoom:d}),ye={type:"FeatureCollection",features:[]};return ye.features=n.dataArray.map(function(ze){return{type:"Feature",geometry:{type:"Point",coordinates:ze.coordinates},properties:Zr({},ze)}}),J.load(ye.features),J}function Bn(n){return n.map(function(c,a){return Zr({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function tr(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]>c&&(c=n[a]);return c}function In(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]<c&&(c=n[a]);return c}function hn(n){if(n.length===0)return 0;for(var c=n[0],a=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?a+=c-s+n[l]:a+=n[l]-s+c,c=s;return c+a*1}function yn(n){if(n.length===0)throw new Error("mean requires at least one data point");return hn(n)/n.length}var Ni={min:In,max:tr,mean:yn,sum:hn};function Tn(n,c){return n.map(function(a){return a[c]*1})}function Di(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ra(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Di(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Di(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function hi(n){var c=na();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function na(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Xi(n,c){if(Array.isArray(c))return c}var Ii=function(n){(0,Kn.Z)(a,n);var c=hi(a);function a(s,l){var d;return(0,vr.Z)(this,a),d=c.call(this),(0,W.Z)((0,St.Z)(d),"data",void 0),(0,W.Z)((0,St.Z)(d),"extent",void 0),(0,W.Z)((0,St.Z)(d),"hooks",{init:new xe.ni}),(0,W.Z)((0,St.Z)(d),"parser",{type:"geojson"}),(0,W.Z)((0,St.Z)(d),"transforms",[]),(0,W.Z)((0,St.Z)(d),"cluster",!1),(0,W.Z)((0,St.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,W.Z)((0,St.Z)(d),"mapService",void 0),(0,W.Z)((0,St.Z)(d),"invalidExtent",!1),(0,W.Z)((0,St.Z)(d),"originData",void 0),(0,W.Z)((0,St.Z)(d),"rawData",void 0),(0,W.Z)((0,St.Z)(d),"cfg",{}),(0,W.Z)((0,St.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,Or.Z)(a,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,x=this.clusterOptions,A=x.method,M=A===void 0?"sum":A,D=x.field,te=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,te.forEach(function(J){J.id||(J.properties.point_count=1)}),(D||de()(M))&&(te=te.map(function(J){var ye=J.id;if(ye){var ze=d.clusterIndex.getLeaves(ye,Infinity),dt=ze.map(function(Ar){return Ar.properties}),Ft;if(N()(M)&&D){var gr=Tn(dt,D);Ft=Ni[M](gr)}de()(M)&&(Ft=M(dt)),J.properties.stat=Ft}else J.properties.point_count=1;return J})),this.data=Y("geojson")({type:"FeatureCollection",features:te}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,x=d===void 0?"geojson":d;if(x==="geojson"&&!this.cluster){var A=l<this.originData.features.length?this.originData.features[l]:"null",M=ue()(A);if(this.transforms.length!==0){var D=this.data.dataArray.find(function(te){return te._id===l});M.properties=D}return M}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var x=this.data.dataArray.find(function(A){return A[l]===name});return x==null?void 0:x._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,qe.yA)((0,qe.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=fe()(this.cfg,l,Xi);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=ra(ra({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",x=Y(d);this.data=x(this.originData,l),this.extent=(0,qe.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(x){var A=x.type,M=he(A)(l.data,x);Object.assign(l.data,M)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=Nn(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(pt.EventEmitter);function ma(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function Da(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Yi(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var D=a.next();return d=D.done,D},e:function(D){x=!0,A=D},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function Yi(n,c){if(!!n){if(typeof n=="string")return zi(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zi(n,c)}}function zi(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Ki=6378e3;function to(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*Ki)*(256<<20)/2,x=$o(a,l),A=x.gridHash,M=x.gridOffset,D=Au(A,M,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:D}}function $o(n,c){var a=Infinity,s=-Infinity,l,d=Da(n),x;try{for(d.s();!(x=d.n()).done;){var A=x.value;l=A.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(vn){d.e(vn)}finally{d.f()}var M=(a+s)/2,D=Ba(c,M);if(D.xOffset<=0||D.yOffset<=0)return{gridHash:{},gridOffset:D};var te={},J=Da(n),ye;try{for(J.s();!(ye=J.n()).done;){var ze=ye.value,dt=ze.coordinates[1],Ft=ze.coordinates[0];if(Number.isFinite(dt)&&Number.isFinite(Ft)){var gr=Math.floor((dt+90)/D.yOffset),Ar=Math.floor((Ft+180)/D.xOffset),Vr="".concat(gr,"-").concat(Ar);te[Vr]=te[Vr]||{count:0,points:[]},te[Vr].count+=1,te[Vr].points.push(ze)}}}catch(vn){J.e(vn)}finally{J.f()}return{gridHash:te,gridOffset:D}}function Ba(n,c){var a=qi(n),s=su(c,n);return{yOffset:a,xOffset:s}}function qi(n){return n/Ki*(180/Math.PI)}function su(n,c){return c/Ki*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Au(n,c,a){return Object.keys(n).reduce(function(s,l,d){var x=l.split("-"),A=parseInt(x[0],10),M=parseInt(x[1],10),D={};if(a.field&&a.method){var te=qe.a5.getColumn(n[l].points,a.field);D[a.method]=qe.a5.statMap[a.method](te)}return Object.assign(D,{_id:d,coordinates:(0,qe.Z)([-180+c.xOffset*(M+.5),-90+c.yOffset*(A+.5)]),rawData:n[l].points,count:n[l].count}),s.push(D),s},[])}var $i=y(28481),yo=Math.PI/3,Ji=[0,yo,2*yo,3*yo,4*yo,5*yo];function Wa(n){return n[0]}function Jo(n){return n[1]}function ba(){var n=0,c=0,a=1,s=1,l=Wa,d=Jo,x,A,M;function D(J){var ye={},ze=[],dt,Ft=J.length;for(dt=0;dt<Ft;++dt)if(!(isNaN(Ar=+l.call(null,gr=J[dt],dt,J))||isNaN(Vr=+d.call(null,gr,dt,J)))){var gr,Ar,Vr,vn=Math.round(Vr=Vr/M),bn=Math.round(Ar=Ar/A-(vn&1)/2),zn=Vr-vn;if(Math.abs(zn)*3>1){var ri=Ar-bn,ii=bn+(Ar<bn?-1:1)/2,Si=vn+(Vr<vn?-1:1),ea=Ar-ii,ya=Vr-Si;ri*ri+zn*zn>ea*ea+ya*ya&&(bn=ii+(vn&1?1:-1)/2,vn=Si)}var yi=bn+"-"+vn,Ta=ye[yi];Ta?Ta.push(gr):(ze.push(Ta=ye[yi]=[gr]),Ta.x=(bn+(vn&1)/2)*A,Ta.y=vn*M)}return ze}function te(J){var ye=0,ze=0;return Ji.map(function(dt){var Ft=Math.sin(dt)*J,gr=-Math.cos(dt)*J,Ar=Ft-ye,Vr=gr-ze;return ye=Ft,ze=gr,[Ar,Vr]})}return D.hexagon=function(J){return"m"+te(J==null?x:+J).join("l")+"z"},D.centers=function(){for(var J=[],ye=Math.round(c/M),ze=Math.round(n/A),dt=ye*M;dt<s+x;dt+=M,++ye)for(var Ft=ze*A+(ye&1)*A/2;Ft<a+A/2;Ft+=A)J.push([Ft,dt]);return J},D.mesh=function(){var J=te(x).slice(0,4).join("l");return D.centers().map(function(ye){return"M"+ye+"m"+J}).join("")},D.x=function(J){return arguments.length?(l=J,D):l},D.y=function(J){return arguments.length?(d=J,D):d},D.radius=function(J){return arguments.length?(x=+J,A=x*2*Math.sin(yo),M=x*1.5,D):x},D.size=function(J){return arguments.length?(n=c=0,a=+J[0],s=+J[1],D):[a-n,s-c]},D.extent=function(J){return arguments.length?(n=+J[0][0],c=+J[0][1],a=+J[1][0],s=+J[1][1],D):[[n,c],[a,s]]},D.radius(1)}function Lo(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ro(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lo(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lo(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Rs=6378e3;function ho(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,x=d===void 0?"sum":d,A=l/(2*Math.PI*Rs)*(256<<20)/2,M=a.map(function(ye){var ze=(0,qe.Z)(ye.coordinates),dt=(0,$i.Z)(ze,2),Ft=dt[0],gr=dt[1];return Ro(Ro({},ye),{},{coordinates:[Ft,gr]})}),D=ba().radius(A).x(function(ye){return ye.coordinates[0]}).y(function(ye){return ye.coordinates[1]}),te=D(M),J={dataArray:te.map(function(ye,ze){var dt;if(c.field&&x){var Ft=qe.a5.getColumn(ye,c.field);ye[x]=qe.a5.statMap[x](Ft)}return dt={},(0,W.Z)(dt,c.method,ye[x]),(0,W.Z)(dt,"count",ye.length),(0,W.Z)(dt,"rawData",ye),(0,W.Z)(dt,"coordinates",[ye.x,ye.y]),(0,W.Z)(dt,"_id",ze),dt}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return J}function Vo(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ka(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Vo(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Vo(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function so(n,c){var a=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(x){d[x[a]]=x}),n.dataArray=n.dataArray.map(function(x){var A=x[s];return ka(ka({},x),d[A])}),n}function as(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var Do=y(4771),Ee=Ii;$("geojson",Tr),$("image",Gr),$("csv",dn),$("json",jt),$("raster",An),Z("cluster",Nn),Z("filter",ma),Z("join",so),Z("map",as),Z("grid",to),Z("hexagon",ho);var Be=Ut,mt=zr,R=y(58881);function qr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function oi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?qr(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):qr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ai(n){var c=uo();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function uo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Xa=0,ja=function(n){(0,Kn.Z)(a,n);var c=Ai(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this),(0,W.Z)((0,St.Z)(l),"controlOption",void 0),(0,W.Z)((0,St.Z)(l),"container",void 0),(0,W.Z)((0,St.Z)(l),"sceneContainer",void 0),(0,W.Z)((0,St.Z)(l),"mapsService",void 0),(0,W.Z)((0,St.Z)(l),"renderService",void 0),(0,W.Z)((0,St.Z)(l),"layerService",void 0),(0,W.Z)((0,St.Z)(l),"controlService",void 0),(0,W.Z)((0,St.Z)(l),"isShow",void 0),l.controlOption=oi(oi({},l.getDefault()),s||{}),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:R.PositionType.TOPRIGHT,name:"".concat(Xa++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R.PositionType.BOTTOMRIGHT,d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(R.vK.IMapService),this.renderService=l.get(R.vK.IRendererService),this.layerService=l.get(R.vK.ILayerService),this.controlService=l.get(R.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,x=this.controlOption.position,A=this.controlService.controlCorners[x];return qe.SO.addClass(d,"l7-control"),x.indexOf("bottom")!==-1?A.insertBefore(d,A.firstChild):A.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;qe.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;qe.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;qe.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),a}(pt.EventEmitter);function os(n){var c=uu();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Tu=function(n){(0,Kn.Z)(a,n);var c=os(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this,s),(0,W.Z)((0,St.Z)(l),"layerControlInputs",void 0),(0,W.Z)((0,St.Z)(l),"layers",void 0),(0,W.Z)((0,St.Z)(l),"lastZIndex",void 0),(0,W.Z)((0,St.Z)(l),"handlingClick",void 0),(0,W.Z)((0,St.Z)(l),"layersLink",void 0),(0,W.Z)((0,St.Z)(l),"baseLayersList",void 0),(0,W.Z)((0,St.Z)(l),"separator",void 0),(0,W.Z)((0,St.Z)(l),"overlaysList",void 0),(0,W.Z)((0,St.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,qe.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:R.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;qe.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var x=d-(this.container.offsetTop+50);return x<this.form.clientHeight?(qe.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=x+"px"):qe.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return qe.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=qe.SO.create("div",l),x=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var A=this.form=qe.SO.create("form",l+"-list");x&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=qe.SO.create("a",l+"-toggle",d);var M=this.layersLink;M.title="Layers",x||this.expand(),this.baseLayersList=qe.SO.create("div",l+"-base",A),this.separator=qe.SO.create("div",l+"-separator",A),this.overlaysList=qe.SO.create("div",l+"-overlays",A),d.appendChild(A)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,x=d.baseLayers,A=x===void 0?{}:x,M=d.overlayers,D=M===void 0?{}:M;Object.keys(A).forEach(function(te,J){l.addLayer(A[te],te,!1)}),Object.keys(D).forEach(function(te,J){l.addLayer(D[te],te,!0)})}},{key:"update",value:function(){if(!this.container)return this;qe.SO.empty(this.baseLayersList),qe.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,x,A,M=0;for(x=0;x<this.layers.length;x++)A=this.layers[x],this.addItem(A),d=d||A.overlay,l=l||!A.overlay,M+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&M>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,x,A=this.mapsService.getZoom(),M=l.length-1;M>=0;M--)if(d=l[M],x=this.layerService.getLayer(d.layerId),x&&x.inited){var D=x.getMinZoom(),te=x.getMaxZoom();d.disabled=A<D||A>te}}},{key:"addLayer",value:function(l,d,x){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:x});var A=this.controlOption,M=A.sortLayers,D=A.sortFunction,te=A.autoZIndex;M&&this.layers.sort(function(J,ye){return D(J.layer,ye.layer,J.name,ye.name)}),te&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),x=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;x&&this.emit(x,d)}},{key:"createRadioElement",value:function(l,d){var x='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=x,A.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),x=this.layerService.getLayer(l.layer.id),A=x&&x.inited&&l.layer.isVisible(),M;l.overlay?(M=document.createElement("input"),M.type="checkbox",M.className="l7-control-layers-selector",M.defaultChecked=A):M=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(M),M.layerId=l.layer.id,M.addEventListener("click",this.onInputClick);var D=document.createElement("span");D.innerHTML=" "+l.name;var te=document.createElement("div");d.appendChild(te),te.appendChild(M),te.appendChild(D);var J=l.overlay?this.overlaysList:this.baseLayersList;return J.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,x,A=[],M=[];this.handlingClick=!0;for(var D=l.length-1;D>=0;D--)d=l[D],x=this.layerService.getLayer(d.layerId),d.checked?A.push(x):d.checked||M.push(x);M.forEach(function(te){te.hide()}),A.forEach(function(te){te.show()}),this.handlingClick=!1}}]),a}(ja);function Ku(n){var c=Qo();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var qo=function(n){(0,Kn.Z)(a,n);var c=Ku(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:R.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=qe.SO.create("div",l),x=qe.SO.create("a","l7-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://antv.alipay.com/l7",x.setAttribute("aria-label","AntV logo"),x.setAttribute("rel","noopener nofollow"),d.appendChild(x),d}},{key:"onRemove",value:function(){return null}}]),a}(ja);function ss(n){var c=ws();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var us=function(n){(0,Kn.Z)(a,n);var c=ss(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this,s),(0,W.Z)((0,St.Z)(l),"mScale",void 0),(0,W.Z)((0,St.Z)(l),"iScale",void 0),(0,qe.Ev)(["update"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:R.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=qe.SO.create("div",l);this.addScales(l+"-line",d);var x=this.controlOption.updateWhenIdle;return this.mapsService.on(x?"moveend":"mapmove",this.update),this.mapsService.on(x?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,x=l.getSize()[1]/2,A=l.containerToLngLat([0,x]),M=l.containerToLngLat([d,x]),D=(0,qe.yM)([A.lng,A.lat],[M.lng,M.lat]);this.updateScales(D)}},{key:"updateScales",value:function(l){var d=this.controlOption,x=d.metric,A=d.imperial;x&&l&&this.updateMetric(l),A&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),x=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,x,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,x,A,M;d>5280?(x=d/5280,A=this.getRoundNum(x),this.updateScale(this.iScale,A+" mi",A/x)):(M=this.getRoundNum(d),this.updateScale(this.iScale,M+" ft",M/d))}},{key:"updateScale",value:function(l,d,x){var A=this.controlOption.maxWidth;l.style.width=Math.round(A*x)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),x=l/d;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:1,d*x}},{key:"addScales",value:function(l,d){var x=this.controlOption,A=x.metric,M=x.imperial;A&&(this.mScale=qe.SO.create("div",l,d)),M&&(this.iScale=qe.SO.create("div",l,d))}}]),a}(ja);function zs(n){var c=Xs();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var As=function(n){(0,Kn.Z)(a,n);var c=zs(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this,s),(0,W.Z)((0,St.Z)(l),"disabled",void 0),(0,W.Z)((0,St.Z)(l),"zoomInButton",void 0),(0,W.Z)((0,St.Z)(l),"zoomOutButton",void 0),(0,qe.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:R.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=qe.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,x,A,M){var D=qe.SO.create("a",x,A);return D.innerHTML=l,D.title=d,D.href="javascript:void(0)",D.addEventListener("click",M),D}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";qe.SO.removeClass(this.zoomInButton,d),qe.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&qe.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&qe.SO.addClass(this.zoomInButton,d)}}]),a}(ja);function Ca(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Co(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ca(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ca(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function vl(n){var c=ml();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $u=function(n){(0,Kn.Z)(a,n);var c=vl(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this),(0,W.Z)((0,St.Z)(l),"markerOption",void 0),(0,W.Z)((0,St.Z)(l),"defaultMarker",void 0),(0,W.Z)((0,St.Z)(l),"popup",void 0),(0,W.Z)((0,St.Z)(l),"mapsService",void 0),(0,W.Z)((0,St.Z)(l),"sceneSerive",void 0),(0,W.Z)((0,St.Z)(l),"lngLat",void 0),(0,W.Z)((0,St.Z)(l),"scene",void 0),(0,W.Z)((0,St.Z)(l),"added",!1),(0,W.Z)((0,St.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=Co(Co({},l.getDefault()),s),(0,qe.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,St.Z)(l)),l.init(),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:qe.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(R.vK.IMapService),this.sceneSerive=l.get(R.vK.ISceneService);var d=this.markerOption,x=d.element,A=d.draggable;return this.mapsService.getMarkerContainer().appendChild(x),this.registerMarkerEvent(x),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&qe.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var x=this.markerOption.element;return x&&qe.SO.remove(x),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,x=l.anchor;this.updatePosition(),qe.SO.setTransform(d,"".concat(qe.rQ[x]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,x=l.offsets,A=this.lngLat,M=A.lng,D=A.lat,te=this.mapsService.getBounds(),J=this.mapsService.lngLatToContainer([M,D]);if(d){d.style.display="block";var ye=this.mapsService.getContainer(),ze=0,dt=0;if(ye&&(ze=ye.scrollWidth,dt=ye.scrollHeight),Math.abs(te[0][0])>180||Math.abs(te[1][0])>180){if(J.x>ze){var Ft=this.mapsService.lngLatToContainer([M-360,D]);J.x=Ft.x}if(J.x<0){var gr=this.mapsService.lngLatToContainer([M+360,D]);J.x=gr.x}}(J.x>ze||J.x<0||J.y>dt||J.y<0)&&(d.style.display="none"),d.style.left=J.x+x[0]+"px",d.style.top=J.y-x[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,x=this.markerOption,A=x.color,M=x.anchor;if(!d){this.defaultMarker=!0,d=qe.SO.create("div"),this.markerOption.element=d;var D=document.createElementNS("http://www.w3.org/2000/svg","svg");D.setAttributeNS(null,"display","block"),D.setAttributeNS(null,"height","48px"),D.setAttributeNS(null,"width","48px"),D.setAttributeNS(null,"viewBox","0 0 1024 1024");var te=document.createElementNS("http://www.w3.org/2000/svg","path");te.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),te.setAttributeNS(null,"fill",A),D.appendChild(te),d.appendChild(D)}qe.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(J){var ye,ze,dt=((ye=l.markerOption)===null||ye===void 0?void 0:ye.style)&&((ze=l.markerOption)===null||ze===void 0?void 0:ze.style[J]);d&&(d.style[J]=dt)}),d.addEventListener("click",function(J){l.onMapClick(J)}),d.addEventListener("click",this.eventHandle),(0,qe.zi)(d,M,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(pt.EventEmitter),Jl=y(82492),gl=y.n(Jl);function Lu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Us(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lu(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function yl(n){var c=m();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var w=function(n){(0,Kn.Z)(a,n);var c=yl(a);function a(s){var l,d;return(0,vr.Z)(this,a),d=c.call(this),(0,W.Z)((0,St.Z)(d),"markers",[]),(0,W.Z)((0,St.Z)(d),"markerLayerOption",void 0),(0,W.Z)((0,St.Z)(d),"clusterIndex",void 0),(0,W.Z)((0,St.Z)(d),"points",[]),(0,W.Z)((0,St.Z)(d),"clusterMarkers",[]),(0,W.Z)((0,St.Z)(d),"mapsService",void 0),(0,W.Z)((0,St.Z)(d),"scene",void 0),(0,W.Z)((0,St.Z)(d),"zoom",void 0),(0,W.Z)((0,St.Z)(d),"bbox",void 0),d.markerLayerOption=gl()(d.getDefault(),s),(0,qe.Ev)(["update"],(0,St.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(R.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var x=l.getLnglat(),A=x.lng,M=x.lat,D={geometry:{type:"Point",coordinates:[A,M]},properties:Us(Us({},l.getExtData()),{},{marker_id:d})};this.points.push(D)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,x=l.minZoom,A=x===void 0?0:x,M=l.maxZoom;this.clusterIndex=new(Kt())({radius:d,minZoom:A,maxZoom:M}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var x=this,A=l[0].concat(l[1]),M=this.clusterIndex.getClusters(A,d);this.clusterMarkers.forEach(function(D){D.remove()}),this.clusterMarkers=[],M.forEach(function(D){var te,J=x.markerLayerOption.clusterOption,ye=J.field,ze=J.method;if(D.properties&&(te=D.properties)!==null&&te!==void 0&&te.cluster_id){var dt,Ft=x.getLeaves((dt=D.properties)===null||dt===void 0?void 0:dt.cluster_id);if(D.properties.clusterData=Ft,ye&&ze){var gr=Ft==null?void 0:Ft.map(function(zn){var ri=(0,W.Z)({},ye,zn.properties[ye]);return ri}),Ar=qe.a5.getColumn(gr,ye),Vr=qe.a5.getSatByColumn(ze,Ar),vn="point_"+ze;D.properties[vn]=Vr.toFixed(2)}}var bn=x.clusterMarker(D);x.clusterMarkers.push(bn),bn.addTo(x.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,x):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,x=d,A=x.element,M=A===void 0?this.generateElement.bind(this):A,D=new $u({element:M(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return D}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,qe.oO)(this.bbox,d))&&(this.bbox=(0,qe.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=qe.SO.create("div","l7-marker-cluster"),x=qe.SO.create("div","",d),A=qe.SO.create("span","",x),M=this.markerLayerOption.clusterOption,D=M.field,te=M.method;l.properties.point_count=l.properties.point_count||1;var J=D&&te?l.properties["point_"+te]||l.properties[D]:l.properties.point_count;return A.textContent=J,d}}]),a}(pt.EventEmitter);function j(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function I(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?j(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function pe(n){var c=De();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function De(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ht=function(n){(0,Kn.Z)(a,n);var c=pe(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this),(0,W.Z)((0,St.Z)(l),"popupOption",void 0),(0,W.Z)((0,St.Z)(l),"mapsService",void 0),(0,W.Z)((0,St.Z)(l),"sceneSerive",void 0),(0,W.Z)((0,St.Z)(l),"lngLat",void 0),(0,W.Z)((0,St.Z)(l),"content",void 0),(0,W.Z)((0,St.Z)(l),"closeButton",void 0),(0,W.Z)((0,St.Z)(l),"timeoutInstance",void 0),(0,W.Z)((0,St.Z)(l),"container",void 0),(0,W.Z)((0,St.Z)(l),"tip",void 0),(0,W.Z)((0,St.Z)(l),"scene",void 0),l.popupOption=I(I({},l.getdefault()),s),(0,qe.Ev)(["update","onClickClose","remove"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(R.vK.IMapService),this.sceneSerive=l.get(R.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),x=window.document.createElement("body"),A;for(x.innerHTML=l;A=x.firstChild,!!A;)d.appendChild(A);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&qe.SO.remove(this.content),this.content=qe.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=qe.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,x){var A=window.document.createElement(l);return d!==void 0&&(A.className=d),x&&x.appendChild(A),A}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:qe.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,x=this.popupOption,A=x.className,M=x.maxWidth,D=x.anchor;if(!(!this.mapsService||!d||!this.content)){var te=this.mapsService.getMarkerContainer();if(!this.container&&te){this.container=this.creatDom("div","l7-popup",te),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(ye){return l.container.classList.add(ye)});var J=this.popupOption.stopPropagation;J&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ye){l.container.addEventListener(ye,function(ze){ze.stopPropagation()})})}M&&this.container.style.maxWidth!==M&&(this.container.style.maxWidth=M),this.updatePosition(),qe.SO.setTransform(this.container,"".concat(qe.rQ[D])),(0,qe.zi)(this.container,D,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,x=l.lat,A=this.popupOption.offsets,M=this.mapsService.lngLatToContainer([d,x]);this.container.style.left=M.x+A[0]+"px",this.container.style.top=M.y-A[1]+"px"}}}]),a}(pt.EventEmitter);function Vt(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}Vt(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Wt=y(92137),kr=y(87757),Kr=y.n(kr),cn=y(86700),Oi=y(88307),Ei=y.n(Oi),ha=y(28660),Pa=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"attribute",void 0),(0,W.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,d=a.stride,x=a.normalized,A=a.size,M=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:x||!1,divisor:M||0},A&&(this.attribute.size=A)}return(0,Or.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),ga,_i,po,wo,Ys,lu,Ks,Ru,Go,ys,ro,Ia,$s,_l,_s=(ga={},(0,W.Z)(ga,R.gl.POINTS,"points"),(0,W.Z)(ga,R.gl.LINES,"lines"),(0,W.Z)(ga,R.gl.LINE_LOOP,"line loop"),(0,W.Z)(ga,R.gl.LINE_STRIP,"line strip"),(0,W.Z)(ga,R.gl.TRIANGLES,"triangles"),(0,W.Z)(ga,R.gl.TRIANGLE_FAN,"triangle fan"),(0,W.Z)(ga,R.gl.TRIANGLE_STRIP,"triangle strip"),ga),Dl=(_i={},(0,W.Z)(_i,R.gl.STATIC_DRAW,"static"),(0,W.Z)(_i,R.gl.DYNAMIC_DRAW,"dynamic"),(0,W.Z)(_i,R.gl.STREAM_DRAW,"stream"),_i),Js=(po={},(0,W.Z)(po,R.gl.BYTE,"int8"),(0,W.Z)(po,R.gl.UNSIGNED_INT,"int16"),(0,W.Z)(po,R.gl.INT,"int32"),(0,W.Z)(po,R.gl.UNSIGNED_BYTE,"uint8"),(0,W.Z)(po,R.gl.UNSIGNED_SHORT,"uint16"),(0,W.Z)(po,R.gl.UNSIGNED_INT,"uint32"),(0,W.Z)(po,R.gl.FLOAT,"float"),po),Qs=(wo={},(0,W.Z)(wo,R.gl.ALPHA,"alpha"),(0,W.Z)(wo,R.gl.LUMINANCE,"luminance"),(0,W.Z)(wo,R.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,W.Z)(wo,R.gl.RGB,"rgb"),(0,W.Z)(wo,R.gl.RGBA,"rgba"),(0,W.Z)(wo,R.gl.RGBA4,"rgba4"),(0,W.Z)(wo,R.gl.RGB5_A1,"rgb5 a1"),(0,W.Z)(wo,R.gl.RGB565,"rgb565"),(0,W.Z)(wo,R.gl.DEPTH_COMPONENT,"depth"),(0,W.Z)(wo,R.gl.DEPTH_STENCIL,"depth stencil"),wo),yc=(Ys={},(0,W.Z)(Ys,R.gl.DONT_CARE,"dont care"),(0,W.Z)(Ys,R.gl.NICEST,"nice"),(0,W.Z)(Ys,R.gl.FASTEST,"fast"),Ys),Du=(lu={},(0,W.Z)(lu,R.gl.NEAREST,"nearest"),(0,W.Z)(lu,R.gl.LINEAR,"linear"),(0,W.Z)(lu,R.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,W.Z)(lu,R.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,W.Z)(lu,R.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,W.Z)(lu,R.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),lu),Oa=(Ks={},(0,W.Z)(Ks,R.gl.REPEAT,"repeat"),(0,W.Z)(Ks,R.gl.CLAMP_TO_EDGE,"clamp"),(0,W.Z)(Ks,R.gl.MIRRORED_REPEAT,"mirror"),Ks),xl=(Ru={},(0,W.Z)(Ru,R.gl.NONE,"none"),(0,W.Z)(Ru,R.gl.BROWSER_DEFAULT_WEBGL,"browser"),Ru),Kc=(Go={},(0,W.Z)(Go,R.gl.NEVER,"never"),(0,W.Z)(Go,R.gl.ALWAYS,"always"),(0,W.Z)(Go,R.gl.LESS,"less"),(0,W.Z)(Go,R.gl.LEQUAL,"lequal"),(0,W.Z)(Go,R.gl.GREATER,"greater"),(0,W.Z)(Go,R.gl.GEQUAL,"gequal"),(0,W.Z)(Go,R.gl.EQUAL,"equal"),(0,W.Z)(Go,R.gl.NOTEQUAL,"notequal"),Go),ku=(ys={},(0,W.Z)(ys,R.gl.FUNC_ADD,"add"),(0,W.Z)(ys,R.gl.MIN_EXT,"min"),(0,W.Z)(ys,R.gl.MAX_EXT,"max"),(0,W.Z)(ys,R.gl.FUNC_SUBTRACT,"subtract"),(0,W.Z)(ys,R.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ys),bl=(ro={},(0,W.Z)(ro,R.gl.ZERO,"zero"),(0,W.Z)(ro,R.gl.ONE,"one"),(0,W.Z)(ro,R.gl.SRC_COLOR,"src color"),(0,W.Z)(ro,R.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,W.Z)(ro,R.gl.SRC_ALPHA,"src alpha"),(0,W.Z)(ro,R.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,W.Z)(ro,R.gl.DST_COLOR,"dst color"),(0,W.Z)(ro,R.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,W.Z)(ro,R.gl.DST_ALPHA,"dst alpha"),(0,W.Z)(ro,R.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,W.Z)(ro,R.gl.CONSTANT_COLOR,"constant color"),(0,W.Z)(ro,R.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,W.Z)(ro,R.gl.CONSTANT_ALPHA,"constant alpha"),(0,W.Z)(ro,R.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,W.Z)(ro,R.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),ro),$c=(Ia={},(0,W.Z)(Ia,R.gl.NEVER,"never"),(0,W.Z)(Ia,R.gl.ALWAYS,"always"),(0,W.Z)(Ia,R.gl.LESS,"less"),(0,W.Z)(Ia,R.gl.LEQUAL,"lequal"),(0,W.Z)(Ia,R.gl.GREATER,"greater"),(0,W.Z)(Ia,R.gl.GEQUAL,"gequal"),(0,W.Z)(Ia,R.gl.EQUAL,"equal"),(0,W.Z)(Ia,R.gl.NOTEQUAL,"notequal"),Ia),Ju=($s={},(0,W.Z)($s,R.gl.ZERO,"zero"),(0,W.Z)($s,R.gl.KEEP,"keep"),(0,W.Z)($s,R.gl.REPLACE,"replace"),(0,W.Z)($s,R.gl.INVERT,"invert"),(0,W.Z)($s,R.gl.INCR,"increment"),(0,W.Z)($s,R.gl.DECR,"decrement"),(0,W.Z)($s,R.gl.INCR_WRAP,"increment wrap"),(0,W.Z)($s,R.gl.DECR_WRAP,"decrement wrap"),$s),Ql=(_l={},(0,W.Z)(_l,R.gl.FRONT,"front"),(0,W.Z)(_l,R.gl.BACK,"back"),_l),Pu=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,d=a.type;this.buffer=c.buffer({data:s,usage:Dl[l||R.gl.STATIC_DRAW],type:Js[d||R.gl.UNSIGNED_BYTE]})}return(0,Or.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),Qu=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"elements",void 0);var s=a.data,l=a.usage,d=a.type,x=a.count;this.elements=c.elements({data:s,usage:Dl[l||R.gl.STATIC_DRAW],type:Js[d||R.gl.UNSIGNED_BYTE],count:x})}return(0,Or.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),Sl=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,d=a.color,x=a.colors,A=a.depth,M=a.stencil,D={width:s,height:l};Array.isArray(x)&&(D.colors=x.map(function(te){return te.get()})),d&&typeof d!="boolean"&&(D.color=d.get()),this.framebuffer=c.framebuffer(D)}return(0,Or.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),El=y(90484),qu=y(36719),Cl=y.n(qu),el=y(68630),qs=y.n(el);function ql(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Fu(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ql(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ql(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Oc=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"reGl",void 0),(0,W.Z)(this,"destroyed",!1),(0,W.Z)(this,"drawCommand",void 0),(0,W.Z)(this,"drawParams",void 0),(0,W.Z)(this,"options",void 0),(0,W.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,d=a.attributes,x=a.uniforms,A=a.primitive,M=a.count,D=a.elements,te=a.depth,J=a.blend,ye=a.stencil,ze=a.cull,dt=a.instances,Ft={};this.options=a,x&&(this.uniforms=this.extractUniforms(x),Object.keys(x).forEach(function(Vr){Ft[Vr]=c.prop(Vr)}));var gr={};Object.keys(d).forEach(function(Vr){gr[Vr]=d[Vr].get()});var Ar={attributes:gr,frag:l,uniforms:Ft,vert:s,primitive:_s[A===void 0?R.gl.TRIANGLES:A]};dt&&(Ar.instances=dt),M&&(Ar.count=M),D&&(Ar.elements=D.get()),this.initDepthDrawParams({depth:te},Ar),this.initBlendDrawParams({blend:J},Ar),this.initStencilDrawParams({stencil:ye},Ar),this.initCullDrawParams({cull:ze},Ar),this.drawCommand=c(Ar),this.drawParams=Ar}return(0,Or.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=Fu(Fu({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Fu(Fu({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(d){var x=(0,El.Z)(s[d]);x==="boolean"||x==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:Kc[l.func||R.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var d=l.enable,x=l.func,A=l.equation,M=l.color,D=M===void 0?[0,0,0,0]:M;s.blend={enable:!!d,func:{srcRGB:bl[x&&x.srcRGB||R.gl.SRC_ALPHA],srcAlpha:bl[x&&x.srcAlpha||R.gl.SRC_ALPHA],dstRGB:bl[x&&x.dstRGB||R.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:bl[x&&x.dstAlpha||R.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ku[A&&A.rgb||R.gl.FUNC_ADD],alpha:ku[A&&A.alpha||R.gl.FUNC_ADD]},color:D}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var d=l.enable,x=l.mask,A=x===void 0?-1:x,M=l.func,D=M===void 0?{cmp:R.gl.ALWAYS,ref:0,mask:-1}:M,te=l.opFront,J=te===void 0?{fail:R.gl.KEEP,zfail:R.gl.KEEP,zpass:R.gl.KEEP}:te,ye=l.opBack,ze=ye===void 0?{fail:R.gl.KEEP,zfail:R.gl.KEEP,zpass:R.gl.KEEP}:ye;s.stencil={enable:!!d,mask:A,func:Fu(Fu({},D),{},{cmp:$c[D.cmp]}),opFront:{fail:Ju[J.fail],zfail:Ju[J.zfail],zpass:Ju[J.zpass]},opBack:{fail:Ju[ze.fail],zfail:Ju[ze.zfail],zpass:Ju[ze.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var d=l.enable,x=l.face,A=x===void 0?R.gl.BACK:x;s.cull={enable:!!d,face:Ql[A]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(d){s.extractUniformsRecursively(d,a[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,d){var x=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||Cl()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(a)]=s;return}qs()(s)&&Object.keys(s).forEach(function(A){x.extractUniformsRecursively(A,s[A],l,"".concat(d&&d+".").concat(a))}),Array.isArray(s)&&s.forEach(function(A,M){Object.keys(A).forEach(function(D){x.extractUniformsRecursively(D,A[D],l,"".concat(d&&d+".").concat(a,"[").concat(M,"]"))})})}}]),n}(),tl=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"texture",void 0),(0,W.Z)(this,"width",void 0),(0,W.Z)(this,"height",void 0);var s=a.data,l=a.type,d=l===void 0?R.gl.UNSIGNED_BYTE:l,x=a.width,A=a.height,M=a.flipY,D=M===void 0?!1:M,te=a.format,J=te===void 0?R.gl.RGBA:te,ye=a.mipmap,ze=ye===void 0?!1:ye,dt=a.wrapS,Ft=dt===void 0?R.gl.CLAMP_TO_EDGE:dt,gr=a.wrapT,Ar=gr===void 0?R.gl.CLAMP_TO_EDGE:gr,Vr=a.aniso,vn=Vr===void 0?0:Vr,bn=a.alignment,zn=bn===void 0?1:bn,ri=a.premultiplyAlpha,ii=ri===void 0?!1:ri,Si=a.mag,ea=Si===void 0?R.gl.NEAREST:Si,ya=a.min,yi=ya===void 0?R.gl.NEAREST:ya,Ta=a.colorSpace,za=Ta===void 0?R.gl.BROWSER_DEFAULT_WEBGL:Ta;this.width=x,this.height=A;var ou={width:x,height:A,type:Js[d],format:Qs[J],wrapS:Oa[Ft],wrapT:Oa[Ar],mag:Du[ea],min:Du[yi],alignment:zn,flipY:D,colorSpace:xl[za],premultiplyAlpha:ii,aniso:vn};s&&(ou.data=s),typeof ze=="number"?ou.mipmap=yc[ze]:typeof ze=="boolean"&&(ou.mipmap=ze),this.texture=c.texture(ou)}return(0,Or.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),wl,kl,_c=(wl=(0,cn.b2)(),wl(kl=function(){function n(){var c=this;(0,vr.Z)(this,n),(0,W.Z)(this,"extensionObject",void 0),(0,W.Z)(this,"gl",void 0),(0,W.Z)(this,"$container",void 0),(0,W.Z)(this,"canvas",void 0),(0,W.Z)(this,"width",void 0),(0,W.Z)(this,"height",void 0),(0,W.Z)(this,"isDirty",void 0),(0,W.Z)(this,"createModel",function(a){return new Oc(c.gl,a)}),(0,W.Z)(this,"createAttribute",function(a){return new Pa(c.gl,a)}),(0,W.Z)(this,"createBuffer",function(a){return new Pu(c.gl,a)}),(0,W.Z)(this,"createElements",function(a){return new Qu(c.gl,a)}),(0,W.Z)(this,"createTexture2D",function(a){return new tl(c.gl,a)}),(0,W.Z)(this,"createFramebuffer",function(a){return new Sl(c.gl,a)}),(0,W.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,W.Z)(this,"clear",function(a){var s=a.color,l=a.depth,d=a.stencil,x=a.framebuffer,A=x===void 0?null:x,M={color:s,depth:l,stencil:d};M.framebuffer=A===null?A:A.get(),c.gl.clear(M)}),(0,W.Z)(this,"viewport",function(a){var s=a.x,l=a.y,d=a.width,x=a.height;c.gl._gl.viewport(s,l,d,x),c.width=d,c.height=x,c.gl._refresh()}),(0,W.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,d=a.y,x=a.width,A=a.height,M={x:l,y:d,width:x,height:A};return s&&(M.framebuffer=s.get()),c.gl.read(M)}),(0,W.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,W.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,W.Z)(this,"getCanvas",function(){return c.canvas}),(0,W.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,W.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,Or.Z)(n,[{key:"init",value:function(){var c=(0,Wt.Z)(Kr().mark(function s(l,d){var x=this;return Kr().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return this.canvas=l,M.next=3,new Promise(function(D,te){Ei()({canvas:x.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(ye,ze){(ye||!ze)&&te(ye),D(ze)}})});case 3:this.gl=M.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return M.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||kl);function Fl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Lc(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Fl(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Fl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ec=function(){function n(c){(0,vr.Z)(this,n),(0,W.Z)(this,"sceneService",void 0),(0,W.Z)(this,"mapService",void 0),(0,W.Z)(this,"controlService",void 0),(0,W.Z)(this,"layerService",void 0),(0,W.Z)(this,"iconService",void 0),(0,W.Z)(this,"markerService",void 0),(0,W.Z)(this,"popupService",void 0),(0,W.Z)(this,"fontService",void 0),(0,W.Z)(this,"interactionService",void 0),(0,W.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,R.Hp)();this.container=l,s.setContainer(l,a),l.bind(R.vK.IRendererService).to(_c).inSingletonScope(),this.sceneService=l.get(R.vK.ISceneService),this.mapService=l.get(R.vK.IMapService),this.iconService=l.get(R.vK.IIconService),this.fontService=l.get(R.vK.IFontService),this.controlService=l.get(R.vK.IControlService),this.layerService=l.get(R.vK.ILayerService),this.markerService=l.get(R.vK.IMarkerService),this.interactionService=l.get(R.vK.IInteractionService),this.popupService=l.get(R.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,Or.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var d=new a(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"setBgColor",value:function(a){this.mapService.setBgColor(a)}},{key:"addLayer",value:function(a){var s=(0,R.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var d=(0,$i.Z)(l,2),x=d[0],A=d[1];s.fontService.addIconFont(x,A)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){R.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){R.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){R.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a,s){this.mapService.panBy(a,s)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,x=l.animate;this.mapService.fitBounds(a,s||Lc(Lc({},d),{},{animate:x}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(R.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:qe.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new qo({position:l}))}}]),n}(),Zs=y(81253),no=y(55770),_o=y(3473),Bu=y(13218),Ds=y.n(Bu),Bl,tc,gu,rc,Nu;function io(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Nl=(Bl=(0,cn.b2)(),tc=(0,cn.f3)(R.vK.IGlobalConfigService),Bl(gu=(rc=function(){function n(){(0,vr.Z)(this,n),(0,no.Z)(this,"configService",Nu,this),(0,W.Z)(this,"enabled",void 0)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.rendererService,x=s.postProcessingPassFactory,A=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var M=a.getLayerConfig(),D=M.enableMultiPassRenderer,te=M.passes,J=te===void 0?[]:te;l.enabled=!!D&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,J,x,A),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,d){var x=a.multiPassRenderer,A=a.getLayerConfig(),M=A.enablePicking,D=A.enableTAA;return M&&x.add(d("pixelPicking")),x}}]),n}(),Nu=(0,_o.Z)(rc.prototype,"configService",[tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc))||gu),js,cu=(js={},(0,W.Z)(js,R.BlendType.additive,{enable:!0,func:{srcRGB:R.gl.ONE,dstRGB:R.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,W.Z)(js,R.BlendType.none,{enable:!1}),(0,W.Z)(js,R.BlendType.normal,{enable:!0,func:{srcRGB:R.gl.SRC_ALPHA,dstRGB:R.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,W.Z)(js,R.BlendType.subtractive,{enable:!0,func:{srcRGB:R.gl.ONE,dstRGB:R.gl.ONE,srcAlpha:R.gl.ZERO,dstAlpha:R.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:R.gl.FUNC_SUBTRACT,alpha:R.gl.FUNC_SUBTRACT}}),(0,W.Z)(js,R.BlendType.max,{enable:!0,func:{srcRGB:R.gl.ONE,dstRGB:R.gl.ONE},equation:{rgb:R.gl.MAX_EXT}}),(0,W.Z)(js,R.BlendType.min,{enable:!0,func:{srcRGB:R.gl.ONE,dstRGB:R.gl.ONE},equation:{rgb:R.gl.MIN_EXT}}),js),la=y(81763),Pi=y.n(la),xs=y(1469),fu=y.n(xs),rl=1024;function es(n,c,a,s,l){c.updateStyleAttribute(n,a,s,l)}function Jc(n,c){n.opacity&&Rc("opacity",c,n.opacity),n.strokeWidth&&Rc("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&Rc("strokeOpacity",c,n.strokeOpacity),n.stroke&&zl("stroke",c,n.stroke),n.offsets&&Al("offsets",c,n.offsets),n.textOffset&&Al("textOffset",c,n.textOffset)}function Rc(n,c,a){N()(a)?es(n,c,a,function(s){return s}):Pi()(a)?es(n,c,[a],void 0):fu()(a)&&a.length===2?N()(a[0])&&de()(a[1])||N()(a[0])&&fu()(a[1])&&Pi()(a[1][0])&&Pi()(a[1][1])?es(n,c,a[0],a[1]):es(n,c,[1],void 0):es(n,c,[1],void 0)}function Al(n,c,a){N()(a)?es(n,c,a,function(s){return s}):fu()(a)&&a.length===2&&N()(a[0])&&de()(a[1])?es(n,c,a[0],a[1]):fu()(a)&&a.length===2&&Pi()(a[0])&&Pi()(a[1])?es(n,c,a,void 0):es(n,c,[0,0],void 0)}function zl(n,c,a){N()(a)?es(n,c,a,void 0):fu()(a)&&a.length===2&&(N()(a[0])&&de()(a[1])||N()(a[0])&&fu()(a[1])&&a[1].length>0)?es(n,c,a[0],a[1]):es(n,c,"#fff",void 0)}var yu,Ao,zu,Tl,To;function Rn(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=lo(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var D=a.next();return d=D.done,D},e:function(D){x=!0,A=D},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function lo(n,c){if(!!n){if(typeof n=="string")return _u(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _u(n,c)}}function _u(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Uu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ya(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Uu(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Uu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ks(n){var c=xc();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Sn=0,Mu=(yu=(0,R.yT)(R.vK.IGlobalConfigService),Ao=(0,R.yT)(R.vK.IShaderModuleService),zu=function(n){(0,Kn.Z)(a,n);var c=ks(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,vr.Z)(this,a),s=c.call(this),(0,W.Z)((0,St.Z)(s),"id","".concat(Sn++)),(0,W.Z)((0,St.Z)(s),"name","".concat(Sn)),(0,W.Z)((0,St.Z)(s),"type",void 0),(0,W.Z)((0,St.Z)(s),"visible",!0),(0,W.Z)((0,St.Z)(s),"zIndex",0),(0,W.Z)((0,St.Z)(s),"minZoom",void 0),(0,W.Z)((0,St.Z)(s),"maxZoom",void 0),(0,W.Z)((0,St.Z)(s),"inited",!1),(0,W.Z)((0,St.Z)(s),"layerModelNeedUpdate",!1),(0,W.Z)((0,St.Z)(s),"pickedFeatureID",null),(0,W.Z)((0,St.Z)(s),"selectedFeatureID",null),(0,W.Z)((0,St.Z)(s),"styleNeedUpdate",!1),(0,W.Z)((0,St.Z)(s),"rendering",void 0),(0,W.Z)((0,St.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,W.Z)((0,St.Z)(s),"hooks",{init:new xe.oI,afterInit:new xe.oI,beforeRender:new xe.oI,beforeRenderData:new xe.gg,afterRender:new xe.ni,beforePickingEncode:new xe.ni,afterPickingEncode:new xe.ni,beforeHighlight:new xe.ni(["pickedColor"]),afterHighlight:new xe.ni,beforeSelect:new xe.ni(["pickedColor"]),afterSelect:new xe.ni,beforeDestroy:new xe.ni,afterDestroy:new xe.ni}),(0,W.Z)((0,St.Z)(s),"models",[]),(0,W.Z)((0,St.Z)(s),"multiPassRenderer",void 0),(0,W.Z)((0,St.Z)(s),"plugins",void 0),(0,W.Z)((0,St.Z)(s),"sourceOption",void 0),(0,W.Z)((0,St.Z)(s),"layerModel",void 0),(0,no.Z)((0,St.Z)(s),"configService",Tl,(0,St.Z)(s)),(0,no.Z)((0,St.Z)(s),"shaderModuleService",To,(0,St.Z)(s)),(0,W.Z)((0,St.Z)(s),"cameraService",void 0),(0,W.Z)((0,St.Z)(s),"coordinateService",void 0),(0,W.Z)((0,St.Z)(s),"iconService",void 0),(0,W.Z)((0,St.Z)(s),"fontService",void 0),(0,W.Z)((0,St.Z)(s),"pickingService",void 0),(0,W.Z)((0,St.Z)(s),"rendererService",void 0),(0,W.Z)((0,St.Z)(s),"layerService",void 0),(0,W.Z)((0,St.Z)(s),"interactionService",void 0),(0,W.Z)((0,St.Z)(s),"mapService",void 0),(0,W.Z)((0,St.Z)(s),"styleAttributeService",void 0),(0,W.Z)((0,St.Z)(s),"layerSource",void 0),(0,W.Z)((0,St.Z)(s),"postProcessingPassFactory",void 0),(0,W.Z)((0,St.Z)(s),"normalPassFactory",void 0),(0,W.Z)((0,St.Z)(s),"animateOptions",{enable:!1}),(0,W.Z)((0,St.Z)(s),"container",void 0),(0,W.Z)((0,St.Z)(s),"encodedData",void 0),(0,W.Z)((0,St.Z)(s),"configSchema",void 0),(0,W.Z)((0,St.Z)(s),"currentPickId",null),(0,W.Z)((0,St.Z)(s),"rawConfig",void 0),(0,W.Z)((0,St.Z)(s),"needUpdateConfig",void 0),(0,W.Z)((0,St.Z)(s),"pendingStyleAttributes",[]),(0,W.Z)((0,St.Z)(s),"scaleOptions",{}),(0,W.Z)((0,St.Z)(s),"animateStartTime",void 0),(0,W.Z)((0,St.Z)(s),"aniamateStatus",!1),(0,W.Z)((0,St.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),x=d.autoFit,A=d.fitBoundsOptions;x&&s.fitBounds(A),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,Or.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=Ya(Ya({},this.needUpdateConfig),l);else{var d=this.container.get(R.vK.SceneID);Jc(l,this),this.configService.setLayerConfig(d,this.id,Ya(Ya(Ya({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(R.vK.SceneID),x=this.rawConfig.enableMultiPassRenderer,A=x===void 0?!1:x;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(R.vK.IIconService),this.fontService=this.container.get(R.vK.IFontService),this.rendererService=this.container.get(R.vK.IRendererService),this.layerService=this.container.get(R.vK.ILayerService),this.interactionService=this.container.get(R.vK.IInteractionService),this.pickingService=this.container.get(R.vK.IPickingService),this.mapService=this.container.get(R.vK.IMapService),this.cameraService=this.container.get(R.vK.ICameraService),this.coordinateService=this.container.get(R.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(R.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(R.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(R.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(R.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(J){var ye=J.attributeName,ze=J.attributeField,dt=J.attributeValues,Ft=J.updateOptions;l.styleAttributeService.updateStyleAttribute(ye,{scale:Ya({field:ze},l.splitValuesAndCallbackInAttribute(dt,l.getLayerConfig()[ye]))},Ft)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(R.vK.ILayerPlugin);var M=Rn(this.plugins),D;try{for(M.s();!(D=M.n()).done;){var te=D.value;te.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(J){M.e(J)}finally{M.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Ya(Ya({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,x){return this.updateStyleAttribute("color",l,d,x),this}},{key:"texture",value:function(l,d,x){return this.updateStyleAttribute("texture",l,d,x),this}},{key:"rotate",value:function(l,d,x){return this.updateStyleAttribute("rotate",l,d,x),this}},{key:"size",value:function(l,d,x){return this.updateStyleAttribute("size",l,d,x),this}},{key:"filter",value:function(l,d,x){return this.updateStyleAttribute("filter",l,d,x),this}},{key:"shape",value:function(l,d,x){return this.updateStyleAttribute("shape",l,d,x),this}},{key:"label",value:function(l,d,x){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:x}),this}},{key:"animate",value:function(l){var d={};return Ds()(l)?(d.enable=!0,d=Ya(Ya({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return l!=null&&l.data?(this.setSource(l),this):(this.sourceOption={data:l,options:d},this)}},{key:"setData",value:function(l,d){var x=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){x.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,x=l.passes,A=(0,Zs.Z)(l,["passes"]);return x&&io(x).forEach(function(M){var D=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(M[0]);D&&D.updateOptions(M[1])}),this.rawConfig=Ya(Ya({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return Ds()(l)?this.scaleOptions=Ya(Ya({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=Ds()(l)?!0:l,Ds()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var x=this;if(Ds()(l)){var A=l.x,M=A===void 0?0:A,D=l.y,te=D===void 0?0:D;this.updateLayerConfig({highlightColor:Ds()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:M,y:te})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Ds()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,qe.Z6)(l)).then(function(){setTimeout(function(){x.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=Ds()(l)?!0:l,Ds()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var x=this;if(Ds()(l)){var A=l.x,M=A===void 0?0:A,D=l.y,te=D===void 0?0:D;this.updateLayerConfig({selectColor:Ds()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:M,y:te})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Ds()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,qe.Z6)(l)).then(function(){setTimeout(function(){x.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),x=d.visible,A=d.minZoom,M=A===void 0?-Infinity:A,D=d.maxZoom,te=D===void 0?Infinity:D;return!!x&&l>=M&&l<=te}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),x=d.extent,A=x.some(function(M){return Math.abs(M)===Infinity});return A?this:(this.mapService.fitBounds([[x[0],x[1]],[x[2],x[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var x=d.ticks().map(function(M){return(0,W.Z)({value:M},l,d(M))});return x}else if(d.invertExtent){var A=d.range().map(function(M){return(0,W.Z)({value:d.invertExtent(M)},l,M)});return A}}else return[]}},{key:"pick",value:function(l){var d=l.x,x=l.y;this.interactionService.triggerHover({x:d,y:x})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,x=l.vertexShader,A=l.fragmentShader,M=l.triangulation,D=l.segmentNumber,te=(0,Zs.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(d,{vs:x,fs:A});var J=this.shaderModuleService.getModule(d),ye=J.vs,ze=J.fs,dt=J.uniforms,Ft=this.rendererService.createModel,gr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,M,D),Ar=gr.attributes,Vr=gr.elements;return Ft(Ya({attributes:Ar,uniforms:dt,fs:ze,vs:ye,elements:Vr,blend:cu[R.BlendType.normal]},te))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),x=d.enableHighlight,A=x===void 0?!0:x,M=d.enableSelect,D=M===void 0?!0:M,te=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&D&&(te=!0),l==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(te=!0),this.isVisible()&&te}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,x,A){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:Ya({field:d},this.splitValuesAndCallbackInAttribute(x,this.getLayerConfig()[d]))},A):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:x,updateOptions:A})}},{key:"setEarthTime",value:function(l){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:de()(l)?void 0:l||d,callback:de()(l)?l:void 0}}}]),a}(pt.EventEmitter),Tl=(0,_o.Z)(zu.prototype,"configService",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=(0,_o.Z)(zu.prototype,"shaderModuleService",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu),bc=y(18446),eu=y.n(bc),Ua=y(2650),bs,Pl,tu,Ts,xu;function Qc(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=nc(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var D=a.next();return d=D.done,D},e:function(D){x=!0,A=D},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function nc(n,c){if(!!n){if(typeof n=="string")return ic(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ic(n,c)}}function ic(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var ko=(bs=(0,R.yT)(R.vK.IGlobalConfigService),Pl=(0,R.yT)(R.vK.IShaderModuleService),tu=function(){function n(c){(0,vr.Z)(this,n),(0,W.Z)(this,"triangulation",void 0),(0,W.Z)(this,"createTexture2D",void 0),(0,W.Z)(this,"layer",void 0),(0,W.Z)(this,"dataTexture",void 0),(0,W.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,W.Z)(this,"rowCount",void 0),(0,W.Z)(this,"cacheStyleProperties",void 0),(0,W.Z)(this,"cellLength",void 0),(0,W.Z)(this,"cellProperties",void 0),(0,W.Z)(this,"cellTypeLayout",void 0),(0,W.Z)(this,"stylePropertyesExist",void 0),(0,W.Z)(this,"dataTextureTest",void 0),(0,no.Z)(this,"configService",Ts,this),(0,no.Z)(this,"shaderModuleService",xu,this),(0,W.Z)(this,"rendererService",void 0),(0,W.Z)(this,"iconService",void 0),(0,W.Z)(this,"fontService",void 0),(0,W.Z)(this,"styleAttributeService",void 0),(0,W.Z)(this,"mapService",void 0),(0,W.Z)(this,"cameraService",void 0),(0,W.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(R.vK.IRendererService),this.styleAttributeService=c.getContainer().get(R.vK.IStyleAttributeService),this.mapService=c.getContainer().get(R.vK.IMapService),this.iconService=c.getContainer().get(R.vK.IIconService),this.fontService=c.getContainer().get(R.vK.IFontService),this.cameraService=c.getContainer().get(R.vK.ICameraService),this.layerService=c.getContainer().get(R.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:R.gl.NEAREST,min:R.gl.NEAREST,width:1,height:1}))}return(0,Or.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return eu()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),eu()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),eu()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),eu()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),eu()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!Pi()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!Pi()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!Pi()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return N()(a)?!!(0,Ua.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,qe.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(fu()(a)&&a.length===2&&Pi()(a[0])&&Pi()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var d=Qc(l),x;try{for(d.s();!(x=d.n()).done;){var A=x.value,M=A.attr,D=A.count,te=s[M];te?M==="stroke"?a.push.apply(a,(0,se.Z)((0,qe.CI)(te))):M==="offsets"?this.isOffsetStatic(te)?a.push(-te[0],te[1]):a.push(0,0):a.push(Pi()(te)?te:1):this.patchMod(a,D)}}catch(J){d.e(J)}finally{d.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var d=s.length,x=Math.ceil(d*a/this.DATA_TEXTURE_WIDTH),A=x*this.DATA_TEXTURE_WIDTH,M=[],D=0;D<d;D++){var te=s[D];this.patchData(M,te,l)}for(var J=M.length;J<A;J++)M.push(-1);return{data:M,width:this.DATA_TEXTURE_WIDTH,height:x}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return cu[R.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),Ts=(0,_o.Z)(tu.prototype,"configService",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xu=(0,_o.Z)(tu.prototype,"shaderModuleService",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu),Vs=y(9187),Po=y.n(Vs),ta=100,Zu=36,hu=40;function Ho(n){return n/180*Math.acos(-1)}function nl(n){var c=Ho(n[0])+Math.PI/2,a=Ho(n[1]),s=ta+Math.random()*.4,l=s*Math.cos(a)*Math.cos(c),d=s*Math.cos(a)*Math.sin(c),x=s*Math.sin(a);return[d,x,l]}function bu(n,c){var a=mat4.create(),s=mat4.create(),l=vec3.fromValues(0,1,0),d=vec3.fromValues(0,0,0);c=c||{},n=typeof n!="undefined"?n:1;for(var x=typeof c.segments!="undefined"?c.segments:32,A=2+x,M=2*A,D=[],te=[],J=[],ye=[],ze=[],dt=[],Ft=0;Ft<=A;Ft++){for(var gr=Ft/A,Ar=gr*Math.PI,Vr=0;Vr<=M;Vr++){var vn=Vr/M,bn=vn*Math.PI*2;mat4.identity(s),mat4.rotateZ(s,s,-Ar),mat4.identity(a),mat4.rotateY(a,a,bn),vec3.transformMat4(d,l,s),vec3.transformMat4(d,d,a),vec3.scale(d,d,-n),J.push(d.slice()),ye.push.apply(ye,_toConsumableArray(d.slice())),vec3.normalize(d,d),ze.push.apply(ze,_toConsumableArray(d.slice())),dt.push([vn,1-gr]),ye.push(vn,1-gr)}if(Ft>0)for(var zn=J.length,ri=zn-2*(M+1);ri+M+2<zn;ri++)D.push([ri,ri+1,ri+M+1]),te.push(ri,ri+1,ri+M+1),D.push([ri+M+1,ri+1,ri+M+2]),te.push(ri+M+1,ri+1,ri+M+2)}return{cells:D,positions:J,uvs:dt,positionsArr:ye,indicesArr:te,normalArr:ze}}var bi=y(31437),co=bi.Ue(),Ml=bi.Ue(),Vn=bi.Ue(),Gn=bi.Ue(),il=bi.Ue();function ts(n,c,a,s,l){bi.IH(n,a,s),bi.Fv(n,n),c=bi.al(-n[1],n[0]);var d=bi.al(-a[1],a[0]);return[l/bi.AK(c,d),c]}function ls(n,c){return bi.t8(n,-c[1],c[0])}function Mo(n,c,a){return bi.lu(n,c,a),bi.Fv(n,n),n}function ru(n,c){return n[0]===c[0]&&n[1]===c[1]}function Dc(n){for(var c=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(a,1),a++):c.set(s,s)}return n}var ac=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vr.Z)(this,n),(0,W.Z)(this,"complex",void 0),(0,W.Z)(this,"join",void 0),(0,W.Z)(this,"cap",void 0),(0,W.Z)(this,"miterLimit",void 0),(0,W.Z)(this,"thickness",void 0),(0,W.Z)(this,"normal",void 0),(0,W.Z)(this,"lastFlip",-1),(0,W.Z)(this,"miter",bi.al(0,0)),(0,W.Z)(this,"started",!1),(0,W.Z)(this,"dash",!1),(0,W.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Or.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=a.length,x=l.startIndex,A=1;A<d;A++){var M=a[A-1],D=s[A-1],te=a[A],J=s[A],ye=A<a.length-1?a[A+1]:null,ze=A<s.length-1?s[A+1]:null,dt=this.segment_gaode2(l,x,M,te,ye,D,J,ze);x+=dt}if(this.dash)for(var Ft=0;Ft<l.positions.length/6;Ft++)l.positions[Ft*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,d=s.startIndex,x=1;x<l;x++){var A=a[x-1],M=a[x],D=x<a.length-1?a[x+1]:null,te=this.segment(s,d,A,M,D);d+=te}if(this.dash)for(var J=0;J<s.positions.length/6;J++)s.positions[J*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,d,x,A,M,D){var te=0,J=a.indices,ye=a.positions,ze=a.normals,dt=this.cap==="square",Ft=this.join==="bevel",gr=(0,qe.Z)([M[0],M[1]]),Ar=(0,qe.Z)([A[0],A[1]]);Mo(Vn,d,l);var Vr=0;if(this.dash&&(Vr=this.lineSegmentDistance(gr,Ar),this.totalDistance+=Vr),this.normal||(this.normal=bi.Ue(),ls(this.normal,Vn)),!this.started)if(this.started=!0,dt){var vn=bi.Ue(),bn=bi.Ue();bi.IH(vn,this.normal,Vn),bi.IH(bn,this.normal,Vn),ze.push(bn[0],bn[1],0),ze.push(vn[0],vn[1],0),ye.push(l[0],l[1],0,this.totalDistance-Vr,-this.thickness,0),ye.push(l[0],l[1],0,this.totalDistance-Vr,this.thickness,0)}else this.extrusions(ye,ze,l,this.normal,this.thickness,this.totalDistance-Vr);if(J.push(s+0,s+1,s+2),x){ru(d,x)&&bi.IH(x,d,bi.Fv(x,bi.$X(x,d,l))),Mo(Gn,x,d);var ii=ts(il,bi.Ue(),Vn,Gn,this.thickness),Si=(0,$i.Z)(ii,2),ea=Si[0],ya=Si[1],yi=bi.AK(il,this.normal)<0?-1:1,Ta=Ft;if(!Ta&&this.join==="miter"){var za=ea;za>this.miterLimit&&(Ta=!0)}Ta?(ze.push(this.normal[0],this.normal[1],0),ze.push(ya[0],ya[1],0),ye.push(d[0],d[1],0,this.totalDistance,-this.thickness*yi,0),ye.push(d[0],d[1],0,this.totalDistance,this.thickness*yi,0),J.push.apply(J,(0,se.Z)(this.lastFlip!==-yi?[s,s+2,s+3]:[s+2,s+1,s+3])),J.push(s+2,s+3,s+4),ls(co,Gn),bi.JG(this.normal,co),ze.push(this.normal[0],this.normal[1],0),ye.push(d[0],d[1],0,this.totalDistance,-this.thickness*yi,0),te+=3):(this.extrusions(ye,ze,d,ya,ea,this.totalDistance),J.push.apply(J,(0,se.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),yi=-1,bi.JG(this.normal,ya),te+=2),this.lastFlip=yi}else{if(ls(this.normal,Vn),dt){var zn=bi.Ue(),ri=bi.Ue();bi.lu(ri,Vn,this.normal),bi.IH(zn,Vn,this.normal),ze.push(ri[0],ri[1],0),ze.push(zn[0],zn[1],0),ye.push(d[0],d[1],0,this.totalDistance,this.thickness,0),ye.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ye,ze,d,this.normal,this.thickness,this.totalDistance);J.push.apply(J,(0,se.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),te+=2}return te}},{key:"segment",value:function(a,s,l,d,x){var A=0,M=a.indices,D=a.positions,te=a.normals,J=this.cap==="square",ye=this.join==="bevel",ze=(0,qe.Z)([d[0],d[1]]),dt=(0,qe.Z)([l[0],l[1]]);Mo(Vn,ze,dt);var Ft=0;if(this.dash&&(Ft=this.lineSegmentDistance(ze,dt),this.totalDistance+=Ft),this.normal||(this.normal=bi.Ue(),ls(this.normal,Vn)),!this.started)if(this.started=!0,J){var gr=bi.Ue(),Ar=bi.Ue();bi.IH(gr,this.normal,Vn),bi.IH(Ar,this.normal,Vn),te.push(Ar[0],Ar[1],0),te.push(gr[0],gr[1],0),D.push(l[0],l[1],0,this.totalDistance-Ft,-this.thickness,0),D.push(l[0],l[1],0,this.totalDistance-Ft,this.thickness,0)}else this.extrusions(D,te,l,this.normal,this.thickness,this.totalDistance-Ft);if(M.push(s+0,s+1,s+2),x){var bn=(0,qe.Z)([x[0],x[1]]);ru(ze,bn)&&bi.IH(bn,ze,bi.Fv(bn,bi.$X(bn,ze,dt))),Mo(Gn,bn,ze);var zn=ts(il,bi.Ue(),Vn,Gn,this.thickness),ri=(0,$i.Z)(zn,2),ii=ri[0],Si=ri[1],ea=bi.AK(il,this.normal)<0?-1:1,ya=ye;if(!ya&&this.join==="miter"){var yi=ii;yi>this.miterLimit&&(ya=!0)}ya?(te.push(this.normal[0],this.normal[1],0),te.push(Si[0],Si[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*ea,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness*ea,0),M.push.apply(M,(0,se.Z)(this.lastFlip!==-ea?[s,s+2,s+3]:[s+2,s+1,s+3])),M.push(s+2,s+3,s+4),ls(co,Gn),bi.JG(this.normal,co),te.push(this.normal[0],this.normal[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*ea,0),A+=3):(this.extrusions(D,te,d,Si,ii,this.totalDistance),M.push.apply(M,(0,se.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),ea=-1,bi.JG(this.normal,Si),A+=2),this.lastFlip=ea}else{if(ls(this.normal,Vn),J){var Vr=bi.Ue(),vn=bi.Ue();bi.lu(vn,Vn,this.normal),bi.IH(Vr,Vn,this.normal),te.push(vn[0],vn[1],0),te.push(Vr[0],Vr[1],0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(D,te,d,this.normal,this.thickness,this.totalDistance);M.push.apply(M,(0,se.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),A+=2}return A}},{key:"extrusions",value:function(a,s,l,d,x,A){s.push(d[0],d[1],0),s.push(d[0],d[1],0),a.push(l[0],l[1],0,A,-x,0),a.push(l[0],l[1],0,A,x,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],d=s[1]-a[1];return Math.sqrt(l*l+d*d)}}]),n}();function Wi(n){if(Pi()(n[0]))return n;if(Pi()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Pi()(n[0][0][0])){var c=n,a=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(x){a+=x[0],s+=x[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Zi=y(77160);function qc(n){var c=n[0][0],a=n[0][n[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=Po().flatten(n),d=l.vertices,x=l.dimensions,A=[],M=[],D=0;D<d.length/x;D++)x===2?A.push(d[D*2],d[D*2+1],1):A.push(d[D*3],d[D*3+1],1);var te=Po()(l.vertices,l.holes,l.dimensions);M.push.apply(M,(0,se.Z)(te));for(var J=function(dt){var Ft=l.vertices.slice(dt*x,(dt+1)*x),gr=l.vertices.slice((dt+1)*x,(dt+2)*x);gr.length===0&&(gr=l.vertices.slice(0,x));var Ar=A.length/3;A.push(Ft[0],Ft[1],1,gr[0],gr[1],1,Ft[0],Ft[1],0,gr[0],gr[1],0),M.push.apply(M,(0,se.Z)([0,2,1,2,3,1].map(function(Vr){return Vr+Ar})))},ye=0;ye<s;ye++)J(ye);return{positions:A,index:M}}function Ps(n){var c=Po().flatten(n),a=Po()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function Il(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,d=Po().flatten(n),x=d.vertices,A=d.dimensions,M=[],D=[],te=[],J=0;J<x.length/A;J++)A===2?M.push(x[J*2],x[J*2+1],1,-1,-1):M.push(x[J*3],x[J*3+1],1,-1,-1),te.push(0,0,1);var ye=Po()(d.vertices,d.holes,d.dimensions);D.push.apply(D,(0,se.Z)(ye));for(var ze=function(gr){var Ar=d.vertices.slice(gr*A,(gr+1)*A),Vr=d.vertices.slice((gr+1)*A,(gr+2)*A);Vr.length===0&&(Vr=d.vertices.slice(0,A));var vn=M.length/5;M.push(Ar[0],Ar[1],1,0,0,Vr[0],Vr[1],1,.1,0,Ar[0],Ar[1],0,0,.8,Vr[0],Vr[1],0,.1,.8);var bn=Ms([Vr[0],Vr[1],1],[Ar[0],Ar[1],0],[Ar[0],Ar[1],1],c);te.push.apply(te,(0,se.Z)(bn).concat((0,se.Z)(bn),(0,se.Z)(bn),(0,se.Z)(bn))),D.push.apply(D,(0,se.Z)([1,2,0,3,2,1].map(function(zn){return zn+vn})))},dt=0;dt<l;dt++)ze(dt);return{positions:M,index:D,normals:te}}function Ms(n,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Zi.create(),d=Zi.create(),x=Zi.create();s&&(n=(0,qe.vP)(n),c=(0,qe.vP)(c),a=(0,qe.vP)(a));var A=Zi.fromValues.apply(Zi,(0,se.Z)(n)),M=Zi.fromValues.apply(Zi,(0,se.Z)(c)),D=Zi.fromValues.apply(Zi,(0,se.Z)(a));Zi.sub(l,D,M),Zi.sub(d,A,M),Zi.cross(x,l,d);var te=Zi.create();return Zi.normalize(te,x),te}var Va,nu;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(nu||(nu={}));var Ss;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(Ss||(Ss={}));function ju(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+c*Math.PI/12);var d=s.map(function(x){var A=Math.sin(x+Math.PI/4),M=Math.cos(x+Math.PI/4);return[A,M,0]});return d}function al(){return ju(30)}function Ol(){return ju(4)}function oc(){return ju(3)}function ol(){return ju(6,1)}function sl(){return ju(5)}var ul=(Va={},(0,W.Z)(Va,Ss.CIRCLE,al),(0,W.Z)(Va,Ss.HEXAGON,ol),(0,W.Z)(Va,Ss.TRIANGLE,oc),(0,W.Z)(Va,Ss.SQUARE,Ol),(0,W.Z)(Va,Ss.PENTAGON,sl),(0,W.Z)(Va,nu.CYLINDER,al),(0,W.Z)(Va,nu.HEXAGONCOLUMN,ol),(0,W.Z)(Va,nu.TRIANGLECOLUMN,oc),(0,W.Z)(Va,nu.SQUARECOLUMN,Ol),(0,W.Z)(Va,nu.PENTAGONCOLUMN,sl),Va),Su={};function Vu(n){var c=Wi(n.coordinates);return{vertices:[].concat((0,se.Z)(c),(0,se.Z)(c),(0,se.Z)(c),(0,se.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function Sc(n){var c=Wi(n.coordinates),a=nl(c);return{vertices:[].concat((0,se.Z)(a),(0,se.Z)(a),(0,se.Z)(a),(0,se.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function Eu(n){var c=n.shape,a=h(c,!1),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function Fs(n){var c=Wi(n.coordinates);return{vertices:(0,se.Z)(c),indices:[0],size:c.length}}function kc(n){var c=n.coordinates,a=n.originCoordinates,s=n.version,l=new ac({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var x=a;Array.isArray(x[0][0])||(x=[a]);for(var A=0;A<d.length;A++){var M=d[A],D=x[A];l.extrude_gaode2(M,D)}}else{var te=c;Array.isArray(te[0][0])||(te=[c]),te.forEach(function(ye){l.extrude(ye)})}var J=l.complex;return{vertices:J.positions,indices:J.indices,normals:J.normals,size:6}}function sc(n){var c=n.coordinates,a=Po().flatten(c),s=a.vertices,l=a.dimensions,d=a.holes;return{indices:Po()(s,d,l),vertices:s,size:l}}function Ul(n){var c=n.coordinates,a=Il(c,!0),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function ll(n){var c=n.shape,a=k(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function i(n){var c=n.coordinates,a=[].concat((0,se.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,se.Z)(c[1]),[0,1,0],(0,se.Z)(c[0]),[0,0,1],(0,se.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function u(n,c){for(var a=c||30,s=n.coordinates,l=[],d=[],x=function(D){l.push(D,1,D,s[0][0],s[0][1],s[1][0],s[1][1],D,-1,D,s[0][0],s[0][1],s[1][0],s[1][1]),D!==a-1&&d.push.apply(d,(0,se.Z)([0,1,2,1,3,2].map(function(te){return D*2+te})))},A=0;A<a;A++)x(A);return{vertices:l,indices:d,size:7}}function o(n){var c=n.coordinates;c.length===2&&c.push(0);var a=n.size,s=K(-1,1),l=K(1,1),d=K(-1,-1),x=K(1,-1),A=[].concat((0,se.Z)(c),(0,se.Z)(s),(0,se.Z)(c),(0,se.Z)(d),(0,se.Z)(c),(0,se.Z)(x),(0,se.Z)(c),(0,se.Z)(l)),M=[0,1,2,3,0,2];return{vertices:A,indices:M,size:5}}function h(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Su&&Su[n])return Su[n];var a=ul[n]?ul[n]():ul.cylinder(),s=Il([a],c);return Su[n]=s,s}function _(n,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),d,x,A,M=vec3.create(),D=vec3.create(),te=vec3.create(),J=0,ye=c.length;J<ye;J+=3){d=c[J+0]*3,x=c[J+1]*3,A=c[J+2]*3;var ze=[n[d],n[d+1]],dt=[n[x],n[x+1]],Ft=[n[A],n[A+1]];s&&(ze=lngLatToMeters(ze),dt=lngLatToMeters(dt),Ft=lngLatToMeters(Ft));var gr=ze,Ar=_slicedToArray(gr,2),Vr=Ar[0],vn=Ar[1],bn=vec3.fromValues(Vr,vn,n[d+2]),zn=dt,ri=_slicedToArray(zn,2),ii=ri[0],Si=ri[1],ea=vec3.fromValues(ii,Si,n[x+2]),ya=Ft,yi=_slicedToArray(ya,2),Ta=yi[0],za=yi[1],ou=vec3.fromValues(Ta,za,n[A+2]);vec3.sub(M,ou,ea),vec3.sub(D,bn,ea),vec3.cross(te,M,D),l[d]+=M[0],l[d+1]+=M[1],l[d+2]+=M[2],l[x]+=M[0],l[x+1]+=M[1],l[x+2]+=M[2],l[A]+=M[0],l[A+1]+=M[1],l[A+2]+=M[2]}return E(l),l}function E(n){for(var c=0,a=n.length;c<a;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function T(n){var c=n[0][0],a=n[0][n[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function k(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=ul[n]?ul[n]():ul.circle(),s=c.indexOf(n)===-1?Ps([a]):qc([a]);return s}function K(n,c){var a=(n+1)/2,s=(c+1)/2;return[a,s]}function le(){var n=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function Ce(){var n=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function we(n){var c=Me();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Me(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ye=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Xe=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,st=function(n){(0,Kn.Z)(a,n);var c=we(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.baseColor,M=A===void 0?"rgb(16,16,16)":A,D=l.brightColor,te=D===void 0?"rgb(255,176,38)":D,J=l.windowColor,ye=J===void 0?"rgb(30,60,89)":J,ze=l.time,dt=ze===void 0?0:ze;return{u_opacity:x,u_baseColor:(0,qe.CI)(M),u_brightColor:(0,qe.CI)(te),u_windowColor:(0,qe.CI)(ye),u_time:this.layer.getLayerAnimateTime()||dt}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Xe,fragmentShader:Ye,triangulation:Ul})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:R.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(d,x,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.size,te=D===void 0?10:D;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(d,x,A,M){var D=d.size;return[A[3],A[4]]}}})}}]),a}(ko);function je(n){var c=ut();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var At=function(n){(0,Kn.Z)(a,n);var c=je(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","PolygonLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new st(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(Mu);function Yt(n){var c=Sr();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Sr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var dr=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,wr=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Wr=function(n){(0,Kn.Z)(a,n);var c=Yt(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:dr,fragmentShader:wr,triangulation:ll,depth:{enable:!1},primitive:R.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:R.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(ko);function fn(n){var c=nn();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function nn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var jn=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,ui=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,li=function(n){(0,Kn.Z)(a,n);var c=fn(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:jn,fragmentShader:ui,triangulation:Eu,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.size;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:R.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(d,x,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:R.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(ko),mn=y(85975);function aa(n,c){for(var a=[],s=[],l=[],d=n+1,x=c+1,A=n/2,M=c/2,D=0;D<x;D++)for(var te=D-M,J=0;J<d;J++){var ye=J-A;s.push(ye/A,-te/M,0),l.push(J/n),l.push(1-D/c)}for(var ze=0;ze<c;ze++)for(var dt=0;dt<n;dt++){var Ft=dt+d*ze,gr=dt+d*(ze+1),Ar=dt+1+d*(ze+1),Vr=dt+1+d*ze;a.push(Ft,gr,Vr),a.push(gr,Ar,Vr)}return{vertices:s,indices:a,uvs:l}}var Hn,xi;function Gi(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function vi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Gi(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Gi(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ci(n){var c=ie();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function ie(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ne=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,L=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,B=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,ce=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,Ae=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,_t=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Rt=(Hn=(0,cn.b2)(),Hn(xi=function(n){(0,Kn.Z)(a,n);var c=Ci(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"colorTexture",void 0),(0,W.Z)((0,St.Z)(s),"heatmapFramerBuffer",void 0),(0,W.Z)((0,St.Z)(s),"intensityModel",void 0),(0,W.Z)((0,St.Z)(s),"colorModel",void 0),(0,W.Z)((0,St.Z)(s),"shapeType",void 0),s}return(0,Or.Z)(a,[{key:"render",value:function(){var l=this,d=this.rendererService,x=d.clear,A=d.useFramebuffer;A(this.heatmapFramerBuffer,function(){x({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,x=d.createFramebuffer,A=d.clear,M=d.getViewportSize,D=d.createTexture2D,te=d.useFramebuffer,J=this.styleAttributeService.getLayerStyleAttribute("shape"),ye=(J==null||(l=J.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=ye,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=ye==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var ze=this.layer.getLayerConfig(),dt=ze.rampColors,Ft=(0,qe.Cl)(dt),gr=M(),Ar=gr.width,Vr=gr.height;return this.heatmapFramerBuffer=x({color:D({width:Math.floor(Ar/4),height:Math.floor(Vr/4),wrapS:R.gl.CLAMP_TO_EDGE,wrapT:R.gl.CLAMP_TO_EDGE,min:R.gl.LINEAR,mag:R.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:R.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(d,x,A,M){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.size,te=D===void 0?1:D;return[te]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:Ae,fragmentShader:ce,triangulation:o,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:R.gl.ONE,srcAlpha:1,dstRGB:R.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:_t,fs:B});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,x=l.fs,A=l.uniforms,M=this.rendererService,D=M.createAttribute,te=M.createElements,J=M.createBuffer,ye=M.createModel;return ye({vs:d,fs:x,attributes:{a_Position:D({buffer:J({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:R.gl.FLOAT}),size:3}),a_Uv:D({buffer:J({data:[0,1,1,1,0,0,1,0],type:R.gl.FLOAT}),size:2})},uniforms:vi({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:te({data:[0,2,1,2,3,1],type:R.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.intensity,A=x===void 0?10:x,M=l.radius,D=M===void 0?5:M;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:D,u_intensity:A}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=mn.create();mn.invert(x,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,se.Z)(x)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),x=d.width,A=d.height,M=aa(x/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:L,fs:ne});var D=this.shaderModuleService.getModule("heatmap3dColor"),te=D.vs,J=D.fs,ye=D.uniforms,ze=this.rendererService,dt=ze.createAttribute,Ft=ze.createElements,gr=ze.createBuffer,Ar=ze.createModel;return Ar({vs:te,fs:J,attributes:{a_Position:dt({buffer:gr({data:M.vertices,type:R.gl.FLOAT}),size:3}),a_Uv:dt({buffer:gr({data:M.uvs,type:R.gl.FLOAT}),size:2})},primitive:R.gl.TRIANGLES,uniforms:vi({},ye),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:R.gl.SRC_ALPHA,srcAlpha:1,dstRGB:R.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ft({data:M.indices,type:R.gl.UNSIGNED_INT,count:M.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),x=d.rampColors,A=(0,qe.Cl)(x);this.colorTexture=l({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:R.gl.CLAMP_TO_EDGE,wrapT:R.gl.CLAMP_TO_EDGE,min:R.gl.NEAREST,mag:R.gl.NEAREST,flipY:!1})}}]),a}(ko))||xi);function wt(n){var c=hr();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function hr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Xr=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Qn=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Wn=function(n){(0,Kn.Z)(a,n);var c=wt(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Qn,fragmentShader:Xr,triangulation:ll,depth:{enable:!1},primitive:R.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:R.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(ko),fi={heatmap:Rt,heatmap3d:Rt,grid:Wr,grid3d:li,hexagon:Wn},mi=fi;function Li(n){var c=oa();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var pa=function(n){(0,Kn.Z)(a,n);var c=Li(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","HeatMapLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new mi[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(x){return x.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=this.getLayerConfig(),A=x.shape3d,M=this.getSource(),D=M.data.type,te=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return te==="heatmap"||te==="heatmap3d"?"heatmap":D==="hexagon"?(A==null?void 0:A.indexOf(te))===-1?"hexagon":"grid3d":D==="grid"?(A==null?void 0:A.indexOf(te))===-1?"grid":"grid3d":"heatmap"}}]),a}(Mu);function Sa(n){var c=vo();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function vo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var wa=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Fo=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Fa=function(n){(0,Kn.Z)(a,n);var c=Sa(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),x=this.rendererService.createTexture2D;return this.texture=x({height:0,width:0}),d.data.images.then(function(A){l.texture=x({data:A[0],width:A[0].width,height:A[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Fo,fragmentShader:wa,triangulation:i,primitive:R.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(d,x,A,M){return[A[3],A[4]]}}})}}]),a}(ko),ji={image:Fa},da=ji;function Ka(n){var c=mo();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function mo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Mi=function(n){(0,Kn.Z)(a,n);var c=Ka(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","ImageLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new da[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(Mu);function ao(n){var c=Ga();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ga(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Gs=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = v_dataset.r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = v_dataset.b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = v_dataset.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = v_dataset.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,Zl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_dataset.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_dataset.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_dataset.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_dataset.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Bs={solid:0,dash:1},Iu=function(n){(0,Kn.Z)(a,n);var c=ao(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:R.gl.NEAREST,min:R.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,te=l.lineType,J=te===void 0?"solid":te,ye=l.dashArray,ze=ye===void 0?[10,5]:ye,dt=l.forward,Ft=dt===void 0?!0:dt,gr=l.lineTexture,Ar=gr===void 0?!1:gr,Vr=l.iconStep,vn=Vr===void 0?100:Vr,bn=l.segmentNumber,zn=bn===void 0?30:bn,ri=l.thetaOffset,ii=ri===void 0?.314:ri;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Si=this.layer.getEncodedData(),ea=this.calDataFrame(this.cellLength,Si,this.cellProperties),ya=ea.data,yi=ea.width,Ta=ea.height;this.rowCount=Ta,this.dataTexture=this.cellLength>0&&ya.length>0?this.createTexture2D({flipY:!0,data:ya,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:yi,height:Ta}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}ze.length===2&&ze.push(0,0);var za=0,ou=[0,0,0,0],Lf=[0,0,0,0];return x&&A&&(ou=(0,qe.CI)(x),Lf=(0,qe.CI)(A),za=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:ii,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:D==="normal"?0:1,segmentNumber:zn,u_line_type:Bs[J||"solid"],u_dash_array:ze,u_blur:.9,u_lineDir:Ft?1:-1,u_texture:this.texture,u_line_texture:Ar?1:0,u_icon_step:vn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:za,u_sourceColor:ou,u_targetColor:Lf}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,x=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Zl,fragmentShader:Gs,triangulation:u,depth:{enable:!1},blend:this.getBlend(),segmentNumber:x})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(x,A,M,D){var te=x.size,J=te===void 0?1:te;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:R.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:4,update:function(x,A,M,D){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(x,A,M,D){var te=l.iconService.getIconMap(),J=x.texture,ye=te[J]||{x:0,y:0},ze=ye.x,dt=ye.y;return[ze,dt]}}})}}]),a}(ko);function Ou(n){var c=jl();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Vl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_dataset.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    v_dataset.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,uc={solid:0,dash:1},Gu=function(n){(0,Kn.Z)(a,n);var c=Ou(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:R.gl.NEAREST,min:R.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,te=l.lineType,J=te===void 0?"solid":te,ye=l.dashArray,ze=ye===void 0?[10,5]:ye,dt=l.lineTexture,Ft=dt===void 0?!1:dt,gr=l.iconStep,Ar=gr===void 0?100:gr,Vr=l.segmentNumber,vn=Vr===void 0?30:Vr,bn=l.globalArcHeight,zn=bn===void 0?10:bn;ze.length===2&&ze.push(0,0);var ri=0,ii=[0,0,0,0],Si=[0,0,0,0];if(x&&A&&(ii=(0,qe.CI)(x),Si=(0,qe.CI)(A),ri=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var ea=this.layer.getEncodedData(),ya=this.calDataFrame(this.cellLength,ea,this.cellProperties),yi=ya.data,Ta=ya.width,za=ya.height;this.rowCount=za,this.dataTexture=this.cellLength>0&&yi.length>0?this.createTexture2D({flipY:!0,data:yi,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:Ta,height:za}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ta,u_global_height:zn,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:D==="normal"?0:1,segmentNumber:vn,u_line_type:uc[J]||0,u_dash_array:ze,u_texture:this.texture,u_line_texture:Ft?1:0,u_icon_step:Ar,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ri,u_sourceColor:ii,u_targetColor:Si}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,x=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Vl,fragmentShader:cl,triangulation:u,blend:this.getBlend(),segmentNumber:x})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(x,A,M,D){var te=x.size,J=te===void 0?1:te;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:R.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:4,update:function(x,A,M,D){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(x,A,M,D){var te=l.iconService.getIconMap(),J=x.texture,ye=te[J]||{x:0,y:0},ze=ye.x,dt=ye.y;return[ze,dt]}}})}}]),a}(ko);function cs(n){var c=Rf();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var df=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = v_dataset.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,vf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_dataset.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_dataset.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,uh={solid:0,dash:1},lh=function(n){(0,Kn.Z)(a,n);var c=cs(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:R.gl.NEAREST,min:R.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,te=l.lineType,J=te===void 0?"solid":te,ye=l.dashArray,ze=ye===void 0?[10,5]:ye,dt=l.lineTexture,Ft=dt===void 0?!1:dt,gr=l.iconStep,Ar=gr===void 0?100:gr,Vr=l.segmentNumber,vn=Vr===void 0?30:Vr;ze.length===2&&ze.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var bn=0,zn=[0,0,0,0],ri=[0,0,0,0];if(x&&A&&(zn=(0,qe.CI)(x),ri=(0,qe.CI)(A),bn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var ii=this.layer.getEncodedData(),Si=this.calDataFrame(this.cellLength,ii,this.cellProperties),ea=Si.data,ya=Si.width,yi=Si.height;this.rowCount=yi,this.dataTexture=this.cellLength>0&&ea.length>0?this.createTexture2D({flipY:!0,data:ea,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:ya,height:yi}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:D==="normal"?0:1,segmentNumber:vn,u_line_type:uh[J]||0,u_dash_array:ze,u_texture:this.texture,u_line_texture:Ft?1:0,u_icon_step:Ar,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:bn,u_sourceColor:zn,u_targetColor:ri}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:vf,fragmentShader:df,triangulation:u,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(x,A,M,D){var te=x.size,J=te===void 0?1:te;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:R.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:4,update:function(x,A,M,D){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(x,A,M,D){var te=l.iconService.getIconMap(),J=x.texture,ye=te[J]||{x:0,y:0},ze=ye.x,dt=ye.y;return[ze,dt]}}})}}]),a}(ko);function ef(n){var c=Ec();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ec(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var up=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Df=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset.r = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset.g = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset.b = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset.a = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ch={solid:0,dash:1},Gl=function(n){(0,Kn.Z)(a,n);var c=ef(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:R.gl.NEAREST,min:R.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,te=l.lineType,J=te===void 0?"solid":te,ye=l.dashArray,ze=ye===void 0?[10,5,0,0]:ye,dt=l.lineTexture,Ft=dt===void 0?!1:dt,gr=l.iconStep,Ar=gr===void 0?100:gr;ze.length===2&&ze.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Vr=0,vn=[0,0,0,0],bn=[0,0,0,0];if(x&&A&&(vn=(0,qe.CI)(x),bn=(0,qe.CI)(A),Vr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var zn=this.layer.getEncodedData(),ri=this.calDataFrame(this.cellLength,zn,this.cellProperties),ii=ri.data,Si=ri.width,ea=ri.height;this.rowCount=ea,this.dataTexture=this.cellLength>0&&ii.length>0?this.createTexture2D({flipY:!0,data:ii,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:Si,height:ea}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:D==="normal"?0:1,u_line_type:ch[J],u_dash_array:ze,u_texture:this.texture,u_line_texture:Ft?1:0,u_icon_step:Ar,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vr,u_sourceColor:vn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Df,fragmentShader:up,triangulation:kc,primitive:R.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.lineType,A=x===void 0?"solid":x;this.styleAttributeService.registerStyleAttribute({name:"distance",type:R.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(D,te,J,ye){return[J[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:R.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(D,te,J,ye){return[J[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(D,te,J,ye){var ze=D.size,dt=ze===void 0?1:ze;return Array.isArray(dt)?[dt[0],dt[1]]:[dt,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:R.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(D,te,J,ye,ze){return ze}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:R.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(D,te,J,ye){return[J[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(D,te,J,ye){var ze=l.iconService.getIconMap(),dt=D.texture,Ft=ze[dt]||{x:0,y:0},gr=Ft.x,Ar=Ft.y;return[gr,Ar]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,x){if(l instanceof HTMLImageElement){d(l);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){d(A)},A.onerror=function(){x(new Error("Could not load image at "+l))},A.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(ko),tf={arc:Iu,arc3d:Gu,greatcircle:lh,line:Gl},lp=tf;function rf(n){var c=fh();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function fh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cp=function(n){(0,Kn.Z)(a,n);var c=rf(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","LineLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new lp[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return x||"line"}}]),a}(Mu);function fp(n){var c=Rh();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Rh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var hp=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hh=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Dh=function(n){(0,Kn.Z)(a,n);var c=fp(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),D=M.data,te=M.width,J=M.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:te,height:J}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:hh,fragmentShader:hp,triangulation:Eu,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(x,A,M,D){var te=x.size;if(te){var J=[];return Array.isArray(te)&&(J=te.length===2?[te[0],te[0],te[1]]:te),Array.isArray(te)||(J=[te,te,te]),J}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:R.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(x,A,M,D,te){return te}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:R.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(x,A){var M=Wi(x.coordinates);return l?nl([M[0],M[1]]):[M[0],M[1],0]}}})}}]),a}(ko);function nf(n){var c=pp();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function pp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var rs=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

  

}
`,kf=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ph=function(n){(0,Kn.Z)(a,n);var c=nf(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.strokeOpacity,M=A===void 0?1:A,D=l.strokeWidth,te=D===void 0?0:D,J=l.stroke,ye=J===void 0?"rgba(0,0,0,0)":J,ze=l.offsets,dt=ze===void 0?[0,0]:ze;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,strokeOpacity:M,strokeWidth:te,stroke:ye,offsets:dt})){this.judgeStyleAttributes({opacity:x,strokeOpacity:M,strokeWidth:te,stroke:ye,offsets:dt});var Ft=this.layer.getEncodedData(),gr=this.calDataFrame(this.cellLength,Ft,this.cellProperties),Ar=gr.data,Vr=gr.width,vn=gr.height;this.rowCount=vn,this.dataTexture=this.cellLength>0&&Ar.length>0?this.createTexture2D({flipY:!0,data:Ar,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:Vr,height:vn}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(x)?x:1,u_stroke_opacity:Pi()(M)?M:1,u_stroke_width:Pi()(te)?te:0,u_stroke_color:this.getStrokeColor(ye),u_offsets:this.isOffsetStatic(dt)?dt:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Vu)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:kf,fragmentShader:rs,triangulation:l?Sc:Vu,depth:{enable:l},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:R.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(A,M,D,te){var J;if(d){var ye=(0,$i.Z)(D,3),ze=ye[0],dt=ye[1],Ft=ye[2],gr=Zi.fromValues(0,0,1),Ar=Zi.fromValues(ze,0,Ft),Vr=ze>=0?Zi.angle(gr,Ar):Math.PI*2-Zi.angle(gr,Ar),vn=Math.PI*2-Math.asin(dt/100),bn=mn.create();mn.rotateY(bn,bn,Vr),mn.rotateX(bn,bn,vn);var zn=Zi.fromValues(1,1,0);Zi.transformMat4(zn,zn,bn),Zi.normalize(zn,zn);var ri=Zi.fromValues(-1,1,0);Zi.transformMat4(ri,ri,bn),Zi.normalize(ri,ri);var ii=Zi.fromValues(-1,-1,0);Zi.transformMat4(ii,ii,bn),Zi.normalize(ii,ii);var Si=Zi.fromValues(1,-1,0);Zi.transformMat4(Si,Si,bn),Zi.normalize(Si,Si),J=[].concat((0,se.Z)(zn),(0,se.Z)(ri),(0,se.Z)(ii),(0,se.Z)(Si))}else J=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var ea=te%4*3;return[J[ea],J[ea+1],J[ea+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(A,M,D,te){var J=A.size,ye=J===void 0?5:J;return Array.isArray(ye)?[ye[0]]:[ye]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:R.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(A,M,D,te){var J=A.shape,ye=J===void 0?2:J,ze=l.layer.getLayerConfig().shape2d,dt=ze.indexOf(ye);return[dt]}}})}}]),a}(ko);function Ff(n){var c=Bf();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Bf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Fc=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,mf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,gf=function(n){(0,Kn.Z)(a,n);var c=Ff(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:mf,fragmentShader:Fc,triangulation:Fs,primitive:R.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(x,A,M,D){var te=x.size;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(x,A,M,D){var te=l.fontService.mapping,J=x.shape,ye=l.fontService.getGlyph(J),ze=te[ye],dt=ze.x,Ft=ze.y;return[dt,Ft]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:R.gl.LINEAR,min:R.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.fontWeight,A=x===void 0?"normal":x,M=d.fontFamily,D=M===void 0?"sans-serif":M,te=this.layer.getEncodedData(),J=[];te.forEach(function(ye){var ze=ye.shape,dt=ze===void 0?"":ze;dt=dt.toString();var Ft=l.fontService.getGlyph(dt);J.indexOf(Ft)===-1&&J.push(Ft)}),this.fontService.setFontOptions({characterSet:J,fontWeight:A,fontFamily:D,fontSize:48})}}]),a}(ko);function Cc(n){var c=yf();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function yf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var af=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Nf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,lc=function(n){(0,Kn.Z)(a,n);var c=Cc(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=A({data:s.iconService.getCanvas(),mag:R.gl.LINEAR,min:R.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.offsets,A=x===void 0?[0,0]:x;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:A})){this.judgeStyleAttributes({opacity:d,offsets:A});var M=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,M,this.cellProperties),te=D.data,J=D.width,ye=D.height;this.rowCount=ye,this.dataTexture=this.cellLength>0&&te.length>0?this.createTexture2D({flipY:!0,data:te,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:J,height:ye}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Pi()(d)?d:1,u_offsets:this.isOffsetStatic(A)?A:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Nf,fragmentShader:af,triangulation:Fs,primitive:R.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(x,A,M,D){var te=x.size,J=te===void 0?5:te;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(x,A,M,D){var te=l.iconService.getIconMap(),J=x.shape,ye=te[J]||{x:0,y:0},ze=ye.x,dt=ye.y;return[ze,dt]}}})}}]),a}(ko);function dh(n){var c=of();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function of(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zf=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sf=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Bc(n){var c=n.coordinates;return{vertices:(0,se.Z)(c),indices:[0],size:c.length}}var pu=function(n){(0,Kn.Z)(a,n);var c=dh(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.offsets,M=A===void 0?[0,0]:A;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,offsets:M})){this.judgeStyleAttributes({opacity:x,offsets:M});var D=this.layer.getEncodedData(),te=this.calDataFrame(this.cellLength,D,this.cellProperties),J=te.data,ye=te.width,ze=te.height;this.rowCount=ze,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:ye,height:ze}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(x)?x:1,u_offsets:this.isOffsetStatic(M)?M:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:sf,fragmentShader:zf,triangulation:Bc,depth:{enable:!1},primitive:R.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.size,te=D===void 0?1:D;return Array.isArray(te)?[te[0]]:[te]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:R.BlendType.additive}}}]),a}(ko),cc=y(98333);function _f(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=xf(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var D=a.next();return d=D.done,D},e:function(D){x=!0,A=D},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function xf(n,c){if(!!n){if(typeof n=="string")return Uf(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Uf(n,c)}}function Uf(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var uf=function(){function n(c,a,s){(0,vr.Z)(this,n),(0,W.Z)(this,"boxCells",[]),(0,W.Z)(this,"xCellCount",void 0),(0,W.Z)(this,"yCellCount",void 0),(0,W.Z)(this,"boxKeys",void 0),(0,W.Z)(this,"bboxes",void 0),(0,W.Z)(this,"width",void 0),(0,W.Z)(this,"height",void 0),(0,W.Z)(this,"xScale",void 0),(0,W.Z)(this,"yScale",void 0),(0,W.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,Or.Z)(n,[{key:"insert",value:function(a,s,l,d,x){this.forEachCell(s,l,d,x,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(x)}},{key:"query",value:function(a,s,l,d,x){return this.queryHitTest(a,s,l,d,!1,x)}},{key:"hitTest",value:function(a,s,l,d,x){return this.queryHitTest(a,s,l,d,!0,x)}},{key:"insertBoxCell",value:function(a,s,l,d,x,A){this.boxCells[x].push(A)}},{key:"queryHitTest",value:function(a,s,l,d,x,A){if(l<0||a>this.width||d<0||s>this.height)return x?!1:[];var M=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=d){if(x)return!0;for(var D=0;D<this.boxKeys.length;D++)M.push({key:this.boxKeys[D],x1:this.bboxes[D*4],y1:this.bboxes[D*4+1],x2:this.bboxes[D*4+2],y2:this.bboxes[D*4+3]});return A?M.filter(A):M}var te={hitTest:x,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,d,this.queryCell,M,te,A),x?M.length>0:M}},{key:"queryCell",value:function(a,s,l,d,x,A,M,D){var te=M.seenUids,J=this.boxCells[x];if(J!==null){var ye=this.bboxes,ze=_f(J),dt;try{for(ze.s();!(dt=ze.n()).done;){var Ft=dt.value;if(!te.box[Ft]){te.box[Ft]=!0;var gr=Ft*4;if(a<=ye[gr+2]&&s<=ye[gr+3]&&l>=ye[gr+0]&&d>=ye[gr+1]&&(!D||D(this.boxKeys[Ft]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Ft],x1:ye[gr],y1:ye[gr+1],x2:ye[gr+2],y2:ye[gr+3]})}}}}catch(Ar){ze.e(Ar)}finally{ze.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,d,x,A,M,D){for(var te=this.convertToXCellCoord(a),J=this.convertToYCellCoord(s),ye=this.convertToXCellCoord(l),ze=this.convertToYCellCoord(d),dt=te;dt<=ye;dt++)for(var Ft=J;Ft<=ze;Ft++){var gr=this.xCellCount*Ft+dt;if(x.call(this,a,s,l,d,gr,A,M,D))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),fl=uf,kh=function(){function n(c,a){(0,vr.Z)(this,n),(0,W.Z)(this,"width",void 0),(0,W.Z)(this,"height",void 0),(0,W.Z)(this,"grid",void 0),(0,W.Z)(this,"viewportPadding",100),(0,W.Z)(this,"screenRightBoundary",void 0),(0,W.Z)(this,"screenBottomBoundary",void 0),(0,W.Z)(this,"gridRightBoundary",void 0),(0,W.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new fl(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,Or.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,d=a.x2+a.anchorPointX+this.viewportPadding,x=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,x)||this.grid.hitTest(s,l,d,x)?{box:[]}:{box:[s,l,d,x]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var d=cc.al(s,l,0,1),x=cc.Ue(),A=mn.fromValues.apply(mn,(0,se.Z)(a));return cc.fF(x,d,A),{x:(x[0]/x[3]+1)/2*this.width+this.viewportPadding,y:(-x[1]/x[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,d){return l>=0&&a<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),n}();function Zf(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Fh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var D=a.next();return d=D.done,D},e:function(D){x=!0,A=D},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function Fh(n,c){if(!!n){if(typeof n=="string")return vh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vh(n,c)}}function vh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Bh(n){var c=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function fc(n,c,a,s,l){if(!!l){var d=n[s],x=d.glyph;if(x)for(var A=c[x].advance*d.scale,M=(n[s].x+A)*l,D=a;D<=s;D++)n[D].x-=M}}function wc(n,c,a,s,l,d,x){var A=(c-a)*l,M=(-s*x+.5)*d,D=Zf(n),te;try{for(D.s();!(te=D.n()).done;){var J=te.value;J.x+=A,J.y+=M}}catch(ye){D.e(ye)}finally{D.f()}}function Nh(n,c,a,s,l,d,x){var A=-8,M=0,D=A,te=0,J=n.positionedGlyphs,ye=d==="right"?1:d==="left"?0:.5,ze=J.length;a.forEach(function(Vr){if(Vr.split("").forEach(function(bn){var zn=c[bn],ri=0;zn&&(J.push({glyph:bn,x:M,y:D+ri,vertical:!1,scale:1,metrics:zn}),M+=zn.advance+x)}),J.length!==ze){var vn=M-x;te=Math.max(vn,te),fc(J,c,ze,J.length-1,ye)}M=0,D+=s});var dt=Bh(l),Ft=dt.horizontalAlign,gr=dt.verticalAlign;wc(J,ye,Ft,gr,te,s,a.length);var Ar=D-A;n.top+=-gr*Ar,n.bottom=n.top+Ar,n.left+=-Ft*te,n.right=n.left+te}function jf(n,c,a,s,l,d,x){var A=-8,M=0,D=A,te=0,J=n.positionedGlyphs,ye=d==="right"?1:d==="left"?0:.5,ze=J.length;a.forEach(function(Vr){var vn=c[Vr],bn=0;if(vn&&(J.push({glyph:Vr,x:M,y:D+bn,vertical:!1,scale:1,metrics:vn}),M+=vn.advance+x),J.length!==ze){var zn=M-x;te=Math.max(zn,te),fc(J,c,ze,J.length-1,ye)}M=0,D+=s});var dt=Bh(l),Ft=dt.horizontalAlign,gr=dt.verticalAlign;wc(J,ye,Ft,gr,te,s,a.length);var Ar=D-A;n.top+=-gr*Ar,n.bottom=n.top+Ar,n.left+=-Ft*te,n.right=n.left+te}function bf(n,c,a,s,l,d){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,M=n.split(`
`),D=[],te={positionedGlyphs:D,top:x[1],bottom:x[1],left:x[0],right:x[0],lineCount:M.length,text:n};return A?jf(te,c,M,a,s,l,d):Nh(te,c,M,a,s,l,d),D.length?te:!1}function hl(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,d=[],x=Zf(l),A;try{for(x.s();!(A=x.n()).done;){var M=A.value,D=M.metrics,te=4,J=D.advance*M.scale/2,ye=a?[M.x+J,M.y]:[0,0],ze=a?[0,0]:[M.x+J+c[0],M.y+c[1]],dt=(0-te)*M.scale-J+ze[0],Ft=(0-te)*M.scale+ze[1],gr=dt+D.width*M.scale,Ar=Ft+D.height*M.scale,Vr={x:dt,y:Ft},vn={x:gr,y:Ft},bn={x:dt,y:Ar},zn={x:gr,y:Ar};d.push({tl:Vr,tr:vn,bl:bn,br:zn,tex:D,glyphOffset:ye})}}catch(ri){x.e(ri)}finally{x.f()}return d}function dp(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Hl(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var D=a.next();return d=D.done,D},e:function(D){x=!0,A=D},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function Hl(n,c){if(!!n){if(typeof n=="string")return mh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mh(n,c)}}function mh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Wl(n){var c=hc();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function hc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gh=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Vf=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Sf(n){var c=this,a=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[a].centroid,x=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[a].glyphQuads.forEach(function(A,M){s.push.apply(s,(0,se.Z)(x).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,se.Z)(x),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,se.Z)(x),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,se.Z)(x),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),l.push(0+M*4,1+M*4,2+M*4,2+M*4,3+M*4,0+M*4)}),{vertices:s,indices:l,size:7}}var yh=function(n){(0,Kn.Z)(a,n);var c=Wl(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"glyphInfo",void 0),(0,W.Z)((0,St.Z)(s),"glyphInfoMap",{}),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"currentZoom",-1),(0,W.Z)((0,St.Z)(s),"extent",void 0),(0,W.Z)((0,St.Z)(s),"textureHeight",0),(0,W.Z)((0,St.Z)(s),"textCount",0),(0,W.Z)((0,St.Z)(s),"preTextStyle",{}),(0,W.Z)((0,St.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Vf,fragmentShader:gh,triangulation:Sf.bind((0,St.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.stroke,M=A===void 0?"#fff":A,D=l.strokeWidth,te=D===void 0?0:D,J=l.textAnchor,ye=J===void 0?"center":J,ze=l.textAllowOverlap,dt=ze===void 0?!1:ze,Ft=l.halo,gr=Ft===void 0?.5:Ft,Ar=l.gamma,Vr=Ar===void 0?2:Ar,vn=this.fontService,bn=vn.canvas,zn=vn.mapping;if(Object.keys(zn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(zn).length),this.preTextStyle={textAnchor:ye,textAllowOverlap:dt},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,strokeWidth:te,stroke:M})){this.judgeStyleAttributes({opacity:x,strokeWidth:te,stroke:M});var ri=this.layer.getEncodedData(),ii=this.calDataFrame(this.cellLength,ri,this.cellProperties),Si=ii.data,ea=ii.width,ya=ii.height;this.rowCount=ya,this.dataTexture=this.cellLength>0&&Si.length>0?this.createTexture2D({flipY:!0,data:Si,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:ea,height:ya}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(x)?x:1,u_stroke_width:Pi()(te)?te:0,u_stroke_color:this.getStrokeColor(M),u_sdf_map:this.texture,u_halo_blur:gr,u_gamma_scale:Vr,u_sdf_map_size:[bn.width,bn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,x=d===void 0?"center":d,A=l.textAllowOverlap,M=A===void 0?!0:A;return this.preTextStyle={textAnchor:x,textAllowOverlap:M},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,x=d===void 0?!1:d,A=this.mapService.getZoom(),M=this.mapService.getBounds(),D=(0,qe.oO)(this.extent,M);return!x&&(Math.abs(this.currentZoom-A)>1||!D)||x!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:R.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.rotate,te=D===void 0?0:D;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:R.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(d,x,A,M){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.size,te=D===void 0?12:D;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:R.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(d,x,A,M){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,qe.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,x=d===void 0?"400":d,A=l.fontFamily,M=A===void 0?"sans-serif":A,D=this.layer.getEncodedData(),te=[];D.forEach(function(J){var ye=J.shape,ze=ye===void 0?"":ye;ze=ze.toString();var dt=dp(ze),Ft;try{for(dt.s();!(Ft=dt.n()).done;){var gr=Ft.value;te.indexOf(gr)===-1&&te.push(gr)}}catch(Ar){dt.e(Ar)}finally{dt.f()}}),this.fontService.setFontOptions({characterSet:te,fontWeight:x,fontFamily:M,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,x=d===void 0?"400":d,A=l.fontFamily,M=A===void 0?"sans-serif":A,D=this.layer.getEncodedData(),te=[];D.forEach(function(J){var ye=J.shape,ze=ye===void 0?"":ye;ze=ze.toString(),te.indexOf(ze)===-1&&te.push(ze)}),this.fontService.setFontOptions({characterSet:te,fontWeight:x,fontFamily:M,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,x=this.fontService.mapping,A=this.layer.getLayerConfig(),M=A.spacing,D=M===void 0?2:M,te=A.textAnchor,J=te===void 0?"center":te,ye=this.layer.getEncodedData();this.glyphInfo=ye.map(function(ze){var dt=ze.shape,Ft=dt===void 0?"":dt,gr=ze.id,Ar=ze.size,Vr=Ar===void 0?1:Ar,vn=ze.textOffset,bn=vn===void 0?[0,0]:vn,zn=bf(Ft.toString(),x,Vr,J,"center",D,bn,l),ri=hl(zn,bn,!1);return ze.shaping=zn,ze.glyphQuads=ri,ze.centroid=Wi(ze.coordinates),ze.originCentroid=ze.version==="GAODE2.x"?Wi(ze.originCoordinates):ze.originCentroid=ze.centroid,d.glyphInfoMap[gr]={shaping:zn,glyphQuads:ri,centroid:Wi(ze.coordinates)},ze})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.padding,A=x===void 0?[4,4]:x,M=d.textAllowOverlap,D=M===void 0?!1:M;if(!D){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var te=this.rendererService.getViewportSize(),J=te.width,ye=te.height,ze=new kh(J,ye),dt=this.glyphInfo.filter(function(Ft){var gr=Ft.shaping,Ar=Ft.id,Vr=Ar===void 0?0:Ar,vn=Ft.version==="GAODE2.x"?Ft.originCentroid:Ft.centroid,bn=Ft.size,zn=bn/24,ri=l.mapService.lngLatToContainer(vn),ii=ze.placeCollisionBox({x1:gr.left*zn-A[0],x2:gr.right*zn+A[0],y1:gr.top*zn-A[1],y2:gr.bottom*zn+A[1],anchorPointX:ri.x,anchorPointY:ri.y}),Si=ii.box;return Si&&Si.length?(ze.insertCollisionBox(Si,Vr),!0):!1});dt.forEach(function(Ft){l.glyphInfoMap[Ft.id]=Ft})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,x=d===void 0?!1:d;x?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(x)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:R.gl.LINEAR,min:R.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Vf,fragmentShader:gh,triangulation:Sf.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(ko),Es={fill:ph,image:lc,normal:pu,extrude:Dh,text:yh,icon:gf},Wo=Es;function fs(n){var c=Cu();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var _h=function(n){(0,Kn.Z)(a,n);var c=fs(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","PointLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Wo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),x=d.shape2d,A=d.shape3d,M=this.iconService.getIconMap(),D=l.find(function(J){return J.hasOwnProperty("shape")});if(D){var te=D.shape;return te==="dot"?"normal":(x==null?void 0:x.indexOf(te))!==-1?"fill":(A==null?void 0:A.indexOf(te))!==-1?"extrude":M.hasOwnProperty(te)?"image":this.fontService.getGlyph(te)!==""?"icon":"text"}else return"normal"}}]),a}(Mu);function vp(n){var c=zh();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function zh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var mp=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gp=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Uh=function(n){(0,Kn.Z)(a,n);var c=vp(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),D=M.data,te=M.width,J=M.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:te,height:J}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:gp,fragmentShader:mp,triangulation:Ul})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:R.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.gl.STATIC_DRAW,data:[],type:R.gl.FLOAT},size:3,update:function(d,x,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:R.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(d,x,A,M){var D=d.size,te=D===void 0?10:D;return Array.isArray(te)?[te[0]]:[te]}}})}}]),a}(ko);function Zh(n){var c=yp();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function yp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var _p=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ef=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,jh=function(n){(0,Kn.Z)(a,n);var c=Zh(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),D=M.data,te=M.width,J=M.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:te,height:J}):this.createTexture2D({flipY:!0,data:[1],format:R.gl.LUMINANCE,type:R.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Ef,fragmentShader:_p,triangulation:sc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(ko),xh={fill:jh,line:Gl,extrude:Uh,text:yh,point_fill:ph,point_image:lc,point_normal:pu,point_extrude:Dh},Cf=xh;function $a(n){var c=Vh();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Vh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Xl=function(n){(0,Kn.Z)(a,n);var c=$a(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","PolygonLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Cf[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return x==="fill"?"fill":x==="extrude"?"extrude":x==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),x=d.shape2d,A=d.shape3d,M=this.iconService.getIconMap(),D=l.find(function(J){return J.hasOwnProperty("shape")});if(D){var te=D.shape;return te==="dot"?"point_normal":(x==null?void 0:x.indexOf(te))!==-1?"point_fill":(A==null?void 0:A.indexOf(te))!==-1?"point_extrude":M.hasOwnProperty(te)?"point_image":"text"}else return"fill"}}]),a}(Mu);function Nc(n){var c=Gh();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Gh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var V=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Oe=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,et=function(n){(0,Kn.Z)(a,n);var c=Nc(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"texture",void 0),(0,W.Z)((0,St.Z)(s),"colorTexture",void 0),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.clampLow,M=A===void 0?!0:A,D=l.clampHigh,te=D===void 0?!0:D,J=l.noDataValue,ye=J===void 0?-9999999:J,ze=l.domain,dt=ze===void 0?[0,1]:ze;return this.updateColorTexure(),{u_opacity:x||1,u_texture:this.texture,u_domain:dt,u_clampLow:M,u_clampHigh:typeof te!="undefined"?te:M,u_noDataValue:ye,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,x=l.data.dataArray[0];this.texture=d({data:x.data,width:x.width,height:x.height,format:R.gl.LUMINANCE,type:R.gl.FLOAT});var A=this.layer.getLayerConfig(),M=A.rampColors,D=(0,qe.Cl)(M);return this.colorTexture=d({data:D.data,width:D.width,height:D.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Oe,fragmentShader:V,triangulation:i,primitive:R.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(d,x,A,M){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),x=d.rampColors,A=(0,qe.Cl)(x);this.colorTexture=l({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),a}(ko),cr={raster:et,raster3d:et},Br=cr;function or(n){var c=Ir();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ir(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Hr=function(n){(0,Kn.Z)(a,n);var c=or(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,W.Z)((0,St.Z)(s),"type","RasterLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Br[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(Mu),Jr,en,tn,on,xn,$r,sn,Zt,_r;function Qr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function kn(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Qr(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Qr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Rr=(Jr=(0,cn.b2)(),en=(0,cn.f3)(R.vK.IGlobalConfigService),tn=(0,cn.f3)(R.vK.IMapService),on=(0,cn.f3)(R.vK.IFontService),Jr(xn=($r=function(){function n(){(0,vr.Z)(this,n),(0,no.Z)(this,"configService",sn,this),(0,no.Z)(this,"mapService",Zt,this),(0,no.Z)(this,"fontService",_r,this)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:d})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:d}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var x=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,D=x.filter(function(J){return J.needRemapping}),te=M;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&(te=M.filter(function(J){return l.applyAttributeMapping(A,J)[0]})),D.length&&(A!=null&&A.needRemapping?(a.setEncodedData(l.mapping(x,te)),A.needRemapping=!1):a.setEncodedData(l.mapping(D,te,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,d=s.styleAttributeService,x=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,D=M;A!=null&&A.scale&&(D=M.filter(function(te){return l.applyAttributeMapping(A,te)[0]})),a.setEncodedData(this.mapping(x,D))}},{key:"mapping",value:function(a,s,l){var d=this,x=s.map(function(A,M){var D=l?l[M]:{},te=kn({id:A._id,coordinates:A.coordinates},D);return a.filter(function(J){return J.scale!==void 0}).forEach(function(J){var ye=d.applyAttributeMapping(J,A);J.needRemapping=!1,J.name==="color"&&(ye=ye.map(function(ze){return(0,qe.CI)(ze)})),te[J.name]=Array.isArray(ye)&&ye.length===1?ye[0]:ye,J.name==="shape"&&(te.shape=d.fontService.getIconFontKey(te[J.name]))}),te});return x.length>0&&this.mapService.version==="GAODE2.x"&&(typeof x[0].coordinates[0]=="number"?x.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=ue()(A.coordinates),A.coordinates=d.mapService.lngLatToCoord(A.coordinates)}):x.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=ue()(A.coordinates),A.coordinates=d.mapService.lngLatToCoords(A.coordinates)})),x}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var d=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],x=[];return d.forEach(function(A){var M,D=A.field;(s.hasOwnProperty(D)||((M=a.scale)===null||M===void 0?void 0:M.type)==="variable")&&x.push(s[D])}),a.mapping?a.mapping(x):[]}}]),n}(),sn=(0,_o.Z)($r.prototype,"configService",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zt=(0,_o.Z)($r.prototype,"mapService",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_r=(0,_o.Z)($r.prototype,"fontService",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$r))||xn),Pn,ln,pi=(Pn=(0,cn.b2)(),Pn(ln=function(){function n(){(0,vr.Z)(this,n),(0,W.Z)(this,"mapService",void 0)}return(0,Or.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(R.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var d=a.sourceOption||{data:Be,options:mt},x=d.data,A=d.options;a.setSource(new Ee(x,A))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),d=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,d=s.clusterOptions,x=d.zoom,A=x===void 0?0:x,M=d.maxZoom,D=M===void 0?16:M,te=this.mapService.getZoom()-1,J=a.dataState.dataSourceNeedUpdate;return l&&(J||Math.abs(A-te)>1)&&D>A?(s.updateClusterData(Math.floor(te)),!0):!1}}]),n}())||ln),Dr=y(44908),Pr=y.n(Dr),ni=y(14293),En=y.n(ni);function rn(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Mn(n){return n.length===1&&(n=On(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],a)<0?s=d+1:l=d}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],a)>0?l=d:s=d+1}return s}}}function On(n){return function(c,a){return rn(n(c),a)}}var Vi=Mn(rn),Fi=Vi.right,Fn=Vi.left,wn=Fi;function Ti(n,c){var a=n.length,s=-1,l,d,x;if(c==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(d=x=l;++s<a;)(l=n[s])!=null&&(d>l&&(d=l),x<l&&(x=l))}else for(;++s<a;)if((l=c(n[s],s,n))!=null&&l>=l)for(d=x=l;++s<a;)(l=c(n[s],s,n))!=null&&(d>l&&(d=l),x<l&&(x=l));return[d,x]}var Ui=Array.prototype,va=Ui.slice,zo=Ui.map,xo=Math.sqrt(50),sa=Math.sqrt(10),hs=Math.sqrt(2);function oo(n,c,a){var s,l=-1,d,x,A;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(d=n,n=c,c=d),(A=Xo(n,c,a))===0||!isFinite(A))return[];if(A>0)for(n=Math.ceil(n/A),c=Math.floor(c/A),x=new Array(d=Math.ceil(c-n+1));++l<d;)x[l]=(n+l)*A;else for(n=Math.floor(n*A),c=Math.ceil(c*A),x=new Array(d=Math.ceil(n-c+1));++l<d;)x[l]=(n-l)/A;return s&&x.reverse(),x}function Xo(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=xo?10:d>=sa?5:d>=hs?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=xo?10:d>=sa?5:d>=hs?2:1)}function Uo(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=xo?l*=10:d>=sa?l*=5:d>=hs&&(l*=2),c<n?-l:l}function Is(){var n=identity,c=extent,a=sturges;function s(l){var d,x=l.length,A,M=new Array(x);for(d=0;d<x;++d)M[d]=n(l[d],d,l);var D=c(M),te=D[0],J=D[1],ye=a(M,te,J);Array.isArray(ye)||(ye=tickStep(te,J,ye),ye=range(Math.ceil(te/ye)*ye,J,ye));for(var ze=ye.length;ye[0]<=te;)ye.shift(),--ze;for(;ye[ze-1]>J;)ye.pop(),--ze;var dt=new Array(ze+1),Ft;for(d=0;d<=ze;++d)Ft=dt[d]=[],Ft.x0=d>0?ye[d-1]:te,Ft.x1=d<ze?ye[d]:J;for(d=0;d<x;++d)A=M[d],te<=A&&A<=J&&dt[bisect(ye,A,0,ze)].push(l[d]);return dt}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function Ns(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function Cs(n){return n===null?NaN:+n}function Yo(n,c,a){if(a==null&&(a=Cs),!!(s=n.length)){if((c=+c)<=0||s<2)return+a(n[0],0,n);if(c>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*c,d=Math.floor(l),x=+a(n[d],d,n),A=+a(n[d+1],d+1,n);return x+(A-x)*(l-d)}}var wi="$";function Zo(){}Zo.prototype=Ma.prototype={constructor:Zo,has:function(n){return wi+n in this},get:function(n){return this[wi+n]},set:function(n,c){return this[wi+n]=c,this},remove:function(n){var c=wi+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===wi&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===wi&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===wi&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===wi&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===wi&&++n;return n},empty:function(){for(var n in this)if(n[0]===wi)return!1;return!0},each:function(n){for(var c in this)c[0]===wi&&n(this[c],c.slice(1),this)}};function Ma(n,c){var a=new Zo;if(n instanceof Zo)n.each(function(A,M){a.set(M,A)});else if(Array.isArray(n)){var s=-1,l=n.length,d;if(c==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(c(d=n[s],s,n),d)}else if(n)for(var x in n)a.set(x,n[x]);return a}var Io=Ma;function ki(){var n=[],c=[],a,s,l;function d(A,M,D,te){if(M>=n.length)return a!=null&&A.sort(a),s!=null?s(A):A;for(var J=-1,ye=A.length,ze=n[M++],dt,Ft,gr=map(),Ar,Vr=D();++J<ye;)(Ar=gr.get(dt=ze(Ft=A[J])+""))?Ar.push(Ft):gr.set(dt,[Ft]);return gr.each(function(vn,bn){te(Vr,bn,d(vn,M,D,te))}),Vr}function x(A,M){if(++M>n.length)return A;var D,te=c[M-1];return s!=null&&M>=n.length?D=A.entries():(D=[],A.each(function(J,ye){D.push({key:ye,values:x(J,M)})})),te!=null?D.sort(function(J,ye){return te(J.key,ye.key)}):D}return l={object:function(A){return d(A,0,ca,Ja)},map:function(A){return d(A,0,bo,pl)},entries:function(A){return x(d(A,0,bo,pl),0)},key:function(A){return n.push(A),l},sortKeys:function(A){return c[n.length-1]=A,l},sortValues:function(A){return a=A,l},rollup:function(A){return s=A,l}}}function ca(){return{}}function Ja(n,c,a){n[c]=a}function bo(){return map()}function pl(n,c,a){n.set(c,a)}function He(){}var ir=Io.prototype;He.prototype=er.prototype={constructor:He,has:ir.has,add:function(n){return n+="",this[wi+n]=n,this},remove:ir.remove,clear:ir.clear,values:ir.keys,size:ir.size,empty:ir.empty,each:ir.each};function er(n,c){var a=new He;if(n instanceof He)n.each(function(d){a.add(d)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(c(n[s],s,n))}return a}var Xn=null,fa=Array.prototype,Ne=fa.map,be=fa.slice;function nt(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function Gt(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var lr={name:"implicit"};function xt(){var n=Io(),c=[],a=[],s=lr;function l(d){var x=d+"",A=n.get(x);if(!A){if(s!==lr)return s;n.set(x,A=c.push(d))}return a[(A-1)%a.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],n=Io();for(var x=-1,A=d.length,M,D;++x<A;)n.has(D=(M=d[x])+"")||n.set(D,c.push(M));return l},l.range=function(d){return arguments.length?(a=be.call(d),l):a.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return xt(c,a).unknown(s)},nt.apply(l,arguments),l}function vt(){var n=ordinal().unknown(void 0),c=n.domain,a=n.range,s=[0,1],l,d,x=!1,A=0,M=0,D=.5;delete n.unknown;function te(){var J=c().length,ye=s[1]<s[0],ze=s[ye-0],dt=s[1-ye];l=(dt-ze)/Math.max(1,J-A+M*2),x&&(l=Math.floor(l)),ze+=(dt-ze-l*(J-A))*D,d=l*(1-A),x&&(ze=Math.round(ze),d=Math.round(d));var Ft=sequence(J).map(function(gr){return ze+l*gr});return a(ye?Ft.reverse():Ft)}return n.domain=function(J){return arguments.length?(c(J),te()):c()},n.range=function(J){return arguments.length?(s=[+J[0],+J[1]],te()):s.slice()},n.rangeRound=function(J){return s=[+J[0],+J[1]],x=!0,te()},n.bandwidth=function(){return d},n.step=function(){return l},n.round=function(J){return arguments.length?(x=!!J,te()):x},n.padding=function(J){return arguments.length?(A=Math.min(1,M=+J),te()):A},n.paddingInner=function(J){return arguments.length?(A=Math.min(1,J),te()):A},n.paddingOuter=function(J){return arguments.length?(M=+J,te()):M},n.align=function(J){return arguments.length?(D=Math.max(0,Math.min(1,J)),te()):D},n.copy=function(){return vt(c(),s).round(x).paddingInner(A).paddingOuter(M).align(D)},initRange.apply(te(),arguments)}function at(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return at(c())},n}function Fe(){return at(vt.apply(null,arguments).paddingInner(1))}var ot=y(26257),Ue=y(73626);function Xt(n,c){return n=+n,c=+c,function(a){return Math.round(n*(1-a)+c*a)}}function Jt(n){return function(){return n}}function jr(n){return+n}var gn=[0,1];function an(n){return n}function Dn(n,c){return(c-=n=+n)?function(a){return(a-n)/c}:Jt(isNaN(c)?NaN:.5)}function pn(n){var c=n[0],a=n[n.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function ai(n,c,a){var s=n[0],l=n[1],d=c[0],x=c[1];return l<s?(s=Dn(l,s),d=a(x,d)):(s=Dn(s,l),d=a(d,x)),function(A){return d(s(A))}}function Un(n,c,a){var s=Math.min(n.length,c.length)-1,l=new Array(s),d=new Array(s),x=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++x<s;)l[x]=Dn(n[x],n[x+1]),d[x]=a(c[x],c[x+1]);return function(A){var M=wn(n,A,1,s)-1;return d[M](l[M](A))}}function Yn(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function qn(){var n=gn,c=gn,a=ot.Z,s,l,d,x=an,A,M,D;function te(){return A=Math.min(n.length,c.length)>2?Un:ai,M=D=null,J}function J(ye){return isNaN(ye=+ye)?d:(M||(M=A(n.map(s),c,a)))(s(x(ye)))}return J.invert=function(ye){return x(l((D||(D=A(c,n.map(s),Ue.Z)))(ye)))},J.domain=function(ye){return arguments.length?(n=Ne.call(ye,jr),x===an||(x=pn(n)),te()):n.slice()},J.range=function(ye){return arguments.length?(c=be.call(ye),te()):c.slice()},J.rangeRound=function(ye){return c=be.call(ye),a=Xt,te()},J.clamp=function(ye){return arguments.length?(x=ye?pn(n):an,J):x!==an},J.interpolate=function(ye){return arguments.length?(a=ye,te()):a},J.unknown=function(ye){return arguments.length?(d=ye,J):d},function(ye,ze){return s=ye,l=ze,te()}}function ei(n,c){return qn()(n,c)}var gi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Na(n){if(!(c=gi.exec(n)))throw new Error("invalid format: "+n);var c;return new Bo({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Na.prototype=Bo.prototype;function Bo(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Bo.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Yl(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Za(n,c){if((a=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function _a(n){return n=Za(Math.abs(n)),n?n[1]:NaN}function iu(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_a(c)/3)))*3-_a(Math.abs(n)))}function Ll(n,c){return function(a,s){for(var l=a.length,d=[],x=0,A=n[0],M=0;l>0&&A>0&&(M+A+1>s&&(A=Math.max(1,s-M)),d.push(a.substring(l-=A,l+A)),!((M+=A+1)>s));)A=n[x=(x+1)%n.length];return d.reverse().join(c)}}function Hu(n){return function(c){return c.replace(/[0-9]/g,function(a){return n[+a]})}}function bh(n){e:for(var c=n.length,a=1,s=-1,l;a<c;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Wu;function Gf(n,c){var a=Za(n,c);if(!a)return n+"";var s=a[0],l=a[1],d=l-(Wu=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,x=s.length;return d===x?s:d>x?s+new Array(d-x+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Za(n,Math.max(0,c+d-1))[0]}function lf(n,c){var a=Za(n,c);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var cf={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Yl,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return lf(n*100,c)},r:lf,s:Gf,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function xp(n){return n}var ps=Array.prototype.map,Hf=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function zc(n){var c=n.grouping===void 0||n.thousands===void 0?xp:Ll(ps.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",d=n.numerals===void 0?xp:Hu(ps.call(n.numerals,String)),x=n.percent===void 0?"%":n.percent+"",A=n.minus===void 0?"-":n.minus+"",M=n.nan===void 0?"NaN":n.nan+"";function D(J){J=Na(J);var ye=J.fill,ze=J.align,dt=J.sign,Ft=J.symbol,gr=J.zero,Ar=J.width,Vr=J.comma,vn=J.precision,bn=J.trim,zn=J.type;zn==="n"?(Vr=!0,zn="g"):cf[zn]||(vn===void 0&&(vn=12),bn=!0,zn="g"),(gr||ye==="0"&&ze==="=")&&(gr=!0,ye="0",ze="=");var ri=Ft==="$"?a:Ft==="#"&&/[boxX]/.test(zn)?"0"+zn.toLowerCase():"",ii=Ft==="$"?s:/[%p]/.test(zn)?x:"",Si=cf[zn],ea=/[defgprs%]/.test(zn);vn=vn===void 0?6:/[gprs]/.test(zn)?Math.max(1,Math.min(21,vn)):Math.max(0,Math.min(20,vn));function ya(yi){var Ta=ri,za=ii,ou,Lf,ap;if(zn==="c")za=Si(yi)+za,yi="";else{yi=+yi;var op=yi<0||1/yi<0;if(yi=isNaN(yi)?M:Si(Math.abs(yi),vn),bn&&(yi=bh(yi)),op&&+yi==0&&dt!=="+"&&(op=!1),Ta=(op?dt==="("?dt:A:dt==="-"||dt==="("?"":dt)+Ta,za=(zn==="s"?Hf[8+Wu/3]:"")+za+(op&&dt==="("?")":""),ea){for(ou=-1,Lf=yi.length;++ou<Lf;)if(ap=yi.charCodeAt(ou),48>ap||ap>57){za=(ap===46?l+yi.slice(ou+1):yi.slice(ou))+za,yi=yi.slice(0,ou);break}}}Vr&&!gr&&(yi=c(yi,Infinity));var sp=Ta.length+yi.length+za.length,Yc=sp<Ar?new Array(Ar-sp+1).join(ye):"";switch(Vr&&gr&&(yi=c(Yc+yi,Yc.length?Ar-za.length:Infinity),Yc=""),ze){case"<":yi=Ta+yi+za+Yc;break;case"=":yi=Ta+Yc+yi+za;break;case"^":yi=Yc.slice(0,sp=Yc.length>>1)+Ta+yi+za+Yc.slice(sp);break;default:yi=Yc+Ta+yi+za;break}return d(yi)}return ya.toString=function(){return J+""},ya}function te(J,ye){var ze=D((J=Na(J),J.type="f",J)),dt=Math.max(-8,Math.min(8,Math.floor(_a(ye)/3)))*3,Ft=Math.pow(10,-dt),gr=Hf[8+dt/3];return function(Ar){return ze(Ft*Ar)+gr}}return{format:D,formatPrefix:te}}var wf,Wf,Hh;Xf({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Xf(n){return wf=zc(n),Wf=wf.format,Hh=wf.formatPrefix,wf}function Uc(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,_a(c)-_a(n))+1}function Gp(n){return Math.max(0,-_a(Math.abs(n)))}function Hp(n,c,a,s){var l=Uo(n,c,a),d;switch(s=Na(s==null?",f":s),s.type){case"s":{var x=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(d=iu(l,x))&&(s.precision=d),Hh(s,x)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=Uc(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Gp(l))&&(s.precision=d-(s.type==="%")*2);break}}return Wf(s)}function Wh(n){var c=n.domain;return n.ticks=function(a){var s=c();return oo(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=c();return Hp(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=c(),l=0,d=s.length-1,x=s[l],A=s[d],M;return A<x&&(M=x,x=A,A=M,M=l,l=d,d=M),M=Xo(x,A,a),M>0?(x=Math.floor(x/M)*M,A=Math.ceil(A/M)*M,M=Xo(x,A,a)):M<0&&(x=Math.ceil(x*M)/M,A=Math.floor(A*M)/M,M=Xo(x,A,a)),M>0?(s[l]=Math.floor(x/M)*M,s[d]=Math.ceil(A/M)*M,c(s)):M<0&&(s[l]=Math.ceil(x*M)/M,s[d]=Math.floor(A*M)/M,c(s)),n},n}function Os(){var n=ei(an,an);return n.copy=function(){return Yn(n,Os())},nt.apply(n,arguments),Wh(n)}function Zc(n){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=Ne.call(s,jr),a):n.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Zc(n).unknown(c)},n=arguments.length?Ne.call(n,jr):[0,1],Wh(a)}function bp(n,c){n=n.slice();var a=0,s=n.length-1,l=n[a],d=n[s],x;return d<l&&(x=a,a=s,s=x,x=l,l=d,d=x),n[a]=c.floor(l),n[s]=c.ceil(d),n}function e(n){return Math.log(n)}function t(n){return Math.exp(n)}function r(n){return-Math.log(-n)}function f(n){return-Math.exp(-n)}function v(n){return isFinite(n)?+("1e"+n):n<0?0:n}function g(n){return n===10?v:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function S(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function P(n){return function(c){return-n(-c)}}function F(n){var c=n(e,t),a=c.domain,s=10,l,d;function x(){return l=S(s),d=g(s),a()[0]<0?(l=P(l),d=P(d),n(r,f)):n(e,t),c}return c.base=function(A){return arguments.length?(s=+A,x()):s},c.domain=function(A){return arguments.length?(a(A),x()):a()},c.ticks=function(A){var M=a(),D=M[0],te=M[M.length-1],J;(J=te<D)&&(ye=D,D=te,te=ye);var ye=l(D),ze=l(te),dt,Ft,gr,Ar=A==null?10:+A,Vr=[];if(!(s%1)&&ze-ye<Ar){if(ye=Math.round(ye)-1,ze=Math.round(ze)+1,D>0){for(;ye<ze;++ye)for(Ft=1,dt=d(ye);Ft<s;++Ft)if(gr=dt*Ft,!(gr<D)){if(gr>te)break;Vr.push(gr)}}else for(;ye<ze;++ye)for(Ft=s-1,dt=d(ye);Ft>=1;--Ft)if(gr=dt*Ft,!(gr<D)){if(gr>te)break;Vr.push(gr)}}else Vr=oo(ye,ze,Math.min(ze-ye,Ar)).map(d);return J?Vr.reverse():Vr},c.tickFormat=function(A,M){if(M==null&&(M=s===10?".0e":","),typeof M!="function"&&(M=Wf(M)),A===Infinity)return M;A==null&&(A=10);var D=Math.max(1,s*A/c.ticks().length);return function(te){var J=te/d(Math.round(l(te)));return J*s<s-.5&&(J*=s),J<=D?M(te):""}},c.nice=function(){return a(bp(a(),{floor:function(A){return d(Math.floor(l(A)))},ceil:function(A){return d(Math.ceil(l(A)))}}))},c}function H(){var n=F(qn()).domain([1,10]);return n.copy=function(){return Yn(n,H()).base(n.base())},nt.apply(n,arguments),n}function Q(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function oe(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function ve(n){var c=1,a=n(Q(c),oe(c));return a.constant=function(s){return arguments.length?n(Q(c=+s),oe(c)):c},linearish(a)}function Se(){var n=ve(transformer());return n.copy=function(){return copy(n,Se()).constant(n.constant())},initRange.apply(n,arguments)}function We(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function Ke(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function bt(n){return n<0?-n*n:n*n}function it(n){var c=n(an,an),a=1;function s(){return a===1?n(an,an):a===.5?n(Ke,bt):n(We(a),We(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},Wh(c)}function Dt(){var n=it(qn());return n.copy=function(){return Yn(n,Dt()).exponent(n.exponent())},nt.apply(n,arguments),n}function Qt(){return Dt.apply(null,arguments).exponent(.5)}function mr(){var n=[],c=[],a=[],s;function l(){var x=0,A=Math.max(1,c.length);for(a=new Array(A-1);++x<A;)a[x-1]=Yo(n,x/A);return d}function d(x){return isNaN(x=+x)?s:c[wn(a,x)]}return d.invertExtent=function(x){var A=c.indexOf(x);return A<0?[NaN,NaN]:[A>0?a[A-1]:n[0],A<a.length?a[A]:n[n.length-1]]},d.domain=function(x){if(!arguments.length)return n.slice();n=[];for(var A=0,M=x.length,D;A<M;++A)D=x[A],D!=null&&!isNaN(D=+D)&&n.push(D);return n.sort(rn),l()},d.range=function(x){return arguments.length?(c=be.call(x),l()):c.slice()},d.unknown=function(x){return arguments.length?(s=x,d):s},d.quantiles=function(){return a.slice()},d.copy=function(){return mr().domain(n).range(c).unknown(s)},nt.apply(d,arguments)}function xr(){var n=0,c=1,a=1,s=[.5],l=[0,1],d;function x(M){return M<=M?l[wn(s,M,0,a)]:d}function A(){var M=-1;for(s=new Array(a);++M<a;)s[M]=((M+1)*c-(M-a)*n)/(a+1);return x}return x.domain=function(M){return arguments.length?(n=+M[0],c=+M[1],A()):[n,c]},x.range=function(M){return arguments.length?(a=(l=be.call(M)).length-1,A()):l.slice()},x.invertExtent=function(M){var D=l.indexOf(M);return D<0?[NaN,NaN]:D<1?[n,s[0]]:D>=a?[s[a-1],c]:[s[D-1],s[D]]},x.unknown=function(M){return arguments.length&&(d=M),x},x.thresholds=function(){return s.slice()},x.copy=function(){return xr().domain([n,c]).range(l).unknown(d)},nt.apply(Wh(x),arguments)}function Nr(){var n=[.5],c=[0,1],a,s=1;function l(d){return d<=d?c[wn(n,d,0,s)]:a}return l.domain=function(d){return arguments.length?(n=be.call(d),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(d){return arguments.length?(c=be.call(d),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var x=c.indexOf(d);return[n[x-1],n[x]]},l.unknown=function(d){return arguments.length?(a=d,l):a},l.copy=function(){return Nr().domain(n).range(c).unknown(a)},nt.apply(l,arguments)}var un=new Date,Cn=new Date;function ti(n,c,a,s){function l(d){return n(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return n(d=new Date(+d)),d},l.ceil=function(d){return n(d=new Date(d-1)),c(d,1),n(d),d},l.round=function(d){var x=l(d),A=l.ceil(d);return d-x<A-d?x:A},l.offset=function(d,x){return c(d=new Date(+d),x==null?1:Math.floor(x)),d},l.range=function(d,x,A){var M=[],D;if(d=l.ceil(d),A=A==null?1:Math.floor(A),!(d<x)||!(A>0))return M;do M.push(D=new Date(+d)),c(d,A),n(d);while(D<d&&d<x);return M},l.filter=function(d){return ti(function(x){if(x>=x)for(;n(x),!d(x);)x.setTime(x-1)},function(x,A){if(x>=x)if(A<0)for(;++A<=0;)for(;c(x,-1),!d(x););else for(;--A>=0;)for(;c(x,1),!d(x););})},a&&(l.count=function(d,x){return un.setTime(+d),Cn.setTime(+x),n(un),n(Cn),Math.floor(a(un,Cn))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(x){return s(x)%d==0}:function(x){return l.count(0,x)%d==0}):l}),l}var Zn=ti(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});Zn.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:ti(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*n)})};var ci=Zn,$n=Zn.range,ia=ti(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),Ri=ia,si=ia.range,ua=1e3,Hi=6e4,Ea=36e5,di=864e5,La=6048e5;function Ha(n){return ti(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*Hi)/La})}var No=Ha(0),So=Ha(1),Oo=Ha(2),Ko=Ha(3),jo=Ha(4),Ls=Ha(5),du=Ha(6),Hs=No.range,wu=So.range,ds=Oo.range,Ws=Ko.range,xa=jo.range,fo=Ls.range,Qa=du.range,Aa=ti(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*Hi)/di},function(n){return n.getDate()-1}),au=Aa,vu=Aa.range,go=ti(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ua-n.getMinutes()*Hi)},function(n,c){n.setTime(+n+c*Ea)},function(n,c){return(c-n)/Ea},function(n){return n.getHours()}),vs=go,mu=go.range,Ra=ti(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ua)},function(n,c){n.setTime(+n+c*Hi)},function(n,c){return(c-n)/Hi},function(n){return n.getMinutes()}),Ac=Ra,Rl=Ra.range,pc=ti(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*ua)},function(n,c){return(c-n)/ua},function(n){return n.getUTCSeconds()}),ns=pc,jc=pc.range,Xu=ti(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});Xu.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?ti(function(c){c.setTime(Math.floor(c/n)*n)},function(c,a){c.setTime(+c+a*n)},function(c,a){return(a-c)/n}):Xu};var Yf=Xu,Kf=Xu.range;function Kl(n){return ti(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/La})}var Tc=Kl(0),Vc=Kl(1),Xh=Kl(2),$f=Kl(3),Pc=Kl(4),Yh=Kl(5),Kh=Kl(6),ff=Tc.range,$h=Vc.range,Sh=Xh.range,Af=$f.range,Eh=Pc.range,Sp=Yh.range,Ep=Kh.range,Jf=ti(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/di},function(n){return n.getUTCDate()-1}),Qf=Jf,Cp=Jf.range,Tf=ti(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});Tf.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:ti(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*n)})};var Gc=Tf,Jh=Tf.range;function qf(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function hf(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function pf(n,c,a){return{y:n,m:c,d:a,H:0,M:0,S:0,L:0}}function eh(n){var c=n.dateTime,a=n.date,s=n.time,l=n.periods,d=n.days,x=n.shortDays,A=n.months,M=n.shortMonths,D=Pf(l),te=nh(l),J=Pf(d),ye=nh(d),ze=Pf(x),dt=nh(x),Ft=Pf(A),gr=nh(A),Ar=Pf(M),Vr=nh(M),vn={a:op,A:sp,b:Yc,B:Xg,c:null,d:Pp,e:Pp,f:ed,g:id,G:Mp,H:Qp,I:qp,j:dl,L:Th,m:Mc,M:Md,p:Yg,q:Kg,Q:hd,s:pd,S:td,u:Mf,U:ah,V:oh,w:sh,W:rd,x:null,X:null,y:nd,Y:ad,Z:Ip,"%":fd},bn={a:$g,A:Jg,b:Qg,B:qg,c:null,d:Ic,e:Ic,f:Dp,g:Ld,G:Dd,H:od,I:Op,j:Lp,L:Rp,m:sd,M:ud,p:ey,q:ty,Q:hd,s:pd,S:kp,u:ld,U:Ph,V:rp,w:Id,W:cd,x:null,X:null,y:Od,Y:Rd,Z:kd,"%":fd},zn={a:ya,A:yi,b:Ta,B:za,c:ou,d:vc,e:vc,f:Kp,g:Hc,G:Xp,H:ih,I:ih,j:qh,L:Tp,m:Qh,M:ep,p:ea,q:Yp,Q:$p,s:Jp,S:tp,u:Pd,U:wh,V:is,w:wp,W:dc,x:Lf,X:ap,y:Hc,Y:Xp,Z:Ap,"%":Ah};vn.x=ri(a,vn),vn.X=ri(s,vn),vn.c=ri(c,vn),bn.x=ri(a,bn),bn.X=ri(s,bn),bn.c=ri(c,bn);function ri(Bi,eo){return function(Eo){var Jn=[],$l=-1,gs=0,mc=Bi.length,gc,Lh,Sm;for(Eo instanceof Date||(Eo=new Date(+Eo));++$l<mc;)Bi.charCodeAt($l)===37&&(Jn.push(Bi.slice(gs,$l)),(Lh=th[gc=Bi.charAt(++$l)])!=null?gc=Bi.charAt(++$l):Lh=gc==="e"?" ":"0",(Sm=eo[gc])&&(gc=Sm(Eo,Lh)),Jn.push(gc),gs=$l+1);return Jn.push(Bi.slice(gs,$l)),Jn.join("")}}function ii(Bi,eo){return function(Eo){var Jn=pf(1900,void 0,1),$l=Si(Jn,Bi,Eo+="",0),gs,mc;if($l!=Eo.length)return null;if("Q"in Jn)return new Date(Jn.Q);if("s"in Jn)return new Date(Jn.s*1e3+("L"in Jn?Jn.L:0));if(eo&&!("Z"in Jn)&&(Jn.Z=0),"p"in Jn&&(Jn.H=Jn.H%12+Jn.p*12),Jn.m===void 0&&(Jn.m="q"in Jn?Jn.q:0),"V"in Jn){if(Jn.V<1||Jn.V>53)return null;"w"in Jn||(Jn.w=1),"Z"in Jn?(gs=hf(pf(Jn.y,0,1)),mc=gs.getUTCDay(),gs=mc>4||mc===0?Vc.ceil(gs):Vc(gs),gs=Qf.offset(gs,(Jn.V-1)*7),Jn.y=gs.getUTCFullYear(),Jn.m=gs.getUTCMonth(),Jn.d=gs.getUTCDate()+(Jn.w+6)%7):(gs=qf(pf(Jn.y,0,1)),mc=gs.getDay(),gs=mc>4||mc===0?So.ceil(gs):So(gs),gs=au.offset(gs,(Jn.V-1)*7),Jn.y=gs.getFullYear(),Jn.m=gs.getMonth(),Jn.d=gs.getDate()+(Jn.w+6)%7)}else("W"in Jn||"U"in Jn)&&("w"in Jn||(Jn.w="u"in Jn?Jn.u%7:"W"in Jn?1:0),mc="Z"in Jn?hf(pf(Jn.y,0,1)).getUTCDay():qf(pf(Jn.y,0,1)).getDay(),Jn.m=0,Jn.d="W"in Jn?(Jn.w+6)%7+Jn.W*7-(mc+5)%7:Jn.w+Jn.U*7-(mc+6)%7);return"Z"in Jn?(Jn.H+=Jn.Z/100|0,Jn.M+=Jn.Z%100,hf(Jn)):qf(Jn)}}function Si(Bi,eo,Eo,Jn){for(var $l=0,gs=eo.length,mc=Eo.length,gc,Lh;$l<gs;){if(Jn>=mc)return-1;if(gc=eo.charCodeAt($l++),gc===37){if(gc=eo.charAt($l++),Lh=zn[gc in th?eo.charAt($l++):gc],!Lh||(Jn=Lh(Bi,Eo,Jn))<0)return-1}else if(gc!=Eo.charCodeAt(Jn++))return-1}return Jn}function ea(Bi,eo,Eo){var Jn=D.exec(eo.slice(Eo));return Jn?(Bi.p=te[Jn[0].toLowerCase()],Eo+Jn[0].length):-1}function ya(Bi,eo,Eo){var Jn=ze.exec(eo.slice(Eo));return Jn?(Bi.w=dt[Jn[0].toLowerCase()],Eo+Jn[0].length):-1}function yi(Bi,eo,Eo){var Jn=J.exec(eo.slice(Eo));return Jn?(Bi.w=ye[Jn[0].toLowerCase()],Eo+Jn[0].length):-1}function Ta(Bi,eo,Eo){var Jn=Ar.exec(eo.slice(Eo));return Jn?(Bi.m=Vr[Jn[0].toLowerCase()],Eo+Jn[0].length):-1}function za(Bi,eo,Eo){var Jn=Ft.exec(eo.slice(Eo));return Jn?(Bi.m=gr[Jn[0].toLowerCase()],Eo+Jn[0].length):-1}function ou(Bi,eo,Eo){return Si(Bi,c,eo,Eo)}function Lf(Bi,eo,Eo){return Si(Bi,a,eo,Eo)}function ap(Bi,eo,Eo){return Si(Bi,s,eo,Eo)}function op(Bi){return x[Bi.getDay()]}function sp(Bi){return d[Bi.getDay()]}function Yc(Bi){return M[Bi.getMonth()]}function Xg(Bi){return A[Bi.getMonth()]}function Yg(Bi){return l[+(Bi.getHours()>=12)]}function Kg(Bi){return 1+~~(Bi.getMonth()/3)}function $g(Bi){return x[Bi.getUTCDay()]}function Jg(Bi){return d[Bi.getUTCDay()]}function Qg(Bi){return M[Bi.getUTCMonth()]}function qg(Bi){return A[Bi.getUTCMonth()]}function ey(Bi){return l[+(Bi.getUTCHours()>=12)]}function ty(Bi){return 1+~~(Bi.getUTCMonth()/3)}return{format:function(Bi){var eo=ri(Bi+="",vn);return eo.toString=function(){return Bi},eo},parse:function(Bi){var eo=ii(Bi+="",!1);return eo.toString=function(){return Bi},eo},utcFormat:function(Bi){var eo=ri(Bi+="",bn);return eo.toString=function(){return Bi},eo},utcParse:function(Bi){var eo=ii(Bi+="",!0);return eo.toString=function(){return Bi},eo}}}var th={"-":"",_:" ","0":"0"},ms=/^\s*\d+/,Ch=/^%/,rh=/[\\^$*+?|[\]().{}]/g;function qa(n,c,a){var s=n<0?"-":"",l=(s?-n:n)+"",d=l.length;return s+(d<a?new Array(a-d+1).join(c)+l:l)}function Wp(n){return n.replace(rh,"\\$&")}function Pf(n){return new RegExp("^(?:"+n.map(Wp).join("|")+")","i")}function nh(n){for(var c={},a=-1,s=n.length;++a<s;)c[n[a].toLowerCase()]=a;return c}function wp(n,c,a){var s=ms.exec(c.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function Pd(n,c,a){var s=ms.exec(c.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function wh(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function is(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function dc(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function Xp(n,c,a){var s=ms.exec(c.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function Hc(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function Ap(n,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function Yp(n,c,a){var s=ms.exec(c.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function Qh(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function vc(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function qh(n,c,a){var s=ms.exec(c.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function ih(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function ep(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function tp(n,c,a){var s=ms.exec(c.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function Tp(n,c,a){var s=ms.exec(c.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function Kp(n,c,a){var s=ms.exec(c.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function Ah(n,c,a){var s=Ch.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function $p(n,c,a){var s=ms.exec(c.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function Jp(n,c,a){var s=ms.exec(c.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function Pp(n,c){return qa(n.getDate(),c,2)}function Qp(n,c){return qa(n.getHours(),c,2)}function qp(n,c){return qa(n.getHours()%12||12,c,2)}function dl(n,c){return qa(1+au.count(ci(n),n),c,3)}function Th(n,c){return qa(n.getMilliseconds(),c,3)}function ed(n,c){return Th(n,c)+"000"}function Mc(n,c){return qa(n.getMonth()+1,c,2)}function Md(n,c){return qa(n.getMinutes(),c,2)}function td(n,c){return qa(n.getSeconds(),c,2)}function Mf(n){var c=n.getDay();return c===0?7:c}function ah(n,c){return qa(No.count(ci(n)-1,n),c,2)}function If(n){var c=n.getDay();return c>=4||c===0?jo(n):jo.ceil(n)}function oh(n,c){return n=If(n),qa(jo.count(ci(n),n)+(ci(n).getDay()===4),c,2)}function sh(n){return n.getDay()}function rd(n,c){return qa(So.count(ci(n)-1,n),c,2)}function nd(n,c){return qa(n.getFullYear()%100,c,2)}function id(n,c){return n=If(n),qa(n.getFullYear()%100,c,2)}function ad(n,c){return qa(n.getFullYear()%1e4,c,4)}function Mp(n,c){var a=n.getDay();return n=a>=4||a===0?jo(n):jo.ceil(n),qa(n.getFullYear()%1e4,c,4)}function Ip(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+qa(c/60|0,"0",2)+qa(c%60,"0",2)}function Ic(n,c){return qa(n.getUTCDate(),c,2)}function od(n,c){return qa(n.getUTCHours(),c,2)}function Op(n,c){return qa(n.getUTCHours()%12||12,c,2)}function Lp(n,c){return qa(1+Qf.count(Gc(n),n),c,3)}function Rp(n,c){return qa(n.getUTCMilliseconds(),c,3)}function Dp(n,c){return Rp(n,c)+"000"}function sd(n,c){return qa(n.getUTCMonth()+1,c,2)}function ud(n,c){return qa(n.getUTCMinutes(),c,2)}function kp(n,c){return qa(n.getUTCSeconds(),c,2)}function ld(n){var c=n.getUTCDay();return c===0?7:c}function Ph(n,c){return qa(Tc.count(Gc(n)-1,n),c,2)}function Fp(n){var c=n.getUTCDay();return c>=4||c===0?Pc(n):Pc.ceil(n)}function rp(n,c){return n=Fp(n),qa(Pc.count(Gc(n),n)+(Gc(n).getUTCDay()===4),c,2)}function Id(n){return n.getUTCDay()}function cd(n,c){return qa(Vc.count(Gc(n)-1,n),c,2)}function Od(n,c){return qa(n.getUTCFullYear()%100,c,2)}function Ld(n,c){return n=Fp(n),qa(n.getUTCFullYear()%100,c,2)}function Rd(n,c){return qa(n.getUTCFullYear()%1e4,c,4)}function Dd(n,c){var a=n.getUTCDay();return n=a>=4||a===0?Pc(n):Pc.ceil(n),qa(n.getUTCFullYear()%1e4,c,4)}function kd(){return"+0000"}function fd(){return"%"}function hd(n){return+n}function pd(n){return Math.floor(+n/1e3)}var Yu,Mh,dd,Ih,vd;Em({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Em(n){return Yu=eh(n),Mh=Yu.format,dd=Yu.parse,Ih=Yu.utcFormat,vd=Yu.utcParse,Yu}var Bp=1e3,Np=Bp*60,zp=Np*60,Up=zp*24,Cm=Up*7,Hd=Up*30,Fd=Up*365;function wm(n){return new Date(n)}function Am(n){return n instanceof Date?+n:+new Date(+n)}function Wd(n,c,a,s,l,d,x,A,M){var D=ei(an,an),te=D.invert,J=D.domain,ye=M(".%L"),ze=M(":%S"),dt=M("%I:%M"),Ft=M("%I %p"),gr=M("%a %d"),Ar=M("%b %d"),Vr=M("%B"),vn=M("%Y"),bn=[[x,1,Bp],[x,5,5*Bp],[x,15,15*Bp],[x,30,30*Bp],[d,1,Np],[d,5,5*Np],[d,15,15*Np],[d,30,30*Np],[l,1,zp],[l,3,3*zp],[l,6,6*zp],[l,12,12*zp],[s,1,Up],[s,2,2*Up],[a,1,Cm],[c,1,Hd],[c,3,3*Hd],[n,1,Fd]];function zn(ii){return(x(ii)<ii?ye:d(ii)<ii?ze:l(ii)<ii?dt:s(ii)<ii?Ft:c(ii)<ii?a(ii)<ii?gr:Ar:n(ii)<ii?Vr:vn)(ii)}function ri(ii,Si,ea,ya){if(ii==null&&(ii=10),typeof ii=="number"){var yi=Math.abs(ea-Si)/ii,Ta=Mn(function(za){return za[2]}).right(bn,yi);Ta===bn.length?(ya=Uo(Si/Fd,ea/Fd,ii),ii=n):Ta?(Ta=bn[yi/bn[Ta-1][2]<bn[Ta][2]/yi?Ta-1:Ta],ya=Ta[1],ii=Ta[0]):(ya=Math.max(Uo(Si,ea,ii),1),ii=A)}return ya==null?ii:ii.every(ya)}return D.invert=function(ii){return new Date(te(ii))},D.domain=function(ii){return arguments.length?J(Ne.call(ii,Am)):J().map(wm)},D.ticks=function(ii,Si){var ea=J(),ya=ea[0],yi=ea[ea.length-1],Ta=yi<ya,za;return Ta&&(za=ya,ya=yi,yi=za),za=ri(ii,ya,yi,Si),za=za?za.range(ya,yi+1):[],Ta?za.reverse():za},D.tickFormat=function(ii,Si){return Si==null?zn:M(Si)},D.nice=function(ii,Si){var ea=J();return(ii=ri(ii,ea[0],ea[ea.length-1],Si))?J(bp(ea,ii)):D},D.copy=function(){return Yn(D,Wd(n,c,a,s,l,d,x,A,M))},D}function Tm(){return nt.apply(Wd(ci,Ri,No,au,vs,Ac,ns,Yf,Mh).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function ry(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function md(){var n=0,c=1,a,s,l,d,x=identity,A=!1,M;function D(te){return isNaN(te=+te)?M:x(l===0?.5:(te=(d(te)-a)*l,A?Math.max(0,Math.min(1,te)):te))}return D.domain=function(te){return arguments.length?(a=d(n=+te[0]),s=d(c=+te[1]),l=a===s?0:1/(s-a),D):[n,c]},D.clamp=function(te){return arguments.length?(A=!!te,D):A},D.interpolator=function(te){return arguments.length?(x=te,D):x},D.unknown=function(te){return arguments.length?(M=te,D):M},function(te){return d=te,a=te(n),s=te(c),l=a===s?0:1/(s-a),D}}function gd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Pm(){var n=linearish(md()(identity));return n.copy=function(){return gd(n,Pm())},initInterpolator.apply(n,arguments)}function Mm(){var n=loggish(md()).domain([1,10]);return n.copy=function(){return gd(n,Mm()).base(n.base())},initInterpolator.apply(n,arguments)}function Im(){var n=symlogish(md());return n.copy=function(){return gd(n,Im()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Xd(){var n=powish(md());return n.copy=function(){return gd(n,Xd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function ny(){return Xd.apply(null,arguments).exponent(.5)}function Om(){var n=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,d=s.length,x;l<d;++l)x=s[l],x!=null&&!isNaN(x=+x)&&n.push(x);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Om(c).domain(n)},initInterpolator.apply(a,arguments)}function yd(){var n=0,c=.5,a=1,s,l,d,x,A,M=identity,D,te=!1,J;function ye(ze){return isNaN(ze=+ze)?J:(ze=.5+((ze=+D(ze))-l)*(ze<l?x:A),M(te?Math.max(0,Math.min(1,ze)):ze))}return ye.domain=function(ze){return arguments.length?(s=D(n=+ze[0]),l=D(c=+ze[1]),d=D(a=+ze[2]),x=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),ye):[n,c,a]},ye.clamp=function(ze){return arguments.length?(te=!!ze,ye):te},ye.interpolator=function(ze){return arguments.length?(M=ze,ye):M},ye.unknown=function(ze){return arguments.length?(J=ze,ye):J},function(ze){return D=ze,s=ze(n),l=ze(c),d=ze(a),x=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),ye}}function Lm(){var n=linearish(yd()(identity));return n.copy=function(){return copy(n,Lm())},initInterpolator.apply(n,arguments)}function Rm(){var n=loggish(yd()).domain([.1,1,10]);return n.copy=function(){return copy(n,Rm()).base(n.base())},initInterpolator.apply(n,arguments)}function Dm(){var n=symlogish(yd());return n.copy=function(){return copy(n,Dm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Yd(){var n=powish(yd());return n.copy=function(){return copy(n,Yd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function iy(){return Yd.apply(null,arguments).exponent(.5)}var Wc,Kd,$d,Jd,Bd,Qd,km=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Fm=(Wc={},(0,W.Z)(Wc,R.ScaleTypes.LINEAR,Os),(0,W.Z)(Wc,R.ScaleTypes.POWER,Dt),(0,W.Z)(Wc,R.ScaleTypes.LOG,H),(0,W.Z)(Wc,R.ScaleTypes.IDENTITY,Zc),(0,W.Z)(Wc,R.ScaleTypes.TIME,Tm),(0,W.Z)(Wc,R.ScaleTypes.QUANTILE,mr),(0,W.Z)(Wc,R.ScaleTypes.QUANTIZE,xr),(0,W.Z)(Wc,R.ScaleTypes.THRESHOLD,Nr),(0,W.Z)(Wc,R.ScaleTypes.CAT,xt),Wc),Bm=(Kd=(0,cn.b2)(),$d=(0,cn.f3)(R.vK.IGlobalConfigService),Kd(Jd=(Bd=function(){function n(){(0,vr.Z)(this,n),(0,no.Z)(this,"configService",Qd,this),(0,W.Z)(this,"scaleCache",{}),(0,W.Z)(this,"scaleOptions",{})}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var x=d.getLayerStyleAttributes(),A=a.getSource().data.dataArray;A.length!==0&&l.caculateScalesForAttributes(x||[],A)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var x=d.getLayerStyleAttributes(),A=a.getSource().data.dataArray;return l.caculateScalesForAttributes(x||[],A),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var x=d.getLayerStyleAttributes();if(x){var A=a.getSource().data.dataArray;if(A.length===0)return;var M=x.filter(function(D){return D.needRescale});M.length&&l.caculateScalesForAttributes(M,A)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(d){if(d.scale){var x=d.scale,A=d.name;x.names=l.parseFields(d.scale.field||[]);var M=[];x.names.forEach(function(D){M.push(l.getOrCreateScale(D,d,s))}),M.some(function(D){return D.type===R.StyleScaleType.VARIABLE})?(x.type=R.StyleScaleType.VARIABLE,M.forEach(function(D){if(!x.callback){var te;if(x.values&&x.values!=="text"){var J;if(((J=D.option)===null||J===void 0?void 0:J.type)==="linear"&&x.values.length>2){var ye=D.scale.ticks(x.values.length);A==="color"&&D.scale.domain(ye)}D.scale.range(x.values)}else((te=D.option)===null||te===void 0?void 0:te.type)==="cat"&&D.scale.range(D.option.domain)}})):(x.type=R.StyleScaleType.CONSTANT,x.defaultValues=M.map(function(D,te){return D.scale(x.names[te])})),x.scalers=M.map(function(D){return{field:D.field,func:D.scale,option:D.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var d,x=[a,s.name].join("_"),A=(d=s.scale)===null||d===void 0?void 0:d.values,M=this.createScale(a,s.name,A,l);return M}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:N()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,d){var x,A,M=this.scaleOptions[s]&&((x=this.scaleOptions[s])===null||x===void 0?void 0:x.field)===a?this.scaleOptions[s]:this.scaleOptions[a],D={field:a,scale:void 0,type:R.StyleScaleType.VARIABLE,option:M};if(!d||!d.length)return M&&M.type?D.scale=this.createDefaultScale(M):(D.scale=xt([a]),D.type=R.StyleScaleType.CONSTANT),D;var te=(A=d.find(function(ze){return!En()(ze[a])}))===null||A===void 0?void 0:A[a];if(this.isNumber(a)||En()(te)&&!M)D.scale=xt([a]),D.type=R.StyleScaleType.CONSTANT;else{var J=M&&M.type||this.getDefaultType(te);l==="text"&&(J=R.ScaleTypes.CAT);var ye=this.createDefaultScaleConfig(J,a,d);Object.assign(ye,M),D.scale=this.createDefaultScale(ye),D.option=ye}return D}},{key:"getDefaultType",value:function(a){var s=R.ScaleTypes.LINEAR;return typeof a=="string"&&(s=km.test(a)?R.ScaleTypes.TIME:R.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var d={type:a},x=(l==null?void 0:l.map(function(A){return A[s]}))||[];return a!==R.ScaleTypes.CAT&&a!==R.ScaleTypes.QUANTILE?d.domain=Ti(x):a===R.ScaleTypes.CAT?d.domain=Pr()(x):a===R.ScaleTypes.QUANTILE&&(d.domain=x),d}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,d=Fm[s]();return l&&d.domain(l),d}}]),n}(),Qd=(0,_o.Z)(Bd.prototype,"configService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd))||Jd),qd,ev,tv,rv,_d,nv,iv;function av(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Nm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?av(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):av(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var zm=(qd=(0,cn.b2)(),ev=(0,cn.f3)(R.vK.ICameraService),tv=(0,cn.f3)(R.vK.IRendererService),qd(rv=(_d=function(){function n(){(0,vr.Z)(this,n),(0,no.Z)(this,"cameraService",nv,this),(0,no.Z)(this,"rendererService",iv,this)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(Nm({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),nv=(0,_o.Z)(_d.prototype,"cameraService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=(0,_o.Z)(_d.prototype,"rendererService",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||rv),ov,sv,Um=(ov=(0,cn.b2)(),ov(sv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||sv),uv,lv,Zm=(uv=(0,cn.b2)(),uv(lv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(d)},100)})}}]),n}())||lv),cv,fv;function hv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Zp(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?hv(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):hv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var pv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},jm={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Vm={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Gm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},ay=null;function Hm(n){var c={u_DirectionalLights:new Array(3).fill(Zp({},Vm)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Zp({},Gm)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[jm]),n.forEach(function(a,s){var l=a.type,d=l===void 0?"directional":l,x=(0,Zs.Z)(a,["type"]),A=pv[d].lights,M=pv[d].num,D=c[M];c[A][D]=Zp(Zp({},c[A][D]),x),c[M]++}),c}var Wm=(cv=(0,cn.b2)(),cv(fv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(d){return d.addUniforms(Zp({},Hm()))})})}}]),n}())||fv),dv,vv,xd={NONE:0,ENCODE:1,HIGHLIGHT:2},Xm=(dv=(0,cn.b2)(),dv(vv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,d=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var x=a.getLayerConfig(),A=x.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:R.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:R.gl.FLOAT},size:3,update:function(D,te){var J=D.id;return A?(0,qe.Z6)(J):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var x=a.getLayerConfig(),A=x.enablePicking;A&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:xd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var x=a.getLayerConfig(),A=x.enablePicking;A&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:xd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(x){var A=a.getLayerConfig(),M=A.highlightColor,D=typeof M=="string"?(0,qe.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,qe.W0)(new Uint8Array(x))}),a.models.forEach(function(te){return te.addUniforms({u_PickingStage:xd.HIGHLIGHT,u_PickingColor:x,u_HighlightColor:D.map(function(J){return J*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(x){var A=a.getLayerConfig(),M=A.selectColor,D=typeof M=="string"?(0,qe.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,qe.W0)(new Uint8Array(x))}),a.models.forEach(function(te){return te.addUniforms({u_PickingStage:xd.HIGHLIGHT,u_PickingColor:x,u_HighlightColor:D.map(function(J){return J*255})})})})}}]),n}())||vv),mv,gv,Ym=(mv=(0,cn.b2)(),mv(gv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:R.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:R.gl.FLOAT},size:3,update:function(l,d,x){return x.length===2?[x[0],x[1],0]:[x[0],x[1],x[2]]}}}),a.registerStyleAttribute({name:"filter",type:R.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(l,d){var x=l.filter;return x?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:R.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:4,update:function(l,d){var x=l.color;return!x||!x.length?[1,1,1,1]:x}}}),a.registerStyleAttribute({name:"vertexId",type:R.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(l,d,x,A){return[d]}}})}}]),n}())||gv),yv,_v,xv,bv,Sv,Ev,np,Cv,wv,Av,Tv,Km=(yv=(0,cn.b2)(),_v=(0,cn.f3)(R.vK.ICameraService),xv=(0,cn.f3)(R.vK.ICoordinateSystemService),bv=(0,cn.f3)(R.vK.IRendererService),Sv=(0,cn.f3)(R.vK.IMapService),yv(Ev=(np=function(){function n(){(0,vr.Z)(this,n),(0,no.Z)(this,"cameraService",Cv,this),(0,no.Z)(this,"coordinateSystemService",wv,this),(0,no.Z)(this,"rendererService",Av,this),(0,no.Z)(this,"mapService",Tv,this)}return(0,Or.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],x=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),x=s.mapService.getCustomCoordCenter());var A=s.rendererService.getViewportSize(),M=A.width,D=A.height;a.models.forEach(function(te){var J;te.addUniforms((J={},(0,W.Z)(J,R.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,W.Z)(J,R.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,W.Z)(J,R.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,W.Z)(J,R.CameraUniform.Zoom,s.cameraService.getZoom()),(0,W.Z)(J,R.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,W.Z)(J,R.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,W.Z)(J,R.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,W.Z)(J,R.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,W.Z)(J,R.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,W.Z)(J,R.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,W.Z)(J,R.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,W.Z)(J,R.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,W.Z)(J,R.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,W.Z)(J,R.CoordinateUniform.Mvp,d),(0,W.Z)(J,"u_SceneCenterMKT",x),(0,W.Z)(J,"u_ViewportSize",[M,D]),(0,W.Z)(J,"u_DevicePixelRatio",window.devicePixelRatio),(0,W.Z)(J,"u_ModelMatrix",s.cameraService.getModelMatrix()),(0,W.Z)(J,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),J))})})}}]),n}(),Cv=(0,_o.Z)(np.prototype,"cameraService",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=(0,_o.Z)(np.prototype,"coordinateSystemService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=(0,_o.Z)(np.prototype,"rendererService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=(0,_o.Z)(np.prototype,"mapService",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np))||Ev),Pv,Mv,$m=(Pv=(0,cn.b2)(),Pv(Mv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||Mv),Iv,Ov,Jm=(Iv=(0,cn.b2)(),Iv(Ov=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:d})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[],x=l.getLayerStyleAttribute("filter"),A=l.getLayerStyleAttribute("shape");if(x&&x.needRegenerateVertices||A&&A.needRegenerateVertices){a.layerModelNeedUpdate=!0,d.forEach(function(M){return M.needRegenerateVertices=!1});return}d.filter(function(M){return M.needRegenerateVertices}).forEach(function(M){l.updateAttributeByFeatureRange(M.name,a.getEncodedData(),M.featureRange.startIndex,M.featureRange.endIndex),M.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[];d.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){l.updateAttributeByFeatureRange(x.name,a.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}}]),n}())||Ov);R.nC.bind(R.vK.ILayerPlugin).to(pi).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Ym).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Bm).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Rr).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Zm).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Jm).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to($m).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Nl).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Km).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(zm).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Wm).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Xm).inRequestScope(),R.nC.bind(R.vK.ILayerPlugin).to(Um).inRequestScope();var oy="2.5.35";function Lv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function sy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lv(Object(a),!0).forEach(function(s){Qm(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Qm(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function uy(n,c){return r0(n)||t0(n,c)||e0(n,c)||qm()}function qm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e0(n,c){if(!!n){if(typeof n=="string")return Rv(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Rv(n,c)}}function Rv(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function t0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function r0(n){if(Array.isArray(n))return n}var ly=null,cy=null,Dv,Nd,kv;function Fv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Bv(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Fv(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Fv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var n0=(Dv=(0,R.yT)(R.vK.IGlobalConfigService),Nd=function(){function n(c){(0,vr.Z)(this,n),(0,no.Z)(this,"configService",kv,this),(0,W.Z)(this,"config",void 0),this.config=c}return(0,Or.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(R.vK.MapConfig).toConstantValue(Bv(Bv({},this.config),{},{id:s})),a.bind(R.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),kv=(0,_o.Z)(Nd.prototype,"configService",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd),i0=y(6158),a0=y.n(i0),zd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP",n.GLOBEL="GLOBEL"})(zd||(zd={}));function jp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bd(n,c){var a=cc.fF([],c,n);return cc.bA(a,a,1/a[3]),a}function fy(n,c){var a=n%c;return a<0?c+a:a}function hy(n,c,a){return a*c+(1-a)*n}function Oh(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var Xc=Math.PI,Nv=Xc/4,Of=Xc/180,zv=180/Xc,Ud=512,Zd=4003e4,o0=1.5;function Uv(n){return Math.pow(2,n)}function s0(n){return Math.log2(n)}function Sd(n,c){var a=(0,$i.Z)(n,2),s=a[0],l=a[1];Oh(Number.isFinite(s)&&Number.isFinite(c)),Oh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Ud;var d=s*Of,x=l*Of,A=c*(d+Xc)/(2*Xc),M=c*(Xc-Math.log(Math.tan(Nv+x*.5)))/(2*Xc);return[A,M]}function jd(n,c){var a=(0,$i.Z)(n,2),s=a[0],l=a[1];c*=Ud;var d=s/c*(2*Xc)-Xc,x=2*(Math.atan(Math.exp(Xc-l/c*(2*Xc)))-Nv);return[d*zv,x*zv]}function py(n){var c=n.latitude;assert(Number.isFinite(c));var a=Math.cos(c*Of);return s0(Zd*a)-9}function Zv(n){var c=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,d=n.highPrecision,x=d===void 0?!1:d;l=l!==void 0?l:Uv(s),Oh(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var A={},M=Ud*l,D=Math.cos(c*Of),te=M/360,J=te/D,ye=M/Zd/D;if(A.pixelsPerMeter=[ye,-ye,ye],A.metersPerPixel=[1/ye,-1/ye,1/ye],A.pixelsPerDegree=[te,-J,ye],A.degreesPerPixel=[1/te,-1/J,1/ye],x){var ze=Of*Math.tan(c*Of)/D,dt=te*ze/2,Ft=M/Zd*ze,gr=Ft/J*ye;A.pixelsPerDegree2=[0,-dt,Ft],A.pixelsPerMeter2=[gr,0,gr]}return A}function dy(n,c){var a=_slicedToArray(n,3),s=a[0],l=a[1],d=a[2],x=_slicedToArray(c,3),A=x[0],M=x[1],D=x[2],te=1,J=Zv({longitude:s,latitude:l,scale:te,highPrecision:!0}),ye=J.pixelsPerMeter,ze=J.pixelsPerMeter2,dt=Sd(n,te);dt[0]+=A*(ye[0]+ze[0]*M),dt[1]+=M*(ye[1]+ze[1]*M);var Ft=jd(dt,te),gr=(d||0)+(D||0);return Number.isFinite(d)||Number.isFinite(D)?[Ft[0],Ft[1],gr]:Ft}function u0(n){var c=n.height,a=n.pitch,s=n.bearing,l=n.altitude,d=n.center,x=d===void 0?null:d,A=n.flipY,M=A===void 0?!1:A,D=jp();return mn.translate(D,D,[0,0,-l]),mn.scale(D,D,[1,1,1/c]),mn.rotateX(D,D,-a*Of),mn.rotateZ(D,D,s*Of),M&&mn.scale(D,D,[1,-1,1]),x&&mn.translate(D,D,Zi.negate([],x)),D}function l0(n){var c=n.width,a=n.height,s=n.altitude,l=s===void 0?o0:s,d=n.pitch,x=d===void 0?0:d,A=n.nearZMultiplier,M=A===void 0?1:A,D=n.farZMultiplier,te=D===void 0?1:D,J=x*Of,ye=Math.atan(.5/l),ze=Math.sin(ye)*l/Math.sin(Math.PI/2-J-ye),dt=Math.cos(Math.PI/2-J)*ze+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:M,far:dt*te}}function c0(n){var c=n.width,a=n.height,s=n.pitch,l=n.altitude,d=n.nearZMultiplier,x=n.farZMultiplier,A=l0({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:x}),M=A.fov,D=A.aspect,te=A.near,J=A.far,ye=mn.perspective([],M,D,te,J);return ye}function f0(n,c){var a=(0,$i.Z)(n,3),s=a[0],l=a[1],d=a[2],x=d===void 0?0:d;return Oh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(x)),bd(c,[s,l,x,1])}function jv(n,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,$i.Z)(n,3),l=s[0],d=s[1],x=s[2];if(Oh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(x)){var A=bd(c,[l,d,x,1]);return A}var M=bd(c,[l,d,0,1]),D=bd(c,[l,d,1,1]),te=M[2],J=D[2],ye=te===J?0:((a||0)-te)/(J-te);return bi.t7([],M,D,ye)}var Vv=jp(),h0=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?Vv:l,x=c.projectionMatrix,A=x===void 0?Vv:x;(0,vr.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=A;var M=jp();mn.multiply(M,M,this.projectionMatrix),mn.multiply(M,M,this.viewMatrix),this.viewProjectionMatrix=M;var D=jp();mn.scale(D,D,[this.width/2,-this.height/2,1]),mn.translate(D,D,[1,-1,0]),mn.multiply(D,D,this.viewProjectionMatrix);var te=mn.invert(jp(),D);if(!te)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=te,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Or.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&mn.equals(a.projectionMatrix,this.projectionMatrix)&&mn.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,x=this.projectPosition(a),A=f0(x,this.pixelProjectionMatrix),M=(0,$i.Z)(A,2),D=M[0],te=M[1],J=d?te:this.height-te;return a.length===2?[D,J]:[D,J,A[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,x=s.targetZ,A=(0,$i.Z)(a,3),M=A[0],D=A[1],te=A[2],J=d?D:this.height-D,ye=x&&x*this.pixelsPerMeter,ze=jv([M,J,te],this.pixelUnprojectionMatrix,ye),dt=this.unprojectPosition(ze),Ft=(0,$i.Z)(dt,3),gr=Ft[0],Ar=Ft[1],Vr=Ft[2];return Number.isFinite(te)?[gr,Ar,Vr]:Number.isFinite(x)?[gr,Ar,x]:[gr,Ar]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,$i.Z)(s,2),d=l[0],x=l[1],A=(a[2]||0)*this.pixelsPerMeter;return[d,x,A]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,$i.Z)(s,2),d=l[0],x=l[1],A=(a[2]||0)/this.pixelsPerMeter;return[d,x,A]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function p0(n){var c=n.width,a=n.height,s=n.bounds,l=n.minExtent,d=l===void 0?0:l,x=n.maxZoom,A=x===void 0?24:x,M=n.padding,D=M===void 0?0:M,te=n.offset,J=te===void 0?[0,0]:te,ye=(0,$i.Z)(s,2),ze=(0,$i.Z)(ye[0],2),dt=ze[0],Ft=ze[1],gr=(0,$i.Z)(ye[1],2),Ar=gr[0],Vr=gr[1];if(Number.isFinite(D)){var vn=D;D={top:vn,bottom:vn,left:vn,right:vn}}else Oh(Number.isFinite(D.top)&&Number.isFinite(D.bottom)&&Number.isFinite(D.left)&&Number.isFinite(D.right));var bn=new Gv({width:c,height:a,longitude:0,latitude:0,zoom:0}),zn=bn.project([dt,Vr]),ri=bn.project([Ar,Ft]),ii=[Math.max(Math.abs(ri[0]-zn[0]),d),Math.max(Math.abs(ri[1]-zn[1]),d)],Si=[c-D.left-D.right-Math.abs(J[0])*2,a-D.top-D.bottom-Math.abs(J[1])*2];Oh(Si[0]>0&&Si[1]>0);var ea=Si[0]/ii[0],ya=Si[1]/ii[1],yi=(D.right-D.left)/2/ea,Ta=(D.bottom-D.top)/2/ya,za=[(ri[0]+zn[0])/2+yi,(ri[1]+zn[1])/2+Ta],ou=bn.unproject(za),Lf=bn.zoom+Math.log2(Math.abs(Math.min(ea,ya)));return{longitude:ou[0],latitude:ou[1],zoom:Math.min(Lf,A)}}var Gv=function(n){(0,Kn.Z)(c,n);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,x=s.latitude,A=x===void 0?0:x,M=s.longitude,D=M===void 0?0:M,te=s.zoom,J=te===void 0?0:te,ye=s.pitch,ze=ye===void 0?0:ye,dt=s.bearing,Ft=dt===void 0?0:dt,gr=s.altitude,Ar=gr===void 0?1.5:gr,Vr=s.nearZMultiplier,vn=s.farZMultiplier;(0,vr.Z)(this,c),l=l||1,d=d||1;var bn=Uv(J);Ar=Math.max(.75,Ar);var zn=Sd([D,A],bn);zn[2]=0;var ri=c0({width:l,height:d,pitch:ze,bearing:Ft,altitude:Ar,nearZMultiplier:Vr||1/d,farZMultiplier:vn||1.01}),ii=u0({height:d,center:zn,pitch:ze,bearing:Ft,altitude:Ar,flipY:!0});return a=(0,Ln.Z)(this,(0,Ur.Z)(c).call(this,{width:l,height:d,viewMatrix:ii,projectionMatrix:ri})),a.latitude=A,a.longitude=D,a.zoom=J,a.pitch=ze,a.bearing=Ft,a.altitude=Ar,a.scale=bn,a.center=zn,a.pixelsPerMeter=Zv((0,St.Z)((0,St.Z)(a))).pixelsPerMeter[2],Object.freeze((0,St.Z)((0,St.Z)(a))),a}return(0,Or.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Sd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return jd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,x=jv(d,this.pixelUnprojectionMatrix),A=Sd(l,this.scale),M=bi.IH([],A,bi.tk([],x)),D=bi.IH([],this.center,M);return jd(D,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,x=this.height,A=p0(Object.assign({width:d,height:x,bounds:s},l)),M=A.longitude,D=A.latitude,te=A.zoom;return new c({width:d,height:x,longitude:M,latitude:D,zoom:te})}}]),c}(h0),d0=function(){function n(){(0,vr.Z)(this,n),(0,W.Z)(this,"viewport",void 0)}return(0,Or.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,d=a.pitch,x=a.bearing,A=a.viewportHeight,M=a.viewportWidth;this.viewport=new Gv({width:M,height:A,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:x})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),Hv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Wv,Xv,Yv,Kv,$v,Jv,ip,Qv,qv,em,tm;function rm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function v0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?rm(Object(a),!0).forEach(function(s){(0,W.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):rm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function m0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}m0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=a0();var nm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},g0=0,y0=12,im="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",_0=(Wv=(0,cn.b2)(),Xv=(0,cn.f3)(R.vK.MapConfig),Yv=(0,cn.f3)(R.vK.IGlobalConfigService),Kv=(0,cn.f3)(R.vK.ICoordinateSystemService),$v=(0,cn.f3)(R.vK.IEventEmitter),Wv(Jv=(ip=function(){function n(){var c=this;(0,vr.Z)(this,n),(0,W.Z)(this,"version",zd.MAPBOX),(0,W.Z)(this,"map",void 0),(0,W.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,no.Z)(this,"config",Qv,this),(0,no.Z)(this,"configService",qv,this),(0,no.Z)(this,"coordinateSystemService",em,this),(0,no.Z)(this,"eventEmitter",tm,this),(0,W.Z)(this,"viewport",void 0),(0,W.Z)(this,"markerContainer",void 0),(0,W.Z)(this,"cameraChangedCallback",void 0),(0,W.Z)(this,"$mapContainer",void 0),(0,W.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,x=d===void 0?y0:d;c.viewport.getZoom()>x?c.coordinateSystemService.setCoordinateSystem(R.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(R.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,Or.Z)(n,[{key:"setBgColor",value:function(a){this.bgColor=a}},{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=qe.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){R.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(nm[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(nm[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a,s){this.panTo([a,s])}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToCoord",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},l=this.lngLatToMercator(a,0),d=l.x,x=l.y;return[d-s.x,x-s.y]}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),d=l.x,x=d===void 0?0:d,A=l.y,M=A===void 0?0:A,D=l.z,te=D===void 0?0:D;return{x,y:M,z:te}}},{key:"getModelMatrix",value:function(a,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),M=A.meterInMercatorCoordinateUnits(),D=mn.create();return mn.translate(D,D,Zi.fromValues(A.x-x.x,A.y-x.y,A.z||0-x.z)),mn.scale(D,D,Zi.fromValues(M*d[0],-M*d[1],M*d[2])),mn.rotateX(D,D,l[0]),mn.rotateY(D,D,l[1]),mn.rotateZ(D,D,l[2]),D}},{key:"init",value:function(){var c=(0,Wt.Z)(Kr().mark(function s(){var l,d,x,A,M,D,te,J,ye,ze,dt,Ft,gr;return Kr().wrap(function(Vr){for(;;)switch(Vr.prev=Vr.next){case 0:l=this.config,d=l.id,x=d===void 0?"map":d,A=l.attributionControl,M=A===void 0?!1:A,D=l.style,te=D===void 0?"light":D,J=l.token,ye=J===void 0?im:J,ze=l.rotation,dt=ze===void 0?0:ze,Ft=l.mapInstance,gr=(0,Zs.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new d0,!Ft&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),ye===im&&te!=="blank"&&!window.mapboxgl.accessToken&&!Ft&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Ft&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=ye),Ft?(this.map=Ft,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(x),this.map=new window.mapboxgl.Map(v0({container:this.$mapContainer,style:this.getMapStyle(te),attributionControl:M,bearing:dt},gr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Vr.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){var a,s;(a=this.$mapContainer)===null||a===void 0||(s=a.parentNode)===null||s===void 0||s.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),x=1;x<l;x++)d[x-1]=arguments[x];(s=this.eventEmitter).emit.apply(s,[a].concat(d))}},{key:"once",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),x=1;x<l;x++)d[x-1]=arguments[x];(s=this.eventEmitter).once.apply(s,[a].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+g0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:Hv[a]?Hv[a]:a}}]),n}(),Qv=(0,_o.Z)(ip.prototype,"config",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qv=(0,_o.Z)(ip.prototype,"configService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=(0,_o.Z)(ip.prototype,"coordinateSystemService",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=(0,_o.Z)(ip.prototype,"eventEmitter",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ip))||Jv);function x0(n){var c=b0();return function(){var s=(0,Ur.Z)(n),l;if(c){var d=(0,Ur.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function b0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function S0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}S0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var E0=function(n){(0,Kn.Z)(a,n);var c=x0(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getServiceConstructor",value:function(){return _0}}]),a}(n0);function am(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function om(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?am(Object(a),!0).forEach(function(s){C0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):am(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function C0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function w0(n,c){return M0(n)||P0(n,c)||T0(n,c)||A0()}function A0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T0(n,c){if(!!n){if(typeof n=="string")return sm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sm(n,c)}}function sm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function P0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function M0(n){if(Array.isArray(n))return n}var I0=z.memo(function(n){var c=n.style,a=n.className,s=n.map,l=n.option,d=n.onSceneLoaded,x=(0,z.createRef)(),A=(0,z.useState)(),M=w0(A,2),D=M[0],te=M[1];return(0,z.useEffect)(function(){var J=new ec(om(om({id:x.current},l),{},{map:new E0(s)}));return J.on("loaded",function(){te(J),d&&d(J)}),function(){J.destroy()}},[]),(0,z.useEffect)(function(){D&&s.style&&D.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,z.useEffect)(function(){D&&s.zoom&&D.setZoom(s.zoom)},[s.zoom]),(0,z.useEffect)(function(){D&&s.center&&D.setCenter(s.center)},[JSON.stringify(s.center)]),(0,z.useEffect)(function(){D&&s.pitch!==void 0&&D.setPitch(s.pitch||0)},[s.pitch]),(0,z.useEffect)(function(){D&&s.rotation&&D.setRotation(s.rotation)},[s.rotation]),z.createElement(b.Provider,{value:D},(0,z.createElement)("div",{ref:x,style:c,className:a},D&&n.children))}),O0=I0;function um(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function vy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?um(Object(a),!0).forEach(function(s){L0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):um(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function L0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function gy(n,c){return F0(n)||k0(n,c)||D0(n,c)||R0()}function R0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D0(n,c){if(!!n){if(typeof n=="string")return lm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lm(n,c)}}function lm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function k0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function F0(n){if(Array.isArray(n))return n}var yy=null,_y=null;function cm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function xy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?cm(Object(a),!0).forEach(function(s){B0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):cm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function B0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function by(n,c){return Z0(n)||U0(n,c)||z0(n,c)||N0()}function N0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z0(n,c){if(!!n){if(typeof n=="string")return fm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fm(n,c)}}function fm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function U0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function Z0(n){if(Array.isArray(n))return n}var Sy=null,Ey=null;function Cy(n,c){return H0(n)||G0(n,c)||V0(n,c)||j0()}function j0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V0(n,c){if(!!n){if(typeof n=="string")return hm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hm(n,c)}}function hm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function G0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function H0(n){if(Array.isArray(n))return n}var wy=null,Ay=null;function pm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ty(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?pm(Object(a),!0).forEach(function(s){W0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):pm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function W0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Py(n,c){if(n==null)return{};var a=X0(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function X0(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var My=null,dm=y(73935);function Y0(n,c){return Q0(n)||J0(n,c)||$0(n,c)||K0()}function K0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $0(n,c){if(!!n){if(typeof n=="string")return vm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vm(n,c)}}function vm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function J0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function Q0(n){if(Array.isArray(n))return n}var q0=z.useEffect,eg=z.useState;function Iy(n){var c=n.className,a=n.style,s=n.children,l=n.position,d=useSceneValue(),x=eg(function(){return document.createElement("div")}),A=Y0(x,1),M=A[0];return q0(function(){var D=new Control({position:l});return D.onAdd=function(){if(c&&(M.className=c),a){var te=Object.keys(a).map(function(J){return"".concat(J,":").concat(a[J])}).join(";");M.style.cssText=te}return M},d.addControl(D),function(){d.removeControl(D)}},[]),createPortal(s,M)}var mm=(0,z.createContext)({});function Oy(){return useContext(mm)}var tg=z.useEffect,rg=z.memo(function(c){var a=c.layer,s=c.active;return tg(function(){a.active(s.option)},[JSON.stringify(s)]),null}),ng=z.useEffect,ig=z.memo(function(c){var a=c.layer,s=c.animate;return ng(function(){a.animate(s)},[JSON.stringify(s)]),null}),ag=z.useEffect,og=z.memo(function(c){var a=c.layer,s=c.color;return ag(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),sg=z.useEffect,ug=z.memo(function(c){var a=c.layer,s=c.filter;return sg(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),lg=z.useEffect,cg=z.memo(function(c){var a=c.layer,s=c.scale;return lg(function(){a.scale(s.values)},[s.values]),null}),fg=z.useEffect,hg=z.memo(function(c){var a=c.layer,s=c.select;return fg(function(){a.select(s.option)},[JSON.stringify(s)]),null}),pg=z.useEffect,dg=z.memo(function(c){var a=c.layer,s=c.shape;return pg(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),vg=z.useEffect,mg=z.memo(function(c){var a=c.layer,s=c.size;return vg(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),gg=["data"];function yg(n,c){if(n==null)return{};var a=_g(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function _g(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var xg=z.useEffect,bg=z.memo(function(c){var a=c.layer,s=c.source,l=s.data,d=yg(s,gg);return xg(function(){a.inited?a.setData(l,d):a.source(l,d),d.autoFit&&a.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),Sg=z.useEffect,Eg=z.memo(function(c){var a=c.layer,s=c.style;return Sg(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Cg(n,c){return Pg(n)||Tg(n,c)||Ag(n,c)||wg()}function wg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ag(n,c){if(!!n){if(typeof n=="string")return gm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gm(n,c)}}function gm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Tg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function Pg(n){if(Array.isArray(n))return n}var Vp=z.useEffect,Mg=z.useState;function ym(n,c){var a=c.source,s=c.color,l=c.shape,d=c.style,x=c.size,A=c.scale,M=c.active,D=c.select,te=c.filter,J=c.animate,ye=c.options,ze=c.onLayerLoaded,dt=p(),Ft=Mg(function(){var Vr;switch(n){case"polygonLayer":Vr=new Xl(ye);break;case"lineLayer":Vr=new cp(ye);break;case"pointLayer":Vr=new _h(ye);break;case"heatmapLayer":Vr=new pa(ye);break;case"rasterLayer":Vr=new Hr(ye);break;case"imageLayer":Vr=new Mi(ye);break;case"citybuildingLayer":Vr=new At(ye);break;default:Vr=new Xl(ye)}return Vr.on("inited",function(){ze&&ze(Vr,dt)}),Vr}),gr=Cg(Ft,1),Ar=gr[0];return Vp(function(){return dt.addLayer(Ar),function(){dt.removeLayer(Ar)}},[]),Vp(function(){Ar.inited&&ye&&Ar.updateLayerConfig(ye)},[ye==null?void 0:ye.minZoom,ye==null?void 0:ye.maxZoom,ye==null?void 0:ye.visible]),Vp(function(){Ar.inited&&(ye==null?void 0:ye.zIndex)&&Ar.setIndex(ye.zIndex)},[ye==null?void 0:ye.zIndex]),Vp(function(){Ar.inited&&(ye==null?void 0:ye.blend)&&Ar.setBlend(ye.blend)},[ye==null?void 0:ye.blend]),Vp(function(){dt.render()}),z.createElement(mm.Provider,{value:Ar},z.createElement(bg,{layer:Ar,source:a}),A&&z.createElement(cg,{layer:Ar,scale:A}),s&&z.createElement(og,{layer:Ar,color:s}),x&&z.createElement(mg,{layer:Ar,size:x}),l&&z.createElement(dg,{layer:Ar,shape:l}),d&&z.createElement(Eg,{layer:Ar,style:d}),M&&z.createElement(rg,{layer:Ar,active:M}),D&&z.createElement(hg,{layer:Ar,select:D}),te&&z.createElement(ug,{layer:Ar,filter:te}),J&&z.createElement(ig,{layer:Ar,animate:J}),c.children)}var Ly=null,Ry=null,Ig=z.memo(function(c){return ym("pointLayer",c)}),Og=z.memo(function(c){return ym("heatmapLayer",c)}),Dy=null,ky=null,Fy=null,By=z.useEffect,Ny=null,zy=null;function Ed(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ed=function(a){return typeof a}:Ed=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ed(n)}function _m(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Cd(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?_m(Object(a),!0).forEach(function(s){Lg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_m(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Lg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Rg(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function xm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function Dg(n,c,a){return c&&xm(n.prototype,c),a&&xm(n,a),n}function kg(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Vd(n,c)}function Vd(n,c){return Vd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Vd(n,c)}function Fg(n){var c=zg();return function(){var s=wd(n),l;if(c){var d=wd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Bg(this,l)}}function Bg(n,c){if(c&&(Ed(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ng(n)}function Ng(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function zg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function wd(n){return wd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},wd(n)}var Uy=function(n){kg(a,n);var c=Fg(a);function a(s){var l;return Rg(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Dg(a,[{key:"componentDidMount",value:function(){var l,d=this.props,x=d.lnglat,A=d.children,M=d.option,D=d.lngLat,te=new ht(Cd(Cd({},M),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));x&&te.setLnglat(x),D&&te.setLnglat(D),A&&te.setDOMContent(this.el),this.popup=te,this.scene.addPopup(te)}},{key:"componentDidUpdate",value:function(l){var d,x,A,M,D,te,J=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(x=l.lnglat)===null||x===void 0?void 0:x.lat],ye=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(M=A.lnglat)===null||M===void 0?void 0:M.lng,(D=this.props)===null||D===void 0||(te=D.lnglat)===null||te===void 0?void 0:te.lat],ze=J.toString()!==ye.toString();if(ze){var dt;this.popup.remove(),this.popup=new ht(Cd(Cd({},this.props.option),{},{stopPropagation:(dt=this.props.option)===null||dt===void 0?void 0:dt.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return z.createElement(b.Consumer,{},function(d){return d&&(l.scene=d),(0,dm.createPortal)(l.props.children,l.el)})}}]),a}(z.PureComponent);function Ad(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ad=function(a){return typeof a}:Ad=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ad(n)}function Ug(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function bm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function Zg(n,c,a){return c&&bm(n.prototype,c),a&&bm(n,a),n}function jg(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Gd(n,c)}function Gd(n,c){return Gd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Gd(n,c)}function Vg(n){var c=Wg();return function(){var s=Td(n),l;if(c){var d=Td(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Gg(this,l)}}function Gg(n,c){if(c&&(Ad(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hg(n)}function Hg(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Wg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Td(n){return Td=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Td(n)}var Zy=function(n){jg(a,n);var c=Vg(a);function a(s){var l;return Ug(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return Zg(a,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,x=l.children,A=l.option,M=l.onMarkerLoaded,D=new $u(A);d&&D.setLnglat(d),x&&D.setElement(this.el),this.marker=D,M&&M(D),this.scene.addMarker(D)}},{key:"componentDidUpdate",value:function(l){var d,x=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());x&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return z.createElement(b.Consumer,{},function(d){return d&&(l.scene=d),(0,dm.createPortal)(l.props.children,l.el)})}}]),a}(z.PureComponent),jy=z.useEffect,Vy=null,Gy=null,Hy=z.useEffect,Wy=null},4771:function(){},6563:function(Qe,O,y){var z=y(31795);Qe.exports=b;function b(he,Z){switch(he&&he.type||null){case"FeatureCollection":return he.features=he.features.map(p(b,Z)),he;case"GeometryCollection":return he.geometries=he.geometries.map(p(b,Z)),he;case"Feature":return he.geometry=b(he.geometry,Z),he;case"Polygon":case"MultiPolygon":return X(he,Z);default:return he}}function p(he,Z){return function(Ie){return he(Ie,Z)}}function X(he,Z){return he.type==="Polygon"?he.coordinates=U(he.coordinates,Z):he.type==="MultiPolygon"&&(he.coordinates=he.coordinates.map(p(U,Z))),he}function U(he,Z){Z=!!Z,he[0]=Y(he[0],Z);for(var Ie=1;Ie<he.length;Ie++)he[Ie]=Y(he[Ie],!Z);return he}function Y(he,Z){return $(he)===Z?he:he.reverse()}function $(he){return z.ring(he)>=0}},6901:function(Qe,O,y){"use strict";y.d(O,{SO:function(){return z},z6:function(){return ct},a5:function(){return b},Z:function(){return lt},rQ:function(){return An},bV:function(){return Yr},zi:function(){return vr},ds:function(){return Je},Ev:function(){return It},oO:function(){return Mr},W0:function(){return Tr},Z6:function(){return qe},We:function(){return ar},Cl:function(){return Gr},gJ:function(){return Ge},vP:function(){return Fr},yM:function(){return q},yA:function(){return Er},CI:function(){return br}});var z={};y.r(z),y.d(z,{DPR:function(){return $e},addClass:function(){return $t},create:function(){return Le},empty:function(){return yt},getClass:function(){return Ct},getContainer:function(){return $},getViewPortScale:function(){return Tt},hasClass:function(){return Lt},printCanvas:function(){return nr},remove:function(){return rt},removeClass:function(){return zt},setClass:function(){return Ht},setTransform:function(){return sr},splitWords:function(){return Z},triggerResize:function(){return re},trim:function(){return he}});var b={};y.r(b),y.d(b,{getColumn:function(){return fe},getSatByColumn:function(){return me},max:function(){return Or},mean:function(){return Ln},min:function(){return St},mode:function(){return Ur},statMap:function(){return ee},sum:function(){return Kn}});function p(N){var ae=131,de=137,Te=0;N+="x";for(var ue=Math.floor(9007199254740991/de),xe=0;xe<N.length;xe++)Te>ue&&(Te=Math.floor(Te/de)),Te=Te*ae+N.charCodeAt(xe);return Te}function X(N){N=N.toString();for(var ae=5381,de=N.length;de;)ae=ae*33^N.charCodeAt(--de);return ae>>>0}var U=y(28481),Y=window.document.documentElement.style;function $(N){var ae=N;return typeof N=="string"&&(ae=document.getElementById(N)),ae}function he(N){return N.trim?N.trim():N.replace(/^\s+|\s+$/g,"")}function Z(N){return he(N).split(/\s+/)}function Ie(N){if(!Y)return N[0];for(var ae in N)if(N[ae]&&N[ae]in Y)return N[ae];return N[0]}function Le(N,ae,de){var Te=document.createElement(N);return Te.className=ae||"",de&&de.appendChild(Te),Te}function rt(N){var ae=N.parentNode;ae&&ae.removeChild(N)}function $t(N,ae){if(N.classList!==void 0)for(var de=Z(ae),Te=0,ue=de.length;Te<ue;Te++)N.classList.add(de[Te]);else if(!Lt(N,ae)){var xe=Ct(N);Ht(N,(xe?xe+" ":"")+ae)}}function zt(N,ae){N.classList!==void 0?N.classList.remove(ae):Ht(N,he((" "+Ct(N)+" ").replace(" "+ae+" "," ")))}function Lt(N,ae){if(N.classList!==void 0)return N.classList.contains(ae);var de=Ct(N);return de.length>0&&new RegExp("(^|\\s)"+ae+"(\\s|$)").test(de)}function Ht(N,ae){N instanceof HTMLElement?N.className=ae:N.className.baseVal=ae}function Ct(N){return N instanceof SVGElement&&(N=N.correspondingElement),N.className.baseVal===void 0?N.className:N.className.baseVal}function yt(N){for(;N&&N.firstChild;)N.removeChild(N.firstChild)}var ft=Ie(["transform","WebkitTransform"]);function sr(N,ae){N.style[ft]=ae}function re(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var N=window.document.createEvent("UIEvents");N.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(N)}}function nr(N){var ae=["padding: "+(N.height/2-8)+"px "+N.width/2+"px;","line-height: "+N.height+"px;","background-image: url("+N.toDataURL()+");"];console.log(`%c
`,ae.join(""))}function Tt(){var N,ae=document.querySelector('meta[name="viewport"]');if(!ae)return 1;var de=(N=ae.content)===null||N===void 0?void 0:N.split(","),Te=de.find(function(ue){var xe=ue.split("="),pt=(0,U.Z)(xe,2),Cr=pt[0],Kt=pt[1];return Cr==="initial-scale"});return Te?Te.split("=")[1]*1:1}var $e=Tt()<1?1:window.devicePixelRatio,Mt=y(6610),Ve=y(5991),Ot=y(63349),pr=y(10379),qt=y(46070),W=y(77608),se=y(14665);function ke(N){return Function.toString.call(N).indexOf("[native code]")!==-1}var _e=y(51814);function Et(N,ae,de){return(0,_e.Z)()?Et=Reflect.construct:Et=function(ue,xe,pt){var Cr=[null];Cr.push.apply(Cr,xe);var Kt=Function.bind.apply(ue,Cr),rr=new Kt;return pt&&(0,se.Z)(rr,pt.prototype),rr},Et.apply(null,arguments)}function gt(N){var ae=typeof Map=="function"?new Map:void 0;return gt=function(Te){if(Te===null||!ke(Te))return Te;if(typeof Te!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ae!="undefined"){if(ae.has(Te))return ae.get(Te);ae.set(Te,ue)}function ue(){return Et(Te,arguments,(0,W.Z)(this).constructor)}return ue.prototype=Object.create(Te.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),(0,se.Z)(ue,Te)},gt(N)}var jt=y(96156);function Ut(N){var ae=zr();return function(){var Te=(0,W.Z)(N),ue;if(ae){var xe=(0,W.Z)(this).constructor;ue=Reflect.construct(Te,arguments,xe)}else ue=Te.apply(this,arguments);return(0,qt.Z)(this,ue)}}function zr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var dn=function(N){(0,pr.Z)(de,N);var ae=Ut(de);function de(Te,ue,xe){var pt;return(0,Mt.Z)(this,de),pt=ae.call(this,Te),(0,jt.Z)((0,Ot.Z)(pt),"status",void 0),(0,jt.Z)((0,Ot.Z)(pt),"url",void 0),pt.status=ue,pt.url=xe,pt.name=pt.constructor.name,pt.message=Te,pt}return(0,Ve.Z)(de,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),de}(gt(Error));function _n(N){var ae=new XMLHttpRequest;ae.open("GET",N.url,!0);for(var de in N.headers)N.headers.hasOwnProperty(de)&&ae.setRequestHeader(de,N.headers[de]);return ae.withCredentials=N.credentials==="include",ae}var Qi=function(ae,de){var Te=_n(ae);return Te.setRequestHeader("Accept","application/json"),Te.onerror=function(){de(new Error(Te.statusText))},Te.onload=function(){if(Te.status>=200&&Te.status<300&&Te.response){var ue;try{ue=JSON.parse(Te.response)}catch(xe){return de(xe)}de(null,ue)}else Te.status===401?de(new dn("".concat(Te.statusText),Te.status,ae.url)):de(new dn(Te.statusText,Te.status,ae.url))},Te.send(),Te},ur=function(ae,de){var Te=_n(ae);return Te.responseType="arraybuffer",Te.onerror=function(){de(new Error(Te.statusText))},Te.onload=function(){var ue=Te.response;if(ue.byteLength===0&&Te.status===200)return de(new Error("http status 200 returned without content."));Te.status>=200&&Te.status<300&&Te.response?de(null,{data:ue,cacheControl:Te.getResponseHeader("Cache-Control"),expires:Te.getResponseHeader("Expires")}):de(new dn(Te.statusText,Te.status,ae.url))},Te.send(),Te};function ge(N){var ae=window.document.createElement("a");return ae.href=N,ae.protocol===window.document.location.protocol&&ae.host===window.document.location.host}var Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ge=function(ae,de){return ur(ae,function(Te,ue){if(Te)de(Te);else if(ue){var xe=new window.Image;xe.crossOrigin="anonymous";var pt=window.URL||window.webkitURL;xe.onload=function(){de(null,xe),pt.revokeObjectURL(xe.src)};var Cr=new window.Blob([new Uint8Array(ue.data)],{type:"image/png"});xe.src=ue.data.byteLength?pt.createObjectURL(Cr):Pe}})},Re=y(40271),Nt=2*Math.PI*6378137/2;function ar(N){var ae=[Infinity,Infinity,-Infinity,-Infinity];return N.forEach(function(de){var Te=de.coordinates;yr(ae,Te)}),ae}function yr(N,ae){return Array.isArray(ae[0])?ae.forEach(function(de){yr(N,de)}):(N[0]>ae[0]&&(N[0]=ae[0]),N[1]>ae[1]&&(N[1]=ae[1]),N[2]<ae[0]&&(N[2]=ae[0]),N[3]<ae[1]&&(N[3]=ae[1])),N}function Lr(N,ae){return fr(N,ae)}function fr(N,ae){return Array.isArray(N[0])?N.map(function(de){return fr(de,ae)}):ae(N)}function Fr(N){var ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};N=tt(N,ae);var Te=N[0],ue=N[1],xe=Te*Nt/180,pt=Math.log(Math.tan((90+ue)*Math.PI/360))/(Math.PI/180);return pt=pt*Nt/180,de.enable&&(xe=Number(xe.toFixed(de.decimal)),pt=Number(pt.toFixed(de.decimal))),N.length===3?[xe,pt,N[2]]:[xe,pt]}function C(N){var ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,de=N[0],Te=N[1],ue=de/Nt*180,xe=Te/Nt*180;return xe=180/Math.PI*(2*Math.atan(Math.exp(xe*Math.PI/180))-Math.PI/2),ae!=null&&(ue=Number(ue.toFixed(ae)),xe=Number(xe.toFixed(ae))),N.length===3?[ue,xe,N[2]]:[ue,xe]}function G(N){if(N==null)throw new Error("lng is required");return(N>180||N<-180)&&(N=N%360,N>180&&(N=-360+N),N<-180&&(N=360+N),N===0&&(N=0)),N}function Ze(N){if(N==null)throw new Error("lat is required");return(N>90||N<-90)&&(N=N%180,N>90&&(N=-180+N),N<-90&&(N=180+N),N===0&&(N=0)),N}function tt(N,ae){if(ae===!1)return N;var de=G(N[0]),Te=Ze(N[1]);return Te>85&&(Te=85),Te<-85&&(Te=-85),N.length===3?[de,Te,N[2]]:[de,Te]}function lt(N){var ae=85.0511287798,de=Math.max(Math.min(ae,N[1]),-ae),Te=256<<20,ue=Math.PI/180,xe=N[0]*ue,pt=de*ue;pt=Math.log(Math.tan(Math.PI/4+pt/2));var Cr=.5/Math.PI,Kt=.5,rr=-.5/Math.PI;return ue=.5,xe=Te*(Cr*xe+Kt),pt=Te*(rr*pt+ue),[Math.floor(xe),Math.floor(pt)]}function Pt(N){var ae=.5/Math.PI,de=.5,Te=-.5/Math.PI,ue=.5,xe=256<<20,pt=_slicedToArray(N,2),Cr=pt[0],Kt=pt[1];Cr=(Cr/xe-de)/ae,Kt=(Kt/xe-ue)/Te,Kt=(Math.atan(Math.pow(Math.E,Kt))-Math.PI/4)*2,ue=Math.PI/180;var rr=Kt/ue,Zr=Cr/ue;return[Zr,rr]}function q(N,ae,de){var Te=(0,Re.Ht)(ae[1]-N[1]),ue=(0,Re.Ht)(ae[0]-N[0]),xe=(0,Re.Ht)(N[1]),pt=(0,Re.Ht)(ae[1]),Cr=Math.pow(Math.sin(Te/2),2)+Math.pow(Math.sin(ue/2),2)*Math.cos(xe)*Math.cos(pt);return(0,Re.DL)(2*Math.atan2(Math.sqrt(Cr),Math.sqrt(1-Cr)),de="meters")}function kt(N){var ae=Math.PI/180,de=85.0511287798,Te=6378137,ue=Math.max(Math.min(de,N[1]),-de),xe=Math.sin(ue*ae),pt=Te*N[0]*ae,Cr=Te*Math.log((1+xe)/(1-xe))/2;return[pt,Cr]}function Er(N,ae){var de=Math.abs(N[1][1]-N[0][1])*ae,Te=Math.abs(N[1][0]-N[0][0])*ae;return[[N[0][0]-Te,N[0][1]-de],[N[1][0]+Te,N[1][1]+de]]}function Mr(N,ae){return N[0][0]<=ae[0][0]&&N[0][1]<=ae[0][1]&&N[1][0]>=ae[1][0]&&N[1][1]>=ae[1][1]}function Je(N){return[[N[0],N[1]],[N[2],N[3]]]}var ct=function(){function N(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,de=arguments.length>1?arguments[1]:void 0;(0,Mt.Z)(this,N),(0,jt.Z)(this,"limit",void 0),(0,jt.Z)(this,"cache",void 0),(0,jt.Z)(this,"destroy",void 0),(0,jt.Z)(this,"order",void 0),this.limit=ae,this.destroy=de||this.defaultDestroy,this.order=[],this.clear()}return(0,Ve.Z)(N,[{key:"clear",value:function(){var de=this;this.order.forEach(function(Te){de.delete(Te)}),this.cache={},this.order=[]}},{key:"get",value:function(de){var Te=this.cache[de];return Te&&(this.deleteOrder(de),this.appendOrder(de)),Te}},{key:"set",value:function(de,Te){this.cache[de]?(this.delete(de),this.cache[de]=Te,this.appendOrder(de)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[de]=Te,this.appendOrder(de))}},{key:"delete",value:function(de){var Te=this.cache[de];Te&&(this.deleteCache(de),this.deleteOrder(de),this.destroy(Te,de))}},{key:"deleteCache",value:function(de){delete this.cache[de]}},{key:"deleteOrder",value:function(de){var Te=this.order.findIndex(function(ue){return ue===de});Te>=0&&this.order.splice(Te,1)}},{key:"appendOrder",value:function(de){this.order.push(de)}},{key:"defaultDestroy",value:function(de,Te){return null}}]),N}();function It(N,ae){N.forEach(function(de){!ae[de]||(ae[de]=ae[de].bind(ae))})}var Bt=y(2650);function br(N){var ae=Bt.ZP(N),de=[0,0,0,0];return ae!=null&&(de[0]=ae.r/255,de[1]=ae.g/255,de[2]=ae.b/255,de[3]=ae.opacity),de}function Tr(N){var ae=N&&N[0],de=N&&N[1],Te=N&&N[2],ue=ae+de*256+Te*65536-1;return ue}function qe(N){return[N+1&255,N+1>>8&255,N+1>>8>>8&255]}function Gr(N){var ae=document.createElement("canvas"),de=ae.getContext("2d");ae.width=256,ae.height=1;for(var Te=de.createLinearGradient(0,0,256,1),ue=null,xe=N.positions[0],pt=N.positions[N.positions.length-1],Cr=0;Cr<N.colors.length;++Cr){var Kt=(N.positions[Cr]-xe)/(pt-xe);Te.addColorStop(Kt,N.colors[Cr])}return de.fillStyle=Te,de.fillRect(0,0,256,1),ue=new Uint8ClampedArray(de.getImageData(0,0,256,1).data),new ImageData(ue,256,1)}var Yr;(function(N){N.CENTER="center",N.TOP="top",N["TOP-LEFT"]="top-left",N["TOP-RIGHT"]="top-right",N.BOTTOM="bottom",N["BOTTOM-LEFT"]="bottom-left",N.LEFT="left",N.RIGHT="right"})(Yr||(Yr={}));var An={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vr(N,ae,de){var Te=N.classList;for(var ue in An)An.hasOwnProperty(ue)&&Te.remove("l7-".concat(de,"-anchor-").concat(ue));Te.add("l7-".concat(de,"-anchor-").concat(ae))}function Or(N){if(N.length===0)throw new Error("max requires at least one data point");for(var ae=N[0],de=1;de<N.length;de++)N[de]>ae&&(ae=N[de]);return ae*1}function St(N){if(N.length===0)throw new Error("min requires at least one data point");for(var ae=N[0],de=1;de<N.length;de++)N[de]<ae&&(ae=N[de]);return ae*1}function Kn(N){if(N.length===0)return 0;for(var ae=N[0]*1,de=1;de<N.length;de++)ae+=N[de]*1;return ae}function Ln(N){if(N.length===0)throw new Error("mean requires at least one data point");return Kn(N)/N.length}function Ur(N){if(N.length===0)throw new Error("mean requires at least one data point");if(N.length<3)return N[0];N.sort();for(var ae=N[0],de=NaN,Te=0,ue=1,xe=1;xe<N.length+1;xe++)N[xe]!==ae?(ue>Te&&(Te=ue,de=ae),ue=1,ae=N[xe]):ue++;return de*1}var ee={min:St,max:Or,mean:Ln,sum:Kn,mode:Ur};function fe(N,ae){return N.map(function(de){return de[ae]})}function me(N,ae){return ee[N](ae)}},3473:function(Qe,O,y){"use strict";y.d(O,{Z:function(){return z}});function z(b,p,X,U,Y){var $={};return Object.keys(U).forEach(function(he){$[he]=U[he]}),$.enumerable=!!$.enumerable,$.configurable=!!$.configurable,("value"in $||$.initializer)&&($.writable=!0),$=X.slice().reverse().reduce(function(he,Z){return Z(b,p,he)||he},$),Y&&$.initializer!==void 0&&($.value=$.initializer?$.initializer.call(Y):void 0,$.initializer=void 0),$.initializer===void 0&&(Object.defineProperty(b,p,$),$=null),$}},66213:function(Qe,O,y){"use strict";y.d(O,{Z:function(){return p}});var z=y(77608);function b(X,U){for(;!Object.prototype.hasOwnProperty.call(X,U)&&(X=(0,z.Z)(X),X!==null););return X}function p(X,U,Y){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(he,Z,Ie){var Le=b(he,Z);if(!!Le){var rt=Object.getOwnPropertyDescriptor(Le,Z);return rt.get?rt.get.call(Ie):rt.value}},p(X,U,Y||X)}},55770:function(Qe,O,y){"use strict";y.d(O,{Z:function(){return z}});function z(b,p,X,U){!X||Object.defineProperty(b,p,{enumerable:X.enumerable,configurable:X.configurable,writable:X.writable,value:X.initializer?X.initializer.call(U):void 0})}},31795:function(Qe,O,y){var z=y(75752);Qe.exports.geometry=b,Qe.exports.ring=X;function b(Y){var $=0,he;switch(Y.type){case"Polygon":return p(Y.coordinates);case"MultiPolygon":for(he=0;he<Y.coordinates.length;he++)$+=p(Y.coordinates[he]);return $;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(he=0;he<Y.geometries.length;he++)$+=b(Y.geometries[he]);return $}}function p(Y){var $=0;if(Y&&Y.length>0){$+=Math.abs(X(Y[0]));for(var he=1;he<Y.length;he++)$-=Math.abs(X(Y[he]))}return $}function X(Y){var $,he,Z,Ie,Le,rt,$t,zt=0,Lt=Y.length;if(Lt>2){for($t=0;$t<Lt;$t++)$t===Lt-2?(Ie=Lt-2,Le=Lt-1,rt=0):$t===Lt-1?(Ie=Lt-1,Le=0,rt=1):(Ie=$t,Le=$t+1,rt=$t+2),$=Y[Ie],he=Y[Le],Z=Y[rt],zt+=(U(Z[0])-U($[0]))*Math.sin(U(he[1]));zt=zt*z.RADIUS*z.RADIUS/2}return zt}function U(Y){return Y*Math.PI/180}},49296:function(Qe){"use strict";Qe.exports=y,Qe.exports.default=y;var O=1e20;function y(U,Y,$,he,Z,Ie){this.fontSize=U||24,this.buffer=Y===void 0?3:Y,this.cutoff=he||.25,this.fontFamily=Z||"sans-serif",this.fontWeight=Ie||"normal",this.radius=$||8;var Le=this.size=this.fontSize+this.buffer*2,rt=Le+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Le,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(rt*rt),this.gridInner=new Float64Array(rt*rt),this.f=new Float64Array(rt),this.z=new Float64Array(rt+1),this.v=new Uint16Array(rt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Le/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function z(U,Y,$,he,Z,Ie,Le){Ie.fill(O,0,Y*$),Le.fill(0,0,Y*$);for(var rt=(Y-he)/2,$t=0;$t<Z;$t++)for(var zt=0;zt<he;zt++){var Lt=($t+rt)*Y+zt+rt,Ht=U.data[4*($t*he+zt)+3]/255;if(Ht===1)Ie[Lt]=0,Le[Lt]=O;else if(Ht===0)Ie[Lt]=O,Le[Lt]=0;else{var Ct=Math.max(0,.5-Ht),yt=Math.max(0,Ht-.5);Ie[Lt]=Ct*Ct,Le[Lt]=yt*yt}}}function b(U,Y,$,he,Z,Ie,Le){for(var rt=0;rt<Y*$;rt++){var $t=Math.sqrt(he[rt])-Math.sqrt(Z[rt]);U[rt]=Math.round(255-255*($t/Ie+Le))}}y.prototype._draw=function(U,Y){var $=this.ctx.measureText(U),he=$.width,Z=2*this.buffer,Ie,Le,rt,$t,zt,Lt,Ht,Ct;Y&&this.useMetrics?(zt=Math.floor($.actualBoundingBoxAscent),Ct=this.buffer+Math.ceil($.actualBoundingBoxAscent),Lt=this.buffer,Ht=this.buffer,Le=Math.min(this.size,Math.ceil($.actualBoundingBoxRight-$.actualBoundingBoxLeft)),$t=Math.min(this.size-Lt,Math.ceil($.actualBoundingBoxAscent+$.actualBoundingBoxDescent)),Ie=Le+Z,rt=$t+Z,this.ctx.textBaseline="alphabetic"):(Ie=Le=this.size,rt=$t=this.size,zt=19*this.fontSize/24,Lt=Ht=0,Ct=this.middle,this.ctx.textBaseline="middle");var yt;Le&&$t&&(this.ctx.clearRect(Ht,Lt,Le,$t),this.ctx.fillText(U,this.buffer,Ct),yt=this.ctx.getImageData(Ht,Lt,Le,$t));var ft=new Uint8ClampedArray(Ie*rt);return z(yt,Ie,rt,Le,$t,this.gridOuter,this.gridInner),p(this.gridOuter,Ie,rt,this.f,this.v,this.z),p(this.gridInner,Ie,rt,this.f,this.v,this.z),b(ft,Ie,rt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:ft,metrics:{width:Le,height:$t,sdfWidth:Ie,sdfHeight:rt,top:zt,left:0,advance:he}}},y.prototype.draw=function(U){return this._draw(U,!1).data},y.prototype.drawWithMetrics=function(U){return this._draw(U,!0)};function p(U,Y,$,he,Z,Ie){for(var Le=0;Le<Y;Le++)X(U,Le,Y,$,he,Z,Ie);for(var rt=0;rt<$;rt++)X(U,rt*Y,1,Y,he,Z,Ie)}function X(U,Y,$,he,Z,Ie,Le){var rt,$t,zt,Lt;for(Ie[0]=0,Le[0]=-O,Le[1]=O,rt=0;rt<he;rt++)Z[rt]=U[Y+rt*$];for(rt=1,$t=0,zt=0;rt<he;rt++){do Lt=Ie[$t],zt=(Z[rt]-Z[Lt]+rt*rt-Lt*Lt)/(rt-Lt)/2;while(zt<=Le[$t]&&--$t>-1);$t++,Ie[$t]=rt,Le[$t]=zt,Le[$t+1]=O}for(rt=0,$t=0;rt<he;rt++){for(;Le[$t+1]<rt;)$t++;Lt=Ie[$t],U[Y+rt*$]=Z[Lt]+(rt-Lt)*(rt-Lt)}}},40271:function(Qe,O,y){"use strict";y.d(O,{zL:function(){return U},DL:function(){return ft},Ht:function(){return $e}});var z=63710088e-1,b={centimeters:z*100,centimetres:z*100,degrees:z/111325,feet:z*3.28084,inches:z*39.37,kilometers:z/1e3,kilometres:z/1e3,meters:z,metres:z,miles:z/1609.344,millimeters:z*1e3,millimetres:z*1e3,nauticalmiles:z/1852,radians:1,yards:z*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/z,yards:1.0936133},X={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function U(se,ke,_e){_e===void 0&&(_e={});var Et={type:"Feature"};return(_e.id===0||_e.id)&&(Et.id=_e.id),_e.bbox&&(Et.bbox=_e.bbox),Et.properties=ke||{},Et.geometry=se,Et}function Y(se,ke,_e){switch(_e===void 0&&(_e={}),se){case"Point":return $(ke).geometry;case"LineString":return Le(ke).geometry;case"Polygon":return Z(ke).geometry;case"MultiPoint":return Lt(ke).geometry;case"MultiLineString":return zt(ke).geometry;case"MultiPolygon":return Ht(ke).geometry;default:throw new Error(se+" is invalid")}}function $(se,ke,_e){if(_e===void 0&&(_e={}),!se)throw new Error("coordinates is required");if(!Array.isArray(se))throw new Error("coordinates must be an Array");if(se.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ot(se[0])||!Ot(se[1]))throw new Error("coordinates must contain numbers");var Et={type:"Point",coordinates:se};return U(Et,ke,_e)}function he(se,ke,_e){return _e===void 0&&(_e={}),$t(se.map(function(Et){return $(Et,ke)}),_e)}function Z(se,ke,_e){_e===void 0&&(_e={});for(var Et=0,gt=se;Et<gt.length;Et++){var jt=gt[Et];if(jt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Ut=0;Ut<jt[jt.length-1].length;Ut++)if(jt[jt.length-1][Ut]!==jt[0][Ut])throw new Error("First and last Position are not equivalent.")}var zr={type:"Polygon",coordinates:se};return U(zr,ke,_e)}function Ie(se,ke,_e){return _e===void 0&&(_e={}),$t(se.map(function(Et){return Z(Et,ke)}),_e)}function Le(se,ke,_e){if(_e===void 0&&(_e={}),se.length<2)throw new Error("coordinates must be an array of two or more positions");var Et={type:"LineString",coordinates:se};return U(Et,ke,_e)}function rt(se,ke,_e){return _e===void 0&&(_e={}),$t(se.map(function(Et){return Le(Et,ke)}),_e)}function $t(se,ke){ke===void 0&&(ke={});var _e={type:"FeatureCollection"};return ke.id&&(_e.id=ke.id),ke.bbox&&(_e.bbox=ke.bbox),_e.features=se,_e}function zt(se,ke,_e){_e===void 0&&(_e={});var Et={type:"MultiLineString",coordinates:se};return U(Et,ke,_e)}function Lt(se,ke,_e){_e===void 0&&(_e={});var Et={type:"MultiPoint",coordinates:se};return U(Et,ke,_e)}function Ht(se,ke,_e){_e===void 0&&(_e={});var Et={type:"MultiPolygon",coordinates:se};return U(Et,ke,_e)}function Ct(se,ke,_e){_e===void 0&&(_e={});var Et={type:"GeometryCollection",geometries:se};return U(Et,ke,_e)}function yt(se,ke){if(ke===void 0&&(ke=0),ke&&!(ke>=0))throw new Error("precision must be a positive number");var _e=Math.pow(10,ke||0);return Math.round(se*_e)/_e}function ft(se,ke){ke===void 0&&(ke="kilometers");var _e=b[ke];if(!_e)throw new Error(ke+" units is invalid");return se*_e}function sr(se,ke){ke===void 0&&(ke="kilometers");var _e=b[ke];if(!_e)throw new Error(ke+" units is invalid");return se/_e}function re(se,ke){return Tt(sr(se,ke))}function nr(se){var ke=se%360;return ke<0&&(ke+=360),ke}function Tt(se){var ke=se%(2*Math.PI);return ke*180/Math.PI}function $e(se){var ke=se%360;return ke*Math.PI/180}function Mt(se,ke,_e){if(ke===void 0&&(ke="kilometers"),_e===void 0&&(_e="kilometers"),!(se>=0))throw new Error("length must be a positive number");return ft(sr(se,ke),_e)}function Ve(se,ke,_e){if(ke===void 0&&(ke="meters"),_e===void 0&&(_e="kilometers"),!(se>=0))throw new Error("area must be a positive number");var Et=X[ke];if(!Et)throw new Error("invalid original units");var gt=X[_e];if(!gt)throw new Error("invalid final units");return se/Et*gt}function Ot(se){return!isNaN(se)&&se!==null&&!Array.isArray(se)}function pr(se){return!!se&&se.constructor===Object}function qt(se){if(!se)throw new Error("bbox is required");if(!Array.isArray(se))throw new Error("bbox must be an Array");if(se.length!==4&&se.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");se.forEach(function(ke){if(!Ot(ke))throw new Error("bbox must only contain numbers")})}function W(se){if(!se)throw new Error("id is required");if(["string","number"].indexOf(typeof se)===-1)throw new Error("id must be a number or a string")}},53645:function(Qe){Qe.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(Qe){"use strict";Qe.exports=O,Qe.exports.default=O;function O(se,ke,_e){_e=_e||2;var Et=ke&&ke.length,gt=Et?ke[0]*_e:se.length,jt=y(se,0,gt,_e,!0),Ut=[];if(!jt||jt.next===jt.prev)return Ut;var zr,dn,_n,Qi,ur,ge,Pe;if(Et&&(jt=$(se,ke,jt,_e)),se.length>80*_e){zr=_n=se[0],dn=Qi=se[1];for(var Ge=_e;Ge<gt;Ge+=_e)ur=se[Ge],ge=se[Ge+1],ur<zr&&(zr=ur),ge<dn&&(dn=ge),ur>_n&&(_n=ur),ge>Qi&&(Qi=ge);Pe=Math.max(_n-zr,Qi-dn),Pe=Pe!==0?1/Pe:0}return b(jt,Ut,_e,zr,dn,Pe),Ut}function y(se,ke,_e,Et,gt){var jt,Ut;if(gt===W(se,ke,_e,Et)>0)for(jt=ke;jt<_e;jt+=Et)Ut=Ot(jt,se[jt],se[jt+1],Ut);else for(jt=_e-Et;jt>=ke;jt-=Et)Ut=Ot(jt,se[jt],se[jt+1],Ut);return Ut&&ft(Ut,Ut.next)&&(pr(Ut),Ut=Ut.next),Ut}function z(se,ke){if(!se)return se;ke||(ke=se);var _e=se,Et;do if(Et=!1,!_e.steiner&&(ft(_e,_e.next)||yt(_e.prev,_e,_e.next)===0)){if(pr(_e),_e=ke=_e.prev,_e===_e.next)break;Et=!0}else _e=_e.next;while(Et||_e!==ke);return ke}function b(se,ke,_e,Et,gt,jt,Ut){if(!!se){!Ut&&jt&&rt(se,Et,gt,jt);for(var zr=se,dn,_n;se.prev!==se.next;){if(dn=se.prev,_n=se.next,jt?X(se,Et,gt,jt):p(se)){ke.push(dn.i/_e),ke.push(se.i/_e),ke.push(_n.i/_e),pr(se),se=_n.next,zr=_n.next;continue}if(se=_n,se===zr){Ut?Ut===1?(se=U(z(se),ke,_e),b(se,ke,_e,Et,gt,jt,2)):Ut===2&&Y(se,ke,_e,Et,gt,jt):b(z(se),ke,_e,Et,gt,jt,1);break}}}}function p(se){var ke=se.prev,_e=se,Et=se.next;if(yt(ke,_e,Et)>=0)return!1;for(var gt=se.next.next;gt!==se.prev;){if(Ht(ke.x,ke.y,_e.x,_e.y,Et.x,Et.y,gt.x,gt.y)&&yt(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function X(se,ke,_e,Et){var gt=se.prev,jt=se,Ut=se.next;if(yt(gt,jt,Ut)>=0)return!1;for(var zr=gt.x<jt.x?gt.x<Ut.x?gt.x:Ut.x:jt.x<Ut.x?jt.x:Ut.x,dn=gt.y<jt.y?gt.y<Ut.y?gt.y:Ut.y:jt.y<Ut.y?jt.y:Ut.y,_n=gt.x>jt.x?gt.x>Ut.x?gt.x:Ut.x:jt.x>Ut.x?jt.x:Ut.x,Qi=gt.y>jt.y?gt.y>Ut.y?gt.y:Ut.y:jt.y>Ut.y?jt.y:Ut.y,ur=zt(zr,dn,ke,_e,Et),ge=zt(_n,Qi,ke,_e,Et),Pe=se.prevZ,Ge=se.nextZ;Pe&&Pe.z>=ur&&Ge&&Ge.z<=ge;){if(Pe!==se.prev&&Pe!==se.next&&Ht(gt.x,gt.y,jt.x,jt.y,Ut.x,Ut.y,Pe.x,Pe.y)&&yt(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ge!==se.prev&&Ge!==se.next&&Ht(gt.x,gt.y,jt.x,jt.y,Ut.x,Ut.y,Ge.x,Ge.y)&&yt(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Pe&&Pe.z>=ur;){if(Pe!==se.prev&&Pe!==se.next&&Ht(gt.x,gt.y,jt.x,jt.y,Ut.x,Ut.y,Pe.x,Pe.y)&&yt(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ge&&Ge.z<=ge;){if(Ge!==se.prev&&Ge!==se.next&&Ht(gt.x,gt.y,jt.x,jt.y,Ut.x,Ut.y,Ge.x,Ge.y)&&yt(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0}function U(se,ke,_e){var Et=se;do{var gt=Et.prev,jt=Et.next.next;!ft(gt,jt)&&sr(gt,Et,Et.next,jt)&&$e(gt,jt)&&$e(jt,gt)&&(ke.push(gt.i/_e),ke.push(Et.i/_e),ke.push(jt.i/_e),pr(Et),pr(Et.next),Et=se=jt),Et=Et.next}while(Et!==se);return z(Et)}function Y(se,ke,_e,Et,gt,jt){var Ut=se;do{for(var zr=Ut.next.next;zr!==Ut.prev;){if(Ut.i!==zr.i&&Ct(Ut,zr)){var dn=Ve(Ut,zr);Ut=z(Ut,Ut.next),dn=z(dn,dn.next),b(Ut,ke,_e,Et,gt,jt),b(dn,ke,_e,Et,gt,jt);return}zr=zr.next}Ut=Ut.next}while(Ut!==se)}function $(se,ke,_e,Et){var gt=[],jt,Ut,zr,dn,_n;for(jt=0,Ut=ke.length;jt<Ut;jt++)zr=ke[jt]*Et,dn=jt<Ut-1?ke[jt+1]*Et:se.length,_n=y(se,zr,dn,Et,!1),_n===_n.next&&(_n.steiner=!0),gt.push(Lt(_n));for(gt.sort(he),jt=0;jt<gt.length;jt++)_e=Z(gt[jt],_e),_e=z(_e,_e.next);return _e}function he(se,ke){return se.x-ke.x}function Z(se,ke){var _e=Ie(se,ke);if(!_e)return ke;var Et=Ve(_e,se),gt=z(_e,_e.next);return z(Et,Et.next),ke===_e?gt:ke}function Ie(se,ke){var _e=ke,Et=se.x,gt=se.y,jt=-Infinity,Ut;do{if(gt<=_e.y&&gt>=_e.next.y&&_e.next.y!==_e.y){var zr=_e.x+(gt-_e.y)*(_e.next.x-_e.x)/(_e.next.y-_e.y);if(zr<=Et&&zr>jt){if(jt=zr,zr===Et){if(gt===_e.y)return _e;if(gt===_e.next.y)return _e.next}Ut=_e.x<_e.next.x?_e:_e.next}}_e=_e.next}while(_e!==ke);if(!Ut)return null;if(Et===jt)return Ut;var dn=Ut,_n=Ut.x,Qi=Ut.y,ur=Infinity,ge;_e=Ut;do Et>=_e.x&&_e.x>=_n&&Et!==_e.x&&Ht(gt<Qi?Et:jt,gt,_n,Qi,gt<Qi?jt:Et,gt,_e.x,_e.y)&&(ge=Math.abs(gt-_e.y)/(Et-_e.x),$e(_e,se)&&(ge<ur||ge===ur&&(_e.x>Ut.x||_e.x===Ut.x&&Le(Ut,_e)))&&(Ut=_e,ur=ge)),_e=_e.next;while(_e!==dn);return Ut}function Le(se,ke){return yt(se.prev,se,ke.prev)<0&&yt(ke.next,se,se.next)<0}function rt(se,ke,_e,Et){var gt=se;do gt.z===null&&(gt.z=zt(gt.x,gt.y,ke,_e,Et)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==se);gt.prevZ.nextZ=null,gt.prevZ=null,$t(gt)}function $t(se){var ke,_e,Et,gt,jt,Ut,zr,dn,_n=1;do{for(_e=se,se=null,jt=null,Ut=0;_e;){for(Ut++,Et=_e,zr=0,ke=0;ke<_n&&(zr++,Et=Et.nextZ,!!Et);ke++);for(dn=_n;zr>0||dn>0&&Et;)zr!==0&&(dn===0||!Et||_e.z<=Et.z)?(gt=_e,_e=_e.nextZ,zr--):(gt=Et,Et=Et.nextZ,dn--),jt?jt.nextZ=gt:se=gt,gt.prevZ=jt,jt=gt;_e=Et}jt.nextZ=null,_n*=2}while(Ut>1);return se}function zt(se,ke,_e,Et,gt){return se=32767*(se-_e)*gt,ke=32767*(ke-Et)*gt,se=(se|se<<8)&16711935,se=(se|se<<4)&252645135,se=(se|se<<2)&858993459,se=(se|se<<1)&1431655765,ke=(ke|ke<<8)&16711935,ke=(ke|ke<<4)&252645135,ke=(ke|ke<<2)&858993459,ke=(ke|ke<<1)&1431655765,se|ke<<1}function Lt(se){var ke=se,_e=se;do(ke.x<_e.x||ke.x===_e.x&&ke.y<_e.y)&&(_e=ke),ke=ke.next;while(ke!==se);return _e}function Ht(se,ke,_e,Et,gt,jt,Ut,zr){return(gt-Ut)*(ke-zr)-(se-Ut)*(jt-zr)>=0&&(se-Ut)*(Et-zr)-(_e-Ut)*(ke-zr)>=0&&(_e-Ut)*(jt-zr)-(gt-Ut)*(Et-zr)>=0}function Ct(se,ke){return se.next.i!==ke.i&&se.prev.i!==ke.i&&!Tt(se,ke)&&($e(se,ke)&&$e(ke,se)&&Mt(se,ke)&&(yt(se.prev,se,ke.prev)||yt(se,ke.prev,ke))||ft(se,ke)&&yt(se.prev,se,se.next)>0&&yt(ke.prev,ke,ke.next)>0)}function yt(se,ke,_e){return(ke.y-se.y)*(_e.x-ke.x)-(ke.x-se.x)*(_e.y-ke.y)}function ft(se,ke){return se.x===ke.x&&se.y===ke.y}function sr(se,ke,_e,Et){var gt=nr(yt(se,ke,_e)),jt=nr(yt(se,ke,Et)),Ut=nr(yt(_e,Et,se)),zr=nr(yt(_e,Et,ke));return!!(gt!==jt&&Ut!==zr||gt===0&&re(se,_e,ke)||jt===0&&re(se,Et,ke)||Ut===0&&re(_e,se,Et)||zr===0&&re(_e,ke,Et))}function re(se,ke,_e){return ke.x<=Math.max(se.x,_e.x)&&ke.x>=Math.min(se.x,_e.x)&&ke.y<=Math.max(se.y,_e.y)&&ke.y>=Math.min(se.y,_e.y)}function nr(se){return se>0?1:se<0?-1:0}function Tt(se,ke){var _e=se;do{if(_e.i!==se.i&&_e.next.i!==se.i&&_e.i!==ke.i&&_e.next.i!==ke.i&&sr(_e,_e.next,se,ke))return!0;_e=_e.next}while(_e!==se);return!1}function $e(se,ke){return yt(se.prev,se,se.next)<0?yt(se,ke,se.next)>=0&&yt(se,se.prev,ke)>=0:yt(se,ke,se.prev)<0||yt(se,se.next,ke)<0}function Mt(se,ke){var _e=se,Et=!1,gt=(se.x+ke.x)/2,jt=(se.y+ke.y)/2;do _e.y>jt!=_e.next.y>jt&&_e.next.y!==_e.y&&gt<(_e.next.x-_e.x)*(jt-_e.y)/(_e.next.y-_e.y)+_e.x&&(Et=!Et),_e=_e.next;while(_e!==se);return Et}function Ve(se,ke){var _e=new qt(se.i,se.x,se.y),Et=new qt(ke.i,ke.x,ke.y),gt=se.next,jt=ke.prev;return se.next=ke,ke.prev=se,_e.next=gt,gt.prev=_e,Et.next=_e,_e.prev=Et,jt.next=Et,Et.prev=jt,Et}function Ot(se,ke,_e,Et){var gt=new qt(se,ke,_e);return Et?(gt.next=Et.next,gt.prev=Et,Et.next.prev=gt,Et.next=gt):(gt.prev=gt,gt.next=gt),gt}function pr(se){se.next.prev=se.prev,se.prev.next=se.next,se.prevZ&&(se.prevZ.nextZ=se.nextZ),se.nextZ&&(se.nextZ.prevZ=se.prevZ)}function qt(se,ke,_e){this.i=se,this.x=ke,this.y=_e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}O.deviation=function(se,ke,_e,Et){var gt=ke&&ke.length,jt=gt?ke[0]*_e:se.length,Ut=Math.abs(W(se,0,jt,_e));if(gt)for(var zr=0,dn=ke.length;zr<dn;zr++){var _n=ke[zr]*_e,Qi=zr<dn-1?ke[zr+1]*_e:se.length;Ut-=Math.abs(W(se,_n,Qi,_e))}var ur=0;for(zr=0;zr<Et.length;zr+=3){var ge=Et[zr]*_e,Pe=Et[zr+1]*_e,Ge=Et[zr+2]*_e;ur+=Math.abs((se[ge]-se[Ge])*(se[Pe+1]-se[ge+1])-(se[ge]-se[Pe])*(se[Ge+1]-se[ge+1]))}return Ut===0&&ur===0?0:Math.abs((ur-Ut)/Ut)};function W(se,ke,_e,Et){for(var gt=0,jt=ke,Ut=_e-Et;jt<_e;jt+=Et)gt+=(se[Ut]-se[jt])*(se[jt+1]+se[Ut+1]),Ut=jt;return gt}O.flatten=function(se){for(var ke=se[0][0].length,_e={vertices:[],holes:[],dimensions:ke},Et=0,gt=0;gt<se.length;gt++){for(var jt=0;jt<se[gt].length;jt++)for(var Ut=0;Ut<ke;Ut++)_e.vertices.push(se[gt][jt][Ut]);gt>0&&(Et+=se[gt-1].length,_e.holes.push(Et))}return _e}},67709:function(Qe){function O(z){var b=z.target||z.srcElement;b.__resizeRAF__&&cancelAnimationFrame(b.__resizeRAF__),b.__resizeRAF__=requestAnimationFrame(function(){var p=b.__resizeTrigger__,X=p&&p.__resizeListeners__;X&&X.forEach(function(U){U.call(p,z)})})}var y=function(b,p){var X=this,U=X.document,Y,$=U.attachEvent;typeof navigator!="undefined"&&(Y=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function he(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",O)}if(!b.__resizeListeners__)if(b.__resizeListeners__=[],$)b.__resizeTrigger__=b,b.attachEvent("onresize",O);else{getComputedStyle(b).position==="static"&&(b.style.position="relative");var Z=b.__resizeTrigger__=U.createElement("object");Z.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),Z.setAttribute("class","resize-sensor"),Z.setAttribute("tabindex","-1"),Z.setAttribute("title",""),Z.__resizeElement__=b,Z.onload=he,Z.type="text/html",Y&&b.appendChild(Z),Z.data="about:blank",Y||b.appendChild(Z)}b.__resizeListeners__.push(p)};Qe.exports=typeof window=="undefined"?y:y.bind(window),Qe.exports.unbind=function(z,b){var p=document.attachEvent,X=z.__resizeListeners__||[];if(b){var U=X.indexOf(b);U!==-1&&X.splice(U,1)}else X=z.__resizeListeners__=[];if(!X.length){if(p)z.detachEvent("onresize",O);else if(z.__resizeTrigger__){var Y=z.__resizeTrigger__.contentDocument,$=Y&&Y.defaultView;$&&($.removeEventListener("resize",O),delete $.__resizeTrigger__),z.__resizeTrigger__=!z.removeChild(z.__resizeTrigger__)}delete z.__resizeListeners__}}},26729:function(Qe){"use strict";var O=Object.prototype.hasOwnProperty,y="~";function z(){}Object.create&&(z.prototype=Object.create(null),new z().__proto__||(y=!1));function b(Y,$,he){this.fn=Y,this.context=$,this.once=he||!1}function p(Y,$,he,Z,Ie){if(typeof he!="function")throw new TypeError("The listener must be a function");var Le=new b(he,Z||Y,Ie),rt=y?y+$:$;return Y._events[rt]?Y._events[rt].fn?Y._events[rt]=[Y._events[rt],Le]:Y._events[rt].push(Le):(Y._events[rt]=Le,Y._eventsCount++),Y}function X(Y,$){--Y._eventsCount==0?Y._events=new z:delete Y._events[$]}function U(){this._events=new z,this._eventsCount=0}U.prototype.eventNames=function(){var $=[],he,Z;if(this._eventsCount===0)return $;for(Z in he=this._events)O.call(he,Z)&&$.push(y?Z.slice(1):Z);return Object.getOwnPropertySymbols?$.concat(Object.getOwnPropertySymbols(he)):$},U.prototype.listeners=function($){var he=y?y+$:$,Z=this._events[he];if(!Z)return[];if(Z.fn)return[Z.fn];for(var Ie=0,Le=Z.length,rt=new Array(Le);Ie<Le;Ie++)rt[Ie]=Z[Ie].fn;return rt},U.prototype.listenerCount=function($){var he=y?y+$:$,Z=this._events[he];return Z?Z.fn?1:Z.length:0},U.prototype.emit=function($,he,Z,Ie,Le,rt){var $t=y?y+$:$;if(!this._events[$t])return!1;var zt=this._events[$t],Lt=arguments.length,Ht,Ct;if(zt.fn){switch(zt.once&&this.removeListener($,zt.fn,void 0,!0),Lt){case 1:return zt.fn.call(zt.context),!0;case 2:return zt.fn.call(zt.context,he),!0;case 3:return zt.fn.call(zt.context,he,Z),!0;case 4:return zt.fn.call(zt.context,he,Z,Ie),!0;case 5:return zt.fn.call(zt.context,he,Z,Ie,Le),!0;case 6:return zt.fn.call(zt.context,he,Z,Ie,Le,rt),!0}for(Ct=1,Ht=new Array(Lt-1);Ct<Lt;Ct++)Ht[Ct-1]=arguments[Ct];zt.fn.apply(zt.context,Ht)}else{var yt=zt.length,ft;for(Ct=0;Ct<yt;Ct++)switch(zt[Ct].once&&this.removeListener($,zt[Ct].fn,void 0,!0),Lt){case 1:zt[Ct].fn.call(zt[Ct].context);break;case 2:zt[Ct].fn.call(zt[Ct].context,he);break;case 3:zt[Ct].fn.call(zt[Ct].context,he,Z);break;case 4:zt[Ct].fn.call(zt[Ct].context,he,Z,Ie);break;default:if(!Ht)for(ft=1,Ht=new Array(Lt-1);ft<Lt;ft++)Ht[ft-1]=arguments[ft];zt[Ct].fn.apply(zt[Ct].context,Ht)}}return!0},U.prototype.on=function($,he,Z){return p(this,$,he,Z,!1)},U.prototype.once=function($,he,Z){return p(this,$,he,Z,!0)},U.prototype.removeListener=function($,he,Z,Ie){var Le=y?y+$:$;if(!this._events[Le])return this;if(!he)return X(this,Le),this;var rt=this._events[Le];if(rt.fn)rt.fn===he&&(!Ie||rt.once)&&(!Z||rt.context===Z)&&X(this,Le);else{for(var $t=0,zt=[],Lt=rt.length;$t<Lt;$t++)(rt[$t].fn!==he||Ie&&!rt[$t].once||Z&&rt[$t].context!==Z)&&zt.push(rt[$t]);zt.length?this._events[Le]=zt.length===1?zt[0]:zt:X(this,Le)}return this},U.prototype.removeAllListeners=function($){var he;return $?(he=y?y+$:$,this._events[he]&&X(this,he)):(this._events=new z,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=y,U.EventEmitter=U,Qe.exports=U},85975:function(Qe,O,y){"use strict";y.r(O),y.d(O,{create:function(){return b},clone:function(){return p},copy:function(){return X},fromValues:function(){return U},set:function(){return Y},identity:function(){return $},transpose:function(){return he},invert:function(){return Z},adjoint:function(){return Ie},determinant:function(){return Le},multiply:function(){return rt},translate:function(){return $t},scale:function(){return zt},rotate:function(){return Lt},rotateX:function(){return Ht},rotateY:function(){return Ct},rotateZ:function(){return yt},fromTranslation:function(){return ft},fromScaling:function(){return sr},fromRotation:function(){return re},fromXRotation:function(){return nr},fromYRotation:function(){return Tt},fromZRotation:function(){return $e},fromRotationTranslation:function(){return Mt},fromQuat2:function(){return Ve},getTranslation:function(){return Ot},getScaling:function(){return pr},getRotation:function(){return qt},fromRotationTranslationScale:function(){return W},fromRotationTranslationScaleOrigin:function(){return se},fromQuat:function(){return ke},frustum:function(){return _e},perspectiveNO:function(){return Et},perspective:function(){return gt},perspectiveZO:function(){return jt},perspectiveFromFieldOfView:function(){return Ut},orthoNO:function(){return zr},ortho:function(){return dn},orthoZO:function(){return _n},lookAt:function(){return Qi},targetTo:function(){return ur},str:function(){return ge},frob:function(){return Pe},add:function(){return Ge},subtract:function(){return Re},multiplyScalar:function(){return Nt},multiplyScalarAndAdd:function(){return ar},exactEquals:function(){return yr},equals:function(){return Lr},mul:function(){return fr},sub:function(){return Fr}});var z=y(49685);function b(){var C=new z.WT(16);return z.WT!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=0,C[12]=0,C[13]=0,C[14]=0),C[0]=1,C[5]=1,C[10]=1,C[15]=1,C}function p(C){var G=new z.WT(16);return G[0]=C[0],G[1]=C[1],G[2]=C[2],G[3]=C[3],G[4]=C[4],G[5]=C[5],G[6]=C[6],G[7]=C[7],G[8]=C[8],G[9]=C[9],G[10]=C[10],G[11]=C[11],G[12]=C[12],G[13]=C[13],G[14]=C[14],G[15]=C[15],G}function X(C,G){return C[0]=G[0],C[1]=G[1],C[2]=G[2],C[3]=G[3],C[4]=G[4],C[5]=G[5],C[6]=G[6],C[7]=G[7],C[8]=G[8],C[9]=G[9],C[10]=G[10],C[11]=G[11],C[12]=G[12],C[13]=G[13],C[14]=G[14],C[15]=G[15],C}function U(C,G,Ze,tt,lt,Pt,q,kt,Er,Mr,Je,ct,It,Bt,br,Tr){var qe=new z.WT(16);return qe[0]=C,qe[1]=G,qe[2]=Ze,qe[3]=tt,qe[4]=lt,qe[5]=Pt,qe[6]=q,qe[7]=kt,qe[8]=Er,qe[9]=Mr,qe[10]=Je,qe[11]=ct,qe[12]=It,qe[13]=Bt,qe[14]=br,qe[15]=Tr,qe}function Y(C,G,Ze,tt,lt,Pt,q,kt,Er,Mr,Je,ct,It,Bt,br,Tr,qe){return C[0]=G,C[1]=Ze,C[2]=tt,C[3]=lt,C[4]=Pt,C[5]=q,C[6]=kt,C[7]=Er,C[8]=Mr,C[9]=Je,C[10]=ct,C[11]=It,C[12]=Bt,C[13]=br,C[14]=Tr,C[15]=qe,C}function $(C){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function he(C,G){if(C===G){var Ze=G[1],tt=G[2],lt=G[3],Pt=G[6],q=G[7],kt=G[11];C[1]=G[4],C[2]=G[8],C[3]=G[12],C[4]=Ze,C[6]=G[9],C[7]=G[13],C[8]=tt,C[9]=Pt,C[11]=G[14],C[12]=lt,C[13]=q,C[14]=kt}else C[0]=G[0],C[1]=G[4],C[2]=G[8],C[3]=G[12],C[4]=G[1],C[5]=G[5],C[6]=G[9],C[7]=G[13],C[8]=G[2],C[9]=G[6],C[10]=G[10],C[11]=G[14],C[12]=G[3],C[13]=G[7],C[14]=G[11],C[15]=G[15];return C}function Z(C,G){var Ze=G[0],tt=G[1],lt=G[2],Pt=G[3],q=G[4],kt=G[5],Er=G[6],Mr=G[7],Je=G[8],ct=G[9],It=G[10],Bt=G[11],br=G[12],Tr=G[13],qe=G[14],Gr=G[15],Yr=Ze*kt-tt*q,An=Ze*Er-lt*q,vr=Ze*Mr-Pt*q,Or=tt*Er-lt*kt,St=tt*Mr-Pt*kt,Kn=lt*Mr-Pt*Er,Ln=Je*Tr-ct*br,Ur=Je*qe-It*br,ee=Je*Gr-Bt*br,fe=ct*qe-It*Tr,me=ct*Gr-Bt*Tr,N=It*Gr-Bt*qe,ae=Yr*N-An*me+vr*fe+Or*ee-St*Ur+Kn*Ln;return ae?(ae=1/ae,C[0]=(kt*N-Er*me+Mr*fe)*ae,C[1]=(lt*me-tt*N-Pt*fe)*ae,C[2]=(Tr*Kn-qe*St+Gr*Or)*ae,C[3]=(It*St-ct*Kn-Bt*Or)*ae,C[4]=(Er*ee-q*N-Mr*Ur)*ae,C[5]=(Ze*N-lt*ee+Pt*Ur)*ae,C[6]=(qe*vr-br*Kn-Gr*An)*ae,C[7]=(Je*Kn-It*vr+Bt*An)*ae,C[8]=(q*me-kt*ee+Mr*Ln)*ae,C[9]=(tt*ee-Ze*me-Pt*Ln)*ae,C[10]=(br*St-Tr*vr+Gr*Yr)*ae,C[11]=(ct*vr-Je*St-Bt*Yr)*ae,C[12]=(kt*Ur-q*fe-Er*Ln)*ae,C[13]=(Ze*fe-tt*Ur+lt*Ln)*ae,C[14]=(Tr*An-br*Or-qe*Yr)*ae,C[15]=(Je*Or-ct*An+It*Yr)*ae,C):null}function Ie(C,G){var Ze=G[0],tt=G[1],lt=G[2],Pt=G[3],q=G[4],kt=G[5],Er=G[6],Mr=G[7],Je=G[8],ct=G[9],It=G[10],Bt=G[11],br=G[12],Tr=G[13],qe=G[14],Gr=G[15];return C[0]=kt*(It*Gr-Bt*qe)-ct*(Er*Gr-Mr*qe)+Tr*(Er*Bt-Mr*It),C[1]=-(tt*(It*Gr-Bt*qe)-ct*(lt*Gr-Pt*qe)+Tr*(lt*Bt-Pt*It)),C[2]=tt*(Er*Gr-Mr*qe)-kt*(lt*Gr-Pt*qe)+Tr*(lt*Mr-Pt*Er),C[3]=-(tt*(Er*Bt-Mr*It)-kt*(lt*Bt-Pt*It)+ct*(lt*Mr-Pt*Er)),C[4]=-(q*(It*Gr-Bt*qe)-Je*(Er*Gr-Mr*qe)+br*(Er*Bt-Mr*It)),C[5]=Ze*(It*Gr-Bt*qe)-Je*(lt*Gr-Pt*qe)+br*(lt*Bt-Pt*It),C[6]=-(Ze*(Er*Gr-Mr*qe)-q*(lt*Gr-Pt*qe)+br*(lt*Mr-Pt*Er)),C[7]=Ze*(Er*Bt-Mr*It)-q*(lt*Bt-Pt*It)+Je*(lt*Mr-Pt*Er),C[8]=q*(ct*Gr-Bt*Tr)-Je*(kt*Gr-Mr*Tr)+br*(kt*Bt-Mr*ct),C[9]=-(Ze*(ct*Gr-Bt*Tr)-Je*(tt*Gr-Pt*Tr)+br*(tt*Bt-Pt*ct)),C[10]=Ze*(kt*Gr-Mr*Tr)-q*(tt*Gr-Pt*Tr)+br*(tt*Mr-Pt*kt),C[11]=-(Ze*(kt*Bt-Mr*ct)-q*(tt*Bt-Pt*ct)+Je*(tt*Mr-Pt*kt)),C[12]=-(q*(ct*qe-It*Tr)-Je*(kt*qe-Er*Tr)+br*(kt*It-Er*ct)),C[13]=Ze*(ct*qe-It*Tr)-Je*(tt*qe-lt*Tr)+br*(tt*It-lt*ct),C[14]=-(Ze*(kt*qe-Er*Tr)-q*(tt*qe-lt*Tr)+br*(tt*Er-lt*kt)),C[15]=Ze*(kt*It-Er*ct)-q*(tt*It-lt*ct)+Je*(tt*Er-lt*kt),C}function Le(C){var G=C[0],Ze=C[1],tt=C[2],lt=C[3],Pt=C[4],q=C[5],kt=C[6],Er=C[7],Mr=C[8],Je=C[9],ct=C[10],It=C[11],Bt=C[12],br=C[13],Tr=C[14],qe=C[15],Gr=G*q-Ze*Pt,Yr=G*kt-tt*Pt,An=G*Er-lt*Pt,vr=Ze*kt-tt*q,Or=Ze*Er-lt*q,St=tt*Er-lt*kt,Kn=Mr*br-Je*Bt,Ln=Mr*Tr-ct*Bt,Ur=Mr*qe-It*Bt,ee=Je*Tr-ct*br,fe=Je*qe-It*br,me=ct*qe-It*Tr;return Gr*me-Yr*fe+An*ee+vr*Ur-Or*Ln+St*Kn}function rt(C,G,Ze){var tt=G[0],lt=G[1],Pt=G[2],q=G[3],kt=G[4],Er=G[5],Mr=G[6],Je=G[7],ct=G[8],It=G[9],Bt=G[10],br=G[11],Tr=G[12],qe=G[13],Gr=G[14],Yr=G[15],An=Ze[0],vr=Ze[1],Or=Ze[2],St=Ze[3];return C[0]=An*tt+vr*kt+Or*ct+St*Tr,C[1]=An*lt+vr*Er+Or*It+St*qe,C[2]=An*Pt+vr*Mr+Or*Bt+St*Gr,C[3]=An*q+vr*Je+Or*br+St*Yr,An=Ze[4],vr=Ze[5],Or=Ze[6],St=Ze[7],C[4]=An*tt+vr*kt+Or*ct+St*Tr,C[5]=An*lt+vr*Er+Or*It+St*qe,C[6]=An*Pt+vr*Mr+Or*Bt+St*Gr,C[7]=An*q+vr*Je+Or*br+St*Yr,An=Ze[8],vr=Ze[9],Or=Ze[10],St=Ze[11],C[8]=An*tt+vr*kt+Or*ct+St*Tr,C[9]=An*lt+vr*Er+Or*It+St*qe,C[10]=An*Pt+vr*Mr+Or*Bt+St*Gr,C[11]=An*q+vr*Je+Or*br+St*Yr,An=Ze[12],vr=Ze[13],Or=Ze[14],St=Ze[15],C[12]=An*tt+vr*kt+Or*ct+St*Tr,C[13]=An*lt+vr*Er+Or*It+St*qe,C[14]=An*Pt+vr*Mr+Or*Bt+St*Gr,C[15]=An*q+vr*Je+Or*br+St*Yr,C}function $t(C,G,Ze){var tt=Ze[0],lt=Ze[1],Pt=Ze[2],q,kt,Er,Mr,Je,ct,It,Bt,br,Tr,qe,Gr;return G===C?(C[12]=G[0]*tt+G[4]*lt+G[8]*Pt+G[12],C[13]=G[1]*tt+G[5]*lt+G[9]*Pt+G[13],C[14]=G[2]*tt+G[6]*lt+G[10]*Pt+G[14],C[15]=G[3]*tt+G[7]*lt+G[11]*Pt+G[15]):(q=G[0],kt=G[1],Er=G[2],Mr=G[3],Je=G[4],ct=G[5],It=G[6],Bt=G[7],br=G[8],Tr=G[9],qe=G[10],Gr=G[11],C[0]=q,C[1]=kt,C[2]=Er,C[3]=Mr,C[4]=Je,C[5]=ct,C[6]=It,C[7]=Bt,C[8]=br,C[9]=Tr,C[10]=qe,C[11]=Gr,C[12]=q*tt+Je*lt+br*Pt+G[12],C[13]=kt*tt+ct*lt+Tr*Pt+G[13],C[14]=Er*tt+It*lt+qe*Pt+G[14],C[15]=Mr*tt+Bt*lt+Gr*Pt+G[15]),C}function zt(C,G,Ze){var tt=Ze[0],lt=Ze[1],Pt=Ze[2];return C[0]=G[0]*tt,C[1]=G[1]*tt,C[2]=G[2]*tt,C[3]=G[3]*tt,C[4]=G[4]*lt,C[5]=G[5]*lt,C[6]=G[6]*lt,C[7]=G[7]*lt,C[8]=G[8]*Pt,C[9]=G[9]*Pt,C[10]=G[10]*Pt,C[11]=G[11]*Pt,C[12]=G[12],C[13]=G[13],C[14]=G[14],C[15]=G[15],C}function Lt(C,G,Ze,tt){var lt=tt[0],Pt=tt[1],q=tt[2],kt=Math.hypot(lt,Pt,q),Er,Mr,Je,ct,It,Bt,br,Tr,qe,Gr,Yr,An,vr,Or,St,Kn,Ln,Ur,ee,fe,me,N,ae,de;return kt<z.Ib?null:(kt=1/kt,lt*=kt,Pt*=kt,q*=kt,Er=Math.sin(Ze),Mr=Math.cos(Ze),Je=1-Mr,ct=G[0],It=G[1],Bt=G[2],br=G[3],Tr=G[4],qe=G[5],Gr=G[6],Yr=G[7],An=G[8],vr=G[9],Or=G[10],St=G[11],Kn=lt*lt*Je+Mr,Ln=Pt*lt*Je+q*Er,Ur=q*lt*Je-Pt*Er,ee=lt*Pt*Je-q*Er,fe=Pt*Pt*Je+Mr,me=q*Pt*Je+lt*Er,N=lt*q*Je+Pt*Er,ae=Pt*q*Je-lt*Er,de=q*q*Je+Mr,C[0]=ct*Kn+Tr*Ln+An*Ur,C[1]=It*Kn+qe*Ln+vr*Ur,C[2]=Bt*Kn+Gr*Ln+Or*Ur,C[3]=br*Kn+Yr*Ln+St*Ur,C[4]=ct*ee+Tr*fe+An*me,C[5]=It*ee+qe*fe+vr*me,C[6]=Bt*ee+Gr*fe+Or*me,C[7]=br*ee+Yr*fe+St*me,C[8]=ct*N+Tr*ae+An*de,C[9]=It*N+qe*ae+vr*de,C[10]=Bt*N+Gr*ae+Or*de,C[11]=br*N+Yr*ae+St*de,G!==C&&(C[12]=G[12],C[13]=G[13],C[14]=G[14],C[15]=G[15]),C)}function Ht(C,G,Ze){var tt=Math.sin(Ze),lt=Math.cos(Ze),Pt=G[4],q=G[5],kt=G[6],Er=G[7],Mr=G[8],Je=G[9],ct=G[10],It=G[11];return G!==C&&(C[0]=G[0],C[1]=G[1],C[2]=G[2],C[3]=G[3],C[12]=G[12],C[13]=G[13],C[14]=G[14],C[15]=G[15]),C[4]=Pt*lt+Mr*tt,C[5]=q*lt+Je*tt,C[6]=kt*lt+ct*tt,C[7]=Er*lt+It*tt,C[8]=Mr*lt-Pt*tt,C[9]=Je*lt-q*tt,C[10]=ct*lt-kt*tt,C[11]=It*lt-Er*tt,C}function Ct(C,G,Ze){var tt=Math.sin(Ze),lt=Math.cos(Ze),Pt=G[0],q=G[1],kt=G[2],Er=G[3],Mr=G[8],Je=G[9],ct=G[10],It=G[11];return G!==C&&(C[4]=G[4],C[5]=G[5],C[6]=G[6],C[7]=G[7],C[12]=G[12],C[13]=G[13],C[14]=G[14],C[15]=G[15]),C[0]=Pt*lt-Mr*tt,C[1]=q*lt-Je*tt,C[2]=kt*lt-ct*tt,C[3]=Er*lt-It*tt,C[8]=Pt*tt+Mr*lt,C[9]=q*tt+Je*lt,C[10]=kt*tt+ct*lt,C[11]=Er*tt+It*lt,C}function yt(C,G,Ze){var tt=Math.sin(Ze),lt=Math.cos(Ze),Pt=G[0],q=G[1],kt=G[2],Er=G[3],Mr=G[4],Je=G[5],ct=G[6],It=G[7];return G!==C&&(C[8]=G[8],C[9]=G[9],C[10]=G[10],C[11]=G[11],C[12]=G[12],C[13]=G[13],C[14]=G[14],C[15]=G[15]),C[0]=Pt*lt+Mr*tt,C[1]=q*lt+Je*tt,C[2]=kt*lt+ct*tt,C[3]=Er*lt+It*tt,C[4]=Mr*lt-Pt*tt,C[5]=Je*lt-q*tt,C[6]=ct*lt-kt*tt,C[7]=It*lt-Er*tt,C}function ft(C,G){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=G[0],C[13]=G[1],C[14]=G[2],C[15]=1,C}function sr(C,G){return C[0]=G[0],C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=G[1],C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=G[2],C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function re(C,G,Ze){var tt=Ze[0],lt=Ze[1],Pt=Ze[2],q=Math.hypot(tt,lt,Pt),kt,Er,Mr;return q<z.Ib?null:(q=1/q,tt*=q,lt*=q,Pt*=q,kt=Math.sin(G),Er=Math.cos(G),Mr=1-Er,C[0]=tt*tt*Mr+Er,C[1]=lt*tt*Mr+Pt*kt,C[2]=Pt*tt*Mr-lt*kt,C[3]=0,C[4]=tt*lt*Mr-Pt*kt,C[5]=lt*lt*Mr+Er,C[6]=Pt*lt*Mr+tt*kt,C[7]=0,C[8]=tt*Pt*Mr+lt*kt,C[9]=lt*Pt*Mr-tt*kt,C[10]=Pt*Pt*Mr+Er,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C)}function nr(C,G){var Ze=Math.sin(G),tt=Math.cos(G);return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=tt,C[6]=Ze,C[7]=0,C[8]=0,C[9]=-Ze,C[10]=tt,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function Tt(C,G){var Ze=Math.sin(G),tt=Math.cos(G);return C[0]=tt,C[1]=0,C[2]=-Ze,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=Ze,C[9]=0,C[10]=tt,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function $e(C,G){var Ze=Math.sin(G),tt=Math.cos(G);return C[0]=tt,C[1]=Ze,C[2]=0,C[3]=0,C[4]=-Ze,C[5]=tt,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function Mt(C,G,Ze){var tt=G[0],lt=G[1],Pt=G[2],q=G[3],kt=tt+tt,Er=lt+lt,Mr=Pt+Pt,Je=tt*kt,ct=tt*Er,It=tt*Mr,Bt=lt*Er,br=lt*Mr,Tr=Pt*Mr,qe=q*kt,Gr=q*Er,Yr=q*Mr;return C[0]=1-(Bt+Tr),C[1]=ct+Yr,C[2]=It-Gr,C[3]=0,C[4]=ct-Yr,C[5]=1-(Je+Tr),C[6]=br+qe,C[7]=0,C[8]=It+Gr,C[9]=br-qe,C[10]=1-(Je+Bt),C[11]=0,C[12]=Ze[0],C[13]=Ze[1],C[14]=Ze[2],C[15]=1,C}function Ve(C,G){var Ze=new z.WT(3),tt=-G[0],lt=-G[1],Pt=-G[2],q=G[3],kt=G[4],Er=G[5],Mr=G[6],Je=G[7],ct=tt*tt+lt*lt+Pt*Pt+q*q;return ct>0?(Ze[0]=(kt*q+Je*tt+Er*Pt-Mr*lt)*2/ct,Ze[1]=(Er*q+Je*lt+Mr*tt-kt*Pt)*2/ct,Ze[2]=(Mr*q+Je*Pt+kt*lt-Er*tt)*2/ct):(Ze[0]=(kt*q+Je*tt+Er*Pt-Mr*lt)*2,Ze[1]=(Er*q+Je*lt+Mr*tt-kt*Pt)*2,Ze[2]=(Mr*q+Je*Pt+kt*lt-Er*tt)*2),Mt(C,G,Ze),C}function Ot(C,G){return C[0]=G[12],C[1]=G[13],C[2]=G[14],C}function pr(C,G){var Ze=G[0],tt=G[1],lt=G[2],Pt=G[4],q=G[5],kt=G[6],Er=G[8],Mr=G[9],Je=G[10];return C[0]=Math.hypot(Ze,tt,lt),C[1]=Math.hypot(Pt,q,kt),C[2]=Math.hypot(Er,Mr,Je),C}function qt(C,G){var Ze=new z.WT(3);pr(Ze,G);var tt=1/Ze[0],lt=1/Ze[1],Pt=1/Ze[2],q=G[0]*tt,kt=G[1]*lt,Er=G[2]*Pt,Mr=G[4]*tt,Je=G[5]*lt,ct=G[6]*Pt,It=G[8]*tt,Bt=G[9]*lt,br=G[10]*Pt,Tr=q+Je+br,qe=0;return Tr>0?(qe=Math.sqrt(Tr+1)*2,C[3]=.25*qe,C[0]=(ct-Bt)/qe,C[1]=(It-Er)/qe,C[2]=(kt-Mr)/qe):q>Je&&q>br?(qe=Math.sqrt(1+q-Je-br)*2,C[3]=(ct-Bt)/qe,C[0]=.25*qe,C[1]=(kt+Mr)/qe,C[2]=(It+Er)/qe):Je>br?(qe=Math.sqrt(1+Je-q-br)*2,C[3]=(It-Er)/qe,C[0]=(kt+Mr)/qe,C[1]=.25*qe,C[2]=(ct+Bt)/qe):(qe=Math.sqrt(1+br-q-Je)*2,C[3]=(kt-Mr)/qe,C[0]=(It+Er)/qe,C[1]=(ct+Bt)/qe,C[2]=.25*qe),C}function W(C,G,Ze,tt){var lt=G[0],Pt=G[1],q=G[2],kt=G[3],Er=lt+lt,Mr=Pt+Pt,Je=q+q,ct=lt*Er,It=lt*Mr,Bt=lt*Je,br=Pt*Mr,Tr=Pt*Je,qe=q*Je,Gr=kt*Er,Yr=kt*Mr,An=kt*Je,vr=tt[0],Or=tt[1],St=tt[2];return C[0]=(1-(br+qe))*vr,C[1]=(It+An)*vr,C[2]=(Bt-Yr)*vr,C[3]=0,C[4]=(It-An)*Or,C[5]=(1-(ct+qe))*Or,C[6]=(Tr+Gr)*Or,C[7]=0,C[8]=(Bt+Yr)*St,C[9]=(Tr-Gr)*St,C[10]=(1-(ct+br))*St,C[11]=0,C[12]=Ze[0],C[13]=Ze[1],C[14]=Ze[2],C[15]=1,C}function se(C,G,Ze,tt,lt){var Pt=G[0],q=G[1],kt=G[2],Er=G[3],Mr=Pt+Pt,Je=q+q,ct=kt+kt,It=Pt*Mr,Bt=Pt*Je,br=Pt*ct,Tr=q*Je,qe=q*ct,Gr=kt*ct,Yr=Er*Mr,An=Er*Je,vr=Er*ct,Or=tt[0],St=tt[1],Kn=tt[2],Ln=lt[0],Ur=lt[1],ee=lt[2],fe=(1-(Tr+Gr))*Or,me=(Bt+vr)*Or,N=(br-An)*Or,ae=(Bt-vr)*St,de=(1-(It+Gr))*St,Te=(qe+Yr)*St,ue=(br+An)*Kn,xe=(qe-Yr)*Kn,pt=(1-(It+Tr))*Kn;return C[0]=fe,C[1]=me,C[2]=N,C[3]=0,C[4]=ae,C[5]=de,C[6]=Te,C[7]=0,C[8]=ue,C[9]=xe,C[10]=pt,C[11]=0,C[12]=Ze[0]+Ln-(fe*Ln+ae*Ur+ue*ee),C[13]=Ze[1]+Ur-(me*Ln+de*Ur+xe*ee),C[14]=Ze[2]+ee-(N*Ln+Te*Ur+pt*ee),C[15]=1,C}function ke(C,G){var Ze=G[0],tt=G[1],lt=G[2],Pt=G[3],q=Ze+Ze,kt=tt+tt,Er=lt+lt,Mr=Ze*q,Je=tt*q,ct=tt*kt,It=lt*q,Bt=lt*kt,br=lt*Er,Tr=Pt*q,qe=Pt*kt,Gr=Pt*Er;return C[0]=1-ct-br,C[1]=Je+Gr,C[2]=It-qe,C[3]=0,C[4]=Je-Gr,C[5]=1-Mr-br,C[6]=Bt+Tr,C[7]=0,C[8]=It+qe,C[9]=Bt-Tr,C[10]=1-Mr-ct,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function _e(C,G,Ze,tt,lt,Pt,q){var kt=1/(Ze-G),Er=1/(lt-tt),Mr=1/(Pt-q);return C[0]=Pt*2*kt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Pt*2*Er,C[6]=0,C[7]=0,C[8]=(Ze+G)*kt,C[9]=(lt+tt)*Er,C[10]=(q+Pt)*Mr,C[11]=-1,C[12]=0,C[13]=0,C[14]=q*Pt*2*Mr,C[15]=0,C}function Et(C,G,Ze,tt,lt){var Pt=1/Math.tan(G/2),q;return C[0]=Pt/Ze,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Pt,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=-1,C[12]=0,C[13]=0,C[15]=0,lt!=null&&lt!==Infinity?(q=1/(tt-lt),C[10]=(lt+tt)*q,C[14]=2*lt*tt*q):(C[10]=-1,C[14]=-2*tt),C}var gt=Et;function jt(C,G,Ze,tt,lt){var Pt=1/Math.tan(G/2),q;return C[0]=Pt/Ze,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Pt,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=-1,C[12]=0,C[13]=0,C[15]=0,lt!=null&&lt!==Infinity?(q=1/(tt-lt),C[10]=lt*q,C[14]=lt*tt*q):(C[10]=-1,C[14]=-tt),C}function Ut(C,G,Ze,tt){var lt=Math.tan(G.upDegrees*Math.PI/180),Pt=Math.tan(G.downDegrees*Math.PI/180),q=Math.tan(G.leftDegrees*Math.PI/180),kt=Math.tan(G.rightDegrees*Math.PI/180),Er=2/(q+kt),Mr=2/(lt+Pt);return C[0]=Er,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Mr,C[6]=0,C[7]=0,C[8]=-((q-kt)*Er*.5),C[9]=(lt-Pt)*Mr*.5,C[10]=tt/(Ze-tt),C[11]=-1,C[12]=0,C[13]=0,C[14]=tt*Ze/(Ze-tt),C[15]=0,C}function zr(C,G,Ze,tt,lt,Pt,q){var kt=1/(G-Ze),Er=1/(tt-lt),Mr=1/(Pt-q);return C[0]=-2*kt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=-2*Er,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=2*Mr,C[11]=0,C[12]=(G+Ze)*kt,C[13]=(lt+tt)*Er,C[14]=(q+Pt)*Mr,C[15]=1,C}var dn=zr;function _n(C,G,Ze,tt,lt,Pt,q){var kt=1/(G-Ze),Er=1/(tt-lt),Mr=1/(Pt-q);return C[0]=-2*kt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=-2*Er,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=Mr,C[11]=0,C[12]=(G+Ze)*kt,C[13]=(lt+tt)*Er,C[14]=Pt*Mr,C[15]=1,C}function Qi(C,G,Ze,tt){var lt,Pt,q,kt,Er,Mr,Je,ct,It,Bt,br=G[0],Tr=G[1],qe=G[2],Gr=tt[0],Yr=tt[1],An=tt[2],vr=Ze[0],Or=Ze[1],St=Ze[2];return Math.abs(br-vr)<z.Ib&&Math.abs(Tr-Or)<z.Ib&&Math.abs(qe-St)<z.Ib?$(C):(Je=br-vr,ct=Tr-Or,It=qe-St,Bt=1/Math.hypot(Je,ct,It),Je*=Bt,ct*=Bt,It*=Bt,lt=Yr*It-An*ct,Pt=An*Je-Gr*It,q=Gr*ct-Yr*Je,Bt=Math.hypot(lt,Pt,q),Bt?(Bt=1/Bt,lt*=Bt,Pt*=Bt,q*=Bt):(lt=0,Pt=0,q=0),kt=ct*q-It*Pt,Er=It*lt-Je*q,Mr=Je*Pt-ct*lt,Bt=Math.hypot(kt,Er,Mr),Bt?(Bt=1/Bt,kt*=Bt,Er*=Bt,Mr*=Bt):(kt=0,Er=0,Mr=0),C[0]=lt,C[1]=kt,C[2]=Je,C[3]=0,C[4]=Pt,C[5]=Er,C[6]=ct,C[7]=0,C[8]=q,C[9]=Mr,C[10]=It,C[11]=0,C[12]=-(lt*br+Pt*Tr+q*qe),C[13]=-(kt*br+Er*Tr+Mr*qe),C[14]=-(Je*br+ct*Tr+It*qe),C[15]=1,C)}function ur(C,G,Ze,tt){var lt=G[0],Pt=G[1],q=G[2],kt=tt[0],Er=tt[1],Mr=tt[2],Je=lt-Ze[0],ct=Pt-Ze[1],It=q-Ze[2],Bt=Je*Je+ct*ct+It*It;Bt>0&&(Bt=1/Math.sqrt(Bt),Je*=Bt,ct*=Bt,It*=Bt);var br=Er*It-Mr*ct,Tr=Mr*Je-kt*It,qe=kt*ct-Er*Je;return Bt=br*br+Tr*Tr+qe*qe,Bt>0&&(Bt=1/Math.sqrt(Bt),br*=Bt,Tr*=Bt,qe*=Bt),C[0]=br,C[1]=Tr,C[2]=qe,C[3]=0,C[4]=ct*qe-It*Tr,C[5]=It*br-Je*qe,C[6]=Je*Tr-ct*br,C[7]=0,C[8]=Je,C[9]=ct,C[10]=It,C[11]=0,C[12]=lt,C[13]=Pt,C[14]=q,C[15]=1,C}function ge(C){return"mat4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+", "+C[8]+", "+C[9]+", "+C[10]+", "+C[11]+", "+C[12]+", "+C[13]+", "+C[14]+", "+C[15]+")"}function Pe(C){return Math.hypot(C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15])}function Ge(C,G,Ze){return C[0]=G[0]+Ze[0],C[1]=G[1]+Ze[1],C[2]=G[2]+Ze[2],C[3]=G[3]+Ze[3],C[4]=G[4]+Ze[4],C[5]=G[5]+Ze[5],C[6]=G[6]+Ze[6],C[7]=G[7]+Ze[7],C[8]=G[8]+Ze[8],C[9]=G[9]+Ze[9],C[10]=G[10]+Ze[10],C[11]=G[11]+Ze[11],C[12]=G[12]+Ze[12],C[13]=G[13]+Ze[13],C[14]=G[14]+Ze[14],C[15]=G[15]+Ze[15],C}function Re(C,G,Ze){return C[0]=G[0]-Ze[0],C[1]=G[1]-Ze[1],C[2]=G[2]-Ze[2],C[3]=G[3]-Ze[3],C[4]=G[4]-Ze[4],C[5]=G[5]-Ze[5],C[6]=G[6]-Ze[6],C[7]=G[7]-Ze[7],C[8]=G[8]-Ze[8],C[9]=G[9]-Ze[9],C[10]=G[10]-Ze[10],C[11]=G[11]-Ze[11],C[12]=G[12]-Ze[12],C[13]=G[13]-Ze[13],C[14]=G[14]-Ze[14],C[15]=G[15]-Ze[15],C}function Nt(C,G,Ze){return C[0]=G[0]*Ze,C[1]=G[1]*Ze,C[2]=G[2]*Ze,C[3]=G[3]*Ze,C[4]=G[4]*Ze,C[5]=G[5]*Ze,C[6]=G[6]*Ze,C[7]=G[7]*Ze,C[8]=G[8]*Ze,C[9]=G[9]*Ze,C[10]=G[10]*Ze,C[11]=G[11]*Ze,C[12]=G[12]*Ze,C[13]=G[13]*Ze,C[14]=G[14]*Ze,C[15]=G[15]*Ze,C}function ar(C,G,Ze,tt){return C[0]=G[0]+Ze[0]*tt,C[1]=G[1]+Ze[1]*tt,C[2]=G[2]+Ze[2]*tt,C[3]=G[3]+Ze[3]*tt,C[4]=G[4]+Ze[4]*tt,C[5]=G[5]+Ze[5]*tt,C[6]=G[6]+Ze[6]*tt,C[7]=G[7]+Ze[7]*tt,C[8]=G[8]+Ze[8]*tt,C[9]=G[9]+Ze[9]*tt,C[10]=G[10]+Ze[10]*tt,C[11]=G[11]+Ze[11]*tt,C[12]=G[12]+Ze[12]*tt,C[13]=G[13]+Ze[13]*tt,C[14]=G[14]+Ze[14]*tt,C[15]=G[15]+Ze[15]*tt,C}function yr(C,G){return C[0]===G[0]&&C[1]===G[1]&&C[2]===G[2]&&C[3]===G[3]&&C[4]===G[4]&&C[5]===G[5]&&C[6]===G[6]&&C[7]===G[7]&&C[8]===G[8]&&C[9]===G[9]&&C[10]===G[10]&&C[11]===G[11]&&C[12]===G[12]&&C[13]===G[13]&&C[14]===G[14]&&C[15]===G[15]}function Lr(C,G){var Ze=C[0],tt=C[1],lt=C[2],Pt=C[3],q=C[4],kt=C[5],Er=C[6],Mr=C[7],Je=C[8],ct=C[9],It=C[10],Bt=C[11],br=C[12],Tr=C[13],qe=C[14],Gr=C[15],Yr=G[0],An=G[1],vr=G[2],Or=G[3],St=G[4],Kn=G[5],Ln=G[6],Ur=G[7],ee=G[8],fe=G[9],me=G[10],N=G[11],ae=G[12],de=G[13],Te=G[14],ue=G[15];return Math.abs(Ze-Yr)<=z.Ib*Math.max(1,Math.abs(Ze),Math.abs(Yr))&&Math.abs(tt-An)<=z.Ib*Math.max(1,Math.abs(tt),Math.abs(An))&&Math.abs(lt-vr)<=z.Ib*Math.max(1,Math.abs(lt),Math.abs(vr))&&Math.abs(Pt-Or)<=z.Ib*Math.max(1,Math.abs(Pt),Math.abs(Or))&&Math.abs(q-St)<=z.Ib*Math.max(1,Math.abs(q),Math.abs(St))&&Math.abs(kt-Kn)<=z.Ib*Math.max(1,Math.abs(kt),Math.abs(Kn))&&Math.abs(Er-Ln)<=z.Ib*Math.max(1,Math.abs(Er),Math.abs(Ln))&&Math.abs(Mr-Ur)<=z.Ib*Math.max(1,Math.abs(Mr),Math.abs(Ur))&&Math.abs(Je-ee)<=z.Ib*Math.max(1,Math.abs(Je),Math.abs(ee))&&Math.abs(ct-fe)<=z.Ib*Math.max(1,Math.abs(ct),Math.abs(fe))&&Math.abs(It-me)<=z.Ib*Math.max(1,Math.abs(It),Math.abs(me))&&Math.abs(Bt-N)<=z.Ib*Math.max(1,Math.abs(Bt),Math.abs(N))&&Math.abs(br-ae)<=z.Ib*Math.max(1,Math.abs(br),Math.abs(ae))&&Math.abs(Tr-de)<=z.Ib*Math.max(1,Math.abs(Tr),Math.abs(de))&&Math.abs(qe-Te)<=z.Ib*Math.max(1,Math.abs(qe),Math.abs(Te))&&Math.abs(Gr-ue)<=z.Ib*Math.max(1,Math.abs(Gr),Math.abs(ue))}var fr=rt,Fr=Re},98333:function(Qe,O,y){"use strict";y.d(O,{Ue:function(){return b},al:function(){return X},bA:function(){return Ht},fF:function(){return qt}});var z=y(49685);function b(){var ge=new z.WT(4);return z.WT!=Float32Array&&(ge[0]=0,ge[1]=0,ge[2]=0,ge[3]=0),ge}function p(ge){var Pe=new glMatrix.ARRAY_TYPE(4);return Pe[0]=ge[0],Pe[1]=ge[1],Pe[2]=ge[2],Pe[3]=ge[3],Pe}function X(ge,Pe,Ge,Re){var Nt=new z.WT(4);return Nt[0]=ge,Nt[1]=Pe,Nt[2]=Ge,Nt[3]=Re,Nt}function U(ge,Pe){return ge[0]=Pe[0],ge[1]=Pe[1],ge[2]=Pe[2],ge[3]=Pe[3],ge}function Y(ge,Pe,Ge,Re,Nt){return ge[0]=Pe,ge[1]=Ge,ge[2]=Re,ge[3]=Nt,ge}function $(ge,Pe,Ge){return ge[0]=Pe[0]+Ge[0],ge[1]=Pe[1]+Ge[1],ge[2]=Pe[2]+Ge[2],ge[3]=Pe[3]+Ge[3],ge}function he(ge,Pe,Ge){return ge[0]=Pe[0]-Ge[0],ge[1]=Pe[1]-Ge[1],ge[2]=Pe[2]-Ge[2],ge[3]=Pe[3]-Ge[3],ge}function Z(ge,Pe,Ge){return ge[0]=Pe[0]*Ge[0],ge[1]=Pe[1]*Ge[1],ge[2]=Pe[2]*Ge[2],ge[3]=Pe[3]*Ge[3],ge}function Ie(ge,Pe,Ge){return ge[0]=Pe[0]/Ge[0],ge[1]=Pe[1]/Ge[1],ge[2]=Pe[2]/Ge[2],ge[3]=Pe[3]/Ge[3],ge}function Le(ge,Pe){return ge[0]=Math.ceil(Pe[0]),ge[1]=Math.ceil(Pe[1]),ge[2]=Math.ceil(Pe[2]),ge[3]=Math.ceil(Pe[3]),ge}function rt(ge,Pe){return ge[0]=Math.floor(Pe[0]),ge[1]=Math.floor(Pe[1]),ge[2]=Math.floor(Pe[2]),ge[3]=Math.floor(Pe[3]),ge}function $t(ge,Pe,Ge){return ge[0]=Math.min(Pe[0],Ge[0]),ge[1]=Math.min(Pe[1],Ge[1]),ge[2]=Math.min(Pe[2],Ge[2]),ge[3]=Math.min(Pe[3],Ge[3]),ge}function zt(ge,Pe,Ge){return ge[0]=Math.max(Pe[0],Ge[0]),ge[1]=Math.max(Pe[1],Ge[1]),ge[2]=Math.max(Pe[2],Ge[2]),ge[3]=Math.max(Pe[3],Ge[3]),ge}function Lt(ge,Pe){return ge[0]=Math.round(Pe[0]),ge[1]=Math.round(Pe[1]),ge[2]=Math.round(Pe[2]),ge[3]=Math.round(Pe[3]),ge}function Ht(ge,Pe,Ge){return ge[0]=Pe[0]*Ge,ge[1]=Pe[1]*Ge,ge[2]=Pe[2]*Ge,ge[3]=Pe[3]*Ge,ge}function Ct(ge,Pe,Ge,Re){return ge[0]=Pe[0]+Ge[0]*Re,ge[1]=Pe[1]+Ge[1]*Re,ge[2]=Pe[2]+Ge[2]*Re,ge[3]=Pe[3]+Ge[3]*Re,ge}function yt(ge,Pe){var Ge=Pe[0]-ge[0],Re=Pe[1]-ge[1],Nt=Pe[2]-ge[2],ar=Pe[3]-ge[3];return Math.hypot(Ge,Re,Nt,ar)}function ft(ge,Pe){var Ge=Pe[0]-ge[0],Re=Pe[1]-ge[1],Nt=Pe[2]-ge[2],ar=Pe[3]-ge[3];return Ge*Ge+Re*Re+Nt*Nt+ar*ar}function sr(ge){var Pe=ge[0],Ge=ge[1],Re=ge[2],Nt=ge[3];return Math.hypot(Pe,Ge,Re,Nt)}function re(ge){var Pe=ge[0],Ge=ge[1],Re=ge[2],Nt=ge[3];return Pe*Pe+Ge*Ge+Re*Re+Nt*Nt}function nr(ge,Pe){return ge[0]=-Pe[0],ge[1]=-Pe[1],ge[2]=-Pe[2],ge[3]=-Pe[3],ge}function Tt(ge,Pe){return ge[0]=1/Pe[0],ge[1]=1/Pe[1],ge[2]=1/Pe[2],ge[3]=1/Pe[3],ge}function $e(ge,Pe){var Ge=Pe[0],Re=Pe[1],Nt=Pe[2],ar=Pe[3],yr=Ge*Ge+Re*Re+Nt*Nt+ar*ar;return yr>0&&(yr=1/Math.sqrt(yr)),ge[0]=Ge*yr,ge[1]=Re*yr,ge[2]=Nt*yr,ge[3]=ar*yr,ge}function Mt(ge,Pe){return ge[0]*Pe[0]+ge[1]*Pe[1]+ge[2]*Pe[2]+ge[3]*Pe[3]}function Ve(ge,Pe,Ge,Re){var Nt=Ge[0]*Re[1]-Ge[1]*Re[0],ar=Ge[0]*Re[2]-Ge[2]*Re[0],yr=Ge[0]*Re[3]-Ge[3]*Re[0],Lr=Ge[1]*Re[2]-Ge[2]*Re[1],fr=Ge[1]*Re[3]-Ge[3]*Re[1],Fr=Ge[2]*Re[3]-Ge[3]*Re[2],C=Pe[0],G=Pe[1],Ze=Pe[2],tt=Pe[3];return ge[0]=G*Fr-Ze*fr+tt*Lr,ge[1]=-(C*Fr)+Ze*yr-tt*ar,ge[2]=C*fr-G*yr+tt*Nt,ge[3]=-(C*Lr)+G*ar-Ze*Nt,ge}function Ot(ge,Pe,Ge,Re){var Nt=Pe[0],ar=Pe[1],yr=Pe[2],Lr=Pe[3];return ge[0]=Nt+Re*(Ge[0]-Nt),ge[1]=ar+Re*(Ge[1]-ar),ge[2]=yr+Re*(Ge[2]-yr),ge[3]=Lr+Re*(Ge[3]-Lr),ge}function pr(ge,Pe){Pe=Pe||1;var Ge,Re,Nt,ar,yr,Lr;do Ge=glMatrix.RANDOM()*2-1,Re=glMatrix.RANDOM()*2-1,yr=Ge*Ge+Re*Re;while(yr>=1);do Nt=glMatrix.RANDOM()*2-1,ar=glMatrix.RANDOM()*2-1,Lr=Nt*Nt+ar*ar;while(Lr>=1);var fr=Math.sqrt((1-yr)/Lr);return ge[0]=Pe*Ge,ge[1]=Pe*Re,ge[2]=Pe*Nt*fr,ge[3]=Pe*ar*fr,ge}function qt(ge,Pe,Ge){var Re=Pe[0],Nt=Pe[1],ar=Pe[2],yr=Pe[3];return ge[0]=Ge[0]*Re+Ge[4]*Nt+Ge[8]*ar+Ge[12]*yr,ge[1]=Ge[1]*Re+Ge[5]*Nt+Ge[9]*ar+Ge[13]*yr,ge[2]=Ge[2]*Re+Ge[6]*Nt+Ge[10]*ar+Ge[14]*yr,ge[3]=Ge[3]*Re+Ge[7]*Nt+Ge[11]*ar+Ge[15]*yr,ge}function W(ge,Pe,Ge){var Re=Pe[0],Nt=Pe[1],ar=Pe[2],yr=Ge[0],Lr=Ge[1],fr=Ge[2],Fr=Ge[3],C=Fr*Re+Lr*ar-fr*Nt,G=Fr*Nt+fr*Re-yr*ar,Ze=Fr*ar+yr*Nt-Lr*Re,tt=-yr*Re-Lr*Nt-fr*ar;return ge[0]=C*Fr+tt*-yr+G*-fr-Ze*-Lr,ge[1]=G*Fr+tt*-Lr+Ze*-yr-C*-fr,ge[2]=Ze*Fr+tt*-fr+C*-Lr-G*-yr,ge[3]=Pe[3],ge}function se(ge){return ge[0]=0,ge[1]=0,ge[2]=0,ge[3]=0,ge}function ke(ge){return"vec4("+ge[0]+", "+ge[1]+", "+ge[2]+", "+ge[3]+")"}function _e(ge,Pe){return ge[0]===Pe[0]&&ge[1]===Pe[1]&&ge[2]===Pe[2]&&ge[3]===Pe[3]}function Et(ge,Pe){var Ge=ge[0],Re=ge[1],Nt=ge[2],ar=ge[3],yr=Pe[0],Lr=Pe[1],fr=Pe[2],Fr=Pe[3];return Math.abs(Ge-yr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ge),Math.abs(yr))&&Math.abs(Re-Lr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Re),Math.abs(Lr))&&Math.abs(Nt-fr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Nt),Math.abs(fr))&&Math.abs(ar-Fr)<=glMatrix.EPSILON*Math.max(1,Math.abs(ar),Math.abs(Fr))}var gt=null,jt=null,Ut=null,zr=null,dn=null,_n=null,Qi=null,ur=function(){var ge=b();return function(Pe,Ge,Re,Nt,ar,yr){var Lr,fr;for(Ge||(Ge=4),Re||(Re=0),Nt?fr=Math.min(Nt*Ge+Re,Pe.length):fr=Pe.length,Lr=Re;Lr<fr;Lr+=Ge)ge[0]=Pe[Lr],ge[1]=Pe[Lr+1],ge[2]=Pe[Lr+2],ge[3]=Pe[Lr+3],ar(ge,ge,yr),Pe[Lr]=ge[0],Pe[Lr+1]=ge[1],Pe[Lr+2]=ge[2],Pe[Lr+3]=ge[3];return Pe}}()},50840:function(Qe,O,y){var z;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(b,p,X,U){"use strict";var Y=["","webkit","Moz","MS","ms","o"],$=p.createElement("div"),he="function",Z=Math.round,Ie=Math.abs,Le=Date.now;function rt(Ee,Be,mt){return setTimeout(sr(Ee,mt),Be)}function $t(Ee,Be,mt){return Array.isArray(Ee)?(zt(Ee,mt[Be],mt),!0):!1}function zt(Ee,Be,mt){var R;if(!!Ee)if(Ee.forEach)Ee.forEach(Be,mt);else if(Ee.length!==U)for(R=0;R<Ee.length;)Be.call(mt,Ee[R],R,Ee),R++;else for(R in Ee)Ee.hasOwnProperty(R)&&Be.call(mt,Ee[R],R,Ee)}function Lt(Ee,Be,mt){var R="DEPRECATED METHOD: "+Be+`
`+mt+` AT 
`;return function(){var qr=new Error("get-stack-trace"),oi=qr&&qr.stack?qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ai=b.console&&(b.console.warn||b.console.log);return Ai&&Ai.call(b.console,R,oi),Ee.apply(this,arguments)}}var Ht;typeof Object.assign!="function"?Ht=function(Be){if(Be===U||Be===null)throw new TypeError("Cannot convert undefined or null to object");for(var mt=Object(Be),R=1;R<arguments.length;R++){var qr=arguments[R];if(qr!==U&&qr!==null)for(var oi in qr)qr.hasOwnProperty(oi)&&(mt[oi]=qr[oi])}return mt}:Ht=Object.assign;var Ct=Lt(function(Be,mt,R){for(var qr=Object.keys(mt),oi=0;oi<qr.length;)(!R||R&&Be[qr[oi]]===U)&&(Be[qr[oi]]=mt[qr[oi]]),oi++;return Be},"extend","Use `assign`."),yt=Lt(function(Be,mt){return Ct(Be,mt,!0)},"merge","Use `assign`.");function ft(Ee,Be,mt){var R=Be.prototype,qr;qr=Ee.prototype=Object.create(R),qr.constructor=Ee,qr._super=R,mt&&Ht(qr,mt)}function sr(Ee,Be){return function(){return Ee.apply(Be,arguments)}}function re(Ee,Be){return typeof Ee==he?Ee.apply(Be&&Be[0]||U,Be):Ee}function nr(Ee,Be){return Ee===U?Be:Ee}function Tt(Ee,Be,mt){zt(Ot(Be),function(R){Ee.addEventListener(R,mt,!1)})}function $e(Ee,Be,mt){zt(Ot(Be),function(R){Ee.removeEventListener(R,mt,!1)})}function Mt(Ee,Be){for(;Ee;){if(Ee==Be)return!0;Ee=Ee.parentNode}return!1}function Ve(Ee,Be){return Ee.indexOf(Be)>-1}function Ot(Ee){return Ee.trim().split(/\s+/g)}function pr(Ee,Be,mt){if(Ee.indexOf&&!mt)return Ee.indexOf(Be);for(var R=0;R<Ee.length;){if(mt&&Ee[R][mt]==Be||!mt&&Ee[R]===Be)return R;R++}return-1}function qt(Ee){return Array.prototype.slice.call(Ee,0)}function W(Ee,Be,mt){for(var R=[],qr=[],oi=0;oi<Ee.length;){var Ai=Be?Ee[oi][Be]:Ee[oi];pr(qr,Ai)<0&&R.push(Ee[oi]),qr[oi]=Ai,oi++}return mt&&(Be?R=R.sort(function(Xa,ja){return Xa[Be]>ja[Be]}):R=R.sort()),R}function se(Ee,Be){for(var mt,R,qr=Be[0].toUpperCase()+Be.slice(1),oi=0;oi<Y.length;){if(mt=Y[oi],R=mt?mt+qr:Be,R in Ee)return R;oi++}return U}var ke=1;function _e(){return ke++}function Et(Ee){var Be=Ee.ownerDocument||Ee;return Be.defaultView||Be.parentWindow||b}var gt=/mobile|tablet|ip(ad|hone|od)|android/i,jt="ontouchstart"in b,Ut=se(b,"PointerEvent")!==U,zr=jt&&gt.test(navigator.userAgent),dn="touch",_n="pen",Qi="mouse",ur="kinect",ge=25,Pe=1,Ge=2,Re=4,Nt=8,ar=1,yr=2,Lr=4,fr=8,Fr=16,C=yr|Lr,G=fr|Fr,Ze=C|G,tt=["x","y"],lt=["clientX","clientY"];function Pt(Ee,Be){var mt=this;this.manager=Ee,this.callback=Be,this.element=Ee.element,this.target=Ee.options.inputTarget,this.domHandler=function(R){re(Ee.options.enable,[Ee])&&mt.handler(R)},this.init()}Pt.prototype={handler:function(){},init:function(){this.evEl&&Tt(this.element,this.evEl,this.domHandler),this.evTarget&&Tt(this.target,this.evTarget,this.domHandler),this.evWin&&Tt(Et(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Et(this.element),this.evWin,this.domHandler)}};function q(Ee){var Be,mt=Ee.options.inputClass;return mt?Be=mt:Ut?Be=fe:zr?Be=pt:jt?Be=Zr:Be=St,new Be(Ee,kt)}function kt(Ee,Be,mt){var R=mt.pointers.length,qr=mt.changedPointers.length,oi=Be&Pe&&R-qr==0,Ai=Be&(Re|Nt)&&R-qr==0;mt.isFirst=!!oi,mt.isFinal=!!Ai,oi&&(Ee.session={}),mt.eventType=Be,Er(Ee,mt),Ee.emit("hammer.input",mt),Ee.recognize(mt),Ee.session.prevInput=mt}function Er(Ee,Be){var mt=Ee.session,R=Be.pointers,qr=R.length;mt.firstInput||(mt.firstInput=ct(Be)),qr>1&&!mt.firstMultiple?mt.firstMultiple=ct(Be):qr===1&&(mt.firstMultiple=!1);var oi=mt.firstInput,Ai=mt.firstMultiple,uo=Ai?Ai.center:oi.center,Xa=Be.center=It(R);Be.timeStamp=Le(),Be.deltaTime=Be.timeStamp-oi.timeStamp,Be.angle=qe(uo,Xa),Be.distance=Tr(uo,Xa),Mr(mt,Be),Be.offsetDirection=br(Be.deltaX,Be.deltaY);var ja=Bt(Be.deltaTime,Be.deltaX,Be.deltaY);Be.overallVelocityX=ja.x,Be.overallVelocityY=ja.y,Be.overallVelocity=Ie(ja.x)>Ie(ja.y)?ja.x:ja.y,Be.scale=Ai?Yr(Ai.pointers,R):1,Be.rotation=Ai?Gr(Ai.pointers,R):0,Be.maxPointers=mt.prevInput?Be.pointers.length>mt.prevInput.maxPointers?Be.pointers.length:mt.prevInput.maxPointers:Be.pointers.length,Je(mt,Be);var os=Ee.element;Mt(Be.srcEvent.target,os)&&(os=Be.srcEvent.target),Be.target=os}function Mr(Ee,Be){var mt=Be.center,R=Ee.offsetDelta||{},qr=Ee.prevDelta||{},oi=Ee.prevInput||{};(Be.eventType===Pe||oi.eventType===Re)&&(qr=Ee.prevDelta={x:oi.deltaX||0,y:oi.deltaY||0},R=Ee.offsetDelta={x:mt.x,y:mt.y}),Be.deltaX=qr.x+(mt.x-R.x),Be.deltaY=qr.y+(mt.y-R.y)}function Je(Ee,Be){var mt=Ee.lastInterval||Be,R=Be.timeStamp-mt.timeStamp,qr,oi,Ai,uo;if(Be.eventType!=Nt&&(R>ge||mt.velocity===U)){var Xa=Be.deltaX-mt.deltaX,ja=Be.deltaY-mt.deltaY,os=Bt(R,Xa,ja);oi=os.x,Ai=os.y,qr=Ie(os.x)>Ie(os.y)?os.x:os.y,uo=br(Xa,ja),Ee.lastInterval=Be}else qr=mt.velocity,oi=mt.velocityX,Ai=mt.velocityY,uo=mt.direction;Be.velocity=qr,Be.velocityX=oi,Be.velocityY=Ai,Be.direction=uo}function ct(Ee){for(var Be=[],mt=0;mt<Ee.pointers.length;)Be[mt]={clientX:Z(Ee.pointers[mt].clientX),clientY:Z(Ee.pointers[mt].clientY)},mt++;return{timeStamp:Le(),pointers:Be,center:It(Be),deltaX:Ee.deltaX,deltaY:Ee.deltaY}}function It(Ee){var Be=Ee.length;if(Be===1)return{x:Z(Ee[0].clientX),y:Z(Ee[0].clientY)};for(var mt=0,R=0,qr=0;qr<Be;)mt+=Ee[qr].clientX,R+=Ee[qr].clientY,qr++;return{x:Z(mt/Be),y:Z(R/Be)}}function Bt(Ee,Be,mt){return{x:Be/Ee||0,y:mt/Ee||0}}function br(Ee,Be){return Ee===Be?ar:Ie(Ee)>=Ie(Be)?Ee<0?yr:Lr:Be<0?fr:Fr}function Tr(Ee,Be,mt){mt||(mt=tt);var R=Be[mt[0]]-Ee[mt[0]],qr=Be[mt[1]]-Ee[mt[1]];return Math.sqrt(R*R+qr*qr)}function qe(Ee,Be,mt){mt||(mt=tt);var R=Be[mt[0]]-Ee[mt[0]],qr=Be[mt[1]]-Ee[mt[1]];return Math.atan2(qr,R)*180/Math.PI}function Gr(Ee,Be){return qe(Be[1],Be[0],lt)+qe(Ee[1],Ee[0],lt)}function Yr(Ee,Be){return Tr(Be[0],Be[1],lt)/Tr(Ee[0],Ee[1],lt)}var An={mousedown:Pe,mousemove:Ge,mouseup:Re},vr="mousedown",Or="mousemove mouseup";function St(){this.evEl=vr,this.evWin=Or,this.pressed=!1,Pt.apply(this,arguments)}ft(St,Pt,{handler:function(Be){var mt=An[Be.type];mt&Pe&&Be.button===0&&(this.pressed=!0),mt&Ge&&Be.which!==1&&(mt=Re),!!this.pressed&&(mt&Re&&(this.pressed=!1),this.callback(this.manager,mt,{pointers:[Be],changedPointers:[Be],pointerType:Qi,srcEvent:Be}))}});var Kn={pointerdown:Pe,pointermove:Ge,pointerup:Re,pointercancel:Nt,pointerout:Nt},Ln={2:dn,3:_n,4:Qi,5:ur},Ur="pointerdown",ee="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(Ur="MSPointerDown",ee="MSPointerMove MSPointerUp MSPointerCancel");function fe(){this.evEl=Ur,this.evWin=ee,Pt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ft(fe,Pt,{handler:function(Be){var mt=this.store,R=!1,qr=Be.type.toLowerCase().replace("ms",""),oi=Kn[qr],Ai=Ln[Be.pointerType]||Be.pointerType,uo=Ai==dn,Xa=pr(mt,Be.pointerId,"pointerId");oi&Pe&&(Be.button===0||uo)?Xa<0&&(mt.push(Be),Xa=mt.length-1):oi&(Re|Nt)&&(R=!0),!(Xa<0)&&(mt[Xa]=Be,this.callback(this.manager,oi,{pointers:mt,changedPointers:[Be],pointerType:Ai,srcEvent:Be}),R&&mt.splice(Xa,1))}});var me={touchstart:Pe,touchmove:Ge,touchend:Re,touchcancel:Nt},N="touchstart",ae="touchstart touchmove touchend touchcancel";function de(){this.evTarget=N,this.evWin=ae,this.started=!1,Pt.apply(this,arguments)}ft(de,Pt,{handler:function(Be){var mt=me[Be.type];if(mt===Pe&&(this.started=!0),!!this.started){var R=Te.call(this,Be,mt);mt&(Re|Nt)&&R[0].length-R[1].length==0&&(this.started=!1),this.callback(this.manager,mt,{pointers:R[0],changedPointers:R[1],pointerType:dn,srcEvent:Be})}}});function Te(Ee,Be){var mt=qt(Ee.touches),R=qt(Ee.changedTouches);return Be&(Re|Nt)&&(mt=W(mt.concat(R),"identifier",!0)),[mt,R]}var ue={touchstart:Pe,touchmove:Ge,touchend:Re,touchcancel:Nt},xe="touchstart touchmove touchend touchcancel";function pt(){this.evTarget=xe,this.targetIds={},Pt.apply(this,arguments)}ft(pt,Pt,{handler:function(Be){var mt=ue[Be.type],R=Cr.call(this,Be,mt);!R||this.callback(this.manager,mt,{pointers:R[0],changedPointers:R[1],pointerType:dn,srcEvent:Be})}});function Cr(Ee,Be){var mt=qt(Ee.touches),R=this.targetIds;if(Be&(Pe|Ge)&&mt.length===1)return R[mt[0].identifier]=!0,[mt,mt];var qr,oi,Ai=qt(Ee.changedTouches),uo=[],Xa=this.target;if(oi=mt.filter(function(ja){return Mt(ja.target,Xa)}),Be===Pe)for(qr=0;qr<oi.length;)R[oi[qr].identifier]=!0,qr++;for(qr=0;qr<Ai.length;)R[Ai[qr].identifier]&&uo.push(Ai[qr]),Be&(Re|Nt)&&delete R[Ai[qr].identifier],qr++;if(!!uo.length)return[W(oi.concat(uo),"identifier",!0),uo]}var Kt=2500,rr=25;function Zr(){Pt.apply(this,arguments);var Ee=sr(this.handler,this);this.touch=new pt(this.manager,Ee),this.mouse=new St(this.manager,Ee),this.primaryTouch=null,this.lastTouches=[]}ft(Zr,Pt,{handler:function(Be,mt,R){var qr=R.pointerType==dn,oi=R.pointerType==Qi;if(!(oi&&R.sourceCapabilities&&R.sourceCapabilities.firesTouchEvents)){if(qr)Nn.call(this,mt,R);else if(oi&&tr.call(this,R))return;this.callback(Be,mt,R)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Nn(Ee,Be){Ee&Pe?(this.primaryTouch=Be.changedPointers[0].identifier,Bn.call(this,Be)):Ee&(Re|Nt)&&Bn.call(this,Be)}function Bn(Ee){var Be=Ee.changedPointers[0];if(Be.identifier===this.primaryTouch){var mt={x:Be.clientX,y:Be.clientY};this.lastTouches.push(mt);var R=this.lastTouches,qr=function(){var oi=R.indexOf(mt);oi>-1&&R.splice(oi,1)};setTimeout(qr,Kt)}}function tr(Ee){for(var Be=Ee.srcEvent.clientX,mt=Ee.srcEvent.clientY,R=0;R<this.lastTouches.length;R++){var qr=this.lastTouches[R],oi=Math.abs(Be-qr.x),Ai=Math.abs(mt-qr.y);if(oi<=rr&&Ai<=rr)return!0}return!1}var In=se($.style,"touchAction"),hn=In!==U,yn="compute",Ni="auto",Tn="manipulation",Di="none",ra="pan-x",hi="pan-y",na=ma();function Xi(Ee,Be){this.manager=Ee,this.set(Be)}Xi.prototype={set:function(Ee){Ee==yn&&(Ee=this.compute()),hn&&this.manager.element.style&&na[Ee]&&(this.manager.element.style[In]=Ee),this.actions=Ee.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ee=[];return zt(this.manager.recognizers,function(Be){re(Be.options.enable,[Be])&&(Ee=Ee.concat(Be.getTouchAction()))}),Ii(Ee.join(" "))},preventDefaults:function(Ee){var Be=Ee.srcEvent,mt=Ee.offsetDirection;if(this.manager.session.prevented){Be.preventDefault();return}var R=this.actions,qr=Ve(R,Di)&&!na[Di],oi=Ve(R,hi)&&!na[hi],Ai=Ve(R,ra)&&!na[ra];if(qr){var uo=Ee.pointers.length===1,Xa=Ee.distance<2,ja=Ee.deltaTime<250;if(uo&&Xa&&ja)return}if(!(Ai&&oi)&&(qr||oi&&mt&C||Ai&&mt&G))return this.preventSrc(Be)},preventSrc:function(Ee){this.manager.session.prevented=!0,Ee.preventDefault()}};function Ii(Ee){if(Ve(Ee,Di))return Di;var Be=Ve(Ee,ra),mt=Ve(Ee,hi);return Be&&mt?Di:Be||mt?Be?ra:hi:Ve(Ee,Tn)?Tn:Ni}function ma(){if(!hn)return!1;var Ee={},Be=b.CSS&&b.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(mt){Ee[mt]=Be?b.CSS.supports("touch-action",mt):!0}),Ee}var Da=1,Yi=2,zi=4,Ki=8,to=Ki,$o=16,Ba=32;function qi(Ee){this.options=Ht({},this.defaults,Ee||{}),this.id=_e(),this.manager=null,this.options.enable=nr(this.options.enable,!0),this.state=Da,this.simultaneous={},this.requireFail=[]}qi.prototype={defaults:{},set:function(Ee){return Ht(this.options,Ee),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ee){if($t(Ee,"recognizeWith",this))return this;var Be=this.simultaneous;return Ee=$i(Ee,this),Be[Ee.id]||(Be[Ee.id]=Ee,Ee.recognizeWith(this)),this},dropRecognizeWith:function(Ee){return $t(Ee,"dropRecognizeWith",this)?this:(Ee=$i(Ee,this),delete this.simultaneous[Ee.id],this)},requireFailure:function(Ee){if($t(Ee,"requireFailure",this))return this;var Be=this.requireFail;return Ee=$i(Ee,this),pr(Be,Ee)===-1&&(Be.push(Ee),Ee.requireFailure(this)),this},dropRequireFailure:function(Ee){if($t(Ee,"dropRequireFailure",this))return this;Ee=$i(Ee,this);var Be=pr(this.requireFail,Ee);return Be>-1&&this.requireFail.splice(Be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ee){return!!this.simultaneous[Ee.id]},emit:function(Ee){var Be=this,mt=this.state;function R(qr){Be.manager.emit(qr,Ee)}mt<Ki&&R(Be.options.event+su(mt)),R(Be.options.event),Ee.additionalEvent&&R(Ee.additionalEvent),mt>=Ki&&R(Be.options.event+su(mt))},tryEmit:function(Ee){if(this.canEmit())return this.emit(Ee);this.state=Ba},canEmit:function(){for(var Ee=0;Ee<this.requireFail.length;){if(!(this.requireFail[Ee].state&(Ba|Da)))return!1;Ee++}return!0},recognize:function(Ee){var Be=Ht({},Ee);if(!re(this.options.enable,[this,Be])){this.reset(),this.state=Ba;return}this.state&(to|$o|Ba)&&(this.state=Da),this.state=this.process(Be),this.state&(Yi|zi|Ki|$o)&&this.tryEmit(Be)},process:function(Ee){},getTouchAction:function(){},reset:function(){}};function su(Ee){return Ee&$o?"cancel":Ee&Ki?"end":Ee&zi?"move":Ee&Yi?"start":""}function Au(Ee){return Ee==Fr?"down":Ee==fr?"up":Ee==yr?"left":Ee==Lr?"right":""}function $i(Ee,Be){var mt=Be.manager;return mt?mt.get(Ee):Ee}function yo(){qi.apply(this,arguments)}ft(yo,qi,{defaults:{pointers:1},attrTest:function(Ee){var Be=this.options.pointers;return Be===0||Ee.pointers.length===Be},process:function(Ee){var Be=this.state,mt=Ee.eventType,R=Be&(Yi|zi),qr=this.attrTest(Ee);return R&&(mt&Nt||!qr)?Be|$o:R||qr?mt&Re?Be|Ki:Be&Yi?Be|zi:Yi:Ba}});function Ji(){yo.apply(this,arguments),this.pX=null,this.pY=null}ft(Ji,yo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ze},getTouchAction:function(){var Ee=this.options.direction,Be=[];return Ee&C&&Be.push(hi),Ee&G&&Be.push(ra),Be},directionTest:function(Ee){var Be=this.options,mt=!0,R=Ee.distance,qr=Ee.direction,oi=Ee.deltaX,Ai=Ee.deltaY;return qr&Be.direction||(Be.direction&C?(qr=oi===0?ar:oi<0?yr:Lr,mt=oi!=this.pX,R=Math.abs(Ee.deltaX)):(qr=Ai===0?ar:Ai<0?fr:Fr,mt=Ai!=this.pY,R=Math.abs(Ee.deltaY))),Ee.direction=qr,mt&&R>Be.threshold&&qr&Be.direction},attrTest:function(Ee){return yo.prototype.attrTest.call(this,Ee)&&(this.state&Yi||!(this.state&Yi)&&this.directionTest(Ee))},emit:function(Ee){this.pX=Ee.deltaX,this.pY=Ee.deltaY;var Be=Au(Ee.direction);Be&&(Ee.additionalEvent=this.options.event+Be),this._super.emit.call(this,Ee)}});function Wa(){yo.apply(this,arguments)}ft(Wa,yo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Di]},attrTest:function(Ee){return this._super.attrTest.call(this,Ee)&&(Math.abs(Ee.scale-1)>this.options.threshold||this.state&Yi)},emit:function(Ee){if(Ee.scale!==1){var Be=Ee.scale<1?"in":"out";Ee.additionalEvent=this.options.event+Be}this._super.emit.call(this,Ee)}});function Jo(){qi.apply(this,arguments),this._timer=null,this._input=null}ft(Jo,qi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ni]},process:function(Ee){var Be=this.options,mt=Ee.pointers.length===Be.pointers,R=Ee.distance<Be.threshold,qr=Ee.deltaTime>Be.time;if(this._input=Ee,!R||!mt||Ee.eventType&(Re|Nt)&&!qr)this.reset();else if(Ee.eventType&Pe)this.reset(),this._timer=rt(function(){this.state=to,this.tryEmit()},Be.time,this);else if(Ee.eventType&Re)return to;return Ba},reset:function(){clearTimeout(this._timer)},emit:function(Ee){this.state===to&&(Ee&&Ee.eventType&Re?this.manager.emit(this.options.event+"up",Ee):(this._input.timeStamp=Le(),this.manager.emit(this.options.event,this._input)))}});function ba(){yo.apply(this,arguments)}ft(ba,yo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Di]},attrTest:function(Ee){return this._super.attrTest.call(this,Ee)&&(Math.abs(Ee.rotation)>this.options.threshold||this.state&Yi)}});function Lo(){yo.apply(this,arguments)}ft(Lo,yo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:C|G,pointers:1},getTouchAction:function(){return Ji.prototype.getTouchAction.call(this)},attrTest:function(Ee){var Be=this.options.direction,mt;return Be&(C|G)?mt=Ee.overallVelocity:Be&C?mt=Ee.overallVelocityX:Be&G&&(mt=Ee.overallVelocityY),this._super.attrTest.call(this,Ee)&&Be&Ee.offsetDirection&&Ee.distance>this.options.threshold&&Ee.maxPointers==this.options.pointers&&Ie(mt)>this.options.velocity&&Ee.eventType&Re},emit:function(Ee){var Be=Au(Ee.offsetDirection);Be&&this.manager.emit(this.options.event+Be,Ee),this.manager.emit(this.options.event,Ee)}});function Ro(){qi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ft(Ro,qi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Tn]},process:function(Ee){var Be=this.options,mt=Ee.pointers.length===Be.pointers,R=Ee.distance<Be.threshold,qr=Ee.deltaTime<Be.time;if(this.reset(),Ee.eventType&Pe&&this.count===0)return this.failTimeout();if(R&&qr&&mt){if(Ee.eventType!=Re)return this.failTimeout();var oi=this.pTime?Ee.timeStamp-this.pTime<Be.interval:!0,Ai=!this.pCenter||Tr(this.pCenter,Ee.center)<Be.posThreshold;this.pTime=Ee.timeStamp,this.pCenter=Ee.center,!Ai||!oi?this.count=1:this.count+=1,this._input=Ee;var uo=this.count%Be.taps;if(uo===0)return this.hasRequireFailures()?(this._timer=rt(function(){this.state=to,this.tryEmit()},Be.interval,this),Yi):to}return Ba},failTimeout:function(){return this._timer=rt(function(){this.state=Ba},this.options.interval,this),Ba},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==to&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Rs(Ee,Be){return Be=Be||{},Be.recognizers=nr(Be.recognizers,Rs.defaults.preset),new ka(Ee,Be)}Rs.VERSION="2.0.7",Rs.defaults={domEvents:!1,touchAction:yn,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[Wa,{enable:!1},["rotate"]],[Lo,{direction:C}],[Ji,{direction:C},["swipe"]],[Ro],[Ro,{event:"doubletap",taps:2},["tap"]],[Jo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ho=1,Vo=2;function ka(Ee,Be){this.options=Ht({},Rs.defaults,Be||{}),this.options.inputTarget=this.options.inputTarget||Ee,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ee,this.input=q(this),this.touchAction=new Xi(this,this.options.touchAction),so(this,!0),zt(this.options.recognizers,function(mt){var R=this.add(new mt[0](mt[1]));mt[2]&&R.recognizeWith(mt[2]),mt[3]&&R.requireFailure(mt[3])},this)}ka.prototype={set:function(Ee){return Ht(this.options,Ee),Ee.touchAction&&this.touchAction.update(),Ee.inputTarget&&(this.input.destroy(),this.input.target=Ee.inputTarget,this.input.init()),this},stop:function(Ee){this.session.stopped=Ee?Vo:ho},recognize:function(Ee){var Be=this.session;if(!Be.stopped){this.touchAction.preventDefaults(Ee);var mt,R=this.recognizers,qr=Be.curRecognizer;(!qr||qr&&qr.state&to)&&(qr=Be.curRecognizer=null);for(var oi=0;oi<R.length;)mt=R[oi],Be.stopped!==Vo&&(!qr||mt==qr||mt.canRecognizeWith(qr))?mt.recognize(Ee):mt.reset(),!qr&&mt.state&(Yi|zi|Ki)&&(qr=Be.curRecognizer=mt),oi++}},get:function(Ee){if(Ee instanceof qi)return Ee;for(var Be=this.recognizers,mt=0;mt<Be.length;mt++)if(Be[mt].options.event==Ee)return Be[mt];return null},add:function(Ee){if($t(Ee,"add",this))return this;var Be=this.get(Ee.options.event);return Be&&this.remove(Be),this.recognizers.push(Ee),Ee.manager=this,this.touchAction.update(),Ee},remove:function(Ee){if($t(Ee,"remove",this))return this;if(Ee=this.get(Ee),Ee){var Be=this.recognizers,mt=pr(Be,Ee);mt!==-1&&(Be.splice(mt,1),this.touchAction.update())}return this},on:function(Ee,Be){if(Ee!==U&&Be!==U){var mt=this.handlers;return zt(Ot(Ee),function(R){mt[R]=mt[R]||[],mt[R].push(Be)}),this}},off:function(Ee,Be){if(Ee!==U){var mt=this.handlers;return zt(Ot(Ee),function(R){Be?mt[R]&&mt[R].splice(pr(mt[R],Be),1):delete mt[R]}),this}},emit:function(Ee,Be){this.options.domEvents&&as(Ee,Be);var mt=this.handlers[Ee]&&this.handlers[Ee].slice();if(!(!mt||!mt.length)){Be.type=Ee,Be.preventDefault=function(){Be.srcEvent.preventDefault()};for(var R=0;R<mt.length;)mt[R](Be),R++}},destroy:function(){this.element&&so(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function so(Ee,Be){var mt=Ee.element;if(!!mt.style){var R;zt(Ee.options.cssProps,function(qr,oi){R=se(mt.style,oi),Be?(Ee.oldCssProps[R]=mt.style[R],mt.style[R]=qr):mt.style[R]=Ee.oldCssProps[R]||""}),Be||(Ee.oldCssProps={})}}function as(Ee,Be){var mt=p.createEvent("Event");mt.initEvent(Ee,!0,!0),mt.gesture=Be,Be.target.dispatchEvent(mt)}Ht(Rs,{INPUT_START:Pe,INPUT_MOVE:Ge,INPUT_END:Re,INPUT_CANCEL:Nt,STATE_POSSIBLE:Da,STATE_BEGAN:Yi,STATE_CHANGED:zi,STATE_ENDED:Ki,STATE_RECOGNIZED:to,STATE_CANCELLED:$o,STATE_FAILED:Ba,DIRECTION_NONE:ar,DIRECTION_LEFT:yr,DIRECTION_RIGHT:Lr,DIRECTION_UP:fr,DIRECTION_DOWN:Fr,DIRECTION_HORIZONTAL:C,DIRECTION_VERTICAL:G,DIRECTION_ALL:Ze,Manager:ka,Input:Pt,TouchAction:Xi,TouchInput:pt,MouseInput:St,PointerEventInput:fe,TouchMouseInput:Zr,SingleTouchInput:de,Recognizer:qi,AttrRecognizer:yo,Tap:Ro,Pan:Ji,Swipe:Lo,Pinch:Wa,Rotate:ba,Press:Jo,on:Tt,off:$e,each:zt,merge:yt,extend:Ct,assign:Ht,inherit:ft,bindFn:sr,prefixed:se});var Do=typeof b!="undefined"?b:typeof self!="undefined"?self:{};Do.Hammer=Rs,z=function(){return Rs}.call(O,y,O,Qe),z!==U&&(Qe.exports=z)})(window,document,"Hammer")},7375:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var y=Symbol.for("INJECTION");function z(Y,$,he,Z){function Ie(){return Z&&!Reflect.hasMetadata(y,this,$)&&Reflect.defineMetadata(y,he(),this,$),Reflect.hasMetadata(y,this,$)?Reflect.getMetadata(y,this,$):he()}function Le(rt){Reflect.defineMetadata(y,rt,this,$)}Object.defineProperty(Y,$,{configurable:!0,enumerable:!0,get:Ie,set:Le})}function b(Y,$){return function(he){return function(Z,Ie){var Le=function(){return Y.get(he)};z(Z,Ie,Le,$)}}}O.makePropertyInjectDecorator=b;function p(Y,$){return function(he,Z){return function(Ie,Le){var rt=function(){return Y.getNamed(he,Z)};z(Ie,Le,rt,$)}}}O.makePropertyInjectNamedDecorator=p;function X(Y,$){return function(he,Z,Ie){return function(Le,rt){var $t=function(){return Y.getTagged(he,Z,Ie)};z(Le,rt,$t,$)}}}O.makePropertyInjectTaggedDecorator=X;function U(Y,$){return function(he){return function(Z,Ie){var Le=function(){return Y.getAll(he)};z(Z,Ie,Le,$)}}}O.makePropertyMultiInjectDecorator=U},84879:function(Qe,O,y){"use strict";var z;z={value:!0};var b=y(7375);function p(X,U){U===void 0&&(U=!0);var Y=b.makePropertyInjectDecorator(X,U),$=b.makePropertyInjectNamedDecorator(X,U),he=b.makePropertyInjectTaggedDecorator(X,U),Z=b.makePropertyMultiInjectDecorator(X,U);return{lazyInject:Y,lazyInjectNamed:$,lazyInjectTagged:he,lazyMultiInject:Z}}O.Z=p},99934:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagProperty=O.tagParameter=O.decorate=void 0;var z=y(16674),b=y(6867);function p(Z,Ie,Le,rt){var $t=b.TAGGED;U($t,Z,Ie,rt,Le)}O.tagParameter=p;function X(Z,Ie,Le){var rt=b.TAGGED_PROP;U(rt,Z.constructor,Ie,Le)}O.tagProperty=X;function U(Z,Ie,Le,rt,$t){var zt={},Lt=typeof $t=="number",Ht=$t!==void 0&&Lt?$t.toString():Le;if(Lt&&Le!==void 0)throw new Error(z.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(Z,Ie)&&(zt=Reflect.getMetadata(Z,Ie));var Ct=zt[Ht];if(!Array.isArray(Ct))Ct=[];else for(var yt=0,ft=Ct;yt<ft.length;yt++){var sr=ft[yt];if(sr.key===rt.key)throw new Error(z.DUPLICATED_METADATA+" "+sr.key.toString())}Ct.push(rt),zt[Ht]=Ct,Reflect.defineMetadata(Z,zt,Ie)}function Y(Z,Ie){Reflect.decorate(Z,Ie)}function $(Z,Ie){return function(Le,rt){Ie(Le,rt,Z)}}function he(Z,Ie,Le){typeof Le=="number"?Y([$(Le,Z)],Ie):typeof Le=="string"?Reflect.decorate([Z],Ie,Le):Y([Z],Ie)}O.decorate=he},5744:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.inject=O.LazyServiceIdentifer=void 0;var z=y(16674),b=y(6867),p=y(47738),X=y(99934),U=function(){function $(he){this._cb=he}return $.prototype.unwrap=function(){return this._cb()},$}();O.LazyServiceIdentifer=U;function Y($){return function(he,Z,Ie){if($===void 0)throw new Error(z.UNDEFINED_INJECT_ANNOTATION(he.name));var Le=new p.Metadata(b.INJECT_TAG,$);typeof Ie=="number"?X.tagParameter(he,Z,Ie,Le):X.tagProperty(he,Z,Le)}}O.inject=Y},64315:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.injectable=void 0;var z=y(16674),b=y(6867);function p(){return function(X){if(Reflect.hasOwnMetadata(b.PARAM_TYPES,X))throw new Error(z.DUPLICATED_INJECTABLE_DECORATOR);var U=Reflect.getMetadata(b.DESIGN_PARAM_TYPES,X)||[];return Reflect.defineMetadata(b.PARAM_TYPES,U,X),X}}O.injectable=p},71693:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiInject=void 0;var z=y(6867),b=y(47738),p=y(99934);function X(U){return function(Y,$,he){var Z=new b.Metadata(z.MULTI_INJECT_TAG,U);typeof he=="number"?p.tagParameter(Y,$,he,Z):p.tagProperty(Y,$,Z)}}O.multiInject=X},38085:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.named=void 0;var z=y(6867),b=y(47738),p=y(99934);function X(U){return function(Y,$,he){var Z=new b.Metadata(z.NAMED_TAG,U);typeof he=="number"?p.tagParameter(Y,$,he,Z):p.tagProperty(Y,$,Z)}}O.named=X},6515:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.optional=void 0;var z=y(6867),b=y(47738),p=y(99934);function X(){return function(U,Y,$){var he=new b.Metadata(z.OPTIONAL_TAG,!0);typeof $=="number"?p.tagParameter(U,Y,$,he):p.tagProperty(U,Y,he)}}O.optional=X},7014:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.postConstruct=void 0;var z=y(16674),b=y(6867),p=y(47738);function X(){return function(U,Y,$){var he=new p.Metadata(b.POST_CONSTRUCT,Y);if(Reflect.hasOwnMetadata(b.POST_CONSTRUCT,U.constructor))throw new Error(z.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(b.POST_CONSTRUCT,he,U.constructor)}}O.postConstruct=X},32052:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagged=void 0;var z=y(47738),b=y(99934);function p(X,U){return function(Y,$,he){var Z=new z.Metadata(X,U);typeof he=="number"?b.tagParameter(Y,$,he,Z):b.tagProperty(Y,$,Z)}}O.tagged=p},55638:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.targetName=void 0;var z=y(6867),b=y(47738),p=y(99934);function X(U){return function(Y,$,he){var Z=new b.Metadata(z.NAME_TAG,U);p.tagParameter(Y,$,he,Z)}}O.targetName=X},86757:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.unmanaged=void 0;var z=y(6867),b=y(47738),p=y(99934);function X(){return function(U,Y,$){var he=new b.Metadata(z.UNMANAGED_TAG,!0);p.tagParameter(U,Y,$,he)}}O.unmanaged=X},44290:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Binding=void 0;var z=y(28421),b=y(37791),p=function(){function X(U,Y){this.id=b.id(),this.activated=!1,this.serviceIdentifier=U,this.scope=Y,this.type=z.BindingTypeEnum.Invalid,this.constraint=function($){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return X.prototype.clone=function(){var U=new X(this.serviceIdentifier,this.scope);return U.activated=U.scope===z.BindingScopeEnum.Singleton?this.activated:!1,U.implementationType=this.implementationType,U.dynamicValue=this.dynamicValue,U.scope=this.scope,U.type=this.type,U.factory=this.factory,U.provider=this.provider,U.constraint=this.constraint,U.onActivation=this.onActivation,U.cache=this.cache,U},X}();O.Binding=p},23184:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingCount=void 0;var y={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};O.BindingCount=y},16674:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.STACK_OVERFLOW=O.CIRCULAR_DEPENDENCY_IN_FACTORY=O.POST_CONSTRUCT_ERROR=O.MULTIPLE_POST_CONSTRUCT_METHODS=O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=O.ARGUMENTS_LENGTH_MISMATCH=O.INVALID_DECORATOR_OPERATION=O.INVALID_TO_SELF_VALUE=O.INVALID_FUNCTION_BINDING=O.INVALID_MIDDLEWARE_RETURN=O.NO_MORE_SNAPSHOTS_AVAILABLE=O.INVALID_BINDING_TYPE=O.NOT_IMPLEMENTED=O.CIRCULAR_DEPENDENCY=O.UNDEFINED_INJECT_ANNOTATION=O.MISSING_INJECT_ANNOTATION=O.MISSING_INJECTABLE_ANNOTATION=O.NOT_REGISTERED=O.CANNOT_UNBIND=O.AMBIGUOUS_MATCH=O.KEY_NOT_FOUND=O.NULL_ARGUMENT=O.DUPLICATED_METADATA=O.DUPLICATED_INJECTABLE_DECORATOR=void 0,O.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",O.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",O.NULL_ARGUMENT="NULL argument",O.KEY_NOT_FOUND="Key Not Found",O.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",O.CANNOT_UNBIND="Could not unbind serviceIdentifier:",O.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",O.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",O.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var y=function(X){return"@inject called with undefined this could mean that the class "+X+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};O.UNDEFINED_INJECT_ANNOTATION=y,O.CIRCULAR_DEPENDENCY="Circular dependency found:",O.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",O.INVALID_BINDING_TYPE="Invalid binding type:",O.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",O.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",O.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",O.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",O.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var z=function(){for(var X=[],U=0;U<arguments.length;U++)X[U]=arguments[U];return"The number of constructor arguments in the derived class "+(X[0]+" must be >= than the number of constructor arguments of its base class.")};O.ARGUMENTS_LENGTH_MISMATCH=z,O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",O.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var b=function(){for(var X=[],U=0;U<arguments.length;U++)X[U]=arguments[U];return"@postConstruct error in class "+X[0]+": "+X[1]};O.POST_CONSTRUCT_ERROR=b;var p=function(){for(var X=[],U=0;U<arguments.length;U++)X[U]=arguments[U];return"It looks like there is a circular dependency "+("in one of the '"+X[0]+"' bindings. Please investigate bindings with")+("service identifier '"+X[1]+"'.")};O.CIRCULAR_DEPENDENCY_IN_FACTORY=p,O.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.TargetTypeEnum=O.BindingTypeEnum=O.BindingScopeEnum=void 0;var y={Request:"Request",Singleton:"Singleton",Transient:"Transient"};O.BindingScopeEnum=y;var z={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};O.BindingTypeEnum=z;var b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};O.TargetTypeEnum=b},6867:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NON_CUSTOM_TAG_KEYS=O.POST_CONSTRUCT=O.DESIGN_PARAM_TYPES=O.PARAM_TYPES=O.TAGGED_PROP=O.TAGGED=O.MULTI_INJECT_TAG=O.INJECT_TAG=O.OPTIONAL_TAG=O.UNMANAGED_TAG=O.NAME_TAG=O.NAMED_TAG=void 0,O.NAMED_TAG="named",O.NAME_TAG="name",O.UNMANAGED_TAG="unmanaged",O.OPTIONAL_TAG="optional",O.INJECT_TAG="inject",O.MULTI_INJECT_TAG="multi_inject",O.TAGGED="inversify:tagged",O.TAGGED_PROP="inversify:tagged_props",O.PARAM_TYPES="inversify:paramtypes",O.DESIGN_PARAM_TYPES="design:paramtypes",O.POST_CONSTRUCT="post_construct";function y(){return[O.INJECT_TAG,O.MULTI_INJECT_TAG,O.NAME_TAG,O.UNMANAGED_TAG,O.NAMED_TAG,O.OPTIONAL_TAG]}O.NON_CUSTOM_TAG_KEYS=y()},51389:function(Qe,O,y){"use strict";var z=this&&this.__awaiter||function(Ct,yt,ft,sr){function re(nr){return nr instanceof ft?nr:new ft(function(Tt){Tt(nr)})}return new(ft||(ft=Promise))(function(nr,Tt){function $e(Ot){try{Ve(sr.next(Ot))}catch(pr){Tt(pr)}}function Mt(Ot){try{Ve(sr.throw(Ot))}catch(pr){Tt(pr)}}function Ve(Ot){Ot.done?nr(Ot.value):re(Ot.value).then($e,Mt)}Ve((sr=sr.apply(Ct,yt||[])).next())})},b=this&&this.__generator||function(Ct,yt){var ft={label:0,sent:function(){if(nr[0]&1)throw nr[1];return nr[1]},trys:[],ops:[]},sr,re,nr,Tt;return Tt={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(Tt[Symbol.iterator]=function(){return this}),Tt;function $e(Ve){return function(Ot){return Mt([Ve,Ot])}}function Mt(Ve){if(sr)throw new TypeError("Generator is already executing.");for(;ft;)try{if(sr=1,re&&(nr=Ve[0]&2?re.return:Ve[0]?re.throw||((nr=re.return)&&nr.call(re),0):re.next)&&!(nr=nr.call(re,Ve[1])).done)return nr;switch(re=0,nr&&(Ve=[Ve[0]&2,nr.value]),Ve[0]){case 0:case 1:nr=Ve;break;case 4:return ft.label++,{value:Ve[1],done:!1};case 5:ft.label++,re=Ve[1],Ve=[0];continue;case 7:Ve=ft.ops.pop(),ft.trys.pop();continue;default:if(nr=ft.trys,!(nr=nr.length>0&&nr[nr.length-1])&&(Ve[0]===6||Ve[0]===2)){ft=0;continue}if(Ve[0]===3&&(!nr||Ve[1]>nr[0]&&Ve[1]<nr[3])){ft.label=Ve[1];break}if(Ve[0]===6&&ft.label<nr[1]){ft.label=nr[1],nr=Ve;break}if(nr&&ft.label<nr[2]){ft.label=nr[2],ft.ops.push(Ve);break}nr[2]&&ft.ops.pop(),ft.trys.pop();continue}Ve=yt.call(Ct,ft)}catch(Ot){Ve=[6,Ot],re=0}finally{sr=nr=0}if(Ve[0]&5)throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Ct,yt){for(var ft=0,sr=yt.length,re=Ct.length;ft<sr;ft++,re++)Ct[re]=yt[ft];return Ct};Object.defineProperty(O,"__esModule",{value:!0}),O.Container=void 0;var X=y(44290),U=y(16674),Y=y(28421),$=y(6867),he=y(51377),Z=y(86311),Ie=y(31927),Le=y(15451),rt=y(37791),$t=y(55800),zt=y(85700),Lt=y(80175),Ht=function(){function Ct(yt){this._appliedMiddleware=[];var ft=yt||{};if(typeof ft!="object")throw new Error(""+U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(ft.defaultScope===void 0)ft.defaultScope=Y.BindingScopeEnum.Transient;else if(ft.defaultScope!==Y.BindingScopeEnum.Singleton&&ft.defaultScope!==Y.BindingScopeEnum.Transient&&ft.defaultScope!==Y.BindingScopeEnum.Request)throw new Error(""+U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(ft.autoBindInjectable===void 0)ft.autoBindInjectable=!1;else if(typeof ft.autoBindInjectable!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(ft.skipBaseClassChecks===void 0)ft.skipBaseClassChecks=!1;else if(typeof ft.skipBaseClassChecks!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:ft.autoBindInjectable,defaultScope:ft.defaultScope,skipBaseClassChecks:ft.skipBaseClassChecks},this.id=rt.id(),this._bindingDictionary=new Lt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new he.MetadataReader}return Ct.merge=function(yt,ft){for(var sr=[],re=2;re<arguments.length;re++)sr[re-2]=arguments[re];var nr=new Ct,Tt=p([yt,ft],sr).map(function(Ve){return Z.getBindingDictionary(Ve)}),$e=Z.getBindingDictionary(nr);function Mt(Ve,Ot){Ve.traverse(function(pr,qt){qt.forEach(function(W){Ot.add(W.serviceIdentifier,W.clone())})})}return Tt.forEach(function(Ve){Mt(Ve,$e)}),nr},Ct.prototype.load=function(){for(var yt=[],ft=0;ft<arguments.length;ft++)yt[ft]=arguments[ft];for(var sr=this._getContainerModuleHelpersFactory(),re=0,nr=yt;re<nr.length;re++){var Tt=nr[re],$e=sr(Tt.id);Tt.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)}},Ct.prototype.loadAsync=function(){for(var yt=[],ft=0;ft<arguments.length;ft++)yt[ft]=arguments[ft];return z(this,void 0,void 0,function(){var sr,re,nr,Tt,$e;return b(this,function(Mt){switch(Mt.label){case 0:sr=this._getContainerModuleHelpersFactory(),re=0,nr=yt,Mt.label=1;case 1:return re<nr.length?(Tt=nr[re],$e=sr(Tt.id),[4,Tt.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)]):[3,4];case 2:Mt.sent(),Mt.label=3;case 3:return re++,[3,1];case 4:return[2]}})})},Ct.prototype.unload=function(){for(var yt=this,ft=[],sr=0;sr<arguments.length;sr++)ft[sr]=arguments[sr];var re=function(nr){return function(Tt){return Tt.moduleId===nr}};ft.forEach(function(nr){var Tt=re(nr.id);yt._bindingDictionary.removeByCondition(Tt)})},Ct.prototype.bind=function(yt){var ft=this.options.defaultScope||Y.BindingScopeEnum.Transient,sr=new X.Binding(yt,ft);return this._bindingDictionary.add(yt,sr),new Le.BindingToSyntax(sr)},Ct.prototype.rebind=function(yt){return this.unbind(yt),this.bind(yt)},Ct.prototype.unbind=function(yt){try{this._bindingDictionary.remove(yt)}catch(ft){throw new Error(U.CANNOT_UNBIND+" "+$t.getServiceIdentifierAsString(yt))}},Ct.prototype.unbindAll=function(){this._bindingDictionary=new Lt.Lookup},Ct.prototype.isBound=function(yt){var ft=this._bindingDictionary.hasKey(yt);return!ft&&this.parent&&(ft=this.parent.isBound(yt)),ft},Ct.prototype.isBoundNamed=function(yt,ft){return this.isBoundTagged(yt,$.NAMED_TAG,ft)},Ct.prototype.isBoundTagged=function(yt,ft,sr){var re=!1;if(this._bindingDictionary.hasKey(yt)){var nr=this._bindingDictionary.get(yt),Tt=Z.createMockRequest(this,yt,ft,sr);re=nr.some(function($e){return $e.constraint(Tt)})}return!re&&this.parent&&(re=this.parent.isBoundTagged(yt,ft,sr)),re},Ct.prototype.snapshot=function(){this._snapshots.push(zt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ct.prototype.restore=function(){var yt=this._snapshots.pop();if(yt===void 0)throw new Error(U.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=yt.bindings,this._middleware=yt.middleware},Ct.prototype.createChild=function(yt){var ft=new Ct(yt||this.options);return ft.parent=this,ft},Ct.prototype.applyMiddleware=function(){for(var yt=[],ft=0;ft<arguments.length;ft++)yt[ft]=arguments[ft];this._appliedMiddleware=this._appliedMiddleware.concat(yt);var sr=this._middleware?this._middleware:this._planAndResolve();this._middleware=yt.reduce(function(re,nr){return nr(re)},sr)},Ct.prototype.applyCustomMetadataReader=function(yt){this._metadataReader=yt},Ct.prototype.get=function(yt){return this._get(!1,!1,Y.TargetTypeEnum.Variable,yt)},Ct.prototype.getTagged=function(yt,ft,sr){return this._get(!1,!1,Y.TargetTypeEnum.Variable,yt,ft,sr)},Ct.prototype.getNamed=function(yt,ft){return this.getTagged(yt,$.NAMED_TAG,ft)},Ct.prototype.getAll=function(yt){return this._get(!0,!0,Y.TargetTypeEnum.Variable,yt)},Ct.prototype.getAllTagged=function(yt,ft,sr){return this._get(!1,!0,Y.TargetTypeEnum.Variable,yt,ft,sr)},Ct.prototype.getAllNamed=function(yt,ft){return this.getAllTagged(yt,$.NAMED_TAG,ft)},Ct.prototype.resolve=function(yt){var ft=this.createChild();return ft.bind(yt).toSelf(),this._appliedMiddleware.forEach(function(sr){ft.applyMiddleware(sr)}),ft.get(yt)},Ct.prototype._getContainerModuleHelpersFactory=function(){var yt=this,ft=function($e,Mt){$e._binding.moduleId=Mt},sr=function($e){return function(Mt){var Ve=yt.bind.bind(yt),Ot=Ve(Mt);return ft(Ot,$e),Ot}},re=function($e){return function(Mt){var Ve=yt.unbind.bind(yt);Ve(Mt)}},nr=function($e){return function(Mt){var Ve=yt.isBound.bind(yt);return Ve(Mt)}},Tt=function($e){return function(Mt){var Ve=yt.rebind.bind(yt),Ot=Ve(Mt);return ft(Ot,$e),Ot}};return function($e){return{bindFunction:sr($e),isboundFunction:nr($e),rebindFunction:Tt($e),unbindFunction:re($e)}}},Ct.prototype._get=function(yt,ft,sr,re,nr,Tt){var $e=null,Mt={avoidConstraints:yt,contextInterceptor:function(Ve){return Ve},isMultiInject:ft,key:nr,serviceIdentifier:re,targetType:sr,value:Tt};if(this._middleware){if($e=this._middleware(Mt),$e==null)throw new Error(U.INVALID_MIDDLEWARE_RETURN)}else $e=this._planAndResolve()(Mt);return $e},Ct.prototype._planAndResolve=function(){var yt=this;return function(ft){var sr=Z.plan(yt._metadataReader,yt,ft.isMultiInject,ft.targetType,ft.serviceIdentifier,ft.key,ft.value,ft.avoidConstraints);sr=ft.contextInterceptor(sr);var re=Ie.resolve(sr);return re}},Ct}();O.Container=Ht},33244:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.AsyncContainerModule=O.ContainerModule=void 0;var z=y(37791),b=function(){function X(U){this.id=z.id(),this.registry=U}return X}();O.ContainerModule=b;var p=function(){function X(U){this.id=z.id(),this.registry=U}return X}();O.AsyncContainerModule=p},85700:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ContainerSnapshot=void 0;var y=function(){function z(){}return z.of=function(b,p){var X=new z;return X.bindings=b,X.middleware=p,X},z}();O.ContainerSnapshot=y},80175:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Lookup=void 0;var z=y(16674),b=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(X,U){if(X==null)throw new Error(z.NULL_ARGUMENT);if(U==null)throw new Error(z.NULL_ARGUMENT);var Y=this._map.get(X);Y!==void 0?(Y.push(U),this._map.set(X,Y)):this._map.set(X,[U])},p.prototype.get=function(X){if(X==null)throw new Error(z.NULL_ARGUMENT);var U=this._map.get(X);if(U!==void 0)return U;throw new Error(z.KEY_NOT_FOUND)},p.prototype.remove=function(X){if(X==null)throw new Error(z.NULL_ARGUMENT);if(!this._map.delete(X))throw new Error(z.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(X){var U=this;this._map.forEach(function(Y,$){var he=Y.filter(function(Z){return!X(Z)});he.length>0?U._map.set($,he):U._map.delete($)})},p.prototype.hasKey=function(X){if(X==null)throw new Error(z.NULL_ARGUMENT);return this._map.has(X)},p.prototype.clone=function(){var X=new p;return this._map.forEach(function(U,Y){U.forEach(function($){return X.add(Y,$.clone())})}),X},p.prototype.traverse=function(X){this._map.forEach(function(U,Y){X(Y,U)})},p}();O.Lookup=b},86700:function(Qe,O,y){"use strict";var z;z={value:!0},z=z=z=z=z=z=O.GW=z=z=O.zY=z=z=z=z=z=O.f3=z=z=O.b2=z=z=z=z=z=O.W2=z=void 0;var b=y(6867);z=b;var p=y(51389);Object.defineProperty(O,"W2",{enumerable:!0,get:function(){return p.Container}});var X=y(28421);z={enumerable:!0,get:function(){return X.BindingScopeEnum}},z={enumerable:!0,get:function(){return X.BindingTypeEnum}},z={enumerable:!0,get:function(){return X.TargetTypeEnum}};var U=y(33244);z={enumerable:!0,get:function(){return U.AsyncContainerModule}},z={enumerable:!0,get:function(){return U.ContainerModule}};var Y=y(64315);Object.defineProperty(O,"b2",{enumerable:!0,get:function(){return Y.injectable}});var $=y(32052);z={enumerable:!0,get:function(){return $.tagged}};var he=y(38085);z={enumerable:!0,get:function(){return he.named}};var Z=y(5744);Object.defineProperty(O,"f3",{enumerable:!0,get:function(){return Z.inject}}),z={enumerable:!0,get:function(){return Z.LazyServiceIdentifer}};var Ie=y(6515);z={enumerable:!0,get:function(){return Ie.optional}};var Le=y(86757);z={enumerable:!0,get:function(){return Le.unmanaged}};var rt=y(71693);z={enumerable:!0,get:function(){return rt.multiInject}};var $t=y(55638);z={enumerable:!0,get:function(){return $t.targetName}};var zt=y(7014);Object.defineProperty(O,"zY",{enumerable:!0,get:function(){return zt.postConstruct}});var Lt=y(51377);z={enumerable:!0,get:function(){return Lt.MetadataReader}};var Ht=y(37791);z={enumerable:!0,get:function(){return Ht.id}};var Ct=y(99934);Object.defineProperty(O,"GW",{enumerable:!0,get:function(){return Ct.decorate}});var yt=y(80758);z={enumerable:!0,get:function(){return yt.traverseAncerstors}},z={enumerable:!0,get:function(){return yt.taggedConstraint}},z={enumerable:!0,get:function(){return yt.namedConstraint}},z={enumerable:!0,get:function(){return yt.typeConstraint}};var ft=y(55800);z={enumerable:!0,get:function(){return ft.getServiceIdentifierAsString}};var sr=y(70600);z={enumerable:!0,get:function(){return sr.multiBindToService}}},95228:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Context=void 0;var z=y(37791),b=function(){function p(X){this.id=z.id(),this.container=X}return p.prototype.addPlan=function(X){this.plan=X},p.prototype.setCurrentRequest=function(X){this.currentRequest=X},p}();O.Context=b},47738:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Metadata=void 0;var z=y(6867),b=function(){function p(X,U){this.key=X,this.value=U}return p.prototype.toString=function(){return this.key===z.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();O.Metadata=b},51377:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.MetadataReader=void 0;var z=y(6867),b=function(){function p(){}return p.prototype.getConstructorMetadata=function(X){var U=Reflect.getMetadata(z.PARAM_TYPES,X),Y=Reflect.getMetadata(z.TAGGED,X);return{compilerGeneratedMetadata:U,userGeneratedMetadata:Y||{}}},p.prototype.getPropertiesMetadata=function(X){var U=Reflect.getMetadata(z.TAGGED_PROP,X)||[];return U},p}();O.MetadataReader=b},55314:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Plan=void 0;var y=function(){function z(b,p){this.parentContext=b,this.rootRequest=p}return z}();O.Plan=y},86311:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getBindingDictionary=O.createMockRequest=O.plan=void 0;var z=y(23184),b=y(16674),p=y(28421),X=y(6867),U=y(85265),Y=y(55800),$=y(95228),he=y(47738),Z=y(55314),Ie=y(6e3),Le=y(6748),rt=y(18924);function $t(re){return re._bindingDictionary}O.getBindingDictionary=$t;function zt(re,nr,Tt,$e,Mt,Ve){var Ot=re?X.MULTI_INJECT_TAG:X.INJECT_TAG,pr=new he.Metadata(Ot,Tt),qt=new rt.Target(nr,$e,Tt,pr);if(Mt!==void 0){var W=new he.Metadata(Mt,Ve);qt.metadata.push(W)}return qt}function Lt(re,nr,Tt,$e,Mt){var Ve=yt(Tt.container,Mt.serviceIdentifier),Ot=[];return Ve.length===z.BindingCount.NoBindingsAvailable&&Tt.container.options.autoBindInjectable&&typeof Mt.serviceIdentifier=="function"&&re.getConstructorMetadata(Mt.serviceIdentifier).compilerGeneratedMetadata&&(Tt.container.bind(Mt.serviceIdentifier).toSelf(),Ve=yt(Tt.container,Mt.serviceIdentifier)),nr?Ot=Ve:Ot=Ve.filter(function(pr){var qt=new Le.Request(pr.serviceIdentifier,Tt,$e,pr,Mt);return pr.constraint(qt)}),Ht(Mt.serviceIdentifier,Ot,Mt,Tt.container),Ot}function Ht(re,nr,Tt,$e){switch(nr.length){case z.BindingCount.NoBindingsAvailable:if(Tt.isOptional())return nr;var Mt=Y.getServiceIdentifierAsString(re),Ve=b.NOT_REGISTERED;throw Ve+=Y.listMetadataForTarget(Mt,Tt),Ve+=Y.listRegisteredBindingsForServiceIdentifier($e,Mt,yt),new Error(Ve);case z.BindingCount.OnlyOneBindingAvailable:if(!Tt.isArray())return nr;case z.BindingCount.MultipleBindingsAvailable:default:if(Tt.isArray())return nr;var Mt=Y.getServiceIdentifierAsString(re),Ve=b.AMBIGUOUS_MATCH+" "+Mt;throw Ve+=Y.listRegisteredBindingsForServiceIdentifier($e,Mt,yt),new Error(Ve)}}function Ct(re,nr,Tt,$e,Mt,Ve){var Ot,pr;if(Mt===null){Ot=Lt(re,nr,$e,null,Ve),pr=new Le.Request(Tt,$e,null,Ot,Ve);var qt=new Z.Plan($e,pr);$e.addPlan(qt)}else Ot=Lt(re,nr,$e,Mt,Ve),pr=Mt.addChildRequest(Ve.serviceIdentifier,Ot,Ve);Ot.forEach(function(W){var se=null;if(Ve.isArray())se=pr.addChildRequest(W.serviceIdentifier,W,Ve);else{if(W.cache)return;se=pr}if(W.type===p.BindingTypeEnum.Instance&&W.implementationType!==null){var ke=Ie.getDependencies(re,W.implementationType);if(!$e.container.options.skipBaseClassChecks){var _e=Ie.getBaseClassDependencyCount(re,W.implementationType);if(ke.length<_e){var Et=b.ARGUMENTS_LENGTH_MISMATCH(Ie.getFunctionName(W.implementationType));throw new Error(Et)}}ke.forEach(function(gt){Ct(re,!1,gt.serviceIdentifier,$e,se,gt)})}})}function yt(re,nr){var Tt=[],$e=$t(re);return $e.hasKey(nr)?Tt=$e.get(nr):re.parent!==null&&(Tt=yt(re.parent,nr)),Tt}function ft(re,nr,Tt,$e,Mt,Ve,Ot,pr){pr===void 0&&(pr=!1);var qt=new $.Context(nr),W=zt(Tt,$e,Mt,"",Ve,Ot);try{return Ct(re,pr,Mt,qt,null,W),qt}catch(se){throw U.isStackOverflowExeption(se)&&qt.plan&&Y.circularDependencyToException(qt.plan.rootRequest),se}}O.plan=ft;function sr(re,nr,Tt,$e){var Mt=new rt.Target(p.TargetTypeEnum.Variable,"",nr,new he.Metadata(Tt,$e)),Ve=new $.Context(re),Ot=new Le.Request(nr,Ve,null,[],Mt);return Ot}O.createMockRequest=sr},88460:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.QueryableString=void 0;var y=function(){function z(b){this.str=b}return z.prototype.startsWith=function(b){return this.str.indexOf(b)===0},z.prototype.endsWith=function(b){var p="",X=b.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},X)},z.prototype.contains=function(b){return this.str.indexOf(b)!==-1},z.prototype.equals=function(b){return this.str===b},z.prototype.value=function(){return this.str},z}();O.QueryableString=y},6e3:function(Qe,O,y){"use strict";var z=this&&this.__spreadArray||function(Lt,Ht){for(var Ct=0,yt=Ht.length,ft=Lt.length;Ct<yt;Ct++,ft++)Lt[ft]=Ht[Ct];return Lt};Object.defineProperty(O,"__esModule",{value:!0}),O.getFunctionName=O.getBaseClassDependencyCount=O.getDependencies=void 0;var b=y(5744),p=y(16674),X=y(28421),U=y(6867),Y=y(55800);Object.defineProperty(O,"getFunctionName",{enumerable:!0,get:function(){return Y.getFunctionName}});var $=y(18924);function he(Lt,Ht){var Ct=Y.getFunctionName(Ht),yt=Z(Lt,Ct,Ht,!1);return yt}O.getDependencies=he;function Z(Lt,Ht,Ct,yt){var ft=Lt.getConstructorMetadata(Ct),sr=ft.compilerGeneratedMetadata;if(sr===void 0){var re=p.MISSING_INJECTABLE_ANNOTATION+" "+Ht+".";throw new Error(re)}var nr=ft.userGeneratedMetadata,Tt=Object.keys(nr),$e=Ct.length===0&&Tt.length>0,Mt=Tt.length>Ct.length,Ve=$e||Mt?Tt.length:Ct.length,Ot=Le(yt,Ht,sr,nr,Ve),pr=rt(Lt,Ct),qt=z(z([],Ot),pr);return qt}function Ie(Lt,Ht,Ct,yt,ft){var sr=ft[Lt.toString()]||[],re=zt(sr),nr=re.unmanaged!==!0,Tt=yt[Lt],$e=re.inject||re.multiInject;if(Tt=$e||Tt,Tt instanceof b.LazyServiceIdentifer&&(Tt=Tt.unwrap()),nr){var Mt=Tt===Object,Ve=Tt===Function,Ot=Tt===void 0,pr=Mt||Ve||Ot;if(!Ht&&pr){var qt=p.MISSING_INJECT_ANNOTATION+" argument "+Lt+" in class "+Ct+".";throw new Error(qt)}var W=new $.Target(X.TargetTypeEnum.ConstructorArgument,re.targetName,Tt);return W.metadata=sr,W}return null}function Le(Lt,Ht,Ct,yt,ft){for(var sr=[],re=0;re<ft;re++){var nr=re,Tt=Ie(nr,Lt,Ht,Ct,yt);Tt!==null&&sr.push(Tt)}return sr}function rt(Lt,Ht){for(var Ct=Lt.getPropertiesMetadata(Ht),yt=[],ft=Object.keys(Ct),sr=0,re=ft;sr<re.length;sr++){var nr=re[sr],Tt=Ct[nr],$e=zt(Ct[nr]),Mt=$e.targetName||nr,Ve=$e.inject||$e.multiInject,Ot=new $.Target(X.TargetTypeEnum.ClassProperty,Mt,Ve);Ot.metadata=Tt,yt.push(Ot)}var pr=Object.getPrototypeOf(Ht.prototype).constructor;if(pr!==Object){var qt=rt(Lt,pr);yt=z(z([],yt),qt)}return yt}function $t(Lt,Ht){var Ct=Object.getPrototypeOf(Ht.prototype).constructor;if(Ct!==Object){var yt=Y.getFunctionName(Ct),ft=Z(Lt,yt,Ct,!0),sr=ft.map(function(Tt){return Tt.metadata.filter(function($e){return $e.key===U.UNMANAGED_TAG})}),re=[].concat.apply([],sr).length,nr=ft.length-re;return nr>0?nr:$t(Lt,Ct)}else return 0}O.getBaseClassDependencyCount=$t;function zt(Lt){var Ht={};return Lt.forEach(function(Ct){Ht[Ct.key.toString()]=Ct.value}),{inject:Ht[U.INJECT_TAG],multiInject:Ht[U.MULTI_INJECT_TAG],targetName:Ht[U.NAME_TAG],unmanaged:Ht[U.UNMANAGED_TAG]}}},6748:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Request=void 0;var z=y(37791),b=function(){function p(X,U,Y,$,he){this.id=z.id(),this.serviceIdentifier=X,this.parentContext=U,this.parentRequest=Y,this.target=he,this.childRequests=[],this.bindings=Array.isArray($)?$:[$],this.requestScope=Y===null?new Map:null}return p.prototype.addChildRequest=function(X,U,Y){var $=new p(X,this.parentContext,this,U,Y);return this.childRequests.push($),$},p}();O.Request=b},18924:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Target=void 0;var z=y(6867),b=y(37791),p=y(47738),X=y(88460),U=function(){function Y($,he,Z,Ie){this.id=b.id(),this.type=$,this.serviceIdentifier=Z,this.name=new X.QueryableString(he||""),this.metadata=new Array;var Le=null;typeof Ie=="string"?Le=new p.Metadata(z.NAMED_TAG,Ie):Ie instanceof p.Metadata&&(Le=Ie),Le!==null&&this.metadata.push(Le)}return Y.prototype.hasTag=function($){for(var he=0,Z=this.metadata;he<Z.length;he++){var Ie=Z[he];if(Ie.key===$)return!0}return!1},Y.prototype.isArray=function(){return this.hasTag(z.MULTI_INJECT_TAG)},Y.prototype.matchesArray=function($){return this.matchesTag(z.MULTI_INJECT_TAG)($)},Y.prototype.isNamed=function(){return this.hasTag(z.NAMED_TAG)},Y.prototype.isTagged=function(){return this.metadata.some(function($){return z.NON_CUSTOM_TAG_KEYS.every(function(he){return $.key!==he})})},Y.prototype.isOptional=function(){return this.matchesTag(z.OPTIONAL_TAG)(!0)},Y.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function($){return $.key===z.NAMED_TAG})[0]:null},Y.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function($){return z.NON_CUSTOM_TAG_KEYS.every(function(he){return $.key!==he})}):null},Y.prototype.matchesNamedTag=function($){return this.matchesTag(z.NAMED_TAG)($)},Y.prototype.matchesTag=function($){var he=this;return function(Z){for(var Ie=0,Le=he.metadata;Ie<Le.length;Ie++){var rt=Le[Ie];if(rt.key===$&&rt.value===Z)return!0}return!1}},Y}();O.Target=U},52279:function(Qe,O,y){"use strict";var z=this&&this.__spreadArray||function(Z,Ie){for(var Le=0,rt=Ie.length,$t=Z.length;Le<rt;Le++,$t++)Z[$t]=Ie[Le];return Z};Object.defineProperty(O,"__esModule",{value:!0}),O.resolveInstance=void 0;var b=y(16674),p=y(28421),X=y(6867);function U(Z,Ie,Le){var rt=Ie.filter(function(zt){return zt.target!==null&&zt.target.type===p.TargetTypeEnum.ClassProperty}),$t=rt.map(Le);return rt.forEach(function(zt,Lt){var Ht="";Ht=zt.target.name.value();var Ct=$t[Lt];Z[Ht]=Ct}),Z}function Y(Z,Ie){return new(Z.bind.apply(Z,z([void 0],Ie)))}function $(Z,Ie){if(Reflect.hasMetadata(X.POST_CONSTRUCT,Z)){var Le=Reflect.getMetadata(X.POST_CONSTRUCT,Z);try{Ie[Le.value]()}catch(rt){throw new Error(b.POST_CONSTRUCT_ERROR(Z.name,rt.message))}}}function he(Z,Ie,Le){var rt=null;if(Ie.length>0){var $t=Ie.filter(function(Lt){return Lt.target!==null&&Lt.target.type===p.TargetTypeEnum.ConstructorArgument}),zt=$t.map(Le);rt=Y(Z,zt),rt=U(rt,Ie,Le)}else rt=new Z;return $(Z,rt),rt}O.resolveInstance=he},31927:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.resolve=void 0;var z=y(16674),b=y(28421),p=y(85265),X=y(55800),U=y(52279),Y=function(Z,Ie,Le){try{return Le()}catch(rt){throw p.isStackOverflowExeption(rt)?new Error(z.CIRCULAR_DEPENDENCY_IN_FACTORY(Z,Ie.toString())):rt}},$=function(Z){return function(Ie){Ie.parentContext.setCurrentRequest(Ie);var Le=Ie.bindings,rt=Ie.childRequests,$t=Ie.target&&Ie.target.isArray(),zt=!Ie.parentRequest||!Ie.parentRequest.target||!Ie.target||!Ie.parentRequest.target.matchesArray(Ie.target.serviceIdentifier);if($t&&zt)return rt.map(function(sr){var re=$(Z);return re(sr)});var Lt=null;if(Ie.target.isOptional()&&Le.length===0)return;var Ht=Le[0],Ct=Ht.scope===b.BindingScopeEnum.Singleton,yt=Ht.scope===b.BindingScopeEnum.Request;if(Ct&&Ht.activated)return Ht.cache;if(yt&&Z!==null&&Z.has(Ht.id))return Z.get(Ht.id);if(Ht.type===b.BindingTypeEnum.ConstantValue)Lt=Ht.cache,Ht.activated=!0;else if(Ht.type===b.BindingTypeEnum.Function)Lt=Ht.cache,Ht.activated=!0;else if(Ht.type===b.BindingTypeEnum.Constructor)Lt=Ht.implementationType;else if(Ht.type===b.BindingTypeEnum.DynamicValue&&Ht.dynamicValue!==null)Lt=Y("toDynamicValue",Ht.serviceIdentifier,function(){return Ht.dynamicValue(Ie.parentContext)});else if(Ht.type===b.BindingTypeEnum.Factory&&Ht.factory!==null)Lt=Y("toFactory",Ht.serviceIdentifier,function(){return Ht.factory(Ie.parentContext)});else if(Ht.type===b.BindingTypeEnum.Provider&&Ht.provider!==null)Lt=Y("toProvider",Ht.serviceIdentifier,function(){return Ht.provider(Ie.parentContext)});else if(Ht.type===b.BindingTypeEnum.Instance&&Ht.implementationType!==null)Lt=U.resolveInstance(Ht.implementationType,rt,$(Z));else{var ft=X.getServiceIdentifierAsString(Ie.serviceIdentifier);throw new Error(z.INVALID_BINDING_TYPE+" "+ft)}return typeof Ht.onActivation=="function"&&(Lt=Ht.onActivation(Ie.parentContext,Lt)),Ct&&(Ht.cache=Lt,Ht.activated=!0),yt&&Z!==null&&!Z.has(Ht.id)&&Z.set(Ht.id,Lt),Lt}};function he(Z){var Ie=$(Z.plan.rootRequest.requestScope);return Ie(Z.plan.rootRequest)}O.resolve=he},83366:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInSyntax=void 0;var z=y(28421),b=y(71325),p=function(){function X(U){this._binding=U}return X.prototype.inRequestScope=function(){return this._binding.scope=z.BindingScopeEnum.Request,new b.BindingWhenOnSyntax(this._binding)},X.prototype.inSingletonScope=function(){return this._binding.scope=z.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},X.prototype.inTransientScope=function(){return this._binding.scope=z.BindingScopeEnum.Transient,new b.BindingWhenOnSyntax(this._binding)},X}();O.BindingInSyntax=p},74889:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInWhenOnSyntax=void 0;var z=y(83366),b=y(51811),p=y(98370),X=function(){function U(Y){this._binding=Y,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new b.BindingOnSyntax(this._binding),this._bindingInSyntax=new z.BindingInSyntax(Y)}return U.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},U.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},U.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},U.prototype.when=function(Y){return this._bindingWhenSyntax.when(Y)},U.prototype.whenTargetNamed=function(Y){return this._bindingWhenSyntax.whenTargetNamed(Y)},U.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},U.prototype.whenTargetTagged=function(Y,$){return this._bindingWhenSyntax.whenTargetTagged(Y,$)},U.prototype.whenInjectedInto=function(Y){return this._bindingWhenSyntax.whenInjectedInto(Y)},U.prototype.whenParentNamed=function(Y){return this._bindingWhenSyntax.whenParentNamed(Y)},U.prototype.whenParentTagged=function(Y,$){return this._bindingWhenSyntax.whenParentTagged(Y,$)},U.prototype.whenAnyAncestorIs=function(Y){return this._bindingWhenSyntax.whenAnyAncestorIs(Y)},U.prototype.whenNoAncestorIs=function(Y){return this._bindingWhenSyntax.whenNoAncestorIs(Y)},U.prototype.whenAnyAncestorNamed=function(Y){return this._bindingWhenSyntax.whenAnyAncestorNamed(Y)},U.prototype.whenAnyAncestorTagged=function(Y,$){return this._bindingWhenSyntax.whenAnyAncestorTagged(Y,$)},U.prototype.whenNoAncestorNamed=function(Y){return this._bindingWhenSyntax.whenNoAncestorNamed(Y)},U.prototype.whenNoAncestorTagged=function(Y,$){return this._bindingWhenSyntax.whenNoAncestorTagged(Y,$)},U.prototype.whenAnyAncestorMatches=function(Y){return this._bindingWhenSyntax.whenAnyAncestorMatches(Y)},U.prototype.whenNoAncestorMatches=function(Y){return this._bindingWhenSyntax.whenNoAncestorMatches(Y)},U.prototype.onActivation=function(Y){return this._bindingOnSyntax.onActivation(Y)},U}();O.BindingInWhenOnSyntax=X},51811:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingOnSyntax=void 0;var z=y(98370),b=function(){function p(X){this._binding=X}return p.prototype.onActivation=function(X){return this._binding.onActivation=X,new z.BindingWhenSyntax(this._binding)},p}();O.BindingOnSyntax=b},15451:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingToSyntax=void 0;var z=y(16674),b=y(28421),p=y(74889),X=y(71325),U=function(){function Y($){this._binding=$}return Y.prototype.to=function($){return this._binding.type=b.BindingTypeEnum.Instance,this._binding.implementationType=$,new p.BindingInWhenOnSyntax(this._binding)},Y.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+z.INVALID_TO_SELF_VALUE);var $=this._binding.serviceIdentifier;return this.to($)},Y.prototype.toConstantValue=function($){return this._binding.type=b.BindingTypeEnum.ConstantValue,this._binding.cache=$,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b.BindingScopeEnum.Singleton,new X.BindingWhenOnSyntax(this._binding)},Y.prototype.toDynamicValue=function($){return this._binding.type=b.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=$,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},Y.prototype.toConstructor=function($){return this._binding.type=b.BindingTypeEnum.Constructor,this._binding.implementationType=$,this._binding.scope=b.BindingScopeEnum.Singleton,new X.BindingWhenOnSyntax(this._binding)},Y.prototype.toFactory=function($){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=$,this._binding.scope=b.BindingScopeEnum.Singleton,new X.BindingWhenOnSyntax(this._binding)},Y.prototype.toFunction=function($){if(typeof $!="function")throw new Error(z.INVALID_FUNCTION_BINDING);var he=this.toConstantValue($);return this._binding.type=b.BindingTypeEnum.Function,this._binding.scope=b.BindingScopeEnum.Singleton,he},Y.prototype.toAutoFactory=function($){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=function(he){var Z=function(){return he.container.get($)};return Z},this._binding.scope=b.BindingScopeEnum.Singleton,new X.BindingWhenOnSyntax(this._binding)},Y.prototype.toProvider=function($){return this._binding.type=b.BindingTypeEnum.Provider,this._binding.provider=$,this._binding.scope=b.BindingScopeEnum.Singleton,new X.BindingWhenOnSyntax(this._binding)},Y.prototype.toService=function($){this.toDynamicValue(function(he){return he.container.get($)})},Y}();O.BindingToSyntax=U},71325:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenOnSyntax=void 0;var z=y(51811),b=y(98370),p=function(){function X(U){this._binding=U,this._bindingWhenSyntax=new b.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new z.BindingOnSyntax(this._binding)}return X.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},X.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},X.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},X.prototype.whenTargetTagged=function(U,Y){return this._bindingWhenSyntax.whenTargetTagged(U,Y)},X.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},X.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},X.prototype.whenParentTagged=function(U,Y){return this._bindingWhenSyntax.whenParentTagged(U,Y)},X.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},X.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},X.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},X.prototype.whenAnyAncestorTagged=function(U,Y){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,Y)},X.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},X.prototype.whenNoAncestorTagged=function(U,Y){return this._bindingWhenSyntax.whenNoAncestorTagged(U,Y)},X.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},X.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},X.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},X}();O.BindingWhenOnSyntax=p},98370:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenSyntax=void 0;var z=y(51811),b=y(80758),p=function(){function X(U){this._binding=U}return X.prototype.when=function(U){return this._binding.constraint=U,new z.BindingOnSyntax(this._binding)},X.prototype.whenTargetNamed=function(U){return this._binding.constraint=b.namedConstraint(U),new z.BindingOnSyntax(this._binding)},X.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(U){var Y=U.target!==null&&!U.target.isNamed()&&!U.target.isTagged();return Y},new z.BindingOnSyntax(this._binding)},X.prototype.whenTargetTagged=function(U,Y){return this._binding.constraint=b.taggedConstraint(U)(Y),new z.BindingOnSyntax(this._binding)},X.prototype.whenInjectedInto=function(U){return this._binding.constraint=function(Y){return b.typeConstraint(U)(Y.parentRequest)},new z.BindingOnSyntax(this._binding)},X.prototype.whenParentNamed=function(U){return this._binding.constraint=function(Y){return b.namedConstraint(U)(Y.parentRequest)},new z.BindingOnSyntax(this._binding)},X.prototype.whenParentTagged=function(U,Y){return this._binding.constraint=function($){return b.taggedConstraint(U)(Y)($.parentRequest)},new z.BindingOnSyntax(this._binding)},X.prototype.whenAnyAncestorIs=function(U){return this._binding.constraint=function(Y){return b.traverseAncerstors(Y,b.typeConstraint(U))},new z.BindingOnSyntax(this._binding)},X.prototype.whenNoAncestorIs=function(U){return this._binding.constraint=function(Y){return!b.traverseAncerstors(Y,b.typeConstraint(U))},new z.BindingOnSyntax(this._binding)},X.prototype.whenAnyAncestorNamed=function(U){return this._binding.constraint=function(Y){return b.traverseAncerstors(Y,b.namedConstraint(U))},new z.BindingOnSyntax(this._binding)},X.prototype.whenNoAncestorNamed=function(U){return this._binding.constraint=function(Y){return!b.traverseAncerstors(Y,b.namedConstraint(U))},new z.BindingOnSyntax(this._binding)},X.prototype.whenAnyAncestorTagged=function(U,Y){return this._binding.constraint=function($){return b.traverseAncerstors($,b.taggedConstraint(U)(Y))},new z.BindingOnSyntax(this._binding)},X.prototype.whenNoAncestorTagged=function(U,Y){return this._binding.constraint=function($){return!b.traverseAncerstors($,b.taggedConstraint(U)(Y))},new z.BindingOnSyntax(this._binding)},X.prototype.whenAnyAncestorMatches=function(U){return this._binding.constraint=function(Y){return b.traverseAncerstors(Y,U)},new z.BindingOnSyntax(this._binding)},X.prototype.whenNoAncestorMatches=function(U){return this._binding.constraint=function(Y){return!b.traverseAncerstors(Y,U)},new z.BindingOnSyntax(this._binding)},X}();O.BindingWhenSyntax=p},80758:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.typeConstraint=O.namedConstraint=O.taggedConstraint=O.traverseAncerstors=void 0;var z=y(6867),b=y(47738),p=function($,he){var Z=$.parentRequest;return Z!==null?he(Z)?!0:p(Z,he):!1};O.traverseAncerstors=p;var X=function($){return function(he){var Z=function(Ie){return Ie!==null&&Ie.target!==null&&Ie.target.matchesTag($)(he)};return Z.metaData=new b.Metadata($,he),Z}};O.taggedConstraint=X;var U=X(z.NAMED_TAG);O.namedConstraint=U;var Y=function($){return function(he){var Z=null;if(he!==null)if(Z=he.bindings[0],typeof $=="string"){var Ie=Z.serviceIdentifier;return Ie===$}else{var Le=he.bindings[0].implementationType;return $===Le}return!1}};O.typeConstraint=Y},70600:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiBindToService=void 0;var y=function(z){return function(b){return function(){for(var p=[],X=0;X<arguments.length;X++)p[X]=arguments[X];return p.forEach(function(U){return z.bind(U).toService(b)})}}};O.multiBindToService=y},85265:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.isStackOverflowExeption=void 0;var z=y(16674);function b(p){return p instanceof RangeError||p.message===z.STACK_OVERFLOW}O.isStackOverflowExeption=b},37791:function(Qe,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.id=void 0;var y=0;function z(){return y++}O.id=z},55800:function(Qe,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.circularDependencyToException=O.listMetadataForTarget=O.listRegisteredBindingsForServiceIdentifier=O.getServiceIdentifierAsString=O.getFunctionName=void 0;var z=y(16674);function b(Z){if(typeof Z=="function"){var Ie=Z;return Ie.name}else{if(typeof Z=="symbol")return Z.toString();var Ie=Z;return Ie}}O.getServiceIdentifierAsString=b;function p(Z,Ie,Le){var rt="",$t=Le(Z,Ie);return $t.length!==0&&(rt=`
Registered bindings:`,$t.forEach(function(zt){var Lt="Object";zt.implementationType!==null&&(Lt=he(zt.implementationType)),rt=rt+`
 `+Lt,zt.constraint.metaData&&(rt=rt+" - "+zt.constraint.metaData)})),rt}O.listRegisteredBindingsForServiceIdentifier=p;function X(Z,Ie){return Z.parentRequest===null?!1:Z.parentRequest.serviceIdentifier===Ie?!0:X(Z.parentRequest,Ie)}function U(Z){function Ie(rt,$t){$t===void 0&&($t=[]);var zt=b(rt.serviceIdentifier);return $t.push(zt),rt.parentRequest!==null?Ie(rt.parentRequest,$t):$t}var Le=Ie(Z);return Le.reverse().join(" --> ")}function Y(Z){Z.childRequests.forEach(function(Ie){if(X(Ie,Ie.serviceIdentifier)){var Le=U(Ie);throw new Error(z.CIRCULAR_DEPENDENCY+" "+Le)}else Y(Ie)})}O.circularDependencyToException=Y;function $(Z,Ie){if(Ie.isTagged()||Ie.isNamed()){var Le="",rt=Ie.getNamedTag(),$t=Ie.getCustomTags();return rt!==null&&(Le+=rt.toString()+`
`),$t!==null&&$t.forEach(function(zt){Le+=zt.toString()+`
`})," "+Z+`
 `+Z+" - "+Le}else return" "+Z}O.listMetadataForTarget=$;function he(Z){if(Z.name)return Z.name;var Ie=Z.toString(),Le=Ie.match(/^function\s*([^\s(]+)/);return Le?Le[1]:"Anonymous function: "+Ie}O.getFunctionName=he},18857:function(Qe,O,y){"use strict";y.r(O),y.d(O,{Function:function(){return Us},Interpreter:function(){return Co},default:function(){return yl},evaluate:function(){return Lu},vm:function(){return z}});var z={};y.r(z),y.d(z,{Script:function(){return gl},compileFunction:function(){return ml},createContext:function(){return vl},runInContext:function(){return $u},runInNewContext:function(){return Jl}});var b={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",X={5:p,"5module":p+" export import",6:p+" const class extends export import super"},U=/^in(stanceof)?$/,Y="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",$="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",he=new RegExp("["+Y+"]"),Z=new RegExp("["+Y+$+"]");Y=$=null;var Ie=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Le=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function rt(m,w){for(var j=65536,I=0;I<w.length;I+=2){if(j+=w[I],j>m)return!1;if(j+=w[I+1],j>=m)return!0}}function $t(m,w){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&he.test(String.fromCharCode(m)):w===!1?!1:rt(m,Ie)}function zt(m,w){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&Z.test(String.fromCharCode(m)):w===!1?!1:rt(m,Ie)||rt(m,Le)}var Lt=function(w,j){j===void 0&&(j={}),this.label=w,this.keyword=j.keyword,this.beforeExpr=!!j.beforeExpr,this.startsExpr=!!j.startsExpr,this.isLoop=!!j.isLoop,this.isAssign=!!j.isAssign,this.prefix=!!j.prefix,this.postfix=!!j.postfix,this.binop=j.binop||null,this.updateContext=null};function Ht(m,w){return new Lt(m,{beforeExpr:!0,binop:w})}var Ct={beforeExpr:!0},yt={startsExpr:!0},ft={};function sr(m,w){return w===void 0&&(w={}),w.keyword=m,ft[m]=new Lt(m,w)}var re={num:new Lt("num",yt),regexp:new Lt("regexp",yt),string:new Lt("string",yt),name:new Lt("name",yt),eof:new Lt("eof"),bracketL:new Lt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Lt("]"),braceL:new Lt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Lt("}"),parenL:new Lt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Lt(")"),comma:new Lt(",",Ct),semi:new Lt(";",Ct),colon:new Lt(":",Ct),dot:new Lt("."),question:new Lt("?",Ct),questionDot:new Lt("?."),arrow:new Lt("=>",Ct),template:new Lt("template"),invalidTemplate:new Lt("invalidTemplate"),ellipsis:new Lt("...",Ct),backQuote:new Lt("`",yt),dollarBraceL:new Lt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Lt("=",{beforeExpr:!0,isAssign:!0}),assign:new Lt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Lt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Lt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Ht("||",1),logicalAND:Ht("&&",2),bitwiseOR:Ht("|",3),bitwiseXOR:Ht("^",4),bitwiseAND:Ht("&",5),equality:Ht("==/!=/===/!==",6),relational:Ht("</>/<=/>=",7),bitShift:Ht("<</>>/>>>",8),plusMin:new Lt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Ht("%",10),star:Ht("*",10),slash:Ht("/",10),starstar:new Lt("**",{beforeExpr:!0}),coalesce:Ht("??",1),_break:sr("break"),_case:sr("case",Ct),_catch:sr("catch"),_continue:sr("continue"),_debugger:sr("debugger"),_default:sr("default",Ct),_do:sr("do",{isLoop:!0,beforeExpr:!0}),_else:sr("else",Ct),_finally:sr("finally"),_for:sr("for",{isLoop:!0}),_function:sr("function",yt),_if:sr("if"),_return:sr("return",Ct),_switch:sr("switch"),_throw:sr("throw",Ct),_try:sr("try"),_var:sr("var"),_const:sr("const"),_while:sr("while",{isLoop:!0}),_with:sr("with"),_new:sr("new",{beforeExpr:!0,startsExpr:!0}),_this:sr("this",yt),_super:sr("super",yt),_class:sr("class",yt),_extends:sr("extends",Ct),_export:sr("export"),_import:sr("import",yt),_null:sr("null",yt),_true:sr("true",yt),_false:sr("false",yt),_in:sr("in",{beforeExpr:!0,binop:7}),_instanceof:sr("instanceof",{beforeExpr:!0,binop:7}),_typeof:sr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:sr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:sr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},nr=/\r\n?|\n|\u2028|\u2029/,Tt=new RegExp(nr.source,"g");function $e(m,w){return m===10||m===13||!w&&(m===8232||m===8233)}var Mt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ve=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ot=Object.prototype,pr=Ot.hasOwnProperty,qt=Ot.toString;function W(m,w){return pr.call(m,w)}var se=Array.isArray||function(m){return qt.call(m)==="[object Array]"};function ke(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var _e=function(w,j){this.line=w,this.column=j};_e.prototype.offset=function(w){return new _e(this.line,this.column+w)};var Et=function(w,j,I){this.start=j,this.end=I,w.sourceFile!==null&&(this.source=w.sourceFile)};function gt(m,w){for(var j=1,I=0;;){Tt.lastIndex=I;var pe=Tt.exec(m);if(pe&&pe.index<w)++j,I=pe.index+pe[0].length;else return new _e(j,w-I)}}var jt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ut(m){var w={};for(var j in jt)w[j]=m&&W(m,j)?m[j]:jt[j];if(w.ecmaVersion>=2015&&(w.ecmaVersion-=2009),w.allowReserved==null&&(w.allowReserved=w.ecmaVersion<5),se(w.onToken)){var I=w.onToken;w.onToken=function(pe){return I.push(pe)}}return se(w.onComment)&&(w.onComment=zr(w,w.onComment)),w}function zr(m,w){return function(j,I,pe,De,ht,Vt){var Wt={type:j?"Block":"Line",value:I,start:pe,end:De};m.locations&&(Wt.loc=new Et(this,ht,Vt)),m.ranges&&(Wt.range=[pe,De]),w.push(Wt)}}var dn=1,_n=2,Qi=dn|_n,ur=4,ge=8,Pe=16,Ge=32,Re=64,Nt=128;function ar(m,w){return _n|(m?ur:0)|(w?ge:0)}var yr=0,Lr=1,fr=2,Fr=3,C=4,G=5,Ze=function(w,j,I){this.options=w=Ut(w),this.sourceFile=w.sourceFile,this.keywords=ke(X[w.ecmaVersion>=6?6:w.sourceType==="module"?"5module":5]);var pe="";if(w.allowReserved!==!0){for(var De=w.ecmaVersion;!(pe=b[De]);De--);w.sourceType==="module"&&(pe+=" await")}this.reservedWords=ke(pe);var ht=(pe?pe+" ":"")+b.strict;this.reservedWordsStrict=ke(ht),this.reservedWordsStrictBind=ke(ht+" "+b.strictBind),this.input=String(j),this.containsEsc=!1,I?(this.pos=I,this.lineStart=this.input.lastIndexOf(`
`,I-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(nr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=re.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=w.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&w.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(dn),this.regexpState=null},tt={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ze.prototype.parse=function(){var w=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(w)},tt.inFunction.get=function(){return(this.currentVarScope().flags&_n)>0},tt.inGenerator.get=function(){return(this.currentVarScope().flags&ge)>0},tt.inAsync.get=function(){return(this.currentVarScope().flags&ur)>0},tt.allowSuper.get=function(){return(this.currentThisScope().flags&Re)>0},tt.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Nt)>0},tt.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ze.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&_n)>0},Ze.extend=function(){for(var w=[],j=arguments.length;j--;)w[j]=arguments[j];for(var I=this,pe=0;pe<w.length;pe++)I=w[pe](I);return I},Ze.parse=function(w,j){return new this(j,w).parse()},Ze.parseExpressionAt=function(w,j,I){var pe=new this(I,w,j);return pe.nextToken(),pe.parseExpression()},Ze.tokenizer=function(w,j){return new this(j,w)},Object.defineProperties(Ze.prototype,tt);var lt=Ze.prototype,Pt=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;lt.strictDirective=function(m){for(;;){Ve.lastIndex=m,m+=Ve.exec(this.input)[0].length;var w=Pt.exec(this.input.slice(m));if(!w)return!1;if((w[1]||w[2])==="use strict"){Ve.lastIndex=m+w[0].length;var j=Ve.exec(this.input),I=j.index+j[0].length,pe=this.input.charAt(I);return pe===";"||pe==="}"||nr.test(j[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(pe)||pe==="!"&&this.input.charAt(I+1)==="=")}m+=w[0].length,Ve.lastIndex=m,m+=Ve.exec(this.input)[0].length,this.input[m]===";"&&m++}},lt.eat=function(m){return this.type===m?(this.next(),!0):!1},lt.isContextual=function(m){return this.type===re.name&&this.value===m&&!this.containsEsc},lt.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},lt.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},lt.canInsertSemicolon=function(){return this.type===re.eof||this.type===re.braceR||nr.test(this.input.slice(this.lastTokEnd,this.start))},lt.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},lt.semicolon=function(){!this.eat(re.semi)&&!this.insertSemicolon()&&this.unexpected()},lt.afterTrailingComma=function(m,w){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),w||this.next(),!0},lt.expect=function(m){this.eat(m)||this.unexpected()},lt.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function q(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}lt.checkPatternErrors=function(m,w){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var j=w?m.parenthesizedAssign:m.parenthesizedBind;j>-1&&this.raiseRecoverable(j,"Parenthesized pattern")}},lt.checkExpressionErrors=function(m,w){if(!m)return!1;var j=m.shorthandAssign,I=m.doubleProto;if(!w)return j>=0||I>=0;j>=0&&this.raise(j,"Shorthand property assignments are valid only in destructuring patterns"),I>=0&&this.raiseRecoverable(I,"Redefinition of __proto__ property")},lt.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},lt.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var kt=Ze.prototype;kt.parseTopLevel=function(m){var w={};for(m.body||(m.body=[]);this.type!==re.eof;){var j=this.parseStatement(null,!0,w);m.body.push(j)}if(this.inModule)for(var I=0,pe=Object.keys(this.undefinedExports);I<pe.length;I+=1){var De=pe[I];this.raiseRecoverable(this.undefinedExports[De].start,"Export '"+De+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Er={kind:"loop"},Mr={kind:"switch"};kt.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ve.lastIndex=this.pos;var w=Ve.exec(this.input),j=this.pos+w[0].length,I=this.input.charCodeAt(j);if(I===91)return!0;if(m)return!1;if(I===123)return!0;if($t(I,!0)){for(var pe=j+1;zt(this.input.charCodeAt(pe),!0);)++pe;var De=this.input.slice(j,pe);if(!U.test(De))return!0}return!1},kt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ve.lastIndex=this.pos;var m=Ve.exec(this.input),w=this.pos+m[0].length;return!nr.test(this.input.slice(this.pos,w))&&this.input.slice(w,w+8)==="function"&&(w+8===this.input.length||!zt(this.input.charAt(w+8)))},kt.parseStatement=function(m,w,j){var I=this.type,pe=this.startNode(),De;switch(this.isLet(m)&&(I=re._var,De="let"),I){case re._break:case re._continue:return this.parseBreakContinueStatement(pe,I.keyword);case re._debugger:return this.parseDebuggerStatement(pe);case re._do:return this.parseDoStatement(pe);case re._for:return this.parseForStatement(pe);case re._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(pe,!1,!m);case re._class:return m&&this.unexpected(),this.parseClass(pe,!0);case re._if:return this.parseIfStatement(pe);case re._return:return this.parseReturnStatement(pe);case re._switch:return this.parseSwitchStatement(pe);case re._throw:return this.parseThrowStatement(pe);case re._try:return this.parseTryStatement(pe);case re._const:case re._var:return De=De||this.value,m&&De!=="var"&&this.unexpected(),this.parseVarStatement(pe,De);case re._while:return this.parseWhileStatement(pe);case re._with:return this.parseWithStatement(pe);case re.braceL:return this.parseBlock(!0,pe);case re.semi:return this.parseEmptyStatement(pe);case re._export:case re._import:if(this.options.ecmaVersion>10&&I===re._import){Ve.lastIndex=this.pos;var ht=Ve.exec(this.input),Vt=this.pos+ht[0].length,Wt=this.input.charCodeAt(Vt);if(Wt===40||Wt===46)return this.parseExpressionStatement(pe,this.parseExpression())}return this.options.allowImportExportEverywhere||(w||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),I===re._import?this.parseImport(pe):this.parseExport(pe,j);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(pe,!0,!m);var kr=this.value,Kr=this.parseExpression();return I===re.name&&Kr.type==="Identifier"&&this.eat(re.colon)?this.parseLabeledStatement(pe,kr,Kr,m):this.parseExpressionStatement(pe,Kr)}},kt.parseBreakContinueStatement=function(m,w){var j=w==="break";this.next(),this.eat(re.semi)||this.insertSemicolon()?m.label=null:this.type!==re.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var I=0;I<this.labels.length;++I){var pe=this.labels[I];if((m.label==null||pe.name===m.label.name)&&(pe.kind!=null&&(j||pe.kind==="loop")||m.label&&j))break}return I===this.labels.length&&this.raise(m.start,"Unsyntactic "+w),this.finishNode(m,j?"BreakStatement":"ContinueStatement")},kt.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},kt.parseDoStatement=function(m){return this.next(),this.labels.push(Er),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(re._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(re.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},kt.parseForStatement=function(m){this.next();var w=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Er),this.enterScope(0),this.expect(re.parenL),this.type===re.semi)return w>-1&&this.unexpected(w),this.parseFor(m,null);var j=this.isLet();if(this.type===re._var||this.type===re._const||j){var I=this.startNode(),pe=j?"let":this.value;return this.next(),this.parseVar(I,!0,pe),this.finishNode(I,"VariableDeclaration"),(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&I.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===re._in?w>-1&&this.unexpected(w):m.await=w>-1),this.parseForIn(m,I)):(w>-1&&this.unexpected(w),this.parseFor(m,I))}var De=new q,ht=this.parseExpression(!0,De);return this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===re._in?w>-1&&this.unexpected(w):m.await=w>-1),this.toAssignable(ht,!1,De),this.checkLVal(ht),this.parseForIn(m,ht)):(this.checkExpressionErrors(De,!0),w>-1&&this.unexpected(w),this.parseFor(m,ht))},kt.parseFunctionStatement=function(m,w,j){return this.next(),this.parseFunction(m,ct|(j?0:It),!1,w)},kt.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(re._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},kt.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(re.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},kt.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(re.braceL),this.labels.push(Mr),this.enterScope(0);for(var w,j=!1;this.type!==re.braceR;)if(this.type===re._case||this.type===re._default){var I=this.type===re._case;w&&this.finishNode(w,"SwitchCase"),m.cases.push(w=this.startNode()),w.consequent=[],this.next(),I?w.test=this.parseExpression():(j&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),j=!0,w.test=null),this.expect(re.colon)}else w||this.unexpected(),w.consequent.push(this.parseStatement(null));return this.exitScope(),w&&this.finishNode(w,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},kt.parseThrowStatement=function(m){return this.next(),nr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var Je=[];kt.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===re._catch){var w=this.startNode();if(this.next(),this.eat(re.parenL)){w.param=this.parseBindingAtom();var j=w.param.type==="Identifier";this.enterScope(j?Ge:0),this.checkLVal(w.param,j?C:fr),this.expect(re.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),w.param=null,this.enterScope(0);w.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(w,"CatchClause")}return m.finalizer=this.eat(re._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},kt.parseVarStatement=function(m,w){return this.next(),this.parseVar(m,!1,w),this.semicolon(),this.finishNode(m,"VariableDeclaration")},kt.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Er),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},kt.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},kt.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},kt.parseLabeledStatement=function(m,w,j,I){for(var pe=0,De=this.labels;pe<De.length;pe+=1){var ht=De[pe];ht.name===w&&this.raise(j.start,"Label '"+w+"' is already declared")}for(var Vt=this.type.isLoop?"loop":this.type===re._switch?"switch":null,Wt=this.labels.length-1;Wt>=0;Wt--){var kr=this.labels[Wt];if(kr.statementStart===m.start)kr.statementStart=this.start,kr.kind=Vt;else break}return this.labels.push({name:w,kind:Vt,statementStart:this.start}),m.body=this.parseStatement(I?I.indexOf("label")===-1?I+"label":I:"label"),this.labels.pop(),m.label=j,this.finishNode(m,"LabeledStatement")},kt.parseExpressionStatement=function(m,w){return m.expression=w,this.semicolon(),this.finishNode(m,"ExpressionStatement")},kt.parseBlock=function(m,w,j){for(m===void 0&&(m=!0),w===void 0&&(w=this.startNode()),w.body=[],this.expect(re.braceL),m&&this.enterScope(0);this.type!==re.braceR;){var I=this.parseStatement(null);w.body.push(I)}return j&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(w,"BlockStatement")},kt.parseFor=function(m,w){return m.init=w,this.expect(re.semi),m.test=this.type===re.semi?null:this.parseExpression(),this.expect(re.semi),m.update=this.type===re.parenR?null:this.parseExpression(),this.expect(re.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},kt.parseForIn=function(m,w){var j=this.type===re._in;return this.next(),w.type==="VariableDeclaration"&&w.declarations[0].init!=null&&(!j||this.options.ecmaVersion<8||this.strict||w.kind!=="var"||w.declarations[0].id.type!=="Identifier")?this.raise(w.start,(j?"for-in":"for-of")+" loop variable declaration may not have an initializer"):w.type==="AssignmentPattern"&&this.raise(w.start,"Invalid left-hand side in for-loop"),m.left=w,m.right=j?this.parseExpression():this.parseMaybeAssign(),this.expect(re.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,j?"ForInStatement":"ForOfStatement")},kt.parseVar=function(m,w,j){for(m.declarations=[],m.kind=j;;){var I=this.startNode();if(this.parseVarId(I,j),this.eat(re.eq)?I.init=this.parseMaybeAssign(w):j==="const"&&!(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():I.id.type!=="Identifier"&&!(w&&(this.type===re._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):I.init=null,m.declarations.push(this.finishNode(I,"VariableDeclarator")),!this.eat(re.comma))break}return m},kt.parseVarId=function(m,w){m.id=this.parseBindingAtom(),this.checkLVal(m.id,w==="var"?Lr:fr,!1)};var ct=1,It=2,Bt=4;kt.parseFunction=function(m,w,j,I){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!I)&&(this.type===re.star&&w&It&&this.unexpected(),m.generator=this.eat(re.star)),this.options.ecmaVersion>=8&&(m.async=!!I),w&ct&&(m.id=w&Bt&&this.type!==re.name?null:this.parseIdent(),m.id&&!(w&It)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Lr:fr:Fr));var pe=this.yieldPos,De=this.awaitPos,ht=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ar(m.async,m.generator)),w&ct||(m.id=this.type===re.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,j,!1),this.yieldPos=pe,this.awaitPos=De,this.awaitIdentPos=ht,this.finishNode(m,w&ct?"FunctionDeclaration":"FunctionExpression")},kt.parseFunctionParams=function(m){this.expect(re.parenL),m.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},kt.parseClass=function(m,w){this.next();var j=this.strict;this.strict=!0,this.parseClassId(m,w),this.parseClassSuper(m);var I=this.startNode(),pe=!1;for(I.body=[],this.expect(re.braceL);this.type!==re.braceR;){var De=this.parseClassElement(m.superClass!==null);De&&(I.body.push(De),De.type==="MethodDefinition"&&De.kind==="constructor"&&(pe&&this.raise(De.start,"Duplicate constructor in the same class"),pe=!0))}return this.strict=j,this.next(),m.body=this.finishNode(I,"ClassBody"),this.finishNode(m,w?"ClassDeclaration":"ClassExpression")},kt.parseClassElement=function(m){var w=this;if(this.eat(re.semi))return null;var j=this.startNode(),I=function(Wt,kr){kr===void 0&&(kr=!1);var Kr=w.start,cn=w.startLoc;return w.eatContextual(Wt)?w.type!==re.parenL&&(!kr||!w.canInsertSemicolon())?!0:(j.key&&w.unexpected(),j.computed=!1,j.key=w.startNodeAt(Kr,cn),j.key.name=Wt,w.finishNode(j.key,"Identifier"),!1):!1};j.kind="method",j.static=I("static");var pe=this.eat(re.star),De=!1;pe||(this.options.ecmaVersion>=8&&I("async",!0)?(De=!0,pe=this.options.ecmaVersion>=9&&this.eat(re.star)):I("get")?j.kind="get":I("set")&&(j.kind="set")),j.key||this.parsePropertyName(j);var ht=j.key,Vt=!1;return!j.computed&&!j.static&&(ht.type==="Identifier"&&ht.name==="constructor"||ht.type==="Literal"&&ht.value==="constructor")?(j.kind!=="method"&&this.raise(ht.start,"Constructor can't have get/set modifier"),pe&&this.raise(ht.start,"Constructor can't be a generator"),De&&this.raise(ht.start,"Constructor can't be an async method"),j.kind="constructor",Vt=m):j.static&&ht.type==="Identifier"&&ht.name==="prototype"&&this.raise(ht.start,"Classes may not have a static property named prototype"),this.parseClassMethod(j,pe,De,Vt),j.kind==="get"&&j.value.params.length!==0&&this.raiseRecoverable(j.value.start,"getter should have no params"),j.kind==="set"&&j.value.params.length!==1&&this.raiseRecoverable(j.value.start,"setter should have exactly one param"),j.kind==="set"&&j.value.params[0].type==="RestElement"&&this.raiseRecoverable(j.value.params[0].start,"Setter cannot use rest params"),j},kt.parseClassMethod=function(m,w,j,I){return m.value=this.parseMethod(w,j,I),this.finishNode(m,"MethodDefinition")},kt.parseClassId=function(m,w){this.type===re.name?(m.id=this.parseIdent(),w&&this.checkLVal(m.id,fr,!1)):(w===!0&&this.unexpected(),m.id=null)},kt.parseClassSuper=function(m){m.superClass=this.eat(re._extends)?this.parseExprSubscripts():null},kt.parseExport=function(m,w){if(this.next(),this.eat(re.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(w,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==re.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(re._default)){this.checkExport(w,"default",this.lastTokStart);var j;if(this.type===re._function||(j=this.isAsyncFunction())){var I=this.startNode();this.next(),j&&this.next(),m.declaration=this.parseFunction(I,ct|Bt,!1,j)}else if(this.type===re._class){var pe=this.startNode();m.declaration=this.parseClass(pe,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(w,m.declaration.declarations):this.checkExport(w,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(w),this.eatContextual("from"))this.type!==re.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var De=0,ht=m.specifiers;De<ht.length;De+=1){var Vt=ht[De];this.checkUnreserved(Vt.local),this.checkLocalExport(Vt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},kt.checkExport=function(m,w,j){!m||(W(m,w)&&this.raiseRecoverable(j,"Duplicate export '"+w+"'"),m[w]=!0)},kt.checkPatternExport=function(m,w){var j=w.type;if(j==="Identifier")this.checkExport(m,w.name,w.start);else if(j==="ObjectPattern")for(var I=0,pe=w.properties;I<pe.length;I+=1){var De=pe[I];this.checkPatternExport(m,De)}else if(j==="ArrayPattern")for(var ht=0,Vt=w.elements;ht<Vt.length;ht+=1){var Wt=Vt[ht];Wt&&this.checkPatternExport(m,Wt)}else j==="Property"?this.checkPatternExport(m,w.value):j==="AssignmentPattern"?this.checkPatternExport(m,w.left):j==="RestElement"?this.checkPatternExport(m,w.argument):j==="ParenthesizedExpression"&&this.checkPatternExport(m,w.expression)},kt.checkVariableExport=function(m,w){if(!!m)for(var j=0,I=w;j<I.length;j+=1){var pe=I[j];this.checkPatternExport(m,pe.id)}},kt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},kt.parseExportSpecifiers=function(m){var w=[],j=!0;for(this.expect(re.braceL);!this.eat(re.braceR);){if(j)j=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var I=this.startNode();I.local=this.parseIdent(!0),I.exported=this.eatContextual("as")?this.parseIdent(!0):I.local,this.checkExport(m,I.exported.name,I.exported.start),w.push(this.finishNode(I,"ExportSpecifier"))}return w},kt.parseImport=function(m){return this.next(),this.type===re.string?(m.specifiers=Je,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===re.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},kt.parseImportSpecifiers=function(){var m=[],w=!0;if(this.type===re.name){var j=this.startNode();if(j.local=this.parseIdent(),this.checkLVal(j.local,fr),m.push(this.finishNode(j,"ImportDefaultSpecifier")),!this.eat(re.comma))return m}if(this.type===re.star){var I=this.startNode();return this.next(),this.expectContextual("as"),I.local=this.parseIdent(),this.checkLVal(I.local,fr),m.push(this.finishNode(I,"ImportNamespaceSpecifier")),m}for(this.expect(re.braceL);!this.eat(re.braceR);){if(w)w=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var pe=this.startNode();pe.imported=this.parseIdent(!0),this.eatContextual("as")?pe.local=this.parseIdent():(this.checkUnreserved(pe.imported),pe.local=pe.imported),this.checkLVal(pe.local,fr),m.push(this.finishNode(pe,"ImportSpecifier"))}return m},kt.adaptDirectivePrologue=function(m){for(var w=0;w<m.length&&this.isDirectiveCandidate(m[w]);++w)m[w].directive=m[w].expression.raw.slice(1,-1)},kt.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var br=Ze.prototype;br.toAssignable=function(m,w,j){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",j&&this.checkPatternErrors(j,!0);for(var I=0,pe=m.properties;I<pe.length;I+=1){var De=pe[I];this.toAssignable(De,w),De.type==="RestElement"&&(De.argument.type==="ArrayPattern"||De.argument.type==="ObjectPattern")&&this.raise(De.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,w);break;case"ArrayExpression":m.type="ArrayPattern",j&&this.checkPatternErrors(j,!0),this.toAssignableList(m.elements,w);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,w),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,w);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,w,j);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!w)break;default:this.raise(m.start,"Assigning to rvalue")}else j&&this.checkPatternErrors(j,!0);return m},br.toAssignableList=function(m,w){for(var j=m.length,I=0;I<j;I++){var pe=m[I];pe&&this.toAssignable(pe,w)}if(j){var De=m[j-1];this.options.ecmaVersion===6&&w&&De&&De.type==="RestElement"&&De.argument.type!=="Identifier"&&this.unexpected(De.argument.start)}return m},br.parseSpread=function(m){var w=this.startNode();return this.next(),w.argument=this.parseMaybeAssign(!1,m),this.finishNode(w,"SpreadElement")},br.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==re.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},br.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case re.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(re.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case re.braceL:return this.parseObj(!0)}return this.parseIdent()},br.parseBindingList=function(m,w,j){for(var I=[],pe=!0;!this.eat(m);)if(pe?pe=!1:this.expect(re.comma),w&&this.type===re.comma)I.push(null);else{if(j&&this.afterTrailingComma(m))break;if(this.type===re.ellipsis){var De=this.parseRestBinding();this.parseBindingListItem(De),I.push(De),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var ht=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ht),I.push(ht)}}return I},br.parseBindingListItem=function(m){return m},br.parseMaybeDefault=function(m,w,j){if(j=j||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(re.eq))return j;var I=this.startNodeAt(m,w);return I.left=j,I.right=this.parseMaybeAssign(),this.finishNode(I,"AssignmentPattern")},br.checkLVal=function(m,w,j){switch(w===void 0&&(w=yr),m.type){case"Identifier":w===fr&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(w?"Binding ":"Assigning to ")+m.name+" in strict mode"),j&&(W(j,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),j[m.name]=!0),w!==yr&&w!==G&&this.declareName(m.name,w,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":w&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var I=0,pe=m.properties;I<pe.length;I+=1){var De=pe[I];this.checkLVal(De,w,j)}break;case"Property":this.checkLVal(m.value,w,j);break;case"ArrayPattern":for(var ht=0,Vt=m.elements;ht<Vt.length;ht+=1){var Wt=Vt[ht];Wt&&this.checkLVal(Wt,w,j)}break;case"AssignmentPattern":this.checkLVal(m.left,w,j);break;case"RestElement":this.checkLVal(m.argument,w,j);break;case"ParenthesizedExpression":this.checkLVal(m.expression,w,j);break;default:this.raise(m.start,(w?"Binding":"Assigning to")+" rvalue")}};var Tr=Ze.prototype;Tr.checkPropClash=function(m,w,j){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var I=m.key,pe;switch(I.type){case"Identifier":pe=I.name;break;case"Literal":pe=String(I.value);break;default:return}var De=m.kind;if(this.options.ecmaVersion>=6){pe==="__proto__"&&De==="init"&&(w.proto&&(j?j.doubleProto<0&&(j.doubleProto=I.start):this.raiseRecoverable(I.start,"Redefinition of __proto__ property")),w.proto=!0);return}pe="$"+pe;var ht=w[pe];if(ht){var Vt;De==="init"?Vt=this.strict&&ht.init||ht.get||ht.set:Vt=ht.init||ht[De],Vt&&this.raiseRecoverable(I.start,"Redefinition of property")}else ht=w[pe]={init:!1,get:!1,set:!1};ht[De]=!0}},Tr.parseExpression=function(m,w){var j=this.start,I=this.startLoc,pe=this.parseMaybeAssign(m,w);if(this.type===re.comma){var De=this.startNodeAt(j,I);for(De.expressions=[pe];this.eat(re.comma);)De.expressions.push(this.parseMaybeAssign(m,w));return this.finishNode(De,"SequenceExpression")}return pe},Tr.parseMaybeAssign=function(m,w,j){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var I=!1,pe=-1,De=-1;w?(pe=w.parenthesizedAssign,De=w.trailingComma,w.parenthesizedAssign=w.trailingComma=-1):(w=new q,I=!0);var ht=this.start,Vt=this.startLoc;(this.type===re.parenL||this.type===re.name)&&(this.potentialArrowAt=this.start);var Wt=this.parseMaybeConditional(m,w);if(j&&(Wt=j.call(this,Wt,ht,Vt)),this.type.isAssign){var kr=this.startNodeAt(ht,Vt);return kr.operator=this.value,kr.left=this.type===re.eq?this.toAssignable(Wt,!1,w):Wt,I||(w.parenthesizedAssign=w.trailingComma=w.doubleProto=-1),w.shorthandAssign>=kr.left.start&&(w.shorthandAssign=-1),this.checkLVal(Wt),this.next(),kr.right=this.parseMaybeAssign(m),this.finishNode(kr,"AssignmentExpression")}else I&&this.checkExpressionErrors(w,!0);return pe>-1&&(w.parenthesizedAssign=pe),De>-1&&(w.trailingComma=De),Wt},Tr.parseMaybeConditional=function(m,w){var j=this.start,I=this.startLoc,pe=this.parseExprOps(m,w);if(this.checkExpressionErrors(w))return pe;if(this.eat(re.question)){var De=this.startNodeAt(j,I);return De.test=pe,De.consequent=this.parseMaybeAssign(),this.expect(re.colon),De.alternate=this.parseMaybeAssign(m),this.finishNode(De,"ConditionalExpression")}return pe},Tr.parseExprOps=function(m,w){var j=this.start,I=this.startLoc,pe=this.parseMaybeUnary(w,!1);return this.checkExpressionErrors(w)||pe.start===j&&pe.type==="ArrowFunctionExpression"?pe:this.parseExprOp(pe,j,I,-1,m)},Tr.parseExprOp=function(m,w,j,I,pe){var De=this.type.binop;if(De!=null&&(!pe||this.type!==re._in)&&De>I){var ht=this.type===re.logicalOR||this.type===re.logicalAND,Vt=this.type===re.coalesce;Vt&&(De=re.logicalAND.binop);var Wt=this.value;this.next();var kr=this.start,Kr=this.startLoc,cn=this.parseExprOp(this.parseMaybeUnary(null,!1),kr,Kr,De,pe),Oi=this.buildBinary(w,j,m,cn,Wt,ht||Vt);return(ht&&this.type===re.coalesce||Vt&&(this.type===re.logicalOR||this.type===re.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Oi,w,j,I,pe)}return m},Tr.buildBinary=function(m,w,j,I,pe,De){var ht=this.startNodeAt(m,w);return ht.left=j,ht.operator=pe,ht.right=I,this.finishNode(ht,De?"LogicalExpression":"BinaryExpression")},Tr.parseMaybeUnary=function(m,w){var j=this.start,I=this.startLoc,pe;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))pe=this.parseAwait(),w=!0;else if(this.type.prefix){var De=this.startNode(),ht=this.type===re.incDec;De.operator=this.value,De.prefix=!0,this.next(),De.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),ht?this.checkLVal(De.argument):this.strict&&De.operator==="delete"&&De.argument.type==="Identifier"?this.raiseRecoverable(De.start,"Deleting local variable in strict mode"):w=!0,pe=this.finishNode(De,ht?"UpdateExpression":"UnaryExpression")}else{if(pe=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return pe;for(;this.type.postfix&&!this.canInsertSemicolon();){var Vt=this.startNodeAt(j,I);Vt.operator=this.value,Vt.prefix=!1,Vt.argument=pe,this.checkLVal(pe),this.next(),pe=this.finishNode(Vt,"UpdateExpression")}}return!w&&this.eat(re.starstar)?this.buildBinary(j,I,pe,this.parseMaybeUnary(null,!1),"**",!1):pe},Tr.parseExprSubscripts=function(m){var w=this.start,j=this.startLoc,I=this.parseExprAtom(m);if(I.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return I;var pe=this.parseSubscripts(I,w,j);return m&&pe.type==="MemberExpression"&&(m.parenthesizedAssign>=pe.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=pe.start&&(m.parenthesizedBind=-1)),pe},Tr.parseSubscripts=function(m,w,j,I){for(var pe=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,De=!1;;){var ht=this.parseSubscript(m,w,j,I,pe,De);if(ht.optional&&(De=!0),ht===m||ht.type==="ArrowFunctionExpression"){if(De){var Vt=this.startNodeAt(w,j);Vt.expression=ht,ht=this.finishNode(Vt,"ChainExpression")}return ht}m=ht}},Tr.parseSubscript=function(m,w,j,I,pe,De){var ht=this.options.ecmaVersion>=11,Vt=ht&&this.eat(re.questionDot);I&&Vt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Wt=this.eat(re.bracketL);if(Wt||Vt&&this.type!==re.parenL&&this.type!==re.backQuote||this.eat(re.dot)){var kr=this.startNodeAt(w,j);kr.object=m,kr.property=Wt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),kr.computed=!!Wt,Wt&&this.expect(re.bracketR),ht&&(kr.optional=Vt),m=this.finishNode(kr,"MemberExpression")}else if(!I&&this.eat(re.parenL)){var Kr=new q,cn=this.yieldPos,Oi=this.awaitPos,Ei=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ha=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1,Kr);if(pe&&!Vt&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Kr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=cn,this.awaitPos=Oi,this.awaitIdentPos=Ei,this.parseArrowExpression(this.startNodeAt(w,j),ha,!0);this.checkExpressionErrors(Kr,!0),this.yieldPos=cn||this.yieldPos,this.awaitPos=Oi||this.awaitPos,this.awaitIdentPos=Ei||this.awaitIdentPos;var Pa=this.startNodeAt(w,j);Pa.callee=m,Pa.arguments=ha,ht&&(Pa.optional=Vt),m=this.finishNode(Pa,"CallExpression")}else if(this.type===re.backQuote){(Vt||De)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ga=this.startNodeAt(w,j);ga.tag=m,ga.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(ga,"TaggedTemplateExpression")}return m},Tr.parseExprAtom=function(m){this.type===re.slash&&this.readRegexp();var w,j=this.potentialArrowAt===this.start;switch(this.type){case re._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),w=this.startNode(),this.next(),this.type===re.parenL&&!this.allowDirectSuper&&this.raise(w.start,"super() call outside constructor of a subclass"),this.type!==re.dot&&this.type!==re.bracketL&&this.type!==re.parenL&&this.unexpected(),this.finishNode(w,"Super");case re._this:return w=this.startNode(),this.next(),this.finishNode(w,"ThisExpression");case re.name:var I=this.start,pe=this.startLoc,De=this.containsEsc,ht=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!De&&ht.name==="async"&&!this.canInsertSemicolon()&&this.eat(re._function))return this.parseFunction(this.startNodeAt(I,pe),0,!1,!0);if(j&&!this.canInsertSemicolon()){if(this.eat(re.arrow))return this.parseArrowExpression(this.startNodeAt(I,pe),[ht],!1);if(this.options.ecmaVersion>=8&&ht.name==="async"&&this.type===re.name&&!De)return ht=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(re.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(I,pe),[ht],!0)}return ht;case re.regexp:var Vt=this.value;return w=this.parseLiteral(Vt.value),w.regex={pattern:Vt.pattern,flags:Vt.flags},w;case re.num:case re.string:return this.parseLiteral(this.value);case re._null:case re._true:case re._false:return w=this.startNode(),w.value=this.type===re._null?null:this.type===re._true,w.raw=this.type.keyword,this.next(),this.finishNode(w,"Literal");case re.parenL:var Wt=this.start,kr=this.parseParenAndDistinguishExpression(j);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(kr)&&(m.parenthesizedAssign=Wt),m.parenthesizedBind<0&&(m.parenthesizedBind=Wt)),kr;case re.bracketL:return w=this.startNode(),this.next(),w.elements=this.parseExprList(re.bracketR,!0,!0,m),this.finishNode(w,"ArrayExpression");case re.braceL:return this.parseObj(!1,m);case re._function:return w=this.startNode(),this.next(),this.parseFunction(w,0);case re._class:return this.parseClass(this.startNode(),!1);case re._new:return this.parseNew();case re.backQuote:return this.parseTemplate();case re._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Tr.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var w=this.parseIdent(!0);switch(this.type){case re.parenL:return this.parseDynamicImport(m);case re.dot:return m.meta=w,this.parseImportMeta(m);default:this.unexpected()}},Tr.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(re.parenR)){var w=this.start;this.eat(re.comma)&&this.eat(re.parenR)?this.raiseRecoverable(w,"Trailing comma is not allowed in import()"):this.unexpected(w)}return this.finishNode(m,"ImportExpression")},Tr.parseImportMeta=function(m){this.next();var w=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),w&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Tr.parseLiteral=function(m){var w=this.startNode();return w.value=m,w.raw=this.input.slice(this.start,this.end),w.raw.charCodeAt(w.raw.length-1)===110&&(w.bigint=w.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(w,"Literal")},Tr.parseParenExpression=function(){this.expect(re.parenL);var m=this.parseExpression();return this.expect(re.parenR),m},Tr.parseParenAndDistinguishExpression=function(m){var w=this.start,j=this.startLoc,I,pe=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var De=this.start,ht=this.startLoc,Vt=[],Wt=!0,kr=!1,Kr=new q,cn=this.yieldPos,Oi=this.awaitPos,Ei;for(this.yieldPos=0,this.awaitPos=0;this.type!==re.parenR;)if(Wt?Wt=!1:this.expect(re.comma),pe&&this.afterTrailingComma(re.parenR,!0)){kr=!0;break}else if(this.type===re.ellipsis){Ei=this.start,Vt.push(this.parseParenItem(this.parseRestBinding())),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Vt.push(this.parseMaybeAssign(!1,Kr,this.parseParenItem));var ha=this.start,Pa=this.startLoc;if(this.expect(re.parenR),m&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Kr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=cn,this.awaitPos=Oi,this.parseParenArrowList(w,j,Vt);(!Vt.length||kr)&&this.unexpected(this.lastTokStart),Ei&&this.unexpected(Ei),this.checkExpressionErrors(Kr,!0),this.yieldPos=cn||this.yieldPos,this.awaitPos=Oi||this.awaitPos,Vt.length>1?(I=this.startNodeAt(De,ht),I.expressions=Vt,this.finishNodeAt(I,"SequenceExpression",ha,Pa)):I=Vt[0]}else I=this.parseParenExpression();if(this.options.preserveParens){var ga=this.startNodeAt(w,j);return ga.expression=I,this.finishNode(ga,"ParenthesizedExpression")}else return I},Tr.parseParenItem=function(m){return m},Tr.parseParenArrowList=function(m,w,j){return this.parseArrowExpression(this.startNodeAt(m,w),j)};var qe=[];Tr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),w=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(re.dot)){m.meta=w;var j=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),j&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var I=this.start,pe=this.startLoc,De=this.type===re._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),I,pe,!0),De&&m.callee.type==="ImportExpression"&&this.raise(I,"Cannot use new with import()"),this.eat(re.parenL)?m.arguments=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1):m.arguments=qe,this.finishNode(m,"NewExpression")},Tr.parseTemplateElement=function(m){var w=m.isTagged,j=this.startNode();return this.type===re.invalidTemplate?(w||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),j.value={raw:this.value,cooked:null}):j.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),j.tail=this.type===re.backQuote,this.finishNode(j,"TemplateElement")},Tr.parseTemplate=function(m){m===void 0&&(m={});var w=m.isTagged;w===void 0&&(w=!1);var j=this.startNode();this.next(),j.expressions=[];var I=this.parseTemplateElement({isTagged:w});for(j.quasis=[I];!I.tail;)this.type===re.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(re.dollarBraceL),j.expressions.push(this.parseExpression()),this.expect(re.braceR),j.quasis.push(I=this.parseTemplateElement({isTagged:w}));return this.next(),this.finishNode(j,"TemplateLiteral")},Tr.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===re.name||this.type===re.num||this.type===re.string||this.type===re.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===re.star)&&!nr.test(this.input.slice(this.lastTokEnd,this.start))},Tr.parseObj=function(m,w){var j=this.startNode(),I=!0,pe={};for(j.properties=[],this.next();!this.eat(re.braceR);){if(I)I=!1;else if(this.expect(re.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(re.braceR))break;var De=this.parseProperty(m,w);m||this.checkPropClash(De,pe,w),j.properties.push(De)}return this.finishNode(j,m?"ObjectPattern":"ObjectExpression")},Tr.parseProperty=function(m,w){var j=this.startNode(),I,pe,De,ht;if(this.options.ecmaVersion>=9&&this.eat(re.ellipsis))return m?(j.argument=this.parseIdent(!1),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(j,"RestElement")):(this.type===re.parenL&&w&&(w.parenthesizedAssign<0&&(w.parenthesizedAssign=this.start),w.parenthesizedBind<0&&(w.parenthesizedBind=this.start)),j.argument=this.parseMaybeAssign(!1,w),this.type===re.comma&&w&&w.trailingComma<0&&(w.trailingComma=this.start),this.finishNode(j,"SpreadElement"));this.options.ecmaVersion>=6&&(j.method=!1,j.shorthand=!1,(m||w)&&(De=this.start,ht=this.startLoc),m||(I=this.eat(re.star)));var Vt=this.containsEsc;return this.parsePropertyName(j),!m&&!Vt&&this.options.ecmaVersion>=8&&!I&&this.isAsyncProp(j)?(pe=!0,I=this.options.ecmaVersion>=9&&this.eat(re.star),this.parsePropertyName(j,w)):pe=!1,this.parsePropertyValue(j,m,I,pe,De,ht,w,Vt),this.finishNode(j,"Property")},Tr.parsePropertyValue=function(m,w,j,I,pe,De,ht,Vt){if((j||I)&&this.type===re.colon&&this.unexpected(),this.eat(re.colon))m.value=w?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ht),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===re.parenL)w&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(j,I);else if(!w&&!Vt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==re.comma&&this.type!==re.braceR&&this.type!==re.eq){(j||I)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Wt=m.kind==="get"?0:1;if(m.value.params.length!==Wt){var kr=m.value.start;m.kind==="get"?this.raiseRecoverable(kr,"getter should have no params"):this.raiseRecoverable(kr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((j||I)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=pe),m.kind="init",w?m.value=this.parseMaybeDefault(pe,De,m.key):this.type===re.eq&&ht?(ht.shorthandAssign<0&&(ht.shorthandAssign=this.start),m.value=this.parseMaybeDefault(pe,De,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Tr.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(re.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(re.bracketR),m.key;m.computed=!1}return m.key=this.type===re.num||this.type===re.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Tr.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Tr.parseMethod=function(m,w,j){var I=this.startNode(),pe=this.yieldPos,De=this.awaitPos,ht=this.awaitIdentPos;return this.initFunction(I),this.options.ecmaVersion>=6&&(I.generator=m),this.options.ecmaVersion>=8&&(I.async=!!w),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ar(w,I.generator)|Re|(j?Nt:0)),this.expect(re.parenL),I.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(I,!1,!0),this.yieldPos=pe,this.awaitPos=De,this.awaitIdentPos=ht,this.finishNode(I,"FunctionExpression")},Tr.parseArrowExpression=function(m,w,j){var I=this.yieldPos,pe=this.awaitPos,De=this.awaitIdentPos;return this.enterScope(ar(j,!1)|Pe),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!j),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(w,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=I,this.awaitPos=pe,this.awaitIdentPos=De,this.finishNode(m,"ArrowFunctionExpression")},Tr.parseFunctionBody=function(m,w,j){var I=w&&this.type!==re.braceL,pe=this.strict,De=!1;if(I)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var ht=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!pe||ht)&&(De=this.strictDirective(this.end),De&&ht&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Vt=this.labels;this.labels=[],De&&(this.strict=!0),this.checkParams(m,!pe&&!De&&!w&&!j&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,G),m.body=this.parseBlock(!1,void 0,De&&!pe),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Vt}this.exitScope()},Tr.isSimpleParamList=function(m){for(var w=0,j=m;w<j.length;w+=1){var I=j[w];if(I.type!=="Identifier")return!1}return!0},Tr.checkParams=function(m,w){for(var j={},I=0,pe=m.params;I<pe.length;I+=1){var De=pe[I];this.checkLVal(De,Lr,w?null:j)}},Tr.parseExprList=function(m,w,j,I){for(var pe=[],De=!0;!this.eat(m);){if(De)De=!1;else if(this.expect(re.comma),w&&this.afterTrailingComma(m))break;var ht=void 0;j&&this.type===re.comma?ht=null:this.type===re.ellipsis?(ht=this.parseSpread(I),I&&this.type===re.comma&&I.trailingComma<0&&(I.trailingComma=this.start)):ht=this.parseMaybeAssign(!1,I),pe.push(ht)}return pe},Tr.checkUnreserved=function(m){var w=m.start,j=m.end,I=m.name;if(this.inGenerator&&I==="yield"&&this.raiseRecoverable(w,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&I==="await"&&this.raiseRecoverable(w,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(I)&&this.raise(w,"Unexpected keyword '"+I+"'"),!(this.options.ecmaVersion<6&&this.input.slice(w,j).indexOf("\\")!==-1)){var pe=this.strict?this.reservedWordsStrict:this.reservedWords;pe.test(I)&&(!this.inAsync&&I==="await"&&this.raiseRecoverable(w,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(w,"The keyword '"+I+"' is reserved"))}},Tr.parseIdent=function(m,w){var j=this.startNode();return this.type===re.name?j.name=this.value:this.type.keyword?(j.name=this.type.keyword,(j.name==="class"||j.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(j,"Identifier"),m||(this.checkUnreserved(j),j.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=j.start)),j},Tr.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var w=this.startNode();return this.next(),this.type===re.semi||this.canInsertSemicolon()||this.type!==re.star&&!this.type.startsExpr?(w.delegate=!1,w.argument=null):(w.delegate=this.eat(re.star),w.argument=this.parseMaybeAssign(m)),this.finishNode(w,"YieldExpression")},Tr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Gr=Ze.prototype;Gr.raise=function(m,w){var j=gt(this.input,m);w+=" ("+j.line+":"+j.column+")";var I=new SyntaxError(w);throw I.pos=m,I.loc=j,I.raisedAt=this.pos,I},Gr.raiseRecoverable=Gr.raise,Gr.curPosition=function(){if(this.options.locations)return new _e(this.curLine,this.pos-this.lineStart)};var Yr=Ze.prototype,An=function(w){this.flags=w,this.var=[],this.lexical=[],this.functions=[]};Yr.enterScope=function(m){this.scopeStack.push(new An(m))},Yr.exitScope=function(){this.scopeStack.pop()},Yr.treatFunctionsAsVarInScope=function(m){return m.flags&_n||!this.inModule&&m.flags&dn},Yr.declareName=function(m,w,j){var I=!1;if(w===fr){var pe=this.currentScope();I=pe.lexical.indexOf(m)>-1||pe.functions.indexOf(m)>-1||pe.var.indexOf(m)>-1,pe.lexical.push(m),this.inModule&&pe.flags&dn&&delete this.undefinedExports[m]}else if(w===C){var De=this.currentScope();De.lexical.push(m)}else if(w===Fr){var ht=this.currentScope();this.treatFunctionsAsVar?I=ht.lexical.indexOf(m)>-1:I=ht.lexical.indexOf(m)>-1||ht.var.indexOf(m)>-1,ht.functions.push(m)}else for(var Vt=this.scopeStack.length-1;Vt>=0;--Vt){var Wt=this.scopeStack[Vt];if(Wt.lexical.indexOf(m)>-1&&!(Wt.flags&Ge&&Wt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Wt)&&Wt.functions.indexOf(m)>-1){I=!0;break}if(Wt.var.push(m),this.inModule&&Wt.flags&dn&&delete this.undefinedExports[m],Wt.flags&Qi)break}I&&this.raiseRecoverable(j,"Identifier '"+m+"' has already been declared")},Yr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Yr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Yr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&Qi)return w}},Yr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&Qi&&!(w.flags&Pe))return w}};var vr=function(w,j,I){this.type="",this.start=j,this.end=0,w.options.locations&&(this.loc=new Et(w,I)),w.options.directSourceFile&&(this.sourceFile=w.options.directSourceFile),w.options.ranges&&(this.range=[j,0])},Or=Ze.prototype;Or.startNode=function(){return new vr(this,this.start,this.startLoc)},Or.startNodeAt=function(m,w){return new vr(this,m,w)};function St(m,w,j,I){return m.type=w,m.end=j,this.options.locations&&(m.loc.end=I),this.options.ranges&&(m.range[1]=j),m}Or.finishNode=function(m,w){return St.call(this,m,w,this.lastTokEnd,this.lastTokEndLoc)},Or.finishNodeAt=function(m,w,j,I){return St.call(this,m,w,j,I)};var Kn=function(w,j,I,pe,De){this.token=w,this.isExpr=!!j,this.preserveSpace=!!I,this.override=pe,this.generator=!!De},Ln={b_stat:new Kn("{",!1),b_expr:new Kn("{",!0),b_tmpl:new Kn("${",!1),p_stat:new Kn("(",!1),p_expr:new Kn("(",!0),q_tmpl:new Kn("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Kn("function",!1),f_expr:new Kn("function",!0),f_expr_gen:new Kn("function",!0,!1,null,!0),f_gen:new Kn("function",!1,!1,null,!0)},Ur=Ze.prototype;Ur.initialContext=function(){return[Ln.b_stat]},Ur.braceIsBlock=function(m){var w=this.curContext();return w===Ln.f_expr||w===Ln.f_stat?!0:m===re.colon&&(w===Ln.b_stat||w===Ln.b_expr)?!w.isExpr:m===re._return||m===re.name&&this.exprAllowed?nr.test(this.input.slice(this.lastTokEnd,this.start)):m===re._else||m===re.semi||m===re.eof||m===re.parenR||m===re.arrow?!0:m===re.braceL?w===Ln.b_stat:m===re._var||m===re._const||m===re.name?!1:!this.exprAllowed},Ur.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var w=this.context[m];if(w.token==="function")return w.generator}return!1},Ur.updateContext=function(m){var w,j=this.type;j.keyword&&m===re.dot?this.exprAllowed=!1:(w=j.updateContext)?w.call(this,m):this.exprAllowed=j.beforeExpr},re.parenR.updateContext=re.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Ln.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},re.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Ln.b_stat:Ln.b_expr),this.exprAllowed=!0},re.dollarBraceL.updateContext=function(){this.context.push(Ln.b_tmpl),this.exprAllowed=!0},re.parenL.updateContext=function(m){var w=m===re._if||m===re._for||m===re._with||m===re._while;this.context.push(w?Ln.p_stat:Ln.p_expr),this.exprAllowed=!0},re.incDec.updateContext=function(){},re._function.updateContext=re._class.updateContext=function(m){m.beforeExpr&&m!==re.semi&&m!==re._else&&!(m===re._return&&nr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===re.colon||m===re.braceL)&&this.curContext()===Ln.b_stat)?this.context.push(Ln.f_expr):this.context.push(Ln.f_stat),this.exprAllowed=!1},re.backQuote.updateContext=function(){this.curContext()===Ln.q_tmpl?this.context.pop():this.context.push(Ln.q_tmpl),this.exprAllowed=!1},re.star.updateContext=function(m){if(m===re._function){var w=this.context.length-1;this.context[w]===Ln.f_expr?this.context[w]=Ln.f_expr_gen:this.context[w]=Ln.f_gen}this.exprAllowed=!0},re.name.updateContext=function(m){var w=!1;this.options.ecmaVersion>=6&&m!==re.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(w=!0),this.exprAllowed=w};var ee="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",fe=ee+" Extended_Pictographic",me=fe,N={9:ee,10:fe,11:me},ae="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",de="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Te=de+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ue=Te+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",xe={9:de,10:Te,11:ue},pt={};function Cr(m){var w=pt[m]={binary:ke(N[m]+" "+ae),nonBinary:{General_Category:ke(ae),Script:ke(xe[m])}};w.nonBinary.Script_Extensions=w.nonBinary.Script,w.nonBinary.gc=w.nonBinary.General_Category,w.nonBinary.sc=w.nonBinary.Script,w.nonBinary.scx=w.nonBinary.Script_Extensions}Cr(9),Cr(10),Cr(11);var Kt=Ze.prototype,rr=function(w){this.parser=w,this.validFlags="gim"+(w.options.ecmaVersion>=6?"uy":"")+(w.options.ecmaVersion>=9?"s":""),this.unicodeProperties=pt[w.options.ecmaVersion>=11?11:w.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};rr.prototype.reset=function(w,j,I){var pe=I.indexOf("u")!==-1;this.start=w|0,this.source=j+"",this.flags=I,this.switchU=pe&&this.parser.options.ecmaVersion>=6,this.switchN=pe&&this.parser.options.ecmaVersion>=9},rr.prototype.raise=function(w){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+w)},rr.prototype.at=function(w,j){j===void 0&&(j=!1);var I=this.source,pe=I.length;if(w>=pe)return-1;var De=I.charCodeAt(w);if(!(j||this.switchU)||De<=55295||De>=57344||w+1>=pe)return De;var ht=I.charCodeAt(w+1);return ht>=56320&&ht<=57343?(De<<10)+ht-56613888:De},rr.prototype.nextIndex=function(w,j){j===void 0&&(j=!1);var I=this.source,pe=I.length;if(w>=pe)return pe;var De=I.charCodeAt(w),ht;return!(j||this.switchU)||De<=55295||De>=57344||w+1>=pe||(ht=I.charCodeAt(w+1))<56320||ht>57343?w+1:w+2},rr.prototype.current=function(w){return w===void 0&&(w=!1),this.at(this.pos,w)},rr.prototype.lookahead=function(w){return w===void 0&&(w=!1),this.at(this.nextIndex(this.pos,w),w)},rr.prototype.advance=function(w){w===void 0&&(w=!1),this.pos=this.nextIndex(this.pos,w)},rr.prototype.eat=function(w,j){return j===void 0&&(j=!1),this.current(j)===w?(this.advance(j),!0):!1};function Zr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Kt.validateRegExpFlags=function(m){for(var w=m.validFlags,j=m.flags,I=0;I<j.length;I++){var pe=j.charAt(I);w.indexOf(pe)===-1&&this.raise(m.start,"Invalid regular expression flag"),j.indexOf(pe,I+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Kt.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Kt.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var w=0,j=m.backReferenceNames;w<j.length;w+=1){var I=j[w];m.groupNames.indexOf(I)===-1&&m.raise("Invalid named capture referenced")}},Kt.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Kt.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Kt.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Kt.regexp_eatAssertion=function(m){var w=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=w}if(m.eat(40)&&m.eat(63)){var j=!1;if(this.options.ecmaVersion>=9&&(j=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!j,!0}return m.pos=w,!1},Kt.regexp_eatQuantifier=function(m,w){return w===void 0&&(w=!1),this.regexp_eatQuantifierPrefix(m,w)?(m.eat(63),!0):!1},Kt.regexp_eatQuantifierPrefix=function(m,w){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,w)},Kt.regexp_eatBracedQuantifier=function(m,w){var j=m.pos;if(m.eat(123)){var I=0,pe=-1;if(this.regexp_eatDecimalDigits(m)&&(I=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(pe=m.lastIntValue),m.eat(125)))return pe!==-1&&pe<I&&!w&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!w&&m.raise("Incomplete quantifier"),m.pos=j}return!1},Kt.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Kt.regexp_eatReverseSolidusAtomEscape=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=w}return!1},Kt.regexp_eatUncapturingGroup=function(m){var w=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=w}return!1},Kt.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Kt.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Kt.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Kt.regexp_eatSyntaxCharacter=function(m){var w=m.current();return Nn(w)?(m.lastIntValue=w,m.advance(),!0):!1};function Nn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Kt.regexp_eatPatternCharacters=function(m){for(var w=m.pos,j=0;(j=m.current())!==-1&&!Nn(j);)m.advance();return m.pos!==w},Kt.regexp_eatExtendedPatternCharacter=function(m){var w=m.current();return w!==-1&&w!==36&&!(w>=40&&w<=43)&&w!==46&&w!==63&&w!==91&&w!==94&&w!==124?(m.advance(),!0):!1},Kt.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Kt.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Kt.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Zr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Zr(m.lastIntValue);return!0}return!1},Kt.regexp_eatRegExpIdentifierStart=function(m){var w=m.pos,j=this.options.ecmaVersion>=11,I=m.current(j);return m.advance(j),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(I=m.lastIntValue),Bn(I)?(m.lastIntValue=I,!0):(m.pos=w,!1)};function Bn(m){return $t(m,!0)||m===36||m===95}Kt.regexp_eatRegExpIdentifierPart=function(m){var w=m.pos,j=this.options.ecmaVersion>=11,I=m.current(j);return m.advance(j),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(I=m.lastIntValue),tr(I)?(m.lastIntValue=I,!0):(m.pos=w,!1)};function tr(m){return zt(m,!0)||m===36||m===95||m===8204||m===8205}Kt.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Kt.regexp_eatBackReference=function(m){var w=m.pos;if(this.regexp_eatDecimalEscape(m)){var j=m.lastIntValue;if(m.switchU)return j>m.maxBackReference&&(m.maxBackReference=j),!0;if(j<=m.numCapturingParens)return!0;m.pos=w}return!1},Kt.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Kt.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Kt.regexp_eatCControlLetter=function(m){var w=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=w}return!1},Kt.regexp_eatZero=function(m){return m.current()===48&&!Di(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Kt.regexp_eatControlEscape=function(m){var w=m.current();return w===116?(m.lastIntValue=9,m.advance(),!0):w===110?(m.lastIntValue=10,m.advance(),!0):w===118?(m.lastIntValue=11,m.advance(),!0):w===102?(m.lastIntValue=12,m.advance(),!0):w===114?(m.lastIntValue=13,m.advance(),!0):!1},Kt.regexp_eatControlLetter=function(m){var w=m.current();return In(w)?(m.lastIntValue=w%32,m.advance(),!0):!1};function In(m){return m>=65&&m<=90||m>=97&&m<=122}Kt.regexp_eatRegExpUnicodeEscapeSequence=function(m,w){w===void 0&&(w=!1);var j=m.pos,I=w||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var pe=m.lastIntValue;if(I&&pe>=55296&&pe<=56319){var De=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var ht=m.lastIntValue;if(ht>=56320&&ht<=57343)return m.lastIntValue=(pe-55296)*1024+(ht-56320)+65536,!0}m.pos=De,m.lastIntValue=pe}return!0}if(I&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&hn(m.lastIntValue))return!0;I&&m.raise("Invalid unicode escape"),m.pos=j}return!1};function hn(m){return m>=0&&m<=1114111}Kt.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var w=m.current();return w!==99&&(!m.switchN||w!==107)?(m.lastIntValue=w,m.advance(),!0):!1},Kt.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var w=m.current();if(w>=49&&w<=57){do m.lastIntValue=10*m.lastIntValue+(w-48),m.advance();while((w=m.current())>=48&&w<=57);return!0}return!1},Kt.regexp_eatCharacterClassEscape=function(m){var w=m.current();if(yn(w))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(w===80||w===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function yn(m){return m===100||m===68||m===115||m===83||m===119||m===87}Kt.regexp_eatUnicodePropertyValueExpression=function(m){var w=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var j=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var I=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,j,I),!0}}if(m.pos=w,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var pe=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,pe),!0}return!1},Kt.regexp_validateUnicodePropertyNameAndValue=function(m,w,j){W(m.unicodeProperties.nonBinary,w)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[w].test(j)||m.raise("Invalid property value")},Kt.regexp_validateUnicodePropertyNameOrValue=function(m,w){m.unicodeProperties.binary.test(w)||m.raise("Invalid property name")},Kt.regexp_eatUnicodePropertyName=function(m){var w=0;for(m.lastStringValue="";Ni(w=m.current());)m.lastStringValue+=Zr(w),m.advance();return m.lastStringValue!==""};function Ni(m){return In(m)||m===95}Kt.regexp_eatUnicodePropertyValue=function(m){var w=0;for(m.lastStringValue="";Tn(w=m.current());)m.lastStringValue+=Zr(w),m.advance();return m.lastStringValue!==""};function Tn(m){return Ni(m)||Di(m)}Kt.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Kt.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Kt.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var w=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var j=m.lastIntValue;m.switchU&&(w===-1||j===-1)&&m.raise("Invalid character class"),w!==-1&&j!==-1&&w>j&&m.raise("Range out of order in character class")}}},Kt.regexp_eatClassAtom=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var j=m.current();(j===99||na(j))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=w}var I=m.current();return I!==93?(m.lastIntValue=I,m.advance(),!0):!1},Kt.regexp_eatClassEscape=function(m){var w=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=w}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Kt.regexp_eatClassControlLetter=function(m){var w=m.current();return Di(w)||w===95?(m.lastIntValue=w%32,m.advance(),!0):!1},Kt.regexp_eatHexEscapeSequence=function(m){var w=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=w}return!1},Kt.regexp_eatDecimalDigits=function(m){var w=m.pos,j=0;for(m.lastIntValue=0;Di(j=m.current());)m.lastIntValue=10*m.lastIntValue+(j-48),m.advance();return m.pos!==w};function Di(m){return m>=48&&m<=57}Kt.regexp_eatHexDigits=function(m){var w=m.pos,j=0;for(m.lastIntValue=0;ra(j=m.current());)m.lastIntValue=16*m.lastIntValue+hi(j),m.advance();return m.pos!==w};function ra(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function hi(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Kt.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var w=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var j=m.lastIntValue;w<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=w*64+j*8+m.lastIntValue:m.lastIntValue=w*8+j}else m.lastIntValue=w;return!0}return!1},Kt.regexp_eatOctalDigit=function(m){var w=m.current();return na(w)?(m.lastIntValue=w-48,m.advance(),!0):(m.lastIntValue=0,!1)};function na(m){return m>=48&&m<=55}Kt.regexp_eatFixedHexDigits=function(m,w){var j=m.pos;m.lastIntValue=0;for(var I=0;I<w;++I){var pe=m.current();if(!ra(pe))return m.pos=j,!1;m.lastIntValue=16*m.lastIntValue+hi(pe),m.advance()}return!0};var Xi=function(w){this.type=w.type,this.value=w.value,this.start=w.start,this.end=w.end,w.options.locations&&(this.loc=new Et(w,w.startLoc,w.endLoc)),w.options.ranges&&(this.range=[w.start,w.end])},Ii=Ze.prototype;Ii.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Xi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ii.getToken=function(){return this.next(),new Xi(this)},typeof Symbol!="undefined"&&(Ii[Symbol.iterator]=function(){var m=this;return{next:function(){var w=m.getToken();return{done:w.type===re.eof,value:w}}}}),Ii.curContext=function(){return this.context[this.context.length-1]},Ii.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(re.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Ii.readToken=function(m){return $t(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Ii.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var w=this.input.charCodeAt(this.pos+1);return(m<<10)+w-56613888},Ii.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),w=this.pos,j=this.input.indexOf("*/",this.pos+=2);if(j===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=j+2,this.options.locations){Tt.lastIndex=w;for(var I;(I=Tt.exec(this.input))&&I.index<this.pos;)++this.curLine,this.lineStart=I.index+I[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(w+2,j),w,this.pos,m,this.curPosition())},Ii.skipLineComment=function(m){for(var w=this.pos,j=this.options.onComment&&this.curPosition(),I=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!$e(I);)I=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(w+m,this.pos),w,this.pos,j,this.curPosition())},Ii.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Mt.test(String.fromCharCode(m)))++this.pos;else break e}}},Ii.finishToken=function(m,w){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var j=this.type;this.type=m,this.value=w,this.updateContext(j)},Ii.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var w=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&w===46?(this.pos+=3,this.finishToken(re.ellipsis)):(++this.pos,this.finishToken(re.dot))},Ii.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(re.assign,2):this.finishOp(re.slash,1)},Ii.readToken_mult_modulo_exp=function(m){var w=this.input.charCodeAt(this.pos+1),j=1,I=m===42?re.star:re.modulo;return this.options.ecmaVersion>=7&&m===42&&w===42&&(++j,I=re.starstar,w=this.input.charCodeAt(this.pos+2)),w===61?this.finishOp(re.assign,j+1):this.finishOp(I,j)},Ii.readToken_pipe_amp=function(m){var w=this.input.charCodeAt(this.pos+1);if(w===m){if(this.options.ecmaVersion>=12){var j=this.input.charCodeAt(this.pos+2);if(j===61)return this.finishOp(re.assign,3)}return this.finishOp(m===124?re.logicalOR:re.logicalAND,2)}return w===61?this.finishOp(re.assign,2):this.finishOp(m===124?re.bitwiseOR:re.bitwiseAND,1)},Ii.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(re.assign,2):this.finishOp(re.bitwiseXOR,1)},Ii.readToken_plus_min=function(m){var w=this.input.charCodeAt(this.pos+1);return w===m?w===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||nr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(re.incDec,2):w===61?this.finishOp(re.assign,2):this.finishOp(re.plusMin,1)},Ii.readToken_lt_gt=function(m){var w=this.input.charCodeAt(this.pos+1),j=1;return w===m?(j=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+j)===61?this.finishOp(re.assign,j+1):this.finishOp(re.bitShift,j)):w===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(w===61&&(j=2),this.finishOp(re.relational,j))},Ii.readToken_eq_excl=function(m){var w=this.input.charCodeAt(this.pos+1);return w===61?this.finishOp(re.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&w===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(re.arrow)):this.finishOp(m===61?re.eq:re.prefix,1)},Ii.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var w=this.input.charCodeAt(this.pos+1);if(w===46){var j=this.input.charCodeAt(this.pos+2);if(j<48||j>57)return this.finishOp(re.questionDot,2)}if(w===63){if(m>=12){var I=this.input.charCodeAt(this.pos+2);if(I===61)return this.finishOp(re.assign,3)}return this.finishOp(re.coalesce,2)}}return this.finishOp(re.question,1)},Ii.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(re.parenL);case 41:return++this.pos,this.finishToken(re.parenR);case 59:return++this.pos,this.finishToken(re.semi);case 44:return++this.pos,this.finishToken(re.comma);case 91:return++this.pos,this.finishToken(re.bracketL);case 93:return++this.pos,this.finishToken(re.bracketR);case 123:return++this.pos,this.finishToken(re.braceL);case 125:return++this.pos,this.finishToken(re.braceR);case 58:return++this.pos,this.finishToken(re.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(re.backQuote);case 48:var w=this.input.charCodeAt(this.pos+1);if(w===120||w===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(w===111||w===79)return this.readRadixNumber(8);if(w===98||w===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(re.prefix,1)}this.raise(this.pos,"Unexpected character '"+Yi(m)+"'")},Ii.finishOp=function(m,w){var j=this.input.slice(this.pos,this.pos+w);return this.pos+=w,this.finishToken(m,j)},Ii.readRegexp=function(){for(var m,w,j=this.pos;;){this.pos>=this.input.length&&this.raise(j,"Unterminated regular expression");var I=this.input.charAt(this.pos);if(nr.test(I)&&this.raise(j,"Unterminated regular expression"),m)m=!1;else{if(I==="[")w=!0;else if(I==="]"&&w)w=!1;else if(I==="/"&&!w)break;m=I==="\\"}++this.pos}var pe=this.input.slice(j,this.pos);++this.pos;var De=this.pos,ht=this.readWord1();this.containsEsc&&this.unexpected(De);var Vt=this.regexpState||(this.regexpState=new rr(this));Vt.reset(j,pe,ht),this.validateRegExpFlags(Vt),this.validateRegExpPattern(Vt);var Wt=null;try{Wt=new RegExp(pe,ht)}catch(kr){}return this.finishToken(re.regexp,{pattern:pe,flags:ht,value:Wt})},Ii.readInt=function(m,w,j){for(var I=this.options.ecmaVersion>=12&&w===void 0,pe=j&&this.input.charCodeAt(this.pos)===48,De=this.pos,ht=0,Vt=0,Wt=0,kr=w==null?Infinity:w;Wt<kr;++Wt,++this.pos){var Kr=this.input.charCodeAt(this.pos),cn=void 0;if(I&&Kr===95){pe&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Vt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Wt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Vt=Kr;continue}if(Kr>=97?cn=Kr-97+10:Kr>=65?cn=Kr-65+10:Kr>=48&&Kr<=57?cn=Kr-48:cn=Infinity,cn>=m)break;Vt=Kr,ht=ht*m+cn}return I&&Vt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===De||w!=null&&this.pos-De!==w?null:ht};function ma(m,w){return w?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Da(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Ii.readRadixNumber=function(m){var w=this.pos;this.pos+=2;var j=this.readInt(m);return j==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(j=Da(this.input.slice(w,this.pos)),++this.pos):$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,j)},Ii.readNumber=function(m){var w=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(w,"Invalid number");var j=this.pos-w>=2&&this.input.charCodeAt(w)===48;j&&this.strict&&this.raise(w,"Invalid number");var I=this.input.charCodeAt(this.pos);if(!j&&!m&&this.options.ecmaVersion>=11&&I===110){var pe=Da(this.input.slice(w,this.pos));return++this.pos,$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,pe)}j&&/[89]/.test(this.input.slice(w,this.pos))&&(j=!1),I===46&&!j&&(++this.pos,this.readInt(10),I=this.input.charCodeAt(this.pos)),(I===69||I===101)&&!j&&(I=this.input.charCodeAt(++this.pos),(I===43||I===45)&&++this.pos,this.readInt(10)===null&&this.raise(w,"Invalid number")),$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var De=ma(this.input.slice(w,this.pos),j);return this.finishToken(re.num,De)},Ii.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),w;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var j=++this.pos;w=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,w>1114111&&this.invalidStringToken(j,"Code point out of bounds")}else w=this.readHexChar(4);return w};function Yi(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ii.readString=function(m){for(var w="",j=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var I=this.input.charCodeAt(this.pos);if(I===m)break;I===92?(w+=this.input.slice(j,this.pos),w+=this.readEscapedChar(!1),j=this.pos):($e(I,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return w+=this.input.slice(j,this.pos++),this.finishToken(re.string,w)};var zi={};Ii.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===zi)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Ii.invalidStringToken=function(m,w){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw zi;this.raise(m,w)},Ii.readTmplToken=function(){for(var m="",w=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var j=this.input.charCodeAt(this.pos);if(j===96||j===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===re.template||this.type===re.invalidTemplate)?j===36?(this.pos+=2,this.finishToken(re.dollarBraceL)):(++this.pos,this.finishToken(re.backQuote)):(m+=this.input.slice(w,this.pos),this.finishToken(re.template,m));if(j===92)m+=this.input.slice(w,this.pos),m+=this.readEscapedChar(!0),w=this.pos;else if($e(j)){switch(m+=this.input.slice(w,this.pos),++this.pos,j){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(j);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),w=this.pos}else++this.pos}},Ii.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(re.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ii.readEscapedChar=function(m){var w=this.input.charCodeAt(++this.pos);switch(++this.pos,w){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Yi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var j=this.pos-1;return this.invalidStringToken(j,"Invalid escape sequence in template string"),null}default:if(w>=48&&w<=55){var I=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],pe=parseInt(I,8);return pe>255&&(I=I.slice(0,-1),pe=parseInt(I,8)),this.pos+=I.length-1,w=this.input.charCodeAt(this.pos),(I!=="0"||w===56||w===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-I.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(pe)}return $e(w)?"":String.fromCharCode(w)}},Ii.readHexChar=function(m){var w=this.pos,j=this.readInt(16,m);return j===null&&this.invalidStringToken(w,"Bad character escape sequence"),j},Ii.readWord1=function(){this.containsEsc=!1;for(var m="",w=!0,j=this.pos,I=this.options.ecmaVersion>=6;this.pos<this.input.length;){var pe=this.fullCharCodeAtPos();if(zt(pe,I))this.pos+=pe<=65535?1:2;else if(pe===92){this.containsEsc=!0,m+=this.input.slice(j,this.pos);var De=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ht=this.readCodePoint();(w?$t:zt)(ht,I)||this.invalidStringToken(De,"Invalid Unicode escape"),m+=Yi(ht),j=this.pos}else break;w=!1}return m+this.input.slice(j,this.pos)},Ii.readWord=function(){var m=this.readWord1(),w=re.name;return this.keywords.test(m)&&(w=ft[m]),this.finishToken(w,m)};var Ki="7.4.1";Ze.acorn={Parser:Ze,version:Ki,defaultOptions:jt,Position:_e,SourceLocation:Et,getLineInfo:gt,Node:vr,TokenType:Lt,tokTypes:re,keywordTypes:ft,TokContext:Kn,tokContexts:Ln,isIdentifierChar:zt,isIdentifierStart:$t,Token:Xi,isNewLine:$e,lineBreak:nr,lineBreakG:Tt,nonASCIIwhitespace:Mt};function to(m,w){return Ze.parse(m,w)}function $o(m,w,j){return Ze.parseExpressionAt(m,w,j)}function Ba(m,w){return Ze.tokenizer(m,w)}function qi(m,w){m.prototype=Object.create(w.prototype),m.prototype.constructor=m,m.__proto__=w}function su(m){var w=typeof Map=="function"?new Map:void 0;return su=function(I){if(I===null||!yo(I))return I;if(typeof I!="function")throw new TypeError("Super expression must either be null or a function");if(typeof w!="undefined"){if(w.has(I))return w.get(I);w.set(I,pe)}function pe(){return $i(I,arguments,Wa(this).constructor)}return pe.prototype=Object.create(I.prototype,{constructor:{value:pe,enumerable:!1,writable:!0,configurable:!0}}),Ji(pe,I)},su(m)}function Au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function $i(m,w,j){return Au()?$i=Reflect.construct:$i=function(pe,De,ht){var Vt=[null];Vt.push.apply(Vt,De);var Wt=Function.bind.apply(pe,Vt),kr=new Wt;return ht&&Ji(kr,ht.prototype),kr},$i.apply(null,arguments)}function yo(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Ji(m,w){return Ji=Object.setPrototypeOf||function(I,pe){return I.__proto__=pe,I},Ji(m,w)}function Wa(m){return Wa=Object.setPrototypeOf?Object.getPrototypeOf:function(j){return j.__proto__||Object.getPrototypeOf(j)},Wa(m)}var Jo=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(su(Error)),ba=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(su(SyntaxError)),Lo=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(su(ReferenceError)),Ro=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(su(TypeError)),Rs=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Jo),ho=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(ba),Vo=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Lo),ka={UnknownError:[3001,"%0",Rs],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Rs],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Vo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Vo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Vo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Vo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Vo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Vo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Vo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Vo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Vo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Vo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Lo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Lo],IsNotConstructor:[2003,"%0 is not a constructor",Ro]};function so(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function as(m,w,j){return so()?as=Reflect.construct:as=function(pe,De,ht){var Vt=[null];Vt.push.apply(Vt,De);var Wt=Function.bind.apply(pe,Vt),kr=new Wt;return ht&&Do(kr,ht.prototype),kr},as.apply(null,arguments)}function Do(m,w){return Do=Object.setPrototypeOf||function(I,pe){return I.__proto__=pe,I},Do(m,w)}var Ee="0.0.2";function Be(m,w){Object.defineProperty(m,"name",{value:w,writable:!1,enumerable:!1,configurable:!0})}var mt=Object.prototype.hasOwnProperty,R=Symbol("Break"),qr=Symbol("Continue"),oi=Symbol("DefaultCase"),Ai=Symbol("EmptyStatementReturn"),uo=Symbol("WithScopeName"),Xa=Symbol("SuperScopeName"),ja=Symbol("RootScopeName"),os=Symbol("GlobalScopeName");function uu(m){return typeof m=="function"}var Tu=function(){function m(j){this.interpreter=j}var w=m.prototype;return w.generator=function(){var I=this.interpreter;function pe(){return this.getCurrentScope()}function De(){return this.getGlobalScope()}function ht(){return this.getCurrentContext()}return{getOptions:I.getOptions.bind(I),getCurrentScope:pe.bind(I),getGlobalScope:De.bind(I),getCurrentContext:ht.bind(I),getExecStartTime:I.getExecStartTime.bind(I)}},m}();function Ku(m,w,j){if(j===void 0&&(j=!0),!(m instanceof Tu))throw new Error("Illegal call");if(typeof w!="string")return w;if(!!w){var I=m.generator(),pe=I.getOptions(),De={timeout:pe.timeout,_initEnv:function(){j||this.setCurrentContext(I.getCurrentContext()),this.execStartTime=I.getExecStartTime(),this.execEndTime=this.execStartTime}},ht=j?I.getGlobalScope():I.getCurrentScope(),Vt=new Co(ht,De);return Vt.evaluate(w)}}Object.defineProperty(Ku,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Qo(m){if(!(m instanceof Tu))throw new Error("Illegal call");for(var w=m.generator(),j=arguments.length,I=new Array(j>1?j-1:0),pe=1;pe<j;pe++)I[pe-1]=arguments[pe];var De=I.pop(),ht=new Co(w.getGlobalScope(),w.getOptions()),Vt=`
		    (function anonymous(`+I.join(",")+`){
		        `+De+`
		    });
		    `;return ht.evaluate(Vt)}Object.defineProperty(Qo,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var qo=function(w){this.value=w},ss=function(w){this.value=w},ws=function(w){this.value=w},us=function(w,j,I){j===void 0&&(j=null),this.name=I,this.parent=j,this.data=w,this.labelStack=[]};function zs(){}function Xs(m,w){return m===void 0&&(m=null),new us(Object.create(null),m,w)}function As(m){return Object.create(m)}var Ca={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Ku,Function:Qo};typeof JSON!="undefined"&&(Ca.JSON=JSON),typeof Promise!="undefined"&&(Ca.Promise=Promise),typeof Set!="undefined"&&(Ca.Set=Set),typeof Map!="undefined"&&(Ca.Map=Map),typeof Symbol!="undefined"&&(Ca.Symbol=Symbol),typeof Proxy!="undefined"&&(Ca.Proxy=Proxy),typeof WeakMap!="undefined"&&(Ca.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Ca.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Ca.Reflect=Reflect);var Co=function(){function m(j,I){j===void 0&&(j=m.global),I===void 0&&(I={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:I.ecmaVersion||m.ecmaVersion,timeout:I.timeout||0,rootContext:I.rootContext,globalContextInFunction:I.globalContextInFunction===void 0?m.globalContextInFunction:I.globalContextInFunction,_initEnv:I._initEnv},this.context=j||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var w=m.prototype;return w.initEnvironment=function(I){var pe;if(I instanceof us)pe=I;else{var De=null,ht=this.createSuperScope(I);this.options.rootContext&&(De=new us(As(this.options.rootContext),ht,ja)),pe=new us(I,De||ht,os)}this.globalScope=pe,this.currentScope=this.globalScope,this.globalContext=pe.data,this.currentContext=pe.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Vt=this.options._initEnv;Vt&&Vt.call(this)},w.getExecStartTime=function(){return this.execStartTime},w.getExecutionTime=function(){return this.execEndTime-this.execStartTime},w.setExecTimeout=function(I){I===void 0&&(I=0),this.options.timeout=I},w.getOptions=function(){return this.options},w.getGlobalScope=function(){return this.globalScope},w.getCurrentScope=function(){return this.currentScope},w.getCurrentContext=function(){return this.currentContext},w.isInterruptThrow=function(I){return I instanceof Rs||I instanceof Vo||I instanceof ho},w.createSuperScope=function(I){var pe=Object.assign({},Ca),De=Object.keys(pe);return De.forEach(function(ht){ht in I&&delete pe[ht]}),new us(pe,null,Xa)},w.setCurrentContext=function(I){this.currentContext=I},w.setCurrentScope=function(I){this.currentScope=I},w.evaluate=function(I){I===void 0&&(I="");var pe;if(!!I)return pe=to(I,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(pe,I)},w.appendCode=function(I){return this.evaluate(I)},w.evaluateNode=function(I,pe){var De=this;pe===void 0&&(pe=""),this.value=void 0,this.source=pe,this.sourceList.push(pe),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ht=this.getCurrentScope(),Vt=this.getCurrentContext(),Wt=ht.labelStack.concat([]),kr=this.callStack.concat([]),Kr=function(){De.setCurrentScope(ht),De.setCurrentContext(Vt),ht.labelStack=Wt,De.callStack=kr};try{var cn=this.createClosure(I);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),cn()}catch(Oi){throw Oi}finally{Kr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},w.createErrorMessage=function(I,pe,De){var ht=I[1].replace("%0",String(pe));return De!==null&&(ht+=this.getNodePosition(De||this.lastExecNode)),ht},w.createError=function(I,pe){return new pe(I)},w.createThrowError=function(I,pe){return this.createError(I,pe)},w.createInternalThrowError=function(I,pe,De){return this.createError(this.createErrorMessage(I,pe,De),I[2])},w.checkTimeout=function(){if(!this.isRunning)return!1;var I=this.options.timeout||0,pe=Date.now();return pe-this.execStartTime>I},w.getNodePosition=function(I){if(I){var pe="";return I.loc?" ["+I.loc.start.line+":"+I.loc.start.column+"]"+pe:""}return""},w.createClosure=function(I){var pe=this,De;switch(I.type){case"BinaryExpression":De=this.binaryExpressionHandler(I);break;case"LogicalExpression":De=this.logicalExpressionHandler(I);break;case"UnaryExpression":De=this.unaryExpressionHandler(I);break;case"UpdateExpression":De=this.updateExpressionHandler(I);break;case"ObjectExpression":De=this.objectExpressionHandler(I);break;case"ArrayExpression":De=this.arrayExpressionHandler(I);break;case"CallExpression":De=this.callExpressionHandler(I);break;case"NewExpression":De=this.newExpressionHandler(I);break;case"MemberExpression":De=this.memberExpressionHandler(I);break;case"ThisExpression":De=this.thisExpressionHandler(I);break;case"SequenceExpression":De=this.sequenceExpressionHandler(I);break;case"Literal":De=this.literalHandler(I);break;case"Identifier":De=this.identifierHandler(I);break;case"AssignmentExpression":De=this.assignmentExpressionHandler(I);break;case"FunctionDeclaration":De=this.functionDeclarationHandler(I);break;case"VariableDeclaration":De=this.variableDeclarationHandler(I);break;case"BlockStatement":case"Program":De=this.programHandler(I);break;case"ExpressionStatement":De=this.expressionStatementHandler(I);break;case"EmptyStatement":De=this.emptyStatementHandler(I);break;case"ReturnStatement":De=this.returnStatementHandler(I);break;case"FunctionExpression":De=this.functionExpressionHandler(I);break;case"IfStatement":De=this.ifStatementHandler(I);break;case"ConditionalExpression":De=this.conditionalExpressionHandler(I);break;case"ForStatement":De=this.forStatementHandler(I);break;case"WhileStatement":De=this.whileStatementHandler(I);break;case"DoWhileStatement":De=this.doWhileStatementHandler(I);break;case"ForInStatement":De=this.forInStatementHandler(I);break;case"WithStatement":De=this.withStatementHandler(I);break;case"ThrowStatement":De=this.throwStatementHandler(I);break;case"TryStatement":De=this.tryStatementHandler(I);break;case"ContinueStatement":De=this.continueStatementHandler(I);break;case"BreakStatement":De=this.breakStatementHandler(I);break;case"SwitchStatement":De=this.switchStatementHandler(I);break;case"LabeledStatement":De=this.labeledStatementHandler(I);break;case"DebuggerStatement":De=this.debuggerStatementHandler(I);break;default:throw this.createInternalThrowError(ka.NodeTypeSyntaxError,I.type,I)}return function(){var ht=pe.options.timeout;if(ht&&ht>0&&pe.checkTimeout())throw pe.createInternalThrowError(ka.ExecutionTimeOutError,ht,null);return pe.lastExecNode=I,De.apply(void 0,arguments)}},w.binaryExpressionHandler=function(I){var pe=this,De=this.createClosure(I.left),ht=this.createClosure(I.right);return function(){var Vt=De(),Wt=ht();switch(I.operator){case"==":return Vt==Wt;case"!=":return Vt!=Wt;case"===":return Vt===Wt;case"!==":return Vt!==Wt;case"<":return Vt<Wt;case"<=":return Vt<=Wt;case">":return Vt>Wt;case">=":return Vt>=Wt;case"<<":return Vt<<Wt;case">>":return Vt>>Wt;case">>>":return Vt>>>Wt;case"+":return Vt+Wt;case"-":return Vt-Wt;case"*":return Vt*Wt;case"**":return Math.pow(Vt,Wt);case"/":return Vt/Wt;case"%":return Vt%Wt;case"|":return Vt|Wt;case"^":return Vt^Wt;case"&":return Vt&Wt;case"in":return Vt in Wt;case"instanceof":return Vt instanceof Wt;default:throw pe.createInternalThrowError(ka.BinaryOperatorSyntaxError,I.operator,I)}}},w.logicalExpressionHandler=function(I){var pe=this,De=this.createClosure(I.left),ht=this.createClosure(I.right);return function(){switch(I.operator){case"||":return De()||ht();case"&&":return De()&&ht();default:throw pe.createInternalThrowError(ka.LogicalOperatorSyntaxError,I.operator,I)}}},w.unaryExpressionHandler=function(I){var pe=this;switch(I.operator){case"delete":var De=this.createObjectGetter(I.argument),ht=this.createNameGetter(I.argument);return function(){var Kr=De(),cn=ht();return delete Kr[cn]};default:var Vt;if(I.operator==="typeof"&&I.argument.type==="Identifier"){var Wt=this.createObjectGetter(I.argument),kr=this.createNameGetter(I.argument);Vt=function(){return Wt()[kr()]}}else Vt=this.createClosure(I.argument);return function(){var Kr=Vt();switch(I.operator){case"-":return-Kr;case"+":return+Kr;case"!":return!Kr;case"~":return~Kr;case"void":return;case"typeof":return typeof Kr;default:throw pe.createInternalThrowError(ka.UnaryOperatorSyntaxError,I.operator,I)}}}},w.updateExpressionHandler=function(I){var pe=this,De=this.createObjectGetter(I.argument),ht=this.createNameGetter(I.argument);return function(){var Vt=De(),Wt=ht();switch(pe.assertVariable(Vt,Wt,I),I.operator){case"++":return I.prefix?++Vt[Wt]:Vt[Wt]++;case"--":return I.prefix?--Vt[Wt]:Vt[Wt]--;default:throw pe.createInternalThrowError(ka.UpdateOperatorSyntaxError,I.operator,I)}}},w.objectExpressionHandler=function(I){var pe=this,De=[];function ht(Wt){return Wt.type==="Identifier"?Wt.name:Wt.type==="Literal"?Wt.value:this.throwError(ka.ObjectStructureSyntaxError,Wt.type,Wt)}var Vt=Object.create(null);return I.properties.forEach(function(Wt){var kr=Wt.kind,Kr=ht(Wt.key);(!Vt[Kr]||kr==="init")&&(Vt[Kr]={}),Vt[Kr][kr]=pe.createClosure(Wt.value),De.push({key:Kr,property:Wt})}),function(){for(var Wt={},kr=De.length,Kr=0;Kr<kr;Kr++){var cn=De[Kr],Oi=cn.key,Ei=Vt[Oi],ha=Ei.init?Ei.init():void 0,Pa=Ei.get?Ei.get():function(){},ga=Ei.set?Ei.set():function(Ys){};if("set"in Ei||"get"in Ei){var _i={configurable:!0,enumerable:!0,get:Pa,set:ga};Object.defineProperty(Wt,Oi,_i)}else{var po=cn.property,wo=po.kind;po.key.type==="Identifier"&&po.value.type==="FunctionExpression"&&wo==="init"&&!po.value.id&&Be(ha,po.key.name),Wt[Oi]=ha}}return Wt}},w.arrayExpressionHandler=function(I){var pe=this,De=I.elements.map(function(ht){return ht&&pe.createClosure(ht)});return function(){for(var ht=De.length,Vt=Array(ht),Wt=0;Wt<ht;Wt++){var kr=De[Wt];kr&&(Vt[Wt]=kr())}return Vt}},w.safeObjectGet=function(I,pe,De){return I[pe]},w.createCallFunctionGetter=function(I){var pe=this;switch(I.type){case"MemberExpression":var De=this.createClosure(I.object),ht=this.createMemberKeyGetter(I),Vt=this.source;return function(){var kr=De(),Kr=ht(),cn=pe.safeObjectGet(kr,Kr,I);if(!cn||!uu(cn)){var Oi=Vt.slice(I.start,I.end);throw pe.createInternalThrowError(ka.FunctionUndefinedReferenceError,Oi,I)}return cn.__IS_EVAL_FUNC?function(Ei){return cn(new Tu(pe),Ei,!0)}:cn.__IS_FUNCTION_FUNC?function(){for(var Ei=arguments.length,ha=new Array(Ei),Pa=0;Pa<Ei;Pa++)ha[Pa]=arguments[Pa];return cn.apply(void 0,[new Tu(pe)].concat(ha))}:cn.bind(kr)};default:var Wt=this.createClosure(I);return function(){var kr="";I.type==="Identifier"&&(kr=I.name);var Kr=Wt();if(!Kr||!uu(Kr))throw pe.createInternalThrowError(ka.FunctionUndefinedReferenceError,kr,I);if(I.type==="Identifier"&&Kr.__IS_EVAL_FUNC&&kr==="eval")return function(Ei){var ha=pe.getScopeFromName(kr,pe.getCurrentScope()),Pa=ha.name===Xa||ha.name===os||ha.name===ja;return Kr(new Tu(pe),Ei,!Pa)};if(Kr.__IS_EVAL_FUNC)return function(Ei){return Kr(new Tu(pe),Ei,!0)};if(Kr.__IS_FUNCTION_FUNC)return function(){for(var Ei=arguments.length,ha=new Array(Ei),Pa=0;Pa<Ei;Pa++)ha[Pa]=arguments[Pa];return Kr.apply(void 0,[new Tu(pe)].concat(ha))};var cn=pe.options.globalContextInFunction;if(I.type==="Identifier"){var Oi=pe.getIdentifierScope(I);Oi.name===uo&&(cn=Oi.data)}return Kr.bind(cn)}}},w.callExpressionHandler=function(I){var pe=this,De=this.createCallFunctionGetter(I.callee),ht=I.arguments.map(function(Vt){return pe.createClosure(Vt)});return function(){return De().apply(void 0,ht.map(function(Vt){return Vt()}))}},w.functionExpressionHandler=function(I){var pe=this,De=this,ht=this.source,Vt=this.collectDeclVars,Wt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var kr=I.id?I.id.name:"",Kr=I.params.length,cn=I.params.map(function(Pa){return pe.createParamNameGetter(Pa)}),Oi=this.createClosure(I.body),Ei=this.collectDeclVars,ha=this.collectDeclFuncs;return this.collectDeclVars=Vt,this.collectDeclFuncs=Wt,function(){var Pa=De.getCurrentScope(),ga=function _i(){for(var po=arguments.length,wo=new Array(po),Ys=0;Ys<po;Ys++)wo[Ys]=arguments[Ys];De.callStack.push(""+kr);var lu=De.getCurrentScope(),Ks=Xs(Pa,"FunctionScope("+kr+")");De.setCurrentScope(Ks),De.addDeclarationsToScope(Ei,ha,Ks),kr&&(Ks.data[kr]=_i),Ks.data.arguments=arguments,cn.forEach(function(ys,ro){Ks.data[ys()]=wo[ro]});var Ru=De.getCurrentContext();De.setCurrentContext(this);var Go=Oi();if(De.setCurrentContext(Ru),De.setCurrentScope(lu),De.callStack.pop(),Go instanceof qo)return Go.value};return Be(ga,kr),Object.defineProperty(ga,"length",{value:Kr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ga,"toString",{value:function(){return ht.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ga,"valueOf",{value:function(){return ht.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),ga}},w.newExpressionHandler=function(I){var pe=this,De=this.source,ht=this.createClosure(I.callee),Vt=I.arguments.map(function(Wt){return pe.createClosure(Wt)});return function(){var Wt=ht();if(!uu(Wt)||Wt.__IS_EVAL_FUNC){var kr=I.callee,Kr=De.slice(kr.start,kr.end);throw pe.createInternalThrowError(ka.IsNotConstructor,Kr,I)}return Wt.__IS_FUNCTION_FUNC?Wt.apply(void 0,[new Tu(pe)].concat(Vt.map(function(cn){return cn()}))):as(Wt,Vt.map(function(cn){return cn()}))}},w.memberExpressionHandler=function(I){var pe=this.createClosure(I.object),De=this.createMemberKeyGetter(I);return function(){var ht=pe(),Vt=De();return ht[Vt]}},w.thisExpressionHandler=function(I){var pe=this;return function(){return pe.getCurrentContext()}},w.sequenceExpressionHandler=function(I){var pe=this,De=I.expressions.map(function(ht){return pe.createClosure(ht)});return function(){for(var ht,Vt=De.length,Wt=0;Wt<Vt;Wt++){var kr=De[Wt];ht=kr()}return ht}},w.literalHandler=function(I){return function(){return I.regex?new RegExp(I.regex.pattern,I.regex.flags):I.value}},w.identifierHandler=function(I){var pe=this;return function(){var De=pe.getCurrentScope(),ht=pe.getScopeDataFromName(I.name,De);return pe.assertVariable(ht,I.name,I),ht[I.name]}},w.getIdentifierScope=function(I){var pe=this.getCurrentScope(),De=this.getScopeFromName(I.name,pe);return De},w.assignmentExpressionHandler=function(I){var pe=this;I.left.type==="Identifier"&&I.right.type==="FunctionExpression"&&!I.right.id&&(I.right.id={type:"Identifier",name:I.left.name});var De=this.createObjectGetter(I.left),ht=this.createNameGetter(I.left),Vt=this.createClosure(I.right);return function(){var Wt=De(),kr=ht(),Kr=Vt();switch(I.operator!=="="&&pe.assertVariable(Wt,kr,I),I.operator){case"=":return Wt[kr]=Kr;case"+=":return Wt[kr]+=Kr;case"-=":return Wt[kr]-=Kr;case"*=":return Wt[kr]*=Kr;case"**=":return Wt[kr]=Math.pow(Wt[kr],Kr);case"/=":return Wt[kr]/=Kr;case"%=":return Wt[kr]%=Kr;case"<<=":return Wt[kr]<<=Kr;case">>=":return Wt[kr]>>=Kr;case">>>=":return Wt[kr]>>>=Kr;case"&=":return Wt[kr]&=Kr;case"^=":return Wt[kr]^=Kr;case"|=":return Wt[kr]|=Kr;default:throw pe.createInternalThrowError(ka.AssignmentExpressionSyntaxError,I.type,I)}}},w.functionDeclarationHandler=function(I){if(I.id){var pe=this.functionExpressionHandler(I);Object.defineProperty(pe,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(I.id.name,pe)}return function(){return Ai}},w.getVariableName=function(I){if(I.type==="Identifier")return I.name;throw this.createInternalThrowError(ka.VariableTypeSyntaxError,I.type,I)},w.variableDeclarationHandler=function(I){for(var pe=this,De,ht=[],Vt=0;Vt<I.declarations.length;Vt++){var Wt=I.declarations[Vt];this.varDeclaration(this.getVariableName(Wt.id)),Wt.init&&ht.push({type:"AssignmentExpression",operator:"=",left:Wt.id,right:Wt.init})}return ht.length&&(De=this.createClosure({type:"BlockStatement",body:ht})),function(){if(De){var kr=pe.isVarDeclMode;pe.isVarDeclMode=!0,De(),pe.isVarDeclMode=kr}return Ai}},w.assertVariable=function(I,pe,De){if(I===this.globalScope.data&&!(pe in I))throw this.createInternalThrowError(ka.VariableUndefinedReferenceError,pe,De)},w.programHandler=function(I){var pe=this,De=I.body.map(function(ht){return pe.createClosure(ht)});return function(){for(var ht=Ai,Vt=0;Vt<De.length;Vt++){var Wt=De[Vt],kr=pe.setValue(Wt());if(kr!==Ai&&(ht=kr,ht instanceof qo||ht instanceof ss||ht instanceof ws||ht===R||ht===qr))break}return ht}},w.expressionStatementHandler=function(I){return this.createClosure(I.expression)},w.emptyStatementHandler=function(I){return function(){return Ai}},w.returnStatementHandler=function(I){var pe=I.argument?this.createClosure(I.argument):zs;return function(){return new qo(pe())}},w.ifStatementHandler=function(I){var pe=this.createClosure(I.test),De=this.createClosure(I.consequent),ht=I.alternate?this.createClosure(I.alternate):function(){return Ai};return function(){return pe()?De():ht()}},w.conditionalExpressionHandler=function(I){return this.ifStatementHandler(I)},w.forStatementHandler=function(I){var pe=this,De=zs,ht=I.test?this.createClosure(I.test):function(){return!0},Vt=zs,Wt=this.createClosure(I.body);return I.type==="ForStatement"&&(De=I.init?this.createClosure(I.init):De,Vt=I.update?this.createClosure(I.update):zs),function(kr){var Kr,cn=Ai,Oi=I.type==="DoWhileStatement";for(kr&&kr.type==="LabeledStatement"&&(Kr=kr.label.name),De();Oi||ht();Vt()){Oi=!1;var Ei=pe.setValue(Wt());if(!(Ei===Ai||Ei===qr)){if(Ei===R)break;if(cn=Ei,cn instanceof ws&&cn.value===Kr){cn=Ai;continue}if(cn instanceof qo||cn instanceof ss||cn instanceof ws)break}}return cn}},w.whileStatementHandler=function(I){return this.forStatementHandler(I)},w.doWhileStatementHandler=function(I){return this.forStatementHandler(I)},w.forInStatementHandler=function(I){var pe=this,De=I.left,ht=this.createClosure(I.right),Vt=this.createClosure(I.body);return I.left.type==="VariableDeclaration"&&(this.createClosure(I.left)(),De=I.left.declarations[0].id),function(Wt){var kr,Kr=Ai,cn;Wt&&Wt.type==="LabeledStatement"&&(kr=Wt.label.name);var Oi=ht();for(cn in Oi){pe.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:De,right:{type:"Literal",value:cn}})();var Ei=pe.setValue(Vt());if(!(Ei===Ai||Ei===qr)){if(Ei===R)break;if(Kr=Ei,Kr instanceof ws&&Kr.value===kr){Kr=Ai;continue}if(Kr instanceof qo||Kr instanceof ss||Kr instanceof ws)break}}return Kr}},w.withStatementHandler=function(I){var pe=this,De=this.createClosure(I.object),ht=this.createClosure(I.body);return function(){var Vt=De(),Wt=pe.getCurrentScope(),kr=new us(Vt,Wt,uo);pe.setCurrentScope(kr);var Kr=pe.setValue(ht());return pe.setCurrentScope(Wt),Kr}},w.throwStatementHandler=function(I){var pe=this,De=this.createClosure(I.argument);return function(){throw pe.setValue(void 0),De()}},w.tryStatementHandler=function(I){var pe=this,De=this.createClosure(I.block),ht=I.handler?this.catchClauseHandler(I.handler):null,Vt=I.finalizer?this.createClosure(I.finalizer):null;return function(){var Wt=pe.getCurrentScope(),kr=pe.getCurrentContext(),Kr=Wt.labelStack.concat([]),cn=pe.callStack.concat([]),Oi=Ai,Ei,ha,Pa=function(){pe.setCurrentScope(Wt),pe.setCurrentContext(kr),Wt.labelStack=Kr,pe.callStack=cn};try{Oi=pe.setValue(De()),Oi instanceof qo&&(Ei=Oi)}catch(ga){if(Pa(),pe.isInterruptThrow(ga))throw ga;if(ht)try{Oi=pe.setValue(ht(ga)),Oi instanceof qo&&(Ei=Oi)}catch(_i){if(Pa(),pe.isInterruptThrow(_i))throw _i;ha=_i}}if(Vt)try{Oi=Vt(),Oi instanceof qo&&(Ei=Oi)}catch(ga){if(Pa(),pe.isInterruptThrow(ga))throw ga;ha=ga}if(ha)throw ha;return Ei||Oi}},w.catchClauseHandler=function(I){var pe=this,De=this.createParamNameGetter(I.param),ht=this.createClosure(I.body);return function(Vt){var Wt,kr=pe.getCurrentScope(),Kr=kr.data,cn=De(),Oi=mt.call(Kr,cn),Ei=Kr[cn];return Kr[cn]=Vt,Wt=ht(),Oi?Kr[cn]=Ei:delete Kr[cn],Wt}},w.continueStatementHandler=function(I){return function(){return I.label?new ws(I.label.name):qr}},w.breakStatementHandler=function(I){return function(){return I.label?new ss(I.label.name):R}},w.switchStatementHandler=function(I){var pe=this,De=this.createClosure(I.discriminant),ht=I.cases.map(function(Vt){return pe.switchCaseHandler(Vt)});return function(){for(var Vt=De(),Wt=!1,kr,Kr,cn,Oi=0;Oi<ht.length;Oi++){var Ei=ht[Oi](),ha=Ei.testClosure();if(ha===oi){cn=Ei;continue}if(Wt||ha===Vt){if(Wt=!0,Kr=pe.setValue(Ei.bodyClosure()),Kr===Ai)continue;if(Kr===R||(kr=Kr,kr instanceof qo||kr instanceof ss||kr instanceof ws||kr===qr))break}}if(!Wt&&cn){Kr=pe.setValue(cn.bodyClosure());var Pa=Kr===Ai||Kr===R||Kr===qr;Pa||(kr=Kr)}return kr}},w.switchCaseHandler=function(I){var pe=I.test?this.createClosure(I.test):function(){return oi},De=this.createClosure({type:"BlockStatement",body:I.consequent});return function(){return{testClosure:pe,bodyClosure:De}}},w.labeledStatementHandler=function(I){var pe=this,De=I.label.name,ht=this.createClosure(I.body);return function(){var Vt,Wt=pe.getCurrentScope();return Wt.labelStack.push(De),Vt=ht(I),Vt instanceof ss&&Vt.value===De&&(Vt=Ai),Wt.labelStack.pop(),Vt}},w.debuggerStatementHandler=function(I){return function(){debugger;return Ai}},w.createParamNameGetter=function(I){if(I.type==="Identifier")return function(){return I.name};throw this.createInternalThrowError(ka.ParamTypeSyntaxError,I.type,I)},w.createObjectKeyGetter=function(I){var pe;return I.type==="Identifier"?pe=function(){return I.name}:pe=this.createClosure(I),function(){return pe()}},w.createMemberKeyGetter=function(I){return I.computed?this.createClosure(I.property):this.createObjectKeyGetter(I.property)},w.createObjectGetter=function(I){var pe=this;switch(I.type){case"Identifier":return function(){return pe.getScopeDataFromName(I.name,pe.getCurrentScope())};case"MemberExpression":return this.createClosure(I.object);default:throw this.createInternalThrowError(ka.AssignmentTypeSyntaxError,I.type,I)}},w.createNameGetter=function(I){switch(I.type){case"Identifier":return function(){return I.name};case"MemberExpression":return this.createMemberKeyGetter(I);default:throw this.createInternalThrowError(ka.AssignmentTypeSyntaxError,I.type,I)}},w.varDeclaration=function(I){var pe=this.collectDeclVars;pe[I]=void 0},w.funcDeclaration=function(I,pe){var De=this.collectDeclFuncs;De[I]=pe},w.addDeclarationsToScope=function(I,pe,De){var ht=De.data;for(var Vt in pe){var Wt=pe[Vt];ht[Vt]=Wt&&Wt()}for(var kr in I)kr in ht||(ht[kr]=void 0)},w.getScopeValue=function(I,pe){var De=this.getScopeFromName(I,pe);return De.data[I]},w.getScopeDataFromName=function(I,pe){return this.getScopeFromName(I,pe).data},w.getScopeFromName=function(I,pe){var De=pe;do if(I in De.data)return De;while(De=De.parent);return this.globalScope},w.setValue=function(I){var pe=this.callStack.length;return this.isVarDeclMode||pe||I===Ai||I===R||I===qr||I instanceof ss||I instanceof ws||(this.value=I instanceof qo?I.value:I),I},w.getValue=function(){return this.value},m}();Co.version=Ee,Co.eval=Ku,Co.Function=Qo,Co.ecmaVersion=5,Co.globalContextInFunction=void 0,Co.global=Object.create(null);function vl(m){return m===void 0&&(m=Object.create(null)),m}function ml(m,w,j){w===void 0&&(w=[]),j===void 0&&(j={});var I=j.parsingContext,pe=j.timeout===void 0?0:j.timeout,De=`
    (function anonymous(`+w.join(",")+`){
         `+m+`
    });
    `,ht=new Co(I,{ecmaVersion:j.ecmaVersion,timeout:pe,rootContext:j.rootContext,globalContextInFunction:j.globalContextInFunction});return ht.evaluate(De)}function $u(m,w,j){var I=new Co(w,j);return I.evaluate(m)}var Jl=$u,gl=function(){function m(j){this._code=j}var w=m.prototype;return w.runInContext=function(I){return $u(this._code,I)},w.runInNewContext=function(I){return $u(this._code,I)},m}(),Lu=function(m,w,j){return $u(m,w,j)};function Us(){for(var m=arguments.length,w=new Array(m),j=0;j<m;j++)w[j]=arguments[j];var I=w.pop();return ml(I||"",w)}var yl=Lu},88307:function(Qe,O,y){(function(z,b){Qe.exports=b(y(18857))})(this,function(z){"use strict";var b=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},p=function(V,Oe){for(var et=Object.keys(Oe),cr=0;cr<et.length;++cr)V[et[cr]]=Oe[et[cr]];return V},X=`
`;function U(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function Y(V){var Oe=new Error("(regl) "+V);throw console.error(Oe),Oe}function $(V,Oe){V||Y(Oe)}function he(V){return V?": "+V:""}function Z(V,Oe,et){V in Oe||Y("unknown parameter ("+V+")"+he(et)+". possible values: "+Object.keys(Oe).join())}function Ie(V,Oe){b(V)||Y("invalid parameter type"+he(Oe)+". must be a typed array")}function Le(V,Oe){switch(Oe){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function rt(V,Oe,et){Le(V,Oe)||Y("invalid parameter type"+he(et)+". expected "+Oe+", got "+typeof V)}function $t(V,Oe){V>=0&&(V|0)===V||Y("invalid parameter type, ("+V+")"+he(Oe)+". must be a nonnegative integer")}function zt(V,Oe,et){Oe.indexOf(V)<0&&Y("invalid value"+he(et)+". must be one of: "+Oe)}var Lt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ht(V){Object.keys(V).forEach(function(Oe){Lt.indexOf(Oe)<0&&Y('invalid regl constructor argument "'+Oe+'". must be one of '+Lt)})}function Ct(V,Oe){for(V=V+"";V.length<Oe;)V=" "+V;return V}function yt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ft(V,Oe){this.number=V,this.line=Oe,this.errors=[]}function sr(V,Oe,et){this.file=V,this.line=Oe,this.message=et}function re(){var V=new Error,Oe=(V.stack||V).toString(),et=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Oe);if(et)return et[1];var cr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Oe);return cr?cr[1]:"unknown"}function nr(){var V=new Error,Oe=(V.stack||V).toString(),et=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Oe);if(et)return et[1];var cr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Oe);return cr?cr[1]:"unknown"}function Tt(V,Oe){var et=V.split(`
`),cr=1,Br=0,or={unknown:new yt,0:new yt};or.unknown.name=or[0].name=Oe||re(),or.unknown.lines.push(new ft(0,""));for(var Ir=0;Ir<et.length;++Ir){var Hr=et[Ir],Jr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Hr);if(Jr)switch(Jr[1]){case"line":var en=/(\d+)(\s+\d+)?/.exec(Jr[2]);en&&(cr=en[1]|0,en[2]&&(Br=en[2]|0,Br in or||(or[Br]=new yt)));break;case"define":var tn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Jr[2]);tn&&(or[Br].name=tn[1]?U(tn[2]):tn[2]);break}or[Br].lines.push(new ft(cr++,Hr))}return Object.keys(or).forEach(function(on){var xn=or[on];xn.lines.forEach(function($r){xn.index[$r.number]=$r})}),or}function $e(V){var Oe=[];return V.split(`
`).forEach(function(et){if(!(et.length<5)){var cr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(et);cr?Oe.push(new sr(cr[1]|0,cr[2]|0,cr[3].trim())):et.length>0&&Oe.push(new sr("unknown",0,et))}}),Oe}function Mt(V,Oe){Oe.forEach(function(et){var cr=V[et.file];if(cr){var Br=cr.index[et.line];if(Br){Br.errors.push(et),cr.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push(et)})}function Ve(V,Oe,et,cr,Br){if(!V.getShaderParameter(Oe,V.COMPILE_STATUS)){var or=V.getShaderInfoLog(Oe),Ir=cr===V.FRAGMENT_SHADER?"fragment":"vertex";_e(et,"string",Ir+" shader source must be a string",Br);var Hr=Tt(et,Br),Jr=$e(or);Mt(Hr,Jr),Object.keys(Hr).forEach(function(en){var tn=Hr[en];if(!tn.hasErrors)return;var on=[""],xn=[""];function $r(sn,Zt){on.push(sn),xn.push(Zt||"")}$r("file number "+en+": "+tn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),tn.lines.forEach(function(sn){if(sn.errors.length>0){$r(Ct(sn.number,4)+"|  ","background-color:yellow; font-weight:bold"),$r(sn.line+X,"color:red; background-color:yellow; font-weight:bold");var Zt=0;sn.errors.forEach(function(_r){var Qr=_r.message,kn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Qr);if(kn){var Rr=kn[1];switch(Qr=kn[2],Rr){case"assign":Rr="=";break}Zt=Math.max(sn.line.indexOf(Rr,Zt),0)}else Zt=0;$r(Ct("| ",6)),$r(Ct("^^^",Zt+3)+X,"font-weight:bold"),$r(Ct("| ",6)),$r(Qr+X,"font-weight:bold")}),$r(Ct("| ",6)+X)}else $r(Ct(sn.number,4)+"|  "),$r(sn.line+X,"color:red")}),typeof document!="undefined"&&!window.chrome?(xn[0]=on.join("%c"),console.log.apply(console,xn)):console.log(on.join(""))}),$.raise("Error compiling "+Ir+" shader, "+Hr[0].name)}}function Ot(V,Oe,et,cr,Br){if(!V.getProgramParameter(Oe,V.LINK_STATUS)){var or=V.getProgramInfoLog(Oe),Ir=Tt(et,Br),Hr=Tt(cr,Br),Jr='Error linking program with vertex shader, "'+Hr[0].name+'", and fragment shader "'+Ir[0].name+'"';typeof document!="undefined"?console.log("%c"+Jr+X+"%c"+or,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Jr+X+or),$.raise(Jr)}}function pr(V){V._commandRef=re()}function qt(V,Oe,et,cr){pr(V);function Br(Jr){return Jr?cr.id(Jr):0}V._fragId=Br(V.static.frag),V._vertId=Br(V.static.vert);function or(Jr,en){Object.keys(en).forEach(function(tn){Jr[cr.id(tn)]=!0})}var Ir=V._uniformSet={};or(Ir,Oe.static),or(Ir,Oe.dynamic);var Hr=V._attributeSet={};or(Hr,et.static),or(Hr,et.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function W(V,Oe){var et=nr();Y(V+" in command "+(Oe||re())+(et==="unknown"?"":" called from "+et))}function se(V,Oe,et){V||W(Oe,et||re())}function ke(V,Oe,et,cr){V in Oe||W("unknown parameter ("+V+")"+he(et)+". possible values: "+Object.keys(Oe).join(),cr||re())}function _e(V,Oe,et,cr){Le(V,Oe)||W("invalid parameter type"+he(et)+". expected "+Oe+", got "+typeof V,cr||re())}function Et(V){V()}function gt(V,Oe,et){V.texture?zt(V.texture._texture.internalformat,Oe,"unsupported texture format for attachment"):zt(V.renderbuffer._renderbuffer.format,et,"unsupported renderbuffer format for attachment")}var jt=33071,Ut=9728,zr=9984,dn=9985,_n=9986,Qi=9987,ur=5120,ge=5121,Pe=5122,Ge=5123,Re=5124,Nt=5125,ar=5126,yr=32819,Lr=32820,fr=33635,Fr=34042,C=36193,G={};G[ur]=G[ge]=1,G[Pe]=G[Ge]=G[C]=G[fr]=G[yr]=G[Lr]=2,G[Re]=G[Nt]=G[ar]=G[Fr]=4;function Ze(V,Oe){return V===Lr||V===yr||V===fr?2:V===Fr?4:G[V]*Oe}function tt(V){return!(V&V-1)&&!!V}function lt(V,Oe,et){var cr,Br=Oe.width,or=Oe.height,Ir=Oe.channels;$(Br>0&&Br<=et.maxTextureSize&&or>0&&or<=et.maxTextureSize,"invalid texture shape"),(V.wrapS!==jt||V.wrapT!==jt)&&$(tt(Br)&&tt(or),"incompatible wrap mode for texture, both width and height must be power of 2"),Oe.mipmask===1?Br!==1&&or!==1&&$(V.minFilter!==zr&&V.minFilter!==_n&&V.minFilter!==dn&&V.minFilter!==Qi,"min filter requires mipmap"):($(tt(Br)&&tt(or),"texture must be a square power of 2 to support mipmapping"),$(Oe.mipmask===(Br<<1)-1,"missing or incomplete mipmap data")),Oe.type===ar&&(et.extensions.indexOf("oes_texture_float_linear")<0&&$(V.minFilter===Ut&&V.magFilter===Ut,"filter not supported, must enable oes_texture_float_linear"),$(!V.genMipmaps,"mipmap generation not supported with float textures"));var Hr=Oe.images;for(cr=0;cr<16;++cr)if(Hr[cr]){var Jr=Br>>cr,en=or>>cr;$(Oe.mipmask&1<<cr,"missing mipmap data");var tn=Hr[cr];if($(tn.width===Jr&&tn.height===en,"invalid shape for mip images"),$(tn.format===Oe.format&&tn.internalformat===Oe.internalformat&&tn.type===Oe.type,"incompatible type for mip image"),!tn.compressed)if(tn.data){var on=Math.ceil(Ze(tn.type,Ir)*Jr/tn.unpackAlignment)*tn.unpackAlignment;$(tn.data.byteLength===on*en,"invalid data for image, buffer size is inconsistent with image format")}else tn.element||tn.copy}else V.genMipmaps||$((Oe.mipmask&1<<cr)==0,"extra mipmap data");Oe.compressed&&$(!V.genMipmaps,"mipmap generation for compressed images not supported")}function Pt(V,Oe,et,cr){var Br=V.width,or=V.height,Ir=V.channels;$(Br>0&&Br<=cr.maxTextureSize&&or>0&&or<=cr.maxTextureSize,"invalid texture shape"),$(Br===or,"cube map must be square"),$(Oe.wrapS===jt&&Oe.wrapT===jt,"wrap mode not supported by cube map");for(var Hr=0;Hr<et.length;++Hr){var Jr=et[Hr];$(Jr.width===Br&&Jr.height===or,"inconsistent cube map face shape"),Oe.genMipmaps&&($(!Jr.compressed,"can not generate mipmap for compressed textures"),$(Jr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var en=Jr.images,tn=0;tn<16;++tn){var on=en[tn];if(on){var xn=Br>>tn,$r=or>>tn;$(Jr.mipmask&1<<tn,"missing mipmap data"),$(on.width===xn&&on.height===$r,"invalid shape for mip images"),$(on.format===V.format&&on.internalformat===V.internalformat&&on.type===V.type,"incompatible type for mip image"),on.compressed||(on.data?$(on.data.byteLength===xn*$r*Math.max(Ze(on.type,Ir),on.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):on.element||on.copy)}}}}var q=p($,{optional:Et,raise:Y,commandRaise:W,command:se,parameter:Z,commandParameter:ke,constructor:Ht,type:rt,commandType:_e,isTypedArray:Ie,nni:$t,oneOf:zt,shaderError:Ve,linkError:Ot,callSite:nr,saveCommandRef:pr,saveDrawInfo:qt,framebufferFormat:gt,guessCommand:re,texture2D:lt,textureCube:Pt}),kt=0,Er=0,Mr=5,Je=6;function ct(V,Oe){this.id=kt++,this.type=V,this.data=Oe}function It(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Bt(V){if(V.length===0)return[];var Oe=V.charAt(0),et=V.charAt(V.length-1);if(V.length>1&&Oe===et&&(Oe==='"'||Oe==="'"))return['"'+It(V.substr(1,V.length-2))+'"'];var cr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(cr)return Bt(V.substr(0,cr.index)).concat(Bt(cr[1])).concat(Bt(V.substr(cr.index+cr[0].length)));var Br=V.split(".");if(Br.length===1)return['"'+It(V)+'"'];for(var or=[],Ir=0;Ir<Br.length;++Ir)or=or.concat(Bt(Br[Ir]));return or}function br(V){return"["+Bt(V).join("][")+"]"}function Tr(V,Oe){return new ct(V,br(Oe+""))}function qe(V){return typeof V=="function"&&!V._reglType||V instanceof ct}function Gr(V,Oe){if(typeof V=="function")return new ct(Er,V);if(typeof V=="number"||typeof V=="boolean")return new ct(Mr,V);if(Array.isArray(V))return new ct(Je,V.map(function(et,cr){return Gr(et,Oe+"["+cr+"]")}));if(V instanceof ct)return V;q(!1,"invalid option type in uniform "+Oe)}var Yr={DynamicVariable:ct,define:Tr,isDynamic:qe,unbox:Gr,accessor:br},An={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Or=vr?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function St(){var V={"":0},Oe=[""];return{id:function(et){var cr=V[et];return cr||(cr=V[et]=Oe.length,Oe.push(et),cr)},str:function(et){return Oe[et]}}}function Kn(V,Oe,et){var cr=document.createElement("canvas");p(cr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),V.appendChild(cr),V===document.body&&(cr.style.position="absolute",p(V.style,{margin:0,padding:0}));function Br(){var Hr=window.innerWidth,Jr=window.innerHeight;if(V!==document.body){var en=cr.getBoundingClientRect();Hr=en.right-en.left,Jr=en.bottom-en.top}cr.width=et*Hr,cr.height=et*Jr}var or;V!==document.body&&typeof ResizeObserver=="function"?(or=new ResizeObserver(function(){setTimeout(Br)}),or.observe(V)):window.addEventListener("resize",Br,!1);function Ir(){or?or.disconnect():window.removeEventListener("resize",Br),V.removeChild(cr)}return Br(),{canvas:cr,onDestroy:Ir}}function Ln(V,Oe){function et(cr){try{return V.getContext(cr,Oe)}catch(Br){return null}}return et("webgl")||et("experimental-webgl")||et("webgl-experimental")}function Ur(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function ee(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function fe(V){return typeof V=="string"?V.split():(q(Array.isArray(V),"invalid extension array"),V)}function me(V){return typeof V=="string"?(q(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function N(V){var Oe=V||{},et,cr,Br,or,Ir={},Hr=[],Jr=[],en=typeof window=="undefined"?1:window.devicePixelRatio,tn=!1,on=function(sn){sn&&q.raise(sn)},xn=function(){};if(typeof Oe=="string"?(q(typeof document!="undefined","selector queries only supported in DOM environments"),et=document.querySelector(Oe),q(et,"invalid query string for element")):typeof Oe=="object"?Ur(Oe)?et=Oe:ee(Oe)?(or=Oe,Br=or.canvas):(q.constructor(Oe),"gl"in Oe?or=Oe.gl:"canvas"in Oe?Br=me(Oe.canvas):"container"in Oe&&(cr=me(Oe.container)),"attributes"in Oe&&(Ir=Oe.attributes,q.type(Ir,"object","invalid context attributes")),"extensions"in Oe&&(Hr=fe(Oe.extensions)),"optionalExtensions"in Oe&&(Jr=fe(Oe.optionalExtensions)),"onDone"in Oe&&(q.type(Oe.onDone,"function","invalid or missing onDone callback"),on=Oe.onDone),"profile"in Oe&&(tn=!!Oe.profile),"pixelRatio"in Oe&&(en=+Oe.pixelRatio,q(en>0,"invalid pixel ratio"))):q.raise("invalid arguments to regl"),et&&(et.nodeName.toLowerCase()==="canvas"?Br=et:cr=et),!or){if(!Br){q(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var $r=Kn(cr||document.body,on,en);if(!$r)return null;Br=$r.canvas,xn=$r.onDestroy}Ir.premultipliedAlpha===void 0&&(Ir.premultipliedAlpha=!0),or=Ln(Br,Ir)}return or?{gl:or,canvas:Br,container:cr,extensions:Hr,optionalExtensions:Jr,pixelRatio:en,profile:tn,onDone:on,onDestroy:xn}:(xn(),on("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ae(V,Oe){var et={};function cr(Hr){q.type(Hr,"string","extension name must be string");var Jr=Hr.toLowerCase(),en;try{en=et[Jr]=Br(Hr)}catch(tn){}return!!en}function Br(Hr){return V.getExtension(Hr)?V.getExtension(Hr):V.getExtension(Hr.toLowerCase())?V.getExtension(Hr.toLowerCase()):null}for(var or=0;or<Oe.extensions.length;++or){var Ir=Oe.extensions[or];if(!cr(Ir))return Oe.onDestroy(),Oe.onDone('"'+Ir+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Oe.optionalExtensions.forEach(cr),{extensions:et,restore:function(){Object.keys(et).forEach(function(Hr){if(et[Hr]&&!cr(Hr))throw new Error("(regl): error restoring extension "+Hr)})}}}function de(V,Oe){for(var et=Array(V),cr=0;cr<V;++cr)et[cr]=Oe(cr);return et}var Te=5120,ue=5121,xe=5122,pt=5123,Cr=5124,Kt=5125,rr=5126;function Zr(V){for(var Oe=16;Oe<=1<<28;Oe*=16)if(V<=Oe)return Oe;return 0}function Nn(V){var Oe,et;return Oe=(V>65535)<<4,V>>>=Oe,et=(V>255)<<3,V>>>=et,Oe|=et,et=(V>15)<<2,V>>>=et,Oe|=et,et=(V>3)<<1,V>>>=et,Oe|=et,Oe|V>>1}function Bn(){var V=de(8,function(){return[]});function Oe(or){var Ir=Zr(or),Hr=V[Nn(Ir)>>2];return Hr.length>0?Hr.pop():new ArrayBuffer(Ir)}function et(or){V[Nn(or.byteLength)>>2].push(or)}function cr(or,Ir){var Hr=null;switch(or){case Te:Hr=new Int8Array(Oe(Ir),0,Ir);break;case ue:Hr=new Uint8Array(Oe(Ir),0,Ir);break;case xe:Hr=new Int16Array(Oe(2*Ir),0,Ir);break;case pt:Hr=new Uint16Array(Oe(2*Ir),0,Ir);break;case Cr:Hr=new Int32Array(Oe(4*Ir),0,Ir);break;case Kt:Hr=new Uint32Array(Oe(4*Ir),0,Ir);break;case rr:Hr=new Float32Array(Oe(4*Ir),0,Ir);break;default:return null}return Hr.length!==Ir?Hr.subarray(0,Ir):Hr}function Br(or){et(or.buffer)}return{alloc:Oe,free:et,allocType:cr,freeType:Br}}var tr=Bn();tr.zero=Bn();var In=3408,hn=3410,yn=3411,Ni=3412,Tn=3413,Di=3414,ra=3415,hi=33901,na=33902,Xi=3379,Ii=3386,ma=34921,Da=36347,Yi=36348,zi=35661,Ki=35660,to=34930,$o=36349,Ba=34076,qi=34024,su=7936,Au=7937,$i=7938,yo=35724,Ji=34047,Wa=36063,Jo=34852,ba=3553,Lo=34067,Ro=34069,Rs=33984,ho=6408,Vo=5126,ka=5121,so=36160,as=36053,Do=36064,Ee=16384,Be=function(V,Oe){var et=1;Oe.ext_texture_filter_anisotropic&&(et=V.getParameter(Ji));var cr=1,Br=1;Oe.webgl_draw_buffers&&(cr=V.getParameter(Jo),Br=V.getParameter(Wa));var or=!!Oe.oes_texture_float;if(or){var Ir=V.createTexture();V.bindTexture(ba,Ir),V.texImage2D(ba,0,ho,1,1,0,ho,Vo,null);var Hr=V.createFramebuffer();if(V.bindFramebuffer(so,Hr),V.framebufferTexture2D(so,Do,ba,Ir,0),V.bindTexture(ba,null),V.checkFramebufferStatus(so)!==as)or=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(Ee);var Jr=tr.allocType(Vo,4);V.readPixels(0,0,1,1,ho,Vo,Jr),V.getError()?or=!1:(V.deleteFramebuffer(Hr),V.deleteTexture(Ir),or=Jr[0]===1),tr.freeType(Jr)}}var en=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),tn=!0;if(!en){var on=V.createTexture(),xn=tr.allocType(ka,36);V.activeTexture(Rs),V.bindTexture(Lo,on),V.texImage2D(Ro,0,ho,3,3,0,ho,ka,xn),tr.freeType(xn),V.bindTexture(Lo,null),V.deleteTexture(on),tn=!V.getError()}return{colorBits:[V.getParameter(hn),V.getParameter(yn),V.getParameter(Ni),V.getParameter(Tn)],depthBits:V.getParameter(Di),stencilBits:V.getParameter(ra),subpixelBits:V.getParameter(In),extensions:Object.keys(Oe).filter(function($r){return!!Oe[$r]}),maxAnisotropic:et,maxDrawbuffers:cr,maxColorAttachments:Br,pointSizeDims:V.getParameter(hi),lineWidthDims:V.getParameter(na),maxViewportDims:V.getParameter(Ii),maxCombinedTextureUnits:V.getParameter(zi),maxCubeMapSize:V.getParameter(Ba),maxRenderbufferSize:V.getParameter(qi),maxTextureUnits:V.getParameter(to),maxTextureSize:V.getParameter(Xi),maxAttributes:V.getParameter(ma),maxVertexUniforms:V.getParameter(Da),maxVertexTextureUnits:V.getParameter(Ki),maxVaryingVectors:V.getParameter(Yi),maxFragmentUniforms:V.getParameter($o),glsl:V.getParameter(yo),renderer:V.getParameter(Au),vendor:V.getParameter(su),version:V.getParameter($i),readFloat:or,npotTextureCube:tn}};function mt(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||b(V.data))}var R=function(V){return Object.keys(V).map(function(Oe){return V[Oe]})},qr={shape:os,flatten:ja};function oi(V,Oe,et){for(var cr=0;cr<Oe;++cr)et[cr]=V[cr]}function Ai(V,Oe,et,cr){for(var Br=0,or=0;or<Oe;++or)for(var Ir=V[or],Hr=0;Hr<et;++Hr)cr[Br++]=Ir[Hr]}function uo(V,Oe,et,cr,Br,or){for(var Ir=or,Hr=0;Hr<Oe;++Hr)for(var Jr=V[Hr],en=0;en<et;++en)for(var tn=Jr[en],on=0;on<cr;++on)Br[Ir++]=tn[on]}function Xa(V,Oe,et,cr,Br){for(var or=1,Ir=et+1;Ir<Oe.length;++Ir)or*=Oe[Ir];var Hr=Oe[et];if(Oe.length-et==4){var Jr=Oe[et+1],en=Oe[et+2],tn=Oe[et+3];for(Ir=0;Ir<Hr;++Ir)uo(V[Ir],Jr,en,tn,cr,Br),Br+=or}else for(Ir=0;Ir<Hr;++Ir)Xa(V[Ir],Oe,et+1,cr,Br),Br+=or}function ja(V,Oe,et,cr){var Br=1;if(Oe.length)for(var or=0;or<Oe.length;++or)Br*=Oe[or];else Br=0;var Ir=cr||tr.allocType(et,Br);switch(Oe.length){case 0:break;case 1:oi(V,Oe[0],Ir);break;case 2:Ai(V,Oe[0],Oe[1],Ir);break;case 3:uo(V,Oe[0],Oe[1],Oe[2],Ir,0);break;default:Xa(V,Oe,0,Ir,0)}return Ir}function os(V){for(var Oe=[],et=V;et.length;et=et[0])Oe.push(et.length);return Oe}var uu={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Tu=5120,Ku=5122,Qo=5124,qo=5121,ss=5123,ws=5125,us=5126,zs=5126,Xs={int8:Tu,int16:Ku,int32:Qo,uint8:qo,uint16:ss,uint32:ws,float:us,float32:zs},As=35048,Ca=35040,Co={dynamic:As,stream:Ca,static:35044},vl=qr.flatten,ml=qr.shape,$u=35044,Jl=35040,gl=5121,Lu=5126,Us=[];Us[5120]=1,Us[5122]=2,Us[5124]=4,Us[5121]=1,Us[5123]=2,Us[5125]=4,Us[5126]=4;function yl(V){return uu[Object.prototype.toString.call(V)]|0}function m(V,Oe){for(var et=0;et<Oe.length;++et)V[et]=Oe[et]}function w(V,Oe,et,cr,Br,or,Ir){for(var Hr=0,Jr=0;Jr<et;++Jr)for(var en=0;en<cr;++en)V[Hr++]=Oe[Br*Jr+or*en+Ir]}function j(V,Oe,et,cr){var Br=0,or={};function Ir(Zt){this.id=Br++,this.buffer=V.createBuffer(),this.type=Zt,this.usage=$u,this.byteLength=0,this.dimension=1,this.dtype=gl,this.persistentData=null,et.profile&&(this.stats={size:0})}Ir.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},Ir.prototype.destroy=function(){xn(this)};var Hr=[];function Jr(Zt,_r){var Qr=Hr.pop();return Qr||(Qr=new Ir(Zt)),Qr.bind(),on(Qr,_r,Jl,0,1,!1),Qr}function en(Zt){Hr.push(Zt)}function tn(Zt,_r,Qr){Zt.byteLength=_r.byteLength,V.bufferData(Zt.type,_r,Qr)}function on(Zt,_r,Qr,kn,Rr,Pn){var ln;if(Zt.usage=Qr,Array.isArray(_r)){if(Zt.dtype=kn||Lu,_r.length>0){var pi;if(Array.isArray(_r[0])){ln=ml(_r);for(var Dr=1,Pr=1;Pr<ln.length;++Pr)Dr*=ln[Pr];Zt.dimension=Dr,pi=vl(_r,ln,Zt.dtype),tn(Zt,pi,Qr),Pn?Zt.persistentData=pi:tr.freeType(pi)}else if(typeof _r[0]=="number"){Zt.dimension=Rr;var ni=tr.allocType(Zt.dtype,_r.length);m(ni,_r),tn(Zt,ni,Qr),Pn?Zt.persistentData=ni:tr.freeType(ni)}else b(_r[0])?(Zt.dimension=_r[0].length,Zt.dtype=kn||yl(_r[0])||Lu,pi=vl(_r,[_r.length,_r[0].length],Zt.dtype),tn(Zt,pi,Qr),Pn?Zt.persistentData=pi:tr.freeType(pi)):q.raise("invalid buffer data")}}else if(b(_r))Zt.dtype=kn||yl(_r),Zt.dimension=Rr,tn(Zt,_r,Qr),Pn&&(Zt.persistentData=new Uint8Array(new Uint8Array(_r.buffer)));else if(mt(_r)){ln=_r.shape;var En=_r.stride,rn=_r.offset,Mn=0,On=0,Vi=0,Fi=0;ln.length===1?(Mn=ln[0],On=1,Vi=En[0],Fi=0):ln.length===2?(Mn=ln[0],On=ln[1],Vi=En[0],Fi=En[1]):q.raise("invalid shape"),Zt.dtype=kn||yl(_r.data)||Lu,Zt.dimension=On;var Fn=tr.allocType(Zt.dtype,Mn*On);w(Fn,_r.data,Mn,On,Vi,Fi,rn),tn(Zt,Fn,Qr),Pn?Zt.persistentData=Fn:tr.freeType(Fn)}else _r instanceof ArrayBuffer?(Zt.dtype=gl,Zt.dimension=Rr,tn(Zt,_r,Qr),Pn&&(Zt.persistentData=new Uint8Array(new Uint8Array(_r)))):q.raise("invalid buffer data")}function xn(Zt){Oe.bufferCount--,cr(Zt);var _r=Zt.buffer;q(_r,"buffer must not be deleted already"),V.deleteBuffer(_r),Zt.buffer=null,delete or[Zt.id]}function $r(Zt,_r,Qr,kn){Oe.bufferCount++;var Rr=new Ir(_r);or[Rr.id]=Rr;function Pn(Dr){var Pr=$u,ni=null,En=0,rn=0,Mn=1;return Array.isArray(Dr)||b(Dr)||mt(Dr)||Dr instanceof ArrayBuffer?ni=Dr:typeof Dr=="number"?En=Dr|0:Dr&&(q.type(Dr,"object","buffer arguments must be an object, a number or an array"),"data"in Dr&&(q(ni===null||Array.isArray(ni)||b(ni)||mt(ni),"invalid data for buffer"),ni=Dr.data),"usage"in Dr&&(q.parameter(Dr.usage,Co,"invalid buffer usage"),Pr=Co[Dr.usage]),"type"in Dr&&(q.parameter(Dr.type,Xs,"invalid buffer type"),rn=Xs[Dr.type]),"dimension"in Dr&&(q.type(Dr.dimension,"number","invalid dimension"),Mn=Dr.dimension|0),"length"in Dr&&(q.nni(En,"buffer length must be a nonnegative integer"),En=Dr.length|0)),Rr.bind(),ni?on(Rr,ni,Pr,rn,Mn,kn):(En&&V.bufferData(Rr.type,En,Pr),Rr.dtype=rn||gl,Rr.usage=Pr,Rr.dimension=Mn,Rr.byteLength=En),et.profile&&(Rr.stats.size=Rr.byteLength*Us[Rr.dtype]),Pn}function ln(Dr,Pr){q(Pr+Dr.byteLength<=Rr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Dr.byteLength+" starting from offset "+Pr+" to a buffer of size "+Rr.byteLength),V.bufferSubData(Rr.type,Pr,Dr)}function pi(Dr,Pr){var ni=(Pr||0)|0,En;if(Rr.bind(),b(Dr)||Dr instanceof ArrayBuffer)ln(Dr,ni);else if(Array.isArray(Dr)){if(Dr.length>0)if(typeof Dr[0]=="number"){var rn=tr.allocType(Rr.dtype,Dr.length);m(rn,Dr),ln(rn,ni),tr.freeType(rn)}else if(Array.isArray(Dr[0])||b(Dr[0])){En=ml(Dr);var Mn=vl(Dr,En,Rr.dtype);ln(Mn,ni),tr.freeType(Mn)}else q.raise("invalid buffer data")}else if(mt(Dr)){En=Dr.shape;var On=Dr.stride,Vi=0,Fi=0,Fn=0,wn=0;En.length===1?(Vi=En[0],Fi=1,Fn=On[0],wn=0):En.length===2?(Vi=En[0],Fi=En[1],Fn=On[0],wn=On[1]):q.raise("invalid shape");var Ti=Array.isArray(Dr.data)?Rr.dtype:yl(Dr.data),Ui=tr.allocType(Ti,Vi*Fi);w(Ui,Dr.data,Vi,Fi,Fn,wn,Dr.offset),ln(Ui,ni),tr.freeType(Ui)}else q.raise("invalid data for buffer subdata");return Pn}return Qr||Pn(Zt),Pn._reglType="buffer",Pn._buffer=Rr,Pn.subdata=pi,et.profile&&(Pn.stats=Rr.stats),Pn.destroy=function(){xn(Rr)},Pn}function sn(){R(or).forEach(function(Zt){Zt.buffer=V.createBuffer(),V.bindBuffer(Zt.type,Zt.buffer),V.bufferData(Zt.type,Zt.persistentData||Zt.byteLength,Zt.usage)})}return et.profile&&(Oe.getTotalBufferSize=function(){var Zt=0;return Object.keys(or).forEach(function(_r){Zt+=or[_r].stats.size}),Zt}),{create:$r,createStream:Jr,destroyStream:en,clear:function(){R(or).forEach(xn),Hr.forEach(xn)},getBuffer:function(Zt){return Zt&&Zt._buffer instanceof Ir?Zt._buffer:null},restore:sn,_initBuffer:on}}var I=0,pe=0,De=1,ht=1,Vt=4,Wt=4,kr={points:I,point:pe,lines:De,line:ht,triangles:Vt,triangle:Wt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Kr=0,cn=1,Oi=4,Ei=5120,ha=5121,Pa=5122,ga=5123,_i=5124,po=5125,wo=34963,Ys=35040,lu=35044;function Ks(V,Oe,et,cr){var Br={},or=0,Ir={uint8:ha,uint16:ga};Oe.oes_element_index_uint&&(Ir.uint32=po);function Hr(sn){this.id=or++,Br[this.id]=this,this.buffer=sn,this.primType=Oi,this.vertCount=0,this.type=0}Hr.prototype.bind=function(){this.buffer.bind()};var Jr=[];function en(sn){var Zt=Jr.pop();return Zt||(Zt=new Hr(et.create(null,wo,!0,!1)._buffer)),on(Zt,sn,Ys,-1,-1,0,0),Zt}function tn(sn){Jr.push(sn)}function on(sn,Zt,_r,Qr,kn,Rr,Pn){sn.buffer.bind();var ln;if(Zt){var pi=Pn;!Pn&&(!b(Zt)||mt(Zt)&&!b(Zt.data))&&(pi=Oe.oes_element_index_uint?po:ga),et._initBuffer(sn.buffer,Zt,_r,pi,3)}else V.bufferData(wo,Rr,_r),sn.buffer.dtype=ln||ha,sn.buffer.usage=_r,sn.buffer.dimension=3,sn.buffer.byteLength=Rr;if(ln=Pn,!Pn){switch(sn.buffer.dtype){case ha:case Ei:ln=ha;break;case ga:case Pa:ln=ga;break;case po:case _i:ln=po;break;default:q.raise("unsupported type for element array")}sn.buffer.dtype=ln}sn.type=ln,q(ln!==po||!!Oe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Dr=kn;Dr<0&&(Dr=sn.buffer.byteLength,ln===ga?Dr>>=1:ln===po&&(Dr>>=2)),sn.vertCount=Dr;var Pr=Qr;if(Qr<0){Pr=Oi;var ni=sn.buffer.dimension;ni===1&&(Pr=Kr),ni===2&&(Pr=cn),ni===3&&(Pr=Oi)}sn.primType=Pr}function xn(sn){cr.elementsCount--,q(sn.buffer!==null,"must not double destroy elements"),delete Br[sn.id],sn.buffer.destroy(),sn.buffer=null}function $r(sn,Zt){var _r=et.create(null,wo,!0),Qr=new Hr(_r._buffer);cr.elementsCount++;function kn(Rr){if(!Rr)_r(),Qr.primType=Oi,Qr.vertCount=0,Qr.type=ha;else if(typeof Rr=="number")_r(Rr),Qr.primType=Oi,Qr.vertCount=Rr|0,Qr.type=ha;else{var Pn=null,ln=lu,pi=-1,Dr=-1,Pr=0,ni=0;Array.isArray(Rr)||b(Rr)||mt(Rr)?Pn=Rr:(q.type(Rr,"object","invalid arguments for elements"),"data"in Rr&&(Pn=Rr.data,q(Array.isArray(Pn)||b(Pn)||mt(Pn),"invalid data for element buffer")),"usage"in Rr&&(q.parameter(Rr.usage,Co,"invalid element buffer usage"),ln=Co[Rr.usage]),"primitive"in Rr&&(q.parameter(Rr.primitive,kr,"invalid element buffer primitive"),pi=kr[Rr.primitive]),"count"in Rr&&(q(typeof Rr.count=="number"&&Rr.count>=0,"invalid vertex count for elements"),Dr=Rr.count|0),"type"in Rr&&(q.parameter(Rr.type,Ir,"invalid buffer type"),ni=Ir[Rr.type]),"length"in Rr?Pr=Rr.length|0:(Pr=Dr,ni===ga||ni===Pa?Pr*=2:(ni===po||ni===_i)&&(Pr*=4))),on(Qr,Pn,ln,pi,Dr,Pr,ni)}return kn}return kn(sn),kn._reglType="elements",kn._elements=Qr,kn.subdata=function(Rr,Pn){return _r.subdata(Rr,Pn),kn},kn.destroy=function(){xn(Qr)},kn}return{create:$r,createStream:en,destroyStream:tn,getElements:function(sn){return typeof sn=="function"&&sn._elements instanceof Hr?sn._elements:null},clear:function(){R(Br).forEach(xn)}}}var Ru=new Float32Array(1),Go=new Uint32Array(Ru.buffer),ys=5123;function ro(V){for(var Oe=tr.allocType(ys,V.length),et=0;et<V.length;++et)if(isNaN(V[et]))Oe[et]=65535;else if(V[et]===Infinity)Oe[et]=31744;else if(V[et]===-Infinity)Oe[et]=64512;else{Ru[0]=V[et];var cr=Go[0],Br=cr>>>31<<15,or=(cr<<1>>>24)-127,Ir=cr>>13&(1<<10)-1;if(or<-24)Oe[et]=Br;else if(or<-14){var Hr=-14-or;Oe[et]=Br+(Ir+(1<<10)>>Hr)}else or>15?Oe[et]=Br+31744:Oe[et]=Br+(or+15<<10)+Ir}return Oe}function Ia(V){return Array.isArray(V)||b(V)}var $s=function(V){return!(V&V-1)&&!!V},_l=34467,_s=3553,Dl=34067,Js=34069,Qs=6408,yc=6406,Du=6407,Oa=6409,xl=6410,Kc=32854,ku=32855,bl=36194,$c=32819,Ju=32820,Ql=33635,Pu=34042,Qu=6402,Sl=34041,El=35904,qu=35906,Cl=36193,el=33776,qs=33777,ql=33778,Fu=33779,Oc=35986,tl=35987,wl=34798,kl=35840,_c=35841,Fl=35842,Lc=35843,ec=36196,Zs=5121,no=5123,_o=5125,Bu=5126,Ds=10242,Bl=10243,tc=10497,gu=33071,rc=33648,Nu=10240,io=10241,Nl=9728,js=9729,cu=9984,la=9985,Pi=9986,xs=9987,fu=33170,rl=4352,es=4353,Jc=4354,Rc=34046,Al=3317,zl=37440,yu=37441,Ao=37443,zu=37444,Tl=33984,To=[cu,Pi,la,xs],Rn=[0,Oa,xl,Du,Qs],lo={};lo[Oa]=lo[yc]=lo[Qu]=1,lo[Sl]=lo[xl]=2,lo[Du]=lo[El]=3,lo[Qs]=lo[qu]=4;function _u(V){return"[object "+V+"]"}var Uu=_u("HTMLCanvasElement"),Ya=_u("OffscreenCanvas"),ks=_u("CanvasRenderingContext2D"),xc=_u("ImageBitmap"),Sn=_u("HTMLImageElement"),Mu=_u("HTMLVideoElement"),bc=Object.keys(uu).concat([Uu,Ya,ks,xc,Sn,Mu]),eu=[];eu[Zs]=1,eu[Bu]=4,eu[Cl]=2,eu[no]=2,eu[_o]=4;var Ua=[];Ua[Kc]=2,Ua[ku]=2,Ua[bl]=2,Ua[Sl]=4,Ua[el]=.5,Ua[qs]=.5,Ua[ql]=1,Ua[Fu]=1,Ua[Oc]=.5,Ua[tl]=1,Ua[wl]=1,Ua[kl]=.5,Ua[_c]=.25,Ua[Fl]=.5,Ua[Lc]=.25,Ua[ec]=.5;function bs(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function Pl(V){if(!Array.isArray(V))return!1;var Oe=V.length;return!(Oe===0||!Ia(V[0]))}function tu(V){return Object.prototype.toString.call(V)}function Ts(V){return tu(V)===Uu}function xu(V){return tu(V)===Ya}function Qc(V){return tu(V)===ks}function nc(V){return tu(V)===xc}function ic(V){return tu(V)===Sn}function ko(V){return tu(V)===Mu}function Vs(V){var Oe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Oe&&V&&V.getContext)}function Po(V){if(!V)return!1;if(Vs(V))return!0;var Oe=tu(V);return bc.indexOf(Oe)>=0?!0:bs(V)||Pl(V)||mt(V)}function ta(V){return uu[Object.prototype.toString.call(V)]|0}function Zu(V,Oe){var et=Oe.length;switch(V.type){case Zs:case no:case _o:case Bu:var cr=tr.allocType(V.type,et);cr.set(Oe),V.data=cr;break;case Cl:V.data=ro(Oe);break;default:q.raise("unsupported texture type, must specify a typed array")}}function hu(V,Oe){return tr.allocType(V.type===Cl?Bu:V.type,Oe)}function Ho(V,Oe){V.type===Cl?(V.data=ro(Oe),tr.freeType(Oe)):V.data=Oe}function nl(V,Oe,et,cr,Br,or){for(var Ir=V.width,Hr=V.height,Jr=V.channels,en=Ir*Hr*Jr,tn=hu(V,en),on=0,xn=0;xn<Hr;++xn)for(var $r=0;$r<Ir;++$r)for(var sn=0;sn<Jr;++sn)tn[on++]=Oe[et*$r+cr*xn+Br*sn+or];Ho(V,tn)}function bu(V,Oe,et,cr,Br,or){var Ir;if(typeof Ua[V]!="undefined"?Ir=Ua[V]:Ir=lo[V]*eu[Oe],or&&(Ir*=6),Br){for(var Hr=0,Jr=et;Jr>=1;)Hr+=Ir*Jr*Jr,Jr/=2;return Hr}else return Ir*et*cr}function bi(V,Oe,et,cr,Br,or,Ir){var Hr={"don't care":rl,"dont care":rl,nice:Jc,fast:es},Jr={repeat:tc,clamp:gu,mirror:rc},en={nearest:Nl,linear:js},tn=p({mipmap:xs,"nearest mipmap nearest":cu,"linear mipmap nearest":la,"nearest mipmap linear":Pi,"linear mipmap linear":xs},en),on={none:0,browser:zu},xn={uint8:Zs,rgba4:$c,rgb565:Ql,"rgb5 a1":Ju},$r={alpha:yc,luminance:Oa,"luminance alpha":xl,rgb:Du,rgba:Qs,rgba4:Kc,"rgb5 a1":ku,rgb565:bl},sn={};Oe.ext_srgb&&($r.srgb=El,$r.srgba=qu),Oe.oes_texture_float&&(xn.float32=xn.float=Bu),Oe.oes_texture_half_float&&(xn.float16=xn["half float"]=Cl),Oe.webgl_depth_texture&&(p($r,{depth:Qu,"depth stencil":Sl}),p(xn,{uint16:no,uint32:_o,"depth stencil":Pu})),Oe.webgl_compressed_texture_s3tc&&p(sn,{"rgb s3tc dxt1":el,"rgba s3tc dxt1":qs,"rgba s3tc dxt3":ql,"rgba s3tc dxt5":Fu}),Oe.webgl_compressed_texture_atc&&p(sn,{"rgb atc":Oc,"rgba atc explicit alpha":tl,"rgba atc interpolated alpha":wl}),Oe.webgl_compressed_texture_pvrtc&&p(sn,{"rgb pvrtc 4bppv1":kl,"rgb pvrtc 2bppv1":_c,"rgba pvrtc 4bppv1":Fl,"rgba pvrtc 2bppv1":Lc}),Oe.webgl_compressed_texture_etc1&&(sn["rgb etc1"]=ec);var Zt=Array.prototype.slice.call(V.getParameter(_l)||new Uint32Array(0));Object.keys(sn).forEach(function(He){var ir=sn[He];Zt.indexOf(ir)>=0&&($r[He]=ir)});var _r=Object.keys($r);et.textureFormats=_r;var Qr=[];Object.keys($r).forEach(function(He){var ir=$r[He];Qr[ir]=He});var kn=[];Object.keys(xn).forEach(function(He){var ir=xn[He];kn[ir]=He});var Rr=[];Object.keys(en).forEach(function(He){var ir=en[He];Rr[ir]=He});var Pn=[];Object.keys(tn).forEach(function(He){var ir=tn[He];Pn[ir]=He});var ln=[];Object.keys(Jr).forEach(function(He){var ir=Jr[He];ln[ir]=He});var pi=_r.reduce(function(He,ir){var er=$r[ir];return er===Oa||er===yc||er===Oa||er===xl||er===Qu||er===Sl||Oe.ext_srgb&&(er===El||er===qu)?He[er]=er:er===ku||ir.indexOf("rgba")>=0?He[er]=Qs:He[er]=Du,He},{});function Dr(){this.internalformat=Qs,this.format=Qs,this.type=Zs,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=zu,this.width=0,this.height=0,this.channels=0}function Pr(He,ir){He.internalformat=ir.internalformat,He.format=ir.format,He.type=ir.type,He.compressed=ir.compressed,He.premultiplyAlpha=ir.premultiplyAlpha,He.flipY=ir.flipY,He.unpackAlignment=ir.unpackAlignment,He.colorSpace=ir.colorSpace,He.width=ir.width,He.height=ir.height,He.channels=ir.channels}function ni(He,ir){if(!(typeof ir!="object"||!ir)){if("premultiplyAlpha"in ir&&(q.type(ir.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),He.premultiplyAlpha=ir.premultiplyAlpha),"flipY"in ir&&(q.type(ir.flipY,"boolean","invalid texture flip"),He.flipY=ir.flipY),"alignment"in ir&&(q.oneOf(ir.alignment,[1,2,4,8],"invalid texture unpack alignment"),He.unpackAlignment=ir.alignment),"colorSpace"in ir&&(q.parameter(ir.colorSpace,on,"invalid colorSpace"),He.colorSpace=on[ir.colorSpace]),"type"in ir){var er=ir.type;q(Oe.oes_texture_float||!(er==="float"||er==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),q(Oe.oes_texture_half_float||!(er==="half float"||er==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),q(Oe.webgl_depth_texture||!(er==="uint16"||er==="uint32"||er==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),q.parameter(er,xn,"invalid texture type"),He.type=xn[er]}var Xn=He.width,fa=He.height,Ne=He.channels,be=!1;"shape"in ir?(q(Array.isArray(ir.shape)&&ir.shape.length>=2,"shape must be an array"),Xn=ir.shape[0],fa=ir.shape[1],ir.shape.length===3&&(Ne=ir.shape[2],q(Ne>0&&Ne<=4,"invalid number of channels"),be=!0),q(Xn>=0&&Xn<=et.maxTextureSize,"invalid width"),q(fa>=0&&fa<=et.maxTextureSize,"invalid height")):("radius"in ir&&(Xn=fa=ir.radius,q(Xn>=0&&Xn<=et.maxTextureSize,"invalid radius")),"width"in ir&&(Xn=ir.width,q(Xn>=0&&Xn<=et.maxTextureSize,"invalid width")),"height"in ir&&(fa=ir.height,q(fa>=0&&fa<=et.maxTextureSize,"invalid height")),"channels"in ir&&(Ne=ir.channels,q(Ne>0&&Ne<=4,"invalid number of channels"),be=!0)),He.width=Xn|0,He.height=fa|0,He.channels=Ne|0;var nt=!1;if("format"in ir){var Gt=ir.format;q(Oe.webgl_depth_texture||!(Gt==="depth"||Gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),q.parameter(Gt,$r,"invalid texture format");var lr=He.internalformat=$r[Gt];He.format=pi[lr],Gt in xn&&("type"in ir||(He.type=xn[Gt])),Gt in sn&&(He.compressed=!0),nt=!0}!be&&nt?He.channels=lo[He.format]:be&&!nt?He.channels!==Rn[He.format]&&(He.format=He.internalformat=Rn[He.channels]):nt&&be&&q(He.channels===lo[He.format],"number of channels inconsistent with specified format")}}function En(He){V.pixelStorei(zl,He.flipY),V.pixelStorei(yu,He.premultiplyAlpha),V.pixelStorei(Ao,He.colorSpace),V.pixelStorei(Al,He.unpackAlignment)}function rn(){Dr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Mn(He,ir){var er=null;if(Po(ir)?er=ir:ir&&(q.type(ir,"object","invalid pixel data type"),ni(He,ir),"x"in ir&&(He.xOffset=ir.x|0),"y"in ir&&(He.yOffset=ir.y|0),Po(ir.data)&&(er=ir.data)),q(!He.compressed||er instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ir.copy){q(!er,"can not specify copy and data field for the same texture");var Xn=Br.viewportWidth,fa=Br.viewportHeight;He.width=He.width||Xn-He.xOffset,He.height=He.height||fa-He.yOffset,He.needsCopy=!0,q(He.xOffset>=0&&He.xOffset<Xn&&He.yOffset>=0&&He.yOffset<fa&&He.width>0&&He.width<=Xn&&He.height>0&&He.height<=fa,"copy texture read out of bounds")}else if(!er)He.width=He.width||1,He.height=He.height||1,He.channels=He.channels||4;else if(b(er))He.channels=He.channels||4,He.data=er,!("type"in ir)&&He.type===Zs&&(He.type=ta(er));else if(bs(er))He.channels=He.channels||4,Zu(He,er),He.alignment=1,He.needsFree=!0;else if(mt(er)){var Ne=er.data;!Array.isArray(Ne)&&He.type===Zs&&(He.type=ta(Ne));var be=er.shape,nt=er.stride,Gt,lr,xt,vt,at,Fe;be.length===3?(xt=be[2],Fe=nt[2]):(q(be.length===2,"invalid ndarray pixel data, must be 2 or 3D"),xt=1,Fe=1),Gt=be[0],lr=be[1],vt=nt[0],at=nt[1],He.alignment=1,He.width=Gt,He.height=lr,He.channels=xt,He.format=He.internalformat=Rn[xt],He.needsFree=!0,nl(He,Ne,vt,at,Fe,er.offset)}else if(Vs(er)||Ts(er)||xu(er)||Qc(er))Vs(er)||Ts(er)||xu(er)?He.element=er:He.element=er.canvas,He.width=He.element.width,He.height=He.element.height,He.channels=4;else if(nc(er))He.element=er,He.width=er.width,He.height=er.height,He.channels=4;else if(ic(er))He.element=er,He.width=er.naturalWidth,He.height=er.naturalHeight,He.channels=4;else if(ko(er))He.element=er,He.width=er.videoWidth,He.height=er.videoHeight,He.channels=4;else if(Pl(er)){var ot=He.width||er[0].length,Ue=He.height||er.length,Xt=He.channels;Ia(er[0][0])?Xt=Xt||er[0][0].length:Xt=Xt||1;for(var Jt=qr.shape(er),jr=1,gn=0;gn<Jt.length;++gn)jr*=Jt[gn];var an=hu(He,jr);qr.flatten(er,Jt,"",an),Ho(He,an),He.alignment=1,He.width=ot,He.height=Ue,He.channels=Xt,He.format=He.internalformat=Rn[Xt],He.needsFree=!0}He.type===Bu?q(et.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):He.type===Cl&&q(et.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function On(He,ir,er){var Xn=He.element,fa=He.data,Ne=He.internalformat,be=He.format,nt=He.type,Gt=He.width,lr=He.height;En(He),Xn?V.texImage2D(ir,er,be,be,nt,Xn):He.compressed?V.compressedTexImage2D(ir,er,Ne,Gt,lr,0,fa):He.needsCopy?(cr(),V.copyTexImage2D(ir,er,be,He.xOffset,He.yOffset,Gt,lr,0)):V.texImage2D(ir,er,be,Gt,lr,0,be,nt,fa||null)}function Vi(He,ir,er,Xn,fa){var Ne=He.element,be=He.data,nt=He.internalformat,Gt=He.format,lr=He.type,xt=He.width,vt=He.height;En(He),Ne?V.texSubImage2D(ir,fa,er,Xn,Gt,lr,Ne):He.compressed?V.compressedTexSubImage2D(ir,fa,er,Xn,nt,xt,vt,be):He.needsCopy?(cr(),V.copyTexSubImage2D(ir,fa,er,Xn,He.xOffset,He.yOffset,xt,vt)):V.texSubImage2D(ir,fa,er,Xn,xt,vt,Gt,lr,be)}var Fi=[];function Fn(){return Fi.pop()||new rn}function wn(He){He.needsFree&&tr.freeType(He.data),rn.call(He),Fi.push(He)}function Ti(){Dr.call(this),this.genMipmaps=!1,this.mipmapHint=rl,this.mipmask=0,this.images=Array(16)}function Ui(He,ir,er){var Xn=He.images[0]=Fn();He.mipmask=1,Xn.width=He.width=ir,Xn.height=He.height=er,Xn.channels=He.channels=4}function va(He,ir){var er=null;if(Po(ir))er=He.images[0]=Fn(),Pr(er,He),Mn(er,ir),He.mipmask=1;else if(ni(He,ir),Array.isArray(ir.mipmap))for(var Xn=ir.mipmap,fa=0;fa<Xn.length;++fa)er=He.images[fa]=Fn(),Pr(er,He),er.width>>=fa,er.height>>=fa,Mn(er,Xn[fa]),He.mipmask|=1<<fa;else er=He.images[0]=Fn(),Pr(er,He),Mn(er,ir),He.mipmask=1;Pr(He,He.images[0]),He.compressed&&(He.internalformat===el||He.internalformat===qs||He.internalformat===ql||He.internalformat===Fu)&&q(He.width%4==0&&He.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function zo(He,ir){for(var er=He.images,Xn=0;Xn<er.length;++Xn){if(!er[Xn])return;On(er[Xn],ir,Xn)}}var xo=[];function sa(){var He=xo.pop()||new Ti;Dr.call(He),He.mipmask=0;for(var ir=0;ir<16;++ir)He.images[ir]=null;return He}function hs(He){for(var ir=He.images,er=0;er<ir.length;++er)ir[er]&&wn(ir[er]),ir[er]=null;xo.push(He)}function oo(){this.minFilter=Nl,this.magFilter=Nl,this.wrapS=gu,this.wrapT=gu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=rl}function Xo(He,ir){if("min"in ir){var er=ir.min;q.parameter(er,tn),He.minFilter=tn[er],To.indexOf(He.minFilter)>=0&&!("faces"in ir)&&(He.genMipmaps=!0)}if("mag"in ir){var Xn=ir.mag;q.parameter(Xn,en),He.magFilter=en[Xn]}var fa=He.wrapS,Ne=He.wrapT;if("wrap"in ir){var be=ir.wrap;typeof be=="string"?(q.parameter(be,Jr),fa=Ne=Jr[be]):Array.isArray(be)&&(q.parameter(be[0],Jr),q.parameter(be[1],Jr),fa=Jr[be[0]],Ne=Jr[be[1]])}else{if("wrapS"in ir){var nt=ir.wrapS;q.parameter(nt,Jr),fa=Jr[nt]}if("wrapT"in ir){var Gt=ir.wrapT;q.parameter(Gt,Jr),Ne=Jr[Gt]}}if(He.wrapS=fa,He.wrapT=Ne,"anisotropic"in ir){var lr=ir.anisotropic;q(typeof lr=="number"&&lr>=1&&lr<=et.maxAnisotropic,"aniso samples must be between 1 and "),He.anisotropic=ir.anisotropic}if("mipmap"in ir){var xt=!1;switch(typeof ir.mipmap){case"string":q.parameter(ir.mipmap,Hr,"invalid mipmap hint"),He.mipmapHint=Hr[ir.mipmap],He.genMipmaps=!0,xt=!0;break;case"boolean":xt=He.genMipmaps=ir.mipmap;break;case"object":q(Array.isArray(ir.mipmap),"invalid mipmap type"),He.genMipmaps=!1,xt=!0;break;default:q.raise("invalid mipmap type")}xt&&!("min"in ir)&&(He.minFilter=cu)}}function Uo(He,ir){V.texParameteri(ir,io,He.minFilter),V.texParameteri(ir,Nu,He.magFilter),V.texParameteri(ir,Ds,He.wrapS),V.texParameteri(ir,Bl,He.wrapT),Oe.ext_texture_filter_anisotropic&&V.texParameteri(ir,Rc,He.anisotropic),He.genMipmaps&&(V.hint(fu,He.mipmapHint),V.generateMipmap(ir))}var Is=0,Ns={},Cs=et.maxTextureUnits,Yo=Array(Cs).map(function(){return null});function wi(He){Dr.call(this),this.mipmask=0,this.internalformat=Qs,this.id=Is++,this.refCount=1,this.target=He,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new oo,Ir.profile&&(this.stats={size:0})}function Zo(He){V.activeTexture(Tl),V.bindTexture(He.target,He.texture)}function Ma(){var He=Yo[0];He?V.bindTexture(He.target,He.texture):V.bindTexture(_s,null)}function Io(He){var ir=He.texture;q(ir,"must not double destroy texture");var er=He.unit,Xn=He.target;er>=0&&(V.activeTexture(Tl+er),V.bindTexture(Xn,null),Yo[er]=null),V.deleteTexture(ir),He.texture=null,He.params=null,He.pixels=null,He.refCount=0,delete Ns[He.id],or.textureCount--}p(wi.prototype,{bind:function(){var He=this;He.bindCount+=1;var ir=He.unit;if(ir<0){for(var er=0;er<Cs;++er){var Xn=Yo[er];if(Xn){if(Xn.bindCount>0)continue;Xn.unit=-1}Yo[er]=He,ir=er;break}ir>=Cs&&q.raise("insufficient number of texture units"),Ir.profile&&or.maxTextureUnits<ir+1&&(or.maxTextureUnits=ir+1),He.unit=ir,V.activeTexture(Tl+ir),V.bindTexture(He.target,He.texture)}return ir},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Io(this)}});function ki(He,ir){var er=new wi(_s);Ns[er.id]=er,or.textureCount++;function Xn(be,nt){var Gt=er.texInfo;oo.call(Gt);var lr=sa();return typeof be=="number"?typeof nt=="number"?Ui(lr,be|0,nt|0):Ui(lr,be|0,be|0):be?(q.type(be,"object","invalid arguments to regl.texture"),Xo(Gt,be),va(lr,be)):Ui(lr,1,1),Gt.genMipmaps&&(lr.mipmask=(lr.width<<1)-1),er.mipmask=lr.mipmask,Pr(er,lr),q.texture2D(Gt,lr,et),er.internalformat=lr.internalformat,Xn.width=lr.width,Xn.height=lr.height,Zo(er),zo(lr,_s),Uo(Gt,_s),Ma(),hs(lr),Ir.profile&&(er.stats.size=bu(er.internalformat,er.type,lr.width,lr.height,Gt.genMipmaps,!1)),Xn.format=Qr[er.internalformat],Xn.type=kn[er.type],Xn.mag=Rr[Gt.magFilter],Xn.min=Pn[Gt.minFilter],Xn.wrapS=ln[Gt.wrapS],Xn.wrapT=ln[Gt.wrapT],Xn}function fa(be,nt,Gt,lr){q(!!be,"must specify image data");var xt=nt|0,vt=Gt|0,at=lr|0,Fe=Fn();return Pr(Fe,er),Fe.width=0,Fe.height=0,Mn(Fe,be),Fe.width=Fe.width||(er.width>>at)-xt,Fe.height=Fe.height||(er.height>>at)-vt,q(er.type===Fe.type&&er.format===Fe.format&&er.internalformat===Fe.internalformat,"incompatible format for texture.subimage"),q(xt>=0&&vt>=0&&xt+Fe.width<=er.width&&vt+Fe.height<=er.height,"texture.subimage write out of bounds"),q(er.mipmask&1<<at,"missing mipmap data"),q(Fe.data||Fe.element||Fe.needsCopy,"missing image data"),Zo(er),Vi(Fe,_s,xt,vt,at),Ma(),wn(Fe),Xn}function Ne(be,nt){var Gt=be|0,lr=nt|0||Gt;if(Gt===er.width&&lr===er.height)return Xn;Xn.width=er.width=Gt,Xn.height=er.height=lr,Zo(er);for(var xt=0;er.mipmask>>xt;++xt){var vt=Gt>>xt,at=lr>>xt;if(!vt||!at)break;V.texImage2D(_s,xt,er.format,vt,at,0,er.format,er.type,null)}return Ma(),Ir.profile&&(er.stats.size=bu(er.internalformat,er.type,Gt,lr,!1,!1)),Xn}return Xn(He,ir),Xn.subimage=fa,Xn.resize=Ne,Xn._reglType="texture2d",Xn._texture=er,Ir.profile&&(Xn.stats=er.stats),Xn.destroy=function(){er.decRef()},Xn}function ca(He,ir,er,Xn,fa,Ne){var be=new wi(Dl);Ns[be.id]=be,or.cubeCount++;var nt=new Array(6);function Gt(vt,at,Fe,ot,Ue,Xt){var Jt,jr=be.texInfo;for(oo.call(jr),Jt=0;Jt<6;++Jt)nt[Jt]=sa();if(typeof vt=="number"||!vt){var gn=vt|0||1;for(Jt=0;Jt<6;++Jt)Ui(nt[Jt],gn,gn)}else if(typeof vt=="object")if(at)va(nt[0],vt),va(nt[1],at),va(nt[2],Fe),va(nt[3],ot),va(nt[4],Ue),va(nt[5],Xt);else if(Xo(jr,vt),ni(be,vt),"faces"in vt){var an=vt.faces;for(q(Array.isArray(an)&&an.length===6,"cube faces must be a length 6 array"),Jt=0;Jt<6;++Jt)q(typeof an[Jt]=="object"&&!!an[Jt],"invalid input for cube map face"),Pr(nt[Jt],be),va(nt[Jt],an[Jt])}else for(Jt=0;Jt<6;++Jt)va(nt[Jt],vt);else q.raise("invalid arguments to cube map");for(Pr(be,nt[0]),q.optional(function(){et.npotTextureCube||q($s(be.width)&&$s(be.height),"your browser does not support non power or two texture dimensions")}),jr.genMipmaps?be.mipmask=(nt[0].width<<1)-1:be.mipmask=nt[0].mipmask,q.textureCube(be,jr,nt,et),be.internalformat=nt[0].internalformat,Gt.width=nt[0].width,Gt.height=nt[0].height,Zo(be),Jt=0;Jt<6;++Jt)zo(nt[Jt],Js+Jt);for(Uo(jr,Dl),Ma(),Ir.profile&&(be.stats.size=bu(be.internalformat,be.type,Gt.width,Gt.height,jr.genMipmaps,!0)),Gt.format=Qr[be.internalformat],Gt.type=kn[be.type],Gt.mag=Rr[jr.magFilter],Gt.min=Pn[jr.minFilter],Gt.wrapS=ln[jr.wrapS],Gt.wrapT=ln[jr.wrapT],Jt=0;Jt<6;++Jt)hs(nt[Jt]);return Gt}function lr(vt,at,Fe,ot,Ue){q(!!at,"must specify image data"),q(typeof vt=="number"&&vt===(vt|0)&&vt>=0&&vt<6,"invalid face");var Xt=Fe|0,Jt=ot|0,jr=Ue|0,gn=Fn();return Pr(gn,be),gn.width=0,gn.height=0,Mn(gn,at),gn.width=gn.width||(be.width>>jr)-Xt,gn.height=gn.height||(be.height>>jr)-Jt,q(be.type===gn.type&&be.format===gn.format&&be.internalformat===gn.internalformat,"incompatible format for texture.subimage"),q(Xt>=0&&Jt>=0&&Xt+gn.width<=be.width&&Jt+gn.height<=be.height,"texture.subimage write out of bounds"),q(be.mipmask&1<<jr,"missing mipmap data"),q(gn.data||gn.element||gn.needsCopy,"missing image data"),Zo(be),Vi(gn,Js+vt,Xt,Jt,jr),Ma(),wn(gn),Gt}function xt(vt){var at=vt|0;if(at!==be.width){Gt.width=be.width=at,Gt.height=be.height=at,Zo(be);for(var Fe=0;Fe<6;++Fe)for(var ot=0;be.mipmask>>ot;++ot)V.texImage2D(Js+Fe,ot,be.format,at>>ot,at>>ot,0,be.format,be.type,null);return Ma(),Ir.profile&&(be.stats.size=bu(be.internalformat,be.type,Gt.width,Gt.height,!1,!0)),Gt}}return Gt(He,ir,er,Xn,fa,Ne),Gt.subimage=lr,Gt.resize=xt,Gt._reglType="textureCube",Gt._texture=be,Ir.profile&&(Gt.stats=be.stats),Gt.destroy=function(){be.decRef()},Gt}function Ja(){for(var He=0;He<Cs;++He)V.activeTexture(Tl+He),V.bindTexture(_s,null),Yo[He]=null;R(Ns).forEach(Io),or.cubeCount=0,or.textureCount=0}Ir.profile&&(or.getTotalTextureSize=function(){var He=0;return Object.keys(Ns).forEach(function(ir){He+=Ns[ir].stats.size}),He});function bo(){for(var He=0;He<Cs;++He){var ir=Yo[He];ir&&(ir.bindCount=0,ir.unit=-1,Yo[He]=null)}R(Ns).forEach(function(er){er.texture=V.createTexture(),V.bindTexture(er.target,er.texture);for(var Xn=0;Xn<32;++Xn)if((er.mipmask&1<<Xn)!=0)if(er.target===_s)V.texImage2D(_s,Xn,er.internalformat,er.width>>Xn,er.height>>Xn,0,er.internalformat,er.type,null);else for(var fa=0;fa<6;++fa)V.texImage2D(Js+fa,Xn,er.internalformat,er.width>>Xn,er.height>>Xn,0,er.internalformat,er.type,null);Uo(er.texInfo,er.target)})}function pl(){for(var He=0;He<Cs;++He){var ir=Yo[He];ir&&(ir.bindCount=0,ir.unit=-1,Yo[He]=null),V.activeTexture(Tl+He),V.bindTexture(_s,null),V.bindTexture(Dl,null)}}return{create2D:ki,createCube:ca,clear:Ja,getTexture:function(He){return null},restore:bo,refresh:pl}}var co=36161,Ml=32854,Vn=32855,Gn=36194,il=33189,ts=36168,ls=34041,Mo=35907,ru=34836,Dc=34842,ac=34843,Wi=[];Wi[Ml]=2,Wi[Vn]=2,Wi[Gn]=2,Wi[il]=2,Wi[ts]=1,Wi[ls]=4,Wi[Mo]=4,Wi[ru]=16,Wi[Dc]=8,Wi[ac]=6;function Zi(V,Oe,et){return Wi[V]*Oe*et}var qc=function(V,Oe,et,cr,Br){var or={rgba4:Ml,rgb565:Gn,"rgb5 a1":Vn,depth:il,stencil:ts,"depth stencil":ls};Oe.ext_srgb&&(or.srgba=Mo),Oe.ext_color_buffer_half_float&&(or.rgba16f=Dc,or.rgb16f=ac),Oe.webgl_color_buffer_float&&(or.rgba32f=ru);var Ir=[];Object.keys(or).forEach(function($r){var sn=or[$r];Ir[sn]=$r});var Hr=0,Jr={};function en($r){this.id=Hr++,this.refCount=1,this.renderbuffer=$r,this.format=Ml,this.width=0,this.height=0,Br.profile&&(this.stats={size:0})}en.prototype.decRef=function(){--this.refCount<=0&&tn(this)};function tn($r){var sn=$r.renderbuffer;q(sn,"must not double destroy renderbuffer"),V.bindRenderbuffer(co,null),V.deleteRenderbuffer(sn),$r.renderbuffer=null,$r.refCount=0,delete Jr[$r.id],cr.renderbufferCount--}function on($r,sn){var Zt=new en(V.createRenderbuffer());Jr[Zt.id]=Zt,cr.renderbufferCount++;function _r(kn,Rr){var Pn=0,ln=0,pi=Ml;if(typeof kn=="object"&&kn){var Dr=kn;if("shape"in Dr){var Pr=Dr.shape;q(Array.isArray(Pr)&&Pr.length>=2,"invalid renderbuffer shape"),Pn=Pr[0]|0,ln=Pr[1]|0}else"radius"in Dr&&(Pn=ln=Dr.radius|0),"width"in Dr&&(Pn=Dr.width|0),"height"in Dr&&(ln=Dr.height|0);"format"in Dr&&(q.parameter(Dr.format,or,"invalid renderbuffer format"),pi=or[Dr.format])}else typeof kn=="number"?(Pn=kn|0,typeof Rr=="number"?ln=Rr|0:ln=Pn):kn?q.raise("invalid arguments to renderbuffer constructor"):Pn=ln=1;if(q(Pn>0&&ln>0&&Pn<=et.maxRenderbufferSize&&ln<=et.maxRenderbufferSize,"invalid renderbuffer size"),!(Pn===Zt.width&&ln===Zt.height&&pi===Zt.format))return _r.width=Zt.width=Pn,_r.height=Zt.height=ln,Zt.format=pi,V.bindRenderbuffer(co,Zt.renderbuffer),V.renderbufferStorage(co,pi,Pn,ln),q(V.getError()===0,"invalid render buffer format"),Br.profile&&(Zt.stats.size=Zi(Zt.format,Zt.width,Zt.height)),_r.format=Ir[Zt.format],_r}function Qr(kn,Rr){var Pn=kn|0,ln=Rr|0||Pn;return Pn===Zt.width&&ln===Zt.height||(q(Pn>0&&ln>0&&Pn<=et.maxRenderbufferSize&&ln<=et.maxRenderbufferSize,"invalid renderbuffer size"),_r.width=Zt.width=Pn,_r.height=Zt.height=ln,V.bindRenderbuffer(co,Zt.renderbuffer),V.renderbufferStorage(co,Zt.format,Pn,ln),q(V.getError()===0,"invalid render buffer format"),Br.profile&&(Zt.stats.size=Zi(Zt.format,Zt.width,Zt.height))),_r}return _r($r,sn),_r.resize=Qr,_r._reglType="renderbuffer",_r._renderbuffer=Zt,Br.profile&&(_r.stats=Zt.stats),_r.destroy=function(){Zt.decRef()},_r}Br.profile&&(cr.getTotalRenderbufferSize=function(){var $r=0;return Object.keys(Jr).forEach(function(sn){$r+=Jr[sn].stats.size}),$r});function xn(){R(Jr).forEach(function($r){$r.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(co,$r.renderbuffer),V.renderbufferStorage(co,$r.format,$r.width,$r.height)}),V.bindRenderbuffer(co,null)}return{create:on,clear:function(){R(Jr).forEach(tn)},restore:xn}},Ps=36160,Il=36161,Ms=3553,Va=34069,nu=36064,Ss=36096,ju=36128,al=33306,Ol=36053,oc=36054,ol=36055,sl=36057,ul=36061,Su=36193,Vu=5121,Sc=5126,Eu=6407,Fs=6408,kc=6402,sc=[Eu,Fs],Ul=[];Ul[Fs]=4,Ul[Eu]=3;var ll=[];ll[Vu]=1,ll[Sc]=4,ll[Su]=2;var i=32854,u=32855,o=36194,h=33189,_=36168,E=34041,T=35907,k=34836,K=34842,le=34843,Ce=[i,u,o,T,K,le,k],we={};we[Ol]="complete",we[oc]="incomplete attachment",we[sl]="incomplete dimensions",we[ol]="incomplete, missing attachment",we[ul]="unsupported";function Me(V,Oe,et,cr,Br,or){var Ir={cur:null,next:null,dirty:!1,setFBO:null},Hr=["rgba"],Jr=["rgba4","rgb565","rgb5 a1"];Oe.ext_srgb&&Jr.push("srgba"),Oe.ext_color_buffer_half_float&&Jr.push("rgba16f","rgb16f"),Oe.webgl_color_buffer_float&&Jr.push("rgba32f");var en=["uint8"];Oe.oes_texture_half_float&&en.push("half float","float16"),Oe.oes_texture_float&&en.push("float","float32");function tn(rn,Mn,On){this.target=rn,this.texture=Mn,this.renderbuffer=On;var Vi=0,Fi=0;Mn?(Vi=Mn.width,Fi=Mn.height):On&&(Vi=On.width,Fi=On.height),this.width=Vi,this.height=Fi}function on(rn){rn&&(rn.texture&&rn.texture._texture.decRef(),rn.renderbuffer&&rn.renderbuffer._renderbuffer.decRef())}function xn(rn,Mn,On){if(!!rn)if(rn.texture){var Vi=rn.texture._texture,Fi=Math.max(1,Vi.width),Fn=Math.max(1,Vi.height);q(Fi===Mn&&Fn===On,"inconsistent width/height for supplied texture"),Vi.refCount+=1}else{var wn=rn.renderbuffer._renderbuffer;q(wn.width===Mn&&wn.height===On,"inconsistent width/height for renderbuffer"),wn.refCount+=1}}function $r(rn,Mn){Mn&&(Mn.texture?V.framebufferTexture2D(Ps,rn,Mn.target,Mn.texture._texture.texture,0):V.framebufferRenderbuffer(Ps,rn,Il,Mn.renderbuffer._renderbuffer.renderbuffer))}function sn(rn){var Mn=Ms,On=null,Vi=null,Fi=rn;typeof rn=="object"&&(Fi=rn.data,"target"in rn&&(Mn=rn.target|0)),q.type(Fi,"function","invalid attachment data");var Fn=Fi._reglType;return Fn==="texture2d"?(On=Fi,q(Mn===Ms)):Fn==="textureCube"?(On=Fi,q(Mn>=Va&&Mn<Va+6,"invalid cube map target")):Fn==="renderbuffer"?(Vi=Fi,Mn=Il):q.raise("invalid regl object for attachment"),new tn(Mn,On,Vi)}function Zt(rn,Mn,On,Vi,Fi){if(On){var Fn=cr.create2D({width:rn,height:Mn,format:Vi,type:Fi});return Fn._texture.refCount=0,new tn(Ms,Fn,null)}else{var wn=Br.create({width:rn,height:Mn,format:Vi});return wn._renderbuffer.refCount=0,new tn(Il,null,wn)}}function _r(rn){return rn&&(rn.texture||rn.renderbuffer)}function Qr(rn,Mn,On){rn&&(rn.texture?rn.texture.resize(Mn,On):rn.renderbuffer&&rn.renderbuffer.resize(Mn,On),rn.width=Mn,rn.height=On)}var kn=0,Rr={};function Pn(){this.id=kn++,Rr[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ln(rn){rn.colorAttachments.forEach(on),on(rn.depthAttachment),on(rn.stencilAttachment),on(rn.depthStencilAttachment)}function pi(rn){var Mn=rn.framebuffer;q(Mn,"must not double destroy framebuffer"),V.deleteFramebuffer(Mn),rn.framebuffer=null,or.framebufferCount--,delete Rr[rn.id]}function Dr(rn){var Mn;V.bindFramebuffer(Ps,rn.framebuffer);var On=rn.colorAttachments;for(Mn=0;Mn<On.length;++Mn)$r(nu+Mn,On[Mn]);for(Mn=On.length;Mn<et.maxColorAttachments;++Mn)V.framebufferTexture2D(Ps,nu+Mn,Ms,null,0);V.framebufferTexture2D(Ps,al,Ms,null,0),V.framebufferTexture2D(Ps,Ss,Ms,null,0),V.framebufferTexture2D(Ps,ju,Ms,null,0),$r(Ss,rn.depthAttachment),$r(ju,rn.stencilAttachment),$r(al,rn.depthStencilAttachment);var Vi=V.checkFramebufferStatus(Ps);!V.isContextLost()&&Vi!==Ol&&q.raise("framebuffer configuration not supported, status = "+we[Vi]),V.bindFramebuffer(Ps,Ir.next?Ir.next.framebuffer:null),Ir.cur=Ir.next,V.getError()}function Pr(rn,Mn){var On=new Pn;or.framebufferCount++;function Vi(Fn,wn){var Ti;q(Ir.next!==On,"can not update framebuffer which is currently in use");var Ui=0,va=0,zo=!0,xo=!0,sa=null,hs=!0,oo="rgba",Xo="uint8",Uo=1,Is=null,Ns=null,Cs=null,Yo=!1;if(typeof Fn=="number")Ui=Fn|0,va=wn|0||Ui;else if(!Fn)Ui=va=1;else{q.type(Fn,"object","invalid arguments for framebuffer");var wi=Fn;if("shape"in wi){var Zo=wi.shape;q(Array.isArray(Zo)&&Zo.length>=2,"invalid shape for framebuffer"),Ui=Zo[0],va=Zo[1]}else"radius"in wi&&(Ui=va=wi.radius),"width"in wi&&(Ui=wi.width),"height"in wi&&(va=wi.height);("color"in wi||"colors"in wi)&&(sa=wi.color||wi.colors,Array.isArray(sa)&&q(sa.length===1||Oe.webgl_draw_buffers,"multiple render targets not supported")),sa||("colorCount"in wi&&(Uo=wi.colorCount|0,q(Uo>0,"invalid color buffer count")),"colorTexture"in wi&&(hs=!!wi.colorTexture,oo="rgba4"),"colorType"in wi&&(Xo=wi.colorType,hs?(q(Oe.oes_texture_float||!(Xo==="float"||Xo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),q(Oe.oes_texture_half_float||!(Xo==="half float"||Xo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Xo==="half float"||Xo==="float16"?(q(Oe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),oo="rgba16f"):(Xo==="float"||Xo==="float32")&&(q(Oe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),oo="rgba32f"),q.oneOf(Xo,en,"invalid color type")),"colorFormat"in wi&&(oo=wi.colorFormat,Hr.indexOf(oo)>=0?hs=!0:Jr.indexOf(oo)>=0?hs=!1:q.optional(function(){hs?q.oneOf(wi.colorFormat,Hr,"invalid color format for texture"):q.oneOf(wi.colorFormat,Jr,"invalid color format for renderbuffer")}))),("depthTexture"in wi||"depthStencilTexture"in wi)&&(Yo=!!(wi.depthTexture||wi.depthStencilTexture),q(!Yo||Oe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in wi&&(typeof wi.depth=="boolean"?zo=wi.depth:(Is=wi.depth,xo=!1)),"stencil"in wi&&(typeof wi.stencil=="boolean"?xo=wi.stencil:(Ns=wi.stencil,zo=!1)),"depthStencil"in wi&&(typeof wi.depthStencil=="boolean"?zo=xo=wi.depthStencil:(Cs=wi.depthStencil,zo=!1,xo=!1))}var Ma=null,Io=null,ki=null,ca=null;if(Array.isArray(sa))Ma=sa.map(sn);else if(sa)Ma=[sn(sa)];else for(Ma=new Array(Uo),Ti=0;Ti<Uo;++Ti)Ma[Ti]=Zt(Ui,va,hs,oo,Xo);q(Oe.webgl_draw_buffers||Ma.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),q(Ma.length<=et.maxColorAttachments,"too many color attachments, not supported"),Ui=Ui||Ma[0].width,va=va||Ma[0].height,Is?Io=sn(Is):zo&&!xo&&(Io=Zt(Ui,va,Yo,"depth","uint32")),Ns?ki=sn(Ns):xo&&!zo&&(ki=Zt(Ui,va,!1,"stencil","uint8")),Cs?ca=sn(Cs):!Is&&!Ns&&xo&&zo&&(ca=Zt(Ui,va,Yo,"depth stencil","depth stencil")),q(!!Is+!!Ns+!!Cs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ja=null;for(Ti=0;Ti<Ma.length;++Ti)if(xn(Ma[Ti],Ui,va),q(!Ma[Ti]||Ma[Ti].texture&&sc.indexOf(Ma[Ti].texture._texture.format)>=0||Ma[Ti].renderbuffer&&Ce.indexOf(Ma[Ti].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ti+" is invalid"),Ma[Ti]&&Ma[Ti].texture){var bo=Ul[Ma[Ti].texture._texture.format]*ll[Ma[Ti].texture._texture.type];Ja===null?Ja=bo:q(Ja===bo,"all color attachments much have the same number of bits per pixel.")}return xn(Io,Ui,va),q(!Io||Io.texture&&Io.texture._texture.format===kc||Io.renderbuffer&&Io.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),xn(ki,Ui,va),q(!ki||ki.renderbuffer&&ki.renderbuffer._renderbuffer.format===_,"invalid stencil attachment for framebuffer object"),xn(ca,Ui,va),q(!ca||ca.texture&&ca.texture._texture.format===E||ca.renderbuffer&&ca.renderbuffer._renderbuffer.format===E,"invalid depth-stencil attachment for framebuffer object"),ln(On),On.width=Ui,On.height=va,On.colorAttachments=Ma,On.depthAttachment=Io,On.stencilAttachment=ki,On.depthStencilAttachment=ca,Vi.color=Ma.map(_r),Vi.depth=_r(Io),Vi.stencil=_r(ki),Vi.depthStencil=_r(ca),Vi.width=On.width,Vi.height=On.height,Dr(On),Vi}function Fi(Fn,wn){q(Ir.next!==On,"can not resize a framebuffer which is currently in use");var Ti=Math.max(Fn|0,1),Ui=Math.max(wn|0||Ti,1);if(Ti===On.width&&Ui===On.height)return Vi;for(var va=On.colorAttachments,zo=0;zo<va.length;++zo)Qr(va[zo],Ti,Ui);return Qr(On.depthAttachment,Ti,Ui),Qr(On.stencilAttachment,Ti,Ui),Qr(On.depthStencilAttachment,Ti,Ui),On.width=Vi.width=Ti,On.height=Vi.height=Ui,Dr(On),Vi}return Vi(rn,Mn),p(Vi,{resize:Fi,_reglType:"framebuffer",_framebuffer:On,destroy:function(){pi(On),ln(On)},use:function(Fn){Ir.setFBO({framebuffer:Vi},Fn)}})}function ni(rn){var Mn=Array(6);function On(Fi){var Fn;q(Mn.indexOf(Ir.next)<0,"can not update framebuffer which is currently in use");var wn={color:null},Ti=0,Ui=null,va="rgba",zo="uint8",xo=1;if(typeof Fi=="number")Ti=Fi|0;else if(!Fi)Ti=1;else{q.type(Fi,"object","invalid arguments for framebuffer");var sa=Fi;if("shape"in sa){var hs=sa.shape;q(Array.isArray(hs)&&hs.length>=2,"invalid shape for framebuffer"),q(hs[0]===hs[1],"cube framebuffer must be square"),Ti=hs[0]}else"radius"in sa&&(Ti=sa.radius|0),"width"in sa?(Ti=sa.width|0,"height"in sa&&q(sa.height===Ti,"must be square")):"height"in sa&&(Ti=sa.height|0);("color"in sa||"colors"in sa)&&(Ui=sa.color||sa.colors,Array.isArray(Ui)&&q(Ui.length===1||Oe.webgl_draw_buffers,"multiple render targets not supported")),Ui||("colorCount"in sa&&(xo=sa.colorCount|0,q(xo>0,"invalid color buffer count")),"colorType"in sa&&(q.oneOf(sa.colorType,en,"invalid color type"),zo=sa.colorType),"colorFormat"in sa&&(va=sa.colorFormat,q.oneOf(sa.colorFormat,Hr,"invalid color format for texture"))),"depth"in sa&&(wn.depth=sa.depth),"stencil"in sa&&(wn.stencil=sa.stencil),"depthStencil"in sa&&(wn.depthStencil=sa.depthStencil)}var oo;if(Ui)if(Array.isArray(Ui))for(oo=[],Fn=0;Fn<Ui.length;++Fn)oo[Fn]=Ui[Fn];else oo=[Ui];else{oo=Array(xo);var Xo={radius:Ti,format:va,type:zo};for(Fn=0;Fn<xo;++Fn)oo[Fn]=cr.createCube(Xo)}for(wn.color=Array(oo.length),Fn=0;Fn<oo.length;++Fn){var Uo=oo[Fn];q(typeof Uo=="function"&&Uo._reglType==="textureCube","invalid cube map"),Ti=Ti||Uo.width,q(Uo.width===Ti&&Uo.height===Ti,"invalid cube map shape"),wn.color[Fn]={target:Va,data:oo[Fn]}}for(Fn=0;Fn<6;++Fn){for(var Is=0;Is<oo.length;++Is)wn.color[Is].target=Va+Fn;Fn>0&&(wn.depth=Mn[0].depth,wn.stencil=Mn[0].stencil,wn.depthStencil=Mn[0].depthStencil),Mn[Fn]?Mn[Fn](wn):Mn[Fn]=Pr(wn)}return p(On,{width:Ti,height:Ti,color:oo})}function Vi(Fi){var Fn,wn=Fi|0;if(q(wn>0&&wn<=et.maxCubeMapSize,"invalid radius for cube fbo"),wn===On.width)return On;var Ti=On.color;for(Fn=0;Fn<Ti.length;++Fn)Ti[Fn].resize(wn);for(Fn=0;Fn<6;++Fn)Mn[Fn].resize(wn);return On.width=On.height=wn,On}return On(rn),p(On,{faces:Mn,resize:Vi,_reglType:"framebufferCube",destroy:function(){Mn.forEach(function(Fi){Fi.destroy()})}})}function En(){Ir.cur=null,Ir.next=null,Ir.dirty=!0,R(Rr).forEach(function(rn){rn.framebuffer=V.createFramebuffer(),Dr(rn)})}return p(Ir,{getFramebuffer:function(rn){if(typeof rn=="function"&&rn._reglType==="framebuffer"){var Mn=rn._framebuffer;if(Mn instanceof Pn)return Mn}return null},create:Pr,createCube:ni,clear:function(){R(Rr).forEach(pi)},restore:En})}var Ye=5126,Xe=34962,st=34963,je=["attributes","elements","offset","count","primitive","instances"];function ut(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ye,this.offset=0,this.stride=0,this.divisor=0}function At(V,Oe,et,cr,Br,or,Ir){for(var Hr=et.maxAttributes,Jr=new Array(Hr),en=0;en<Hr;++en)Jr[en]=new ut;var tn=0,on={},xn={Record:ut,scope:{},state:Jr,currentVAO:null,targetVAO:null,restore:sn()?ln:function(){},createVAO:pi,getVAO:_r,destroyBuffer:$r,setVAO:sn()?Qr:kn,clear:sn()?Rr:function(){}};function $r(Dr){for(var Pr=0;Pr<Jr.length;++Pr){var ni=Jr[Pr];ni.buffer===Dr&&(V.disableVertexAttribArray(Pr),ni.buffer=null)}}function sn(){return Oe.oes_vertex_array_object}function Zt(){return Oe.angle_instanced_arrays}function _r(Dr){return typeof Dr=="function"&&Dr._vao?Dr._vao:null}function Qr(Dr){if(Dr!==xn.currentVAO){var Pr=sn();Dr?Pr.bindVertexArrayOES(Dr.vao):Pr.bindVertexArrayOES(null),xn.currentVAO=Dr}}function kn(Dr){if(Dr!==xn.currentVAO){if(Dr)Dr.bindAttrs();else{for(var Pr=Zt(),ni=0;ni<Jr.length;++ni){var En=Jr[ni];En.buffer?(V.enableVertexAttribArray(ni),En.buffer.bind(),V.vertexAttribPointer(ni,En.size,En.type,En.normalized,En.stride,En.offfset),Pr&&En.divisor&&Pr.vertexAttribDivisorANGLE(ni,En.divisor)):(V.disableVertexAttribArray(ni),V.vertexAttrib4f(ni,En.x,En.y,En.z,En.w))}Ir.elements?V.bindBuffer(st,Ir.elements.buffer.buffer):V.bindBuffer(st,null)}xn.currentVAO=Dr}}function Rr(){R(on).forEach(function(Dr){Dr.destroy()})}function Pn(){this.id=++tn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Dr=sn();Dr?this.vao=Dr.createVertexArrayOES():this.vao=null,on[this.id]=this,this.buffers=[]}Pn.prototype.bindAttrs=function(){for(var Dr=Zt(),Pr=this.attributes,ni=0;ni<Pr.length;++ni){var En=Pr[ni];En.buffer?(V.enableVertexAttribArray(ni),V.bindBuffer(Xe,En.buffer.buffer),V.vertexAttribPointer(ni,En.size,En.type,En.normalized,En.stride,En.offset),Dr&&En.divisor&&Dr.vertexAttribDivisorANGLE(ni,En.divisor)):(V.disableVertexAttribArray(ni),V.vertexAttrib4f(ni,En.x,En.y,En.z,En.w))}for(var rn=Pr.length;rn<Hr;++rn)V.disableVertexAttribArray(rn);var Mn=or.getElements(this.elements);Mn?V.bindBuffer(st,Mn.buffer.buffer):V.bindBuffer(st,null)},Pn.prototype.refresh=function(){var Dr=sn();Dr&&(Dr.bindVertexArrayOES(this.vao),this.bindAttrs(),xn.currentVAO=null,Dr.bindVertexArrayOES(null))},Pn.prototype.destroy=function(){if(this.vao){var Dr=sn();this===xn.currentVAO&&(xn.currentVAO=null,Dr.bindVertexArrayOES(null)),Dr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),on[this.id]&&(delete on[this.id],cr.vaoCount-=1)};function ln(){var Dr=sn();Dr&&R(on).forEach(function(Pr){Pr.refresh()})}function pi(Dr){var Pr=new Pn;cr.vaoCount+=1;function ni(En){var rn;if(Array.isArray(En))rn=En,Pr.elements&&Pr.ownsElements&&Pr.elements.destroy(),Pr.elements=null,Pr.ownsElements=!1,Pr.offset=0,Pr.count=0,Pr.instances=-1,Pr.primitive=4;else{if(q(typeof En=="object","invalid arguments for create vao"),q("attributes"in En,"must specify attributes for vao"),En.elements){var Mn=En.elements;Pr.ownsElements?typeof Mn=="function"&&Mn._reglType==="elements"?(Pr.elements.destroy(),Pr.ownsElements=!1):(Pr.elements(Mn),Pr.ownsElements=!1):or.getElements(En.elements)?(Pr.elements=En.elements,Pr.ownsElements=!1):(Pr.elements=or.create(En.elements),Pr.ownsElements=!0)}else Pr.elements=null,Pr.ownsElements=!1;rn=En.attributes,Pr.offset=0,Pr.count=-1,Pr.instances=-1,Pr.primitive=4,Pr.elements&&(Pr.count=Pr.elements._elements.vertCount,Pr.primitive=Pr.elements._elements.primType),"offset"in En&&(Pr.offset=En.offset|0),"count"in En&&(Pr.count=En.count|0),"instances"in En&&(Pr.instances=En.instances|0),"primitive"in En&&(q(En.primitive in kr,"bad primitive type: "+En.primitive),Pr.primitive=kr[En.primitive]),q.optional(()=>{for(var zo=Object.keys(En),xo=0;xo<zo.length;++xo)q(je.indexOf(zo[xo])>=0,'invalid option for vao: "'+zo[xo]+'" valid options are '+je)}),q(Array.isArray(rn),"attributes must be an array")}q(rn.length<Hr,"too many attributes"),q(rn.length>0,"must specify at least one attribute");var On={},Vi=Pr.attributes;Vi.length=rn.length;for(var Fi=0;Fi<rn.length;++Fi){var Fn=rn[Fi],wn=Vi[Fi]=new ut,Ti=Fn.data||Fn;if(Array.isArray(Ti)||b(Ti)||mt(Ti)){var Ui;Pr.buffers[Fi]&&(Ui=Pr.buffers[Fi],b(Ti)&&Ui._buffer.byteLength>=Ti.byteLength?Ui.subdata(Ti):(Ui.destroy(),Pr.buffers[Fi]=null)),Pr.buffers[Fi]||(Ui=Pr.buffers[Fi]=Br.create(Fn,Xe,!1,!0)),wn.buffer=Br.getBuffer(Ui),wn.size=wn.buffer.dimension|0,wn.normalized=!1,wn.type=wn.buffer.dtype,wn.offset=0,wn.stride=0,wn.divisor=0,wn.state=1,On[Fi]=1}else Br.getBuffer(Fn)?(wn.buffer=Br.getBuffer(Fn),wn.size=wn.buffer.dimension|0,wn.normalized=!1,wn.type=wn.buffer.dtype,wn.offset=0,wn.stride=0,wn.divisor=0,wn.state=1):Br.getBuffer(Fn.buffer)?(wn.buffer=Br.getBuffer(Fn.buffer),wn.size=(+Fn.size||wn.buffer.dimension)|0,wn.normalized=!!Fn.normalized||!1,"type"in Fn?(q.parameter(Fn.type,Xs,"invalid buffer type"),wn.type=Xs[Fn.type]):wn.type=wn.buffer.dtype,wn.offset=(Fn.offset||0)|0,wn.stride=(Fn.stride||0)|0,wn.divisor=(Fn.divisor||0)|0,wn.state=1,q(wn.size>=1&&wn.size<=4,"size must be between 1 and 4"),q(wn.offset>=0,"invalid offset"),q(wn.stride>=0&&wn.stride<=255,"stride must be between 0 and 255"),q(wn.divisor>=0,"divisor must be positive"),q(!wn.divisor||!!Oe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Fn?(q(Fi>0,"first attribute must not be a constant"),wn.x=+Fn.x||0,wn.y=+Fn.y||0,wn.z=+Fn.z||0,wn.w=+Fn.w||0,wn.state=2):q(!1,"invalid attribute spec for location "+Fi)}for(var va=0;va<Pr.buffers.length;++va)!On[va]&&Pr.buffers[va]&&(Pr.buffers[va].destroy(),Pr.buffers[va]=null);return Pr.refresh(),ni}return ni.destroy=function(){for(var En=0;En<Pr.buffers.length;++En)Pr.buffers[En]&&Pr.buffers[En].destroy();Pr.buffers.length=0,Pr.ownsElements&&(Pr.elements.destroy(),Pr.elements=null,Pr.ownsElements=!1),Pr.destroy()},ni._vao=Pr,ni._reglType="vao",ni(Dr)}return xn}var Yt=35632,Sr=35633,dr=35718,wr=35721;function Wr(V,Oe,et,cr){var Br={},or={};function Ir(Zt,_r,Qr,kn){this.name=Zt,this.id=_r,this.location=Qr,this.info=kn}function Hr(Zt,_r){for(var Qr=0;Qr<Zt.length;++Qr)if(Zt[Qr].id===_r.id){Zt[Qr].location=_r.location;return}Zt.push(_r)}function Jr(Zt,_r,Qr){var kn=Zt===Yt?Br:or,Rr=kn[_r];if(!Rr){var Pn=Oe.str(_r);Rr=V.createShader(Zt),V.shaderSource(Rr,Pn),V.compileShader(Rr),q.shaderError(V,Rr,Pn,Zt,Qr),kn[_r]=Rr}return Rr}var en={},tn=[],on=0;function xn(Zt,_r){this.id=on++,this.fragId=Zt,this.vertId=_r,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,cr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function $r(Zt,_r,Qr){var kn,Rr,Pn=Jr(Yt,Zt.fragId),ln=Jr(Sr,Zt.vertId),pi=Zt.program=V.createProgram();if(V.attachShader(pi,Pn),V.attachShader(pi,ln),Qr)for(kn=0;kn<Qr.length;++kn){var Dr=Qr[kn];V.bindAttribLocation(pi,Dr[0],Dr[1])}V.linkProgram(pi),q.linkError(V,pi,Oe.str(Zt.fragId),Oe.str(Zt.vertId),_r);var Pr=V.getProgramParameter(pi,dr);cr.profile&&(Zt.stats.uniformsCount=Pr);var ni=Zt.uniforms;for(kn=0;kn<Pr;++kn)if(Rr=V.getActiveUniform(pi,kn),Rr)if(Rr.size>1)for(var En=0;En<Rr.size;++En){var rn=Rr.name.replace("[0]","["+En+"]");Hr(ni,new Ir(rn,Oe.id(rn),V.getUniformLocation(pi,rn),Rr))}else Hr(ni,new Ir(Rr.name,Oe.id(Rr.name),V.getUniformLocation(pi,Rr.name),Rr));var Mn=V.getProgramParameter(pi,wr);cr.profile&&(Zt.stats.attributesCount=Mn);var On=Zt.attributes;for(kn=0;kn<Mn;++kn)Rr=V.getActiveAttrib(pi,kn),Rr&&Hr(On,new Ir(Rr.name,Oe.id(Rr.name),V.getAttribLocation(pi,Rr.name),Rr))}cr.profile&&(et.getMaxUniformsCount=function(){var Zt=0;return tn.forEach(function(_r){_r.stats.uniformsCount>Zt&&(Zt=_r.stats.uniformsCount)}),Zt},et.getMaxAttributesCount=function(){var Zt=0;return tn.forEach(function(_r){_r.stats.attributesCount>Zt&&(Zt=_r.stats.attributesCount)}),Zt});function sn(){Br={},or={};for(var Zt=0;Zt<tn.length;++Zt)$r(tn[Zt],null,tn[Zt].attributes.map(function(_r){return[_r.location,_r.name]}))}return{clear:function(){var Zt=V.deleteShader.bind(V);R(Br).forEach(Zt),Br={},R(or).forEach(Zt),or={},tn.forEach(function(_r){V.deleteProgram(_r.program)}),tn.length=0,en={},et.shaderCount=0},program:function(Zt,_r,Qr,kn){q.command(Zt>=0,"missing vertex shader",Qr),q.command(_r>=0,"missing fragment shader",Qr);var Rr=en[_r];Rr||(Rr=en[_r]={});var Pn=Rr[Zt];if(Pn&&(Pn.refCount++,!kn))return Pn;var ln=new xn(_r,Zt);return et.shaderCount++,$r(ln,Qr,kn),Pn||(Rr[Zt]=ln),tn.push(ln),p(ln,{destroy:function(){if(ln.refCount--,ln.refCount<=0){V.deleteProgram(ln.program);var pi=tn.indexOf(ln);tn.splice(pi,1),et.shaderCount--}Rr[ln.vertId].refCount<=0&&(V.deleteShader(or[ln.vertId]),delete or[ln.vertId],delete en[ln.fragId][ln.vertId]),Object.keys(en[ln.fragId]).length||(V.deleteShader(Br[ln.fragId]),delete Br[ln.fragId],delete en[ln.fragId])}})},restore:sn,shader:Jr,frag:-1,vert:-1}}var fn=6408,nn=5121,jn=3333,ui=5126;function li(V,Oe,et,cr,Br,or,Ir){function Hr(tn){var on;Oe.next===null?(q(Br.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),on=nn):(q(Oe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),on=Oe.next.colorAttachments[0].texture._texture.type,q.optional(function(){or.oes_texture_float?(q(on===nn||on===ui,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),on===ui&&q(Ir.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):q(on===nn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var xn=0,$r=0,sn=cr.framebufferWidth,Zt=cr.framebufferHeight,_r=null;b(tn)?_r=tn:tn&&(q.type(tn,"object","invalid arguments to regl.read()"),xn=tn.x|0,$r=tn.y|0,q(xn>=0&&xn<cr.framebufferWidth,"invalid x offset for regl.read"),q($r>=0&&$r<cr.framebufferHeight,"invalid y offset for regl.read"),sn=(tn.width||cr.framebufferWidth-xn)|0,Zt=(tn.height||cr.framebufferHeight-$r)|0,_r=tn.data||null),_r&&(on===nn?q(_r instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):on===ui&&q(_r instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),q(sn>0&&sn+xn<=cr.framebufferWidth,"invalid width for read pixels"),q(Zt>0&&Zt+$r<=cr.framebufferHeight,"invalid height for read pixels"),et();var Qr=sn*Zt*4;return _r||(on===nn?_r=new Uint8Array(Qr):on===ui&&(_r=_r||new Float32Array(Qr))),q.isTypedArray(_r,"data buffer for regl.read() must be a typedarray"),q(_r.byteLength>=Qr,"data buffer for regl.read() too small"),V.pixelStorei(jn,4),V.readPixels(xn,$r,sn,Zt,fn,on,_r),_r}function Jr(tn){var on;return Oe.setFBO({framebuffer:tn.framebuffer},function(){on=Hr(tn)}),on}function en(tn){return!tn||!("framebuffer"in tn)?Hr(tn):Jr(tn)}return en}function mn(V){return Array.prototype.slice.call(V)}function aa(V){return mn(V).join("")}function Hn(){var V=0,Oe=[],et=[];function cr(on){for(var xn=0;xn<et.length;++xn)if(et[xn]===on)return Oe[xn];var $r="g"+V++;return Oe.push($r),et.push(on),$r}function Br(){var on=[];function xn(){on.push.apply(on,mn(arguments))}var $r=[];function sn(){var Zt="v"+V++;return $r.push(Zt),arguments.length>0&&(on.push(Zt,"="),on.push.apply(on,mn(arguments)),on.push(";")),Zt}return p(xn,{def:sn,toString:function(){return aa([$r.length>0?"var "+$r.join(",")+";":"",aa(on)])}})}function or(){var on=Br(),xn=Br(),$r=on.toString,sn=xn.toString;function Zt(_r,Qr){xn(_r,Qr,"=",on.def(_r,Qr),";")}return p(function(){on.apply(on,mn(arguments))},{def:on.def,entry:on,exit:xn,save:Zt,set:function(_r,Qr,kn){Zt(_r,Qr),on(_r,Qr,"=",kn,";")},toString:function(){return $r()+sn()}})}function Ir(){var on=aa(arguments),xn=or(),$r=or(),sn=xn.toString,Zt=$r.toString;return p(xn,{then:function(){return xn.apply(xn,mn(arguments)),this},else:function(){return $r.apply($r,mn(arguments)),this},toString:function(){var _r=Zt();return _r&&(_r="else{"+_r+"}"),aa(["if(",on,"){",sn(),"}",_r])}})}var Hr=Br(),Jr={};function en(on,xn){var $r=[];function sn(){var Rr="a"+$r.length;return $r.push(Rr),Rr}xn=xn||0;for(var Zt=0;Zt<xn;++Zt)sn();var _r=or(),Qr=_r.toString,kn=Jr[on]=p(_r,{arg:sn,toString:function(){return aa(["function(",$r.join(),"){",Qr(),"}"])}});return kn}function tn(){var on=['"use strict";',Hr,"return {"];Object.keys(Jr).forEach(function(Zt){on.push('"',Zt,'":',Jr[Zt].toString(),",")}),on.push("}");var xn=aa(on).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),$r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",sn=$r?z.Function.apply(null,Oe.concat(xn)):Function.apply(null,Oe.concat(xn));return sn.apply(null,et)}return{global:Hr,link:cr,block:Br,proc:en,scope:or,cond:Ir,compile:tn}}var xi="xyzw".split(""),Gi=5121,vi=1,Ci=2,ie=0,ne=1,L=2,B=3,ce=4,Ae=5,_t=6,Rt="dither",wt="blend.enable",hr="blend.color",Xr="blend.equation",Qn="blend.func",Wn="depth.enable",fi="depth.func",mi="depth.range",Li="depth.mask",oa="colorMask",pa="cull.enable",Sa="cull.face",vo="frontFace",wa="lineWidth",Fo="polygonOffset.enable",Fa="polygonOffset.offset",ji="sample.alpha",da="sample.enable",Ka="sample.coverage",mo="stencil.enable",Mi="stencil.mask",ao="stencil.func",Ga="stencil.opFront",Gs="stencil.opBack",Zl="scissor.enable",Bs="scissor.box",Iu="viewport",Ou="profile",jl="framebuffer",cl="vert",Vl="frag",uc="elements",Gu="primitive",cs="count",Rf="offset",df="instances",vf="vao",uh="Width",lh="Height",ef=jl+uh,Ec=jl+lh,up=Iu+uh,Df=Iu+lh,ch="drawingBuffer",Gl=ch+uh,tf=ch+lh,lp=[Qn,Xr,ao,Ga,Gs,Ka,Iu,Bs,Fa],rf=34962,fh=34963,cp=35632,fp=35633,Rh=3553,hp=34067,hh=2884,Dh=3042,nf=3024,pp=2960,rs=2929,kf=3089,ph=32823,Ff=32926,Bf=32928,Fc=5126,mf=35664,gf=35665,Cc=35666,yf=5124,af=35667,Nf=35668,lc=35669,dh=35670,of=35671,zf=35672,sf=35673,Bc=35674,pu=35675,cc=35676,_f=35678,xf=35680,Uf=4,uf=1028,fl=1029,kh=2304,Zf=2305,Fh=32775,vh=32776,Bh=519,fc=7680,wc=0,Nh=1,jf=32774,bf=513,hl=36160,dp=36064,Hl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},mh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Wl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},hc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},gh={frag:cp,vert:fp},Vf={cw:kh,ccw:Zf};function Sf(V){return Array.isArray(V)||b(V)||mt(V)}function yh(V){return V.sort(function(Oe,et){return Oe===Iu?-1:et===Iu?1:Oe<et?-1:1})}function Es(V,Oe,et,cr){this.thisDep=V,this.contextDep=Oe,this.propDep=et,this.append=cr}function Wo(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function fs(V){return new Es(!1,!1,!1,V)}function Cu(V,Oe){var et=V.type;if(et===ie){var cr=V.data.length;return new Es(!0,cr>=1,cr>=2,Oe)}else if(et===ce){var Br=V.data;return new Es(Br.thisDep,Br.contextDep,Br.propDep,Oe)}else{if(et===Ae)return new Es(!1,!1,!1,Oe);if(et===_t){for(var or=!1,Ir=!1,Hr=!1,Jr=0;Jr<V.data.length;++Jr){var en=V.data[Jr];if(en.type===ne)Hr=!0;else if(en.type===L)Ir=!0;else if(en.type===B)or=!0;else if(en.type===ie){or=!0;var tn=en.data;tn>=1&&(Ir=!0),tn>=2&&(Hr=!0)}else en.type===ce&&(or=or||en.data.thisDep,Ir=Ir||en.data.contextDep,Hr=Hr||en.data.propDep)}return new Es(or,Ir,Hr,Oe)}else return new Es(et===B,et===L,et===ne,Oe)}}var _h=new Es(!1,!1,!1,function(){});function vp(V,Oe,et,cr,Br,or,Ir,Hr,Jr,en,tn,on,xn,$r,sn){var Zt=en.Record,_r={add:32774,subtract:32778,"reverse subtract":32779};et.ext_blend_minmax&&(_r.min=Fh,_r.max=vh);var Qr=et.angle_instanced_arrays,kn=et.webgl_draw_buffers,Rr=et.oes_vertex_array_object,Pn={dirty:!0,profile:sn.profile},ln={},pi=[],Dr={},Pr={};function ni(Ne){return Ne.replace(".","_")}function En(Ne,be,nt){var Gt=ni(Ne);pi.push(Ne),ln[Gt]=Pn[Gt]=!!nt,Dr[Gt]=be}function rn(Ne,be,nt){var Gt=ni(Ne);pi.push(Ne),Array.isArray(nt)?(Pn[Gt]=nt.slice(),ln[Gt]=nt.slice()):Pn[Gt]=ln[Gt]=nt,Pr[Gt]=be}En(Rt,nf),En(wt,Dh),rn(hr,"blendColor",[0,0,0,0]),rn(Xr,"blendEquationSeparate",[jf,jf]),rn(Qn,"blendFuncSeparate",[Nh,wc,Nh,wc]),En(Wn,rs,!0),rn(fi,"depthFunc",bf),rn(mi,"depthRange",[0,1]),rn(Li,"depthMask",!0),rn(oa,oa,[!0,!0,!0,!0]),En(pa,hh),rn(Sa,"cullFace",fl),rn(vo,vo,Zf),rn(wa,wa,1),En(Fo,ph),rn(Fa,"polygonOffset",[0,0]),En(ji,Ff),En(da,Bf),rn(Ka,"sampleCoverage",[1,!1]),En(mo,pp),rn(Mi,"stencilMask",-1),rn(ao,"stencilFunc",[Bh,0,-1]),rn(Ga,"stencilOpSeparate",[uf,fc,fc,fc]),rn(Gs,"stencilOpSeparate",[fl,fc,fc,fc]),En(Zl,kf),rn(Bs,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),rn(Iu,Iu,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var Mn={gl:V,context:xn,strings:Oe,next:ln,current:Pn,draw:on,elements:or,buffer:Br,shader:tn,attributes:en.state,vao:en,uniforms:Jr,framebuffer:Hr,extensions:et,timer:$r,isBufferArgs:Sf},On={primTypes:kr,compareFuncs:Wl,blendFuncs:Hl,blendEquations:_r,stencilOps:hc,glTypes:Xs,orientationType:Vf};q.optional(function(){Mn.isArrayLike=Ia}),kn&&(On.backBuffer=[fl],On.drawBuffer=de(cr.maxDrawbuffers,function(Ne){return Ne===0?[0]:de(Ne,function(be){return dp+be})}));var Vi=0;function Fi(){var Ne=Hn(),be=Ne.link,nt=Ne.global;Ne.id=Vi++,Ne.batchId="0";var Gt=be(Mn),lr=Ne.shared={props:"a0"};Object.keys(Mn).forEach(function(ot){lr[ot]=nt.def(Gt,".",ot)}),q.optional(function(){Ne.CHECK=be(q),Ne.commandStr=q.guessCommand(),Ne.command=be(Ne.commandStr),Ne.assert=function(ot,Ue,Xt){ot("if(!(",Ue,"))",this.CHECK,".commandRaise(",be(Xt),",",this.command,");")},On.invalidBlendCombinations=mh});var xt=Ne.next={},vt=Ne.current={};Object.keys(Pr).forEach(function(ot){Array.isArray(Pn[ot])&&(xt[ot]=nt.def(lr.next,".",ot),vt[ot]=nt.def(lr.current,".",ot))});var at=Ne.constants={};Object.keys(On).forEach(function(ot){at[ot]=nt.def(JSON.stringify(On[ot]))}),Ne.invoke=function(ot,Ue){switch(Ue.type){case ie:var Xt=["this",lr.context,lr.props,Ne.batchId];return ot.def(be(Ue.data),".call(",Xt.slice(0,Math.max(Ue.data.length+1,4)),")");case ne:return ot.def(lr.props,Ue.data);case L:return ot.def(lr.context,Ue.data);case B:return ot.def("this",Ue.data);case ce:return Ue.data.append(Ne,ot),Ue.data.ref;case Ae:return Ue.data.toString();case _t:return Ue.data.map(function(Jt){return Ne.invoke(ot,Jt)})}},Ne.attribCache={};var Fe={};return Ne.scopeAttrib=function(ot){var Ue=Oe.id(ot);if(Ue in Fe)return Fe[Ue];var Xt=en.scope[Ue];Xt||(Xt=en.scope[Ue]=new Zt);var Jt=Fe[Ue]=be(Xt);return Jt},Ne}function Fn(Ne){var be=Ne.static,nt=Ne.dynamic,Gt;if(Ou in be){var lr=!!be[Ou];Gt=fs(function(vt,at){return lr}),Gt.enable=lr}else if(Ou in nt){var xt=nt[Ou];Gt=Cu(xt,function(vt,at){return vt.invoke(at,xt)})}return Gt}function wn(Ne,be){var nt=Ne.static,Gt=Ne.dynamic;if(jl in nt){var lr=nt[jl];return lr?(lr=Hr.getFramebuffer(lr),q.command(lr,"invalid framebuffer object"),fs(function(vt,at){var Fe=vt.link(lr),ot=vt.shared;at.set(ot.framebuffer,".next",Fe);var Ue=ot.context;return at.set(Ue,"."+ef,Fe+".width"),at.set(Ue,"."+Ec,Fe+".height"),Fe})):fs(function(vt,at){var Fe=vt.shared;at.set(Fe.framebuffer,".next","null");var ot=Fe.context;return at.set(ot,"."+ef,ot+"."+Gl),at.set(ot,"."+Ec,ot+"."+tf),"null"})}else if(jl in Gt){var xt=Gt[jl];return Cu(xt,function(vt,at){var Fe=vt.invoke(at,xt),ot=vt.shared,Ue=ot.framebuffer,Xt=at.def(Ue,".getFramebuffer(",Fe,")");q.optional(function(){vt.assert(at,"!"+Fe+"||"+Xt,"invalid framebuffer object")}),at.set(Ue,".next",Xt);var Jt=ot.context;return at.set(Jt,"."+ef,Xt+"?"+Xt+".width:"+Jt+"."+Gl),at.set(Jt,"."+Ec,Xt+"?"+Xt+".height:"+Jt+"."+tf),Xt})}else return null}function Ti(Ne,be,nt){var Gt=Ne.static,lr=Ne.dynamic;function xt(Fe){if(Fe in Gt){var ot=Gt[Fe];q.commandType(ot,"object","invalid "+Fe,nt.commandStr);var Ue=!0,Xt=ot.x|0,Jt=ot.y|0,jr,gn;return"width"in ot?(jr=ot.width|0,q.command(jr>=0,"invalid "+Fe,nt.commandStr)):Ue=!1,"height"in ot?(gn=ot.height|0,q.command(gn>=0,"invalid "+Fe,nt.commandStr)):Ue=!1,new Es(!Ue&&be&&be.thisDep,!Ue&&be&&be.contextDep,!Ue&&be&&be.propDep,function(pn,ai){var Un=pn.shared.context,Yn=jr;"width"in ot||(Yn=ai.def(Un,".",ef,"-",Xt));var qn=gn;return"height"in ot||(qn=ai.def(Un,".",Ec,"-",Jt)),[Xt,Jt,Yn,qn]})}else if(Fe in lr){var an=lr[Fe],Dn=Cu(an,function(pn,ai){var Un=pn.invoke(ai,an);q.optional(function(){pn.assert(ai,Un+"&&typeof "+Un+'==="object"',"invalid "+Fe)});var Yn=pn.shared.context,qn=ai.def(Un,".x|0"),ei=ai.def(Un,".y|0"),gi=ai.def('"width" in ',Un,"?",Un,".width|0:","(",Yn,".",ef,"-",qn,")"),Na=ai.def('"height" in ',Un,"?",Un,".height|0:","(",Yn,".",Ec,"-",ei,")");return q.optional(function(){pn.assert(ai,gi+">=0&&"+Na+">=0","invalid "+Fe)}),[qn,ei,gi,Na]});return be&&(Dn.thisDep=Dn.thisDep||be.thisDep,Dn.contextDep=Dn.contextDep||be.contextDep,Dn.propDep=Dn.propDep||be.propDep),Dn}else return be?new Es(be.thisDep,be.contextDep,be.propDep,function(pn,ai){var Un=pn.shared.context;return[0,0,ai.def(Un,".",ef),ai.def(Un,".",Ec)]}):null}var vt=xt(Iu);if(vt){var at=vt;vt=new Es(vt.thisDep,vt.contextDep,vt.propDep,function(Fe,ot){var Ue=at.append(Fe,ot),Xt=Fe.shared.context;return ot.set(Xt,"."+up,Ue[2]),ot.set(Xt,"."+Df,Ue[3]),Ue})}return{viewport:vt,scissor_box:xt(Bs)}}function Ui(Ne,be){var nt=Ne.static,Gt=typeof nt[Vl]=="string"&&typeof nt[cl]=="string";if(Gt){if(Object.keys(be.dynamic).length>0)return null;var lr=be.static,xt=Object.keys(lr);if(xt.length>0&&typeof lr[xt[0]]=="number"){for(var vt=[],at=0;at<xt.length;++at)q(typeof lr[xt[at]]=="number","must specify all vertex attribute locations when using vaos"),vt.push([lr[xt[at]]|0,xt[at]]);return vt}}return null}function va(Ne,be,nt){var Gt=Ne.static,lr=Ne.dynamic;function xt(Ue){if(Ue in Gt){var Xt=Oe.id(Gt[Ue]);q.optional(function(){tn.shader(gh[Ue],Xt,q.guessCommand())});var Jt=fs(function(){return Xt});return Jt.id=Xt,Jt}else if(Ue in lr){var jr=lr[Ue];return Cu(jr,function(gn,an){var Dn=gn.invoke(an,jr),pn=an.def(gn.shared.strings,".id(",Dn,")");return q.optional(function(){an(gn.shared.shader,".shader(",gh[Ue],",",pn,",",gn.command,");")}),pn})}return null}var vt=xt(Vl),at=xt(cl),Fe=null,ot;return Wo(vt)&&Wo(at)?(Fe=tn.program(at.id,vt.id,null,nt),ot=fs(function(Ue,Xt){return Ue.link(Fe)})):ot=new Es(vt&&vt.thisDep||at&&at.thisDep,vt&&vt.contextDep||at&&at.contextDep,vt&&vt.propDep||at&&at.propDep,function(Ue,Xt){var Jt=Ue.shared.shader,jr;vt?jr=vt.append(Ue,Xt):jr=Xt.def(Jt,".",Vl);var gn;at?gn=at.append(Ue,Xt):gn=Xt.def(Jt,".",cl);var an=Jt+".program("+gn+","+jr;return q.optional(function(){an+=","+Ue.command}),Xt.def(an+")")}),{frag:vt,vert:at,progVar:ot,program:Fe}}function zo(Ne,be){var nt=Ne.static,Gt=Ne.dynamic,lr={},xt=!1;function vt(){if(vf in nt){var ai=nt[vf];return ai!==null&&en.getVAO(ai)===null&&(ai=en.createVAO(ai)),xt=!0,lr.vao=ai,fs(function(Yn){var qn=en.getVAO(ai);return qn?Yn.link(qn):"null"})}else if(vf in Gt){xt=!0;var Un=Gt[vf];return Cu(Un,function(Yn,qn){var ei=Yn.invoke(qn,Un);return qn.def(Yn.shared.vao+".getVAO("+ei+")")})}return null}var at=vt(),Fe=!1;function ot(){if(uc in nt){var ai=nt[uc];if(lr.elements=ai,Sf(ai)){var Un=lr.elements=or.create(ai,!0);ai=or.getElements(Un),Fe=!0}else ai&&(ai=or.getElements(ai),Fe=!0,q.command(ai,"invalid elements",be.commandStr));var Yn=fs(function(ei,gi){if(ai){var Na=ei.link(ai);return ei.ELEMENTS=Na,Na}return ei.ELEMENTS=null,null});return Yn.value=ai,Yn}else if(uc in Gt){Fe=!0;var qn=Gt[uc];return Cu(qn,function(ei,gi){var Na=ei.shared,Bo=Na.isBufferArgs,Yl=Na.elements,Za=ei.invoke(gi,qn),_a=gi.def("null"),iu=gi.def(Bo,"(",Za,")"),Ll=ei.cond(iu).then(_a,"=",Yl,".createStream(",Za,");").else(_a,"=",Yl,".getElements(",Za,");");return q.optional(function(){ei.assert(Ll.else,"!"+Za+"||"+_a,"invalid elements")}),gi.entry(Ll),gi.exit(ei.cond(iu).then(Yl,".destroyStream(",_a,");")),ei.ELEMENTS=_a,_a})}else if(xt)return new Es(at.thisDep,at.contextDep,at.propDep,function(ei,gi){return gi.def(ei.shared.vao+".currentVAO?"+ei.shared.elements+".getElements("+ei.shared.vao+".currentVAO.elements):null")});return null}var Ue=ot();function Xt(){if(Gu in nt){var ai=nt[Gu];return lr.primitive=ai,q.commandParameter(ai,kr,"invalid primitve",be.commandStr),fs(function(Yn,qn){return kr[ai]})}else if(Gu in Gt){var Un=Gt[Gu];return Cu(Un,function(Yn,qn){var ei=Yn.constants.primTypes,gi=Yn.invoke(qn,Un);return q.optional(function(){Yn.assert(qn,gi+" in "+ei,"invalid primitive, must be one of "+Object.keys(kr))}),qn.def(ei,"[",gi,"]")})}else{if(Fe)return Wo(Ue)?Ue.value?fs(function(Yn,qn){return qn.def(Yn.ELEMENTS,".primType")}):fs(function(){return Uf}):new Es(Ue.thisDep,Ue.contextDep,Ue.propDep,function(Yn,qn){var ei=Yn.ELEMENTS;return qn.def(ei,"?",ei,".primType:",Uf)});if(xt)return new Es(at.thisDep,at.contextDep,at.propDep,function(Yn,qn){return qn.def(Yn.shared.vao+".currentVAO?"+Yn.shared.vao+".currentVAO.primitive:"+Uf)})}return null}function Jt(ai,Un){if(ai in nt){var Yn=nt[ai]|0;return Un?lr.offset=Yn:lr.instances=Yn,q.command(!Un||Yn>=0,"invalid "+ai,be.commandStr),fs(function(ei,gi){return Un&&(ei.OFFSET=Yn),Yn})}else if(ai in Gt){var qn=Gt[ai];return Cu(qn,function(ei,gi){var Na=ei.invoke(gi,qn);return Un&&(ei.OFFSET=Na,q.optional(function(){ei.assert(gi,Na+">=0","invalid "+ai)})),Na})}else if(Un){if(Fe)return fs(function(ei,gi){return ei.OFFSET=0,0});if(xt)return new Es(at.thisDep,at.contextDep,at.propDep,function(ei,gi){return gi.def(ei.shared.vao+".currentVAO?"+ei.shared.vao+".currentVAO.offset:0")})}else if(xt)return new Es(at.thisDep,at.contextDep,at.propDep,function(ei,gi){return gi.def(ei.shared.vao+".currentVAO?"+ei.shared.vao+".currentVAO.instances:-1")});return null}var jr=Jt(Rf,!0);function gn(){if(cs in nt){var ai=nt[cs]|0;return lr.count=ai,q.command(typeof ai=="number"&&ai>=0,"invalid vertex count",be.commandStr),fs(function(){return ai})}else if(cs in Gt){var Un=Gt[cs];return Cu(Un,function(gi,Na){var Bo=gi.invoke(Na,Un);return q.optional(function(){gi.assert(Na,"typeof "+Bo+'==="number"&&'+Bo+">=0&&"+Bo+"===("+Bo+"|0)","invalid vertex count")}),Bo})}else if(Fe)if(Wo(Ue)){if(Ue)return jr?new Es(jr.thisDep,jr.contextDep,jr.propDep,function(gi,Na){var Bo=Na.def(gi.ELEMENTS,".vertCount-",gi.OFFSET);return q.optional(function(){gi.assert(Na,Bo+">=0","invalid vertex offset/element buffer too small")}),Bo}):fs(function(gi,Na){return Na.def(gi.ELEMENTS,".vertCount")});var Yn=fs(function(){return-1});return q.optional(function(){Yn.MISSING=!0}),Yn}else{var qn=new Es(Ue.thisDep||jr.thisDep,Ue.contextDep||jr.contextDep,Ue.propDep||jr.propDep,function(gi,Na){var Bo=gi.ELEMENTS;return gi.OFFSET?Na.def(Bo,"?",Bo,".vertCount-",gi.OFFSET,":-1"):Na.def(Bo,"?",Bo,".vertCount:-1")});return q.optional(function(){qn.DYNAMIC=!0}),qn}else if(xt){var ei=new Es(at.thisDep,at.contextDep,at.propDep,function(gi,Na){return Na.def(gi.shared.vao,".currentVAO?",gi.shared.vao,".currentVAO.count:-1")});return ei}return null}var an=Xt(),Dn=gn(),pn=Jt(df,!1);return{elements:Ue,primitive:an,count:Dn,instances:pn,offset:jr,vao:at,vaoActive:xt,elementsActive:Fe,static:lr}}function xo(Ne,be){var nt=Ne.static,Gt=Ne.dynamic,lr={};return pi.forEach(function(xt){var vt=ni(xt);function at(Fe,ot){if(xt in nt){var Ue=Fe(nt[xt]);lr[vt]=fs(function(){return Ue})}else if(xt in Gt){var Xt=Gt[xt];lr[vt]=Cu(Xt,function(Jt,jr){return ot(Jt,jr,Jt.invoke(jr,Xt))})}}switch(xt){case pa:case wt:case Rt:case mo:case Wn:case Zl:case Fo:case ji:case da:case Li:return at(function(Fe){return q.commandType(Fe,"boolean",xt,be.commandStr),Fe},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,"typeof "+Ue+'==="boolean"',"invalid flag "+xt,Fe.commandStr)}),Ue});case fi:return at(function(Fe){return q.commandParameter(Fe,Wl,"invalid "+xt,be.commandStr),Wl[Fe]},function(Fe,ot,Ue){var Xt=Fe.constants.compareFuncs;return q.optional(function(){Fe.assert(ot,Ue+" in "+Xt,"invalid "+xt+", must be one of "+Object.keys(Wl))}),ot.def(Xt,"[",Ue,"]")});case mi:return at(function(Fe){return q.command(Ia(Fe)&&Fe.length===2&&typeof Fe[0]=="number"&&typeof Fe[1]=="number"&&Fe[0]<=Fe[1],"depth range is 2d array",be.commandStr),Fe},function(Fe,ot,Ue){q.optional(function(){Fe.assert(ot,Fe.shared.isArrayLike+"("+Ue+")&&"+Ue+".length===2&&typeof "+Ue+'[0]==="number"&&typeof '+Ue+'[1]==="number"&&'+Ue+"[0]<="+Ue+"[1]","depth range must be a 2d array")});var Xt=ot.def("+",Ue,"[0]"),Jt=ot.def("+",Ue,"[1]");return[Xt,Jt]});case Qn:return at(function(Fe){q.commandType(Fe,"object","blend.func",be.commandStr);var ot="srcRGB"in Fe?Fe.srcRGB:Fe.src,Ue="srcAlpha"in Fe?Fe.srcAlpha:Fe.src,Xt="dstRGB"in Fe?Fe.dstRGB:Fe.dst,Jt="dstAlpha"in Fe?Fe.dstAlpha:Fe.dst;return q.commandParameter(ot,Hl,vt+".srcRGB",be.commandStr),q.commandParameter(Ue,Hl,vt+".srcAlpha",be.commandStr),q.commandParameter(Xt,Hl,vt+".dstRGB",be.commandStr),q.commandParameter(Jt,Hl,vt+".dstAlpha",be.commandStr),q.command(mh.indexOf(ot+", "+Xt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ot+", "+Xt+")",be.commandStr),[Hl[ot],Hl[Xt],Hl[Ue],Hl[Jt]]},function(Fe,ot,Ue){var Xt=Fe.constants.blendFuncs;q.optional(function(){Fe.assert(ot,Ue+"&&typeof "+Ue+'==="object"',"invalid blend func, must be an object")});function Jt(Un,Yn){var qn=ot.def('"',Un,Yn,'" in ',Ue,"?",Ue,".",Un,Yn,":",Ue,".",Un);return q.optional(function(){Fe.assert(ot,qn+" in "+Xt,"invalid "+xt+"."+Un+Yn+", must be one of "+Object.keys(Hl))}),qn}var jr=Jt("src","RGB"),gn=Jt("dst","RGB");q.optional(function(){var Un=Fe.constants.invalidBlendCombinations;Fe.assert(ot,Un+".indexOf("+jr+'+", "+'+gn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var an=ot.def(Xt,"[",jr,"]"),Dn=ot.def(Xt,"[",Jt("src","Alpha"),"]"),pn=ot.def(Xt,"[",gn,"]"),ai=ot.def(Xt,"[",Jt("dst","Alpha"),"]");return[an,pn,Dn,ai]});case Xr:return at(function(Fe){if(typeof Fe=="string")return q.commandParameter(Fe,_r,"invalid "+xt,be.commandStr),[_r[Fe],_r[Fe]];if(typeof Fe=="object")return q.commandParameter(Fe.rgb,_r,xt+".rgb",be.commandStr),q.commandParameter(Fe.alpha,_r,xt+".alpha",be.commandStr),[_r[Fe.rgb],_r[Fe.alpha]];q.commandRaise("invalid blend.equation",be.commandStr)},function(Fe,ot,Ue){var Xt=Fe.constants.blendEquations,Jt=ot.def(),jr=ot.def(),gn=Fe.cond("typeof ",Ue,'==="string"');return q.optional(function(){function an(Dn,pn,ai){Fe.assert(Dn,ai+" in "+Xt,"invalid "+pn+", must be one of "+Object.keys(_r))}an(gn.then,xt,Ue),Fe.assert(gn.else,Ue+"&&typeof "+Ue+'==="object"',"invalid "+xt),an(gn.else,xt+".rgb",Ue+".rgb"),an(gn.else,xt+".alpha",Ue+".alpha")}),gn.then(Jt,"=",jr,"=",Xt,"[",Ue,"];"),gn.else(Jt,"=",Xt,"[",Ue,".rgb];",jr,"=",Xt,"[",Ue,".alpha];"),ot(gn),[Jt,jr]});case hr:return at(function(Fe){return q.command(Ia(Fe)&&Fe.length===4,"blend.color must be a 4d array",be.commandStr),de(4,function(ot){return+Fe[ot]})},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,Fe.shared.isArrayLike+"("+Ue+")&&"+Ue+".length===4","blend.color must be a 4d array")}),de(4,function(Xt){return ot.def("+",Ue,"[",Xt,"]")})});case Mi:return at(function(Fe){return q.commandType(Fe,"number",vt,be.commandStr),Fe|0},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,"typeof "+Ue+'==="number"',"invalid stencil.mask")}),ot.def(Ue,"|0")});case ao:return at(function(Fe){q.commandType(Fe,"object",vt,be.commandStr);var ot=Fe.cmp||"keep",Ue=Fe.ref||0,Xt="mask"in Fe?Fe.mask:-1;return q.commandParameter(ot,Wl,xt+".cmp",be.commandStr),q.commandType(Ue,"number",xt+".ref",be.commandStr),q.commandType(Xt,"number",xt+".mask",be.commandStr),[Wl[ot],Ue,Xt]},function(Fe,ot,Ue){var Xt=Fe.constants.compareFuncs;q.optional(function(){function an(){Fe.assert(ot,Array.prototype.join.call(arguments,""),"invalid stencil.func")}an(Ue+"&&typeof ",Ue,'==="object"'),an('!("cmp" in ',Ue,")||(",Ue,".cmp in ",Xt,")")});var Jt=ot.def('"cmp" in ',Ue,"?",Xt,"[",Ue,".cmp]",":",fc),jr=ot.def(Ue,".ref|0"),gn=ot.def('"mask" in ',Ue,"?",Ue,".mask|0:-1");return[Jt,jr,gn]});case Ga:case Gs:return at(function(Fe){q.commandType(Fe,"object",vt,be.commandStr);var ot=Fe.fail||"keep",Ue=Fe.zfail||"keep",Xt=Fe.zpass||"keep";return q.commandParameter(ot,hc,xt+".fail",be.commandStr),q.commandParameter(Ue,hc,xt+".zfail",be.commandStr),q.commandParameter(Xt,hc,xt+".zpass",be.commandStr),[xt===Gs?fl:uf,hc[ot],hc[Ue],hc[Xt]]},function(Fe,ot,Ue){var Xt=Fe.constants.stencilOps;q.optional(function(){Fe.assert(ot,Ue+"&&typeof "+Ue+'==="object"',"invalid "+xt)});function Jt(jr){return q.optional(function(){Fe.assert(ot,'!("'+jr+'" in '+Ue+")||("+Ue+"."+jr+" in "+Xt+")","invalid "+xt+"."+jr+", must be one of "+Object.keys(hc))}),ot.def('"',jr,'" in ',Ue,"?",Xt,"[",Ue,".",jr,"]:",fc)}return[xt===Gs?fl:uf,Jt("fail"),Jt("zfail"),Jt("zpass")]});case Fa:return at(function(Fe){q.commandType(Fe,"object",vt,be.commandStr);var ot=Fe.factor|0,Ue=Fe.units|0;return q.commandType(ot,"number",vt+".factor",be.commandStr),q.commandType(Ue,"number",vt+".units",be.commandStr),[ot,Ue]},function(Fe,ot,Ue){q.optional(function(){Fe.assert(ot,Ue+"&&typeof "+Ue+'==="object"',"invalid "+xt)});var Xt=ot.def(Ue,".factor|0"),Jt=ot.def(Ue,".units|0");return[Xt,Jt]});case Sa:return at(function(Fe){var ot=0;return Fe==="front"?ot=uf:Fe==="back"&&(ot=fl),q.command(!!ot,vt,be.commandStr),ot},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,Ue+'==="front"||'+Ue+'==="back"',"invalid cull.face")}),ot.def(Ue,'==="front"?',uf,":",fl)});case wa:return at(function(Fe){return q.command(typeof Fe=="number"&&Fe>=cr.lineWidthDims[0]&&Fe<=cr.lineWidthDims[1],"invalid line width, must be a positive number between "+cr.lineWidthDims[0]+" and "+cr.lineWidthDims[1],be.commandStr),Fe},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,"typeof "+Ue+'==="number"&&'+Ue+">="+cr.lineWidthDims[0]+"&&"+Ue+"<="+cr.lineWidthDims[1],"invalid line width")}),Ue});case vo:return at(function(Fe){return q.commandParameter(Fe,Vf,vt,be.commandStr),Vf[Fe]},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,Ue+'==="cw"||'+Ue+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ot.def(Ue+'==="cw"?'+kh+":"+Zf)});case oa:return at(function(Fe){return q.command(Ia(Fe)&&Fe.length===4,"color.mask must be length 4 array",be.commandStr),Fe.map(function(ot){return!!ot})},function(Fe,ot,Ue){return q.optional(function(){Fe.assert(ot,Fe.shared.isArrayLike+"("+Ue+")&&"+Ue+".length===4","invalid color.mask")}),de(4,function(Xt){return"!!"+Ue+"["+Xt+"]"})});case Ka:return at(function(Fe){q.command(typeof Fe=="object"&&Fe,vt,be.commandStr);var ot="value"in Fe?Fe.value:1,Ue=!!Fe.invert;return q.command(typeof ot=="number"&&ot>=0&&ot<=1,"sample.coverage.value must be a number between 0 and 1",be.commandStr),[ot,Ue]},function(Fe,ot,Ue){q.optional(function(){Fe.assert(ot,Ue+"&&typeof "+Ue+'==="object"',"invalid sample.coverage")});var Xt=ot.def('"value" in ',Ue,"?+",Ue,".value:1"),Jt=ot.def("!!",Ue,".invert");return[Xt,Jt]})}}),lr}function sa(Ne,be){var nt=Ne.static,Gt=Ne.dynamic,lr={};return Object.keys(nt).forEach(function(xt){var vt=nt[xt],at;if(typeof vt=="number"||typeof vt=="boolean")at=fs(function(){return vt});else if(typeof vt=="function"){var Fe=vt._reglType;Fe==="texture2d"||Fe==="textureCube"?at=fs(function(ot){return ot.link(vt)}):Fe==="framebuffer"||Fe==="framebufferCube"?(q.command(vt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+xt+'"',be.commandStr),at=fs(function(ot){return ot.link(vt.color[0])})):q.commandRaise('invalid data for uniform "'+xt+'"',be.commandStr)}else Ia(vt)?at=fs(function(ot){var Ue=ot.global.def("[",de(vt.length,function(Xt){return q.command(typeof vt[Xt]=="number"||typeof vt[Xt]=="boolean","invalid uniform "+xt,ot.commandStr),vt[Xt]}),"]");return Ue}):q.commandRaise('invalid or missing data for uniform "'+xt+'"',be.commandStr);at.value=vt,lr[xt]=at}),Object.keys(Gt).forEach(function(xt){var vt=Gt[xt];lr[xt]=Cu(vt,function(at,Fe){return at.invoke(Fe,vt)})}),lr}function hs(Ne,be){var nt=Ne.static,Gt=Ne.dynamic,lr={};return Object.keys(nt).forEach(function(xt){var vt=nt[xt],at=Oe.id(xt),Fe=new Zt;if(Sf(vt))Fe.state=vi,Fe.buffer=Br.getBuffer(Br.create(vt,rf,!1,!0)),Fe.type=0;else{var ot=Br.getBuffer(vt);if(ot)Fe.state=vi,Fe.buffer=ot,Fe.type=0;else if(q.command(typeof vt=="object"&&vt,"invalid data for attribute "+xt,be.commandStr),"constant"in vt){var Ue=vt.constant;Fe.buffer="null",Fe.state=Ci,typeof Ue=="number"?Fe.x=Ue:(q.command(Ia(Ue)&&Ue.length>0&&Ue.length<=4,"invalid constant for attribute "+xt,be.commandStr),xi.forEach(function(pn,ai){ai<Ue.length&&(Fe[pn]=Ue[ai])}))}else{Sf(vt.buffer)?ot=Br.getBuffer(Br.create(vt.buffer,rf,!1,!0)):ot=Br.getBuffer(vt.buffer),q.command(!!ot,'missing buffer for attribute "'+xt+'"',be.commandStr);var Xt=vt.offset|0;q.command(Xt>=0,'invalid offset for attribute "'+xt+'"',be.commandStr);var Jt=vt.stride|0;q.command(Jt>=0&&Jt<256,'invalid stride for attribute "'+xt+'", must be integer betweeen [0, 255]',be.commandStr);var jr=vt.size|0;q.command(!("size"in vt)||jr>0&&jr<=4,'invalid size for attribute "'+xt+'", must be 1,2,3,4',be.commandStr);var gn=!!vt.normalized,an=0;"type"in vt&&(q.commandParameter(vt.type,Xs,"invalid type for attribute "+xt,be.commandStr),an=Xs[vt.type]);var Dn=vt.divisor|0;q.optional(function(){"divisor"in vt&&(q.command(Dn===0||Qr,'cannot specify divisor for attribute "'+xt+'", instancing not supported',be.commandStr),q.command(Dn>=0,'invalid divisor for attribute "'+xt+'"',be.commandStr));var pn=be.commandStr,ai=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(vt).forEach(function(Un){q.command(ai.indexOf(Un)>=0,'unknown parameter "'+Un+'" for attribute pointer "'+xt+'" (valid parameters are '+ai+")",pn)})}),Fe.buffer=ot,Fe.state=vi,Fe.size=jr,Fe.normalized=gn,Fe.type=an||ot.dtype,Fe.offset=Xt,Fe.stride=Jt,Fe.divisor=Dn}}lr[xt]=fs(function(pn,ai){var Un=pn.attribCache;if(at in Un)return Un[at];var Yn={isStream:!1};return Object.keys(Fe).forEach(function(qn){Yn[qn]=Fe[qn]}),Fe.buffer&&(Yn.buffer=pn.link(Fe.buffer),Yn.type=Yn.type||Yn.buffer+".dtype"),Un[at]=Yn,Yn})}),Object.keys(Gt).forEach(function(xt){var vt=Gt[xt];function at(Fe,ot){var Ue=Fe.invoke(ot,vt),Xt=Fe.shared,Jt=Fe.constants,jr=Xt.isBufferArgs,gn=Xt.buffer;q.optional(function(){Fe.assert(ot,Ue+"&&(typeof "+Ue+'==="object"||typeof '+Ue+'==="function")&&('+jr+"("+Ue+")||"+gn+".getBuffer("+Ue+")||"+gn+".getBuffer("+Ue+".buffer)||"+jr+"("+Ue+'.buffer)||("constant" in '+Ue+"&&(typeof "+Ue+'.constant==="number"||'+Xt.isArrayLike+"("+Ue+".constant))))",'invalid dynamic attribute "'+xt+'"')});var an={isStream:ot.def(!1)},Dn=new Zt;Dn.state=vi,Object.keys(Dn).forEach(function(Yn){an[Yn]=ot.def(""+Dn[Yn])});var pn=an.buffer,ai=an.type;ot("if(",jr,"(",Ue,")){",an.isStream,"=true;",pn,"=",gn,".createStream(",rf,",",Ue,");",ai,"=",pn,".dtype;","}else{",pn,"=",gn,".getBuffer(",Ue,");","if(",pn,"){",ai,"=",pn,".dtype;",'}else if("constant" in ',Ue,"){",an.state,"=",Ci,";","if(typeof "+Ue+'.constant === "number"){',an[xi[0]],"=",Ue,".constant;",xi.slice(1).map(function(Yn){return an[Yn]}).join("="),"=0;","}else{",xi.map(function(Yn,qn){return an[Yn]+"="+Ue+".constant.length>"+qn+"?"+Ue+".constant["+qn+"]:0;"}).join(""),"}}else{","if(",jr,"(",Ue,".buffer)){",pn,"=",gn,".createStream(",rf,",",Ue,".buffer);","}else{",pn,"=",gn,".getBuffer(",Ue,".buffer);","}",ai,'="type" in ',Ue,"?",Jt.glTypes,"[",Ue,".type]:",pn,".dtype;",an.normalized,"=!!",Ue,".normalized;");function Un(Yn){ot(an[Yn],"=",Ue,".",Yn,"|0;")}return Un("size"),Un("offset"),Un("stride"),Un("divisor"),ot("}}"),ot.exit("if(",an.isStream,"){",gn,".destroyStream(",pn,");","}"),an}lr[xt]=Cu(vt,at)}),lr}function oo(Ne){var be=Ne.static,nt=Ne.dynamic,Gt={};return Object.keys(be).forEach(function(lr){var xt=be[lr];Gt[lr]=fs(function(vt,at){return typeof xt=="number"||typeof xt=="boolean"?""+xt:vt.link(xt)})}),Object.keys(nt).forEach(function(lr){var xt=nt[lr];Gt[lr]=Cu(xt,function(vt,at){return vt.invoke(at,xt)})}),Gt}function Xo(Ne,be,nt,Gt,lr){var xt=Ne.static,vt=Ne.dynamic;q.optional(function(){var Un=[jl,cl,Vl,uc,Gu,Rf,cs,df,Ou,vf].concat(pi);function Yn(qn){Object.keys(qn).forEach(function(ei){q.command(Un.indexOf(ei)>=0,'unknown parameter "'+ei+'"',lr.commandStr)})}Yn(xt),Yn(vt)});var at=Ui(Ne,be),Fe=wn(Ne,lr),ot=Ti(Ne,Fe,lr),Ue=zo(Ne,lr),Xt=xo(Ne,lr),Jt=va(Ne,lr,at);function jr(Un){var Yn=ot[Un];Yn&&(Xt[Un]=Yn)}jr(Iu),jr(ni(Bs));var gn=Object.keys(Xt).length>0,an={framebuffer:Fe,draw:Ue,shader:Jt,state:Xt,dirty:gn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(an.profile=Fn(Ne,lr),an.uniforms=sa(nt,lr),an.drawVAO=an.scopeVAO=Ue.vao,!an.drawVAO&&Jt.program&&!at&&et.angle_instanced_arrays&&Ue.static.elements){var Dn=!0,pn=Jt.program.attributes.map(function(Un){var Yn=be.static[Un];return Dn=Dn&&!!Yn,Yn});if(Dn&&pn.length>0){var ai=en.getVAO(en.createVAO({attributes:pn,elements:Ue.static.elements}));an.drawVAO=new Es(null,null,null,function(Un,Yn){return Un.link(ai)}),an.useVAO=!0}}return at?an.useVAO=!0:an.attributes=hs(be,lr),an.context=oo(Gt,lr),an}function Uo(Ne,be,nt){var Gt=Ne.shared,lr=Gt.context,xt=Ne.scope();Object.keys(nt).forEach(function(vt){be.save(lr,"."+vt);var at=nt[vt],Fe=at.append(Ne,be);Array.isArray(Fe)?xt(lr,".",vt,"=[",Fe.join(),"];"):xt(lr,".",vt,"=",Fe,";")}),be(xt)}function Is(Ne,be,nt,Gt){var lr=Ne.shared,xt=lr.gl,vt=lr.framebuffer,at;kn&&(at=be.def(lr.extensions,".webgl_draw_buffers"));var Fe=Ne.constants,ot=Fe.drawBuffer,Ue=Fe.backBuffer,Xt;nt?Xt=nt.append(Ne,be):Xt=be.def(vt,".next"),Gt||be("if(",Xt,"!==",vt,".cur){"),be("if(",Xt,"){",xt,".bindFramebuffer(",hl,",",Xt,".framebuffer);"),kn&&be(at,".drawBuffersWEBGL(",ot,"[",Xt,".colorAttachments.length]);"),be("}else{",xt,".bindFramebuffer(",hl,",null);"),kn&&be(at,".drawBuffersWEBGL(",Ue,");"),be("}",vt,".cur=",Xt,";"),Gt||be("}")}function Ns(Ne,be,nt){var Gt=Ne.shared,lr=Gt.gl,xt=Ne.current,vt=Ne.next,at=Gt.current,Fe=Gt.next,ot=Ne.cond(at,".dirty");pi.forEach(function(Ue){var Xt=ni(Ue);if(!(Xt in nt.state)){var Jt,jr;if(Xt in vt){Jt=vt[Xt],jr=xt[Xt];var gn=de(Pn[Xt].length,function(Dn){return ot.def(Jt,"[",Dn,"]")});ot(Ne.cond(gn.map(function(Dn,pn){return Dn+"!=="+jr+"["+pn+"]"}).join("||")).then(lr,".",Pr[Xt],"(",gn,");",gn.map(function(Dn,pn){return jr+"["+pn+"]="+Dn}).join(";"),";"))}else{Jt=ot.def(Fe,".",Xt);var an=Ne.cond(Jt,"!==",at,".",Xt);ot(an),Xt in Dr?an(Ne.cond(Jt).then(lr,".enable(",Dr[Xt],");").else(lr,".disable(",Dr[Xt],");"),at,".",Xt,"=",Jt,";"):an(lr,".",Pr[Xt],"(",Jt,");",at,".",Xt,"=",Jt,";")}}}),Object.keys(nt.state).length===0&&ot(at,".dirty=false;"),be(ot)}function Cs(Ne,be,nt,Gt){var lr=Ne.shared,xt=Ne.current,vt=lr.current,at=lr.gl;yh(Object.keys(nt)).forEach(function(Fe){var ot=nt[Fe];if(!(Gt&&!Gt(ot))){var Ue=ot.append(Ne,be);if(Dr[Fe]){var Xt=Dr[Fe];Wo(ot)?Ue?be(at,".enable(",Xt,");"):be(at,".disable(",Xt,");"):be(Ne.cond(Ue).then(at,".enable(",Xt,");").else(at,".disable(",Xt,");")),be(vt,".",Fe,"=",Ue,";")}else if(Ia(Ue)){var Jt=xt[Fe];be(at,".",Pr[Fe],"(",Ue,");",Ue.map(function(jr,gn){return Jt+"["+gn+"]="+jr}).join(";"),";")}else be(at,".",Pr[Fe],"(",Ue,");",vt,".",Fe,"=",Ue,";")}})}function Yo(Ne,be){Qr&&(Ne.instancing=be.def(Ne.shared.extensions,".angle_instanced_arrays"))}function wi(Ne,be,nt,Gt,lr){var xt=Ne.shared,vt=Ne.stats,at=xt.current,Fe=xt.timer,ot=nt.profile;function Ue(){var Un=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return Un||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Xt,Jt;function jr(Un){Xt=be.def(),Un(Xt,"=",Ue(),";"),typeof lr=="string"?Un(vt,".count+=",lr,";"):Un(vt,".count++;"),$r&&(Gt?(Jt=be.def(),Un(Jt,"=",Fe,".getNumPendingQueries();")):Un(Fe,".beginQuery(",vt,");"))}function gn(Un){Un(vt,".cpuTime+=",Ue(),"-",Xt,";"),$r&&(Gt?Un(Fe,".pushScopeStats(",Jt,",",Fe,".getNumPendingQueries(),",vt,");"):Un(Fe,".endQuery();"))}function an(Un){var Yn=be.def(at,".profile");be(at,".profile=",Un,";"),be.exit(at,".profile=",Yn,";")}var Dn;if(ot){if(Wo(ot)){ot.enable?(jr(be),gn(be.exit),an("true")):an("false");return}Dn=ot.append(Ne,be),an(Dn)}else Dn=be.def(at,".profile");var pn=Ne.block();jr(pn),be("if(",Dn,"){",pn,"}");var ai=Ne.block();gn(ai),be.exit("if(",Dn,"){",ai,"}")}function Zo(Ne,be,nt,Gt,lr){var xt=Ne.shared;function vt(Fe){switch(Fe){case mf:case af:case of:return 2;case gf:case Nf:case zf:return 3;case Cc:case lc:case sf:return 4;default:return 1}}function at(Fe,ot,Ue){var Xt=xt.gl,Jt=be.def(Fe,".location"),jr=be.def(xt.attributes,"[",Jt,"]"),gn=Ue.state,an=Ue.buffer,Dn=[Ue.x,Ue.y,Ue.z,Ue.w],pn=["buffer","normalized","offset","stride"];function ai(){be("if(!",jr,".buffer){",Xt,".enableVertexAttribArray(",Jt,");}");var Yn=Ue.type,qn;if(Ue.size?qn=be.def(Ue.size,"||",ot):qn=ot,be("if(",jr,".type!==",Yn,"||",jr,".size!==",qn,"||",pn.map(function(gi){return jr+"."+gi+"!=="+Ue[gi]}).join("||"),"){",Xt,".bindBuffer(",rf,",",an,".buffer);",Xt,".vertexAttribPointer(",[Jt,qn,Yn,Ue.normalized,Ue.stride,Ue.offset],");",jr,".type=",Yn,";",jr,".size=",qn,";",pn.map(function(gi){return jr+"."+gi+"="+Ue[gi]+";"}).join(""),"}"),Qr){var ei=Ue.divisor;be("if(",jr,".divisor!==",ei,"){",Ne.instancing,".vertexAttribDivisorANGLE(",[Jt,ei],");",jr,".divisor=",ei,";}")}}function Un(){be("if(",jr,".buffer){",Xt,".disableVertexAttribArray(",Jt,");",jr,".buffer=null;","}if(",xi.map(function(Yn,qn){return jr+"."+Yn+"!=="+Dn[qn]}).join("||"),"){",Xt,".vertexAttrib4f(",Jt,",",Dn,");",xi.map(function(Yn,qn){return jr+"."+Yn+"="+Dn[qn]+";"}).join(""),"}")}gn===vi?ai():gn===Ci?Un():(be("if(",gn,"===",vi,"){"),ai(),be("}else{"),Un(),be("}"))}Gt.forEach(function(Fe){var ot=Fe.name,Ue=nt.attributes[ot],Xt;if(Ue){if(!lr(Ue))return;Xt=Ue.append(Ne,be)}else{if(!lr(_h))return;var Jt=Ne.scopeAttrib(ot);q.optional(function(){Ne.assert(be,Jt+".state","missing attribute "+ot)}),Xt={},Object.keys(new Zt).forEach(function(jr){Xt[jr]=be.def(Jt,".",jr)})}at(Ne.link(Fe),vt(Fe.info.type),Xt)})}function Ma(Ne,be,nt,Gt,lr,xt){for(var vt=Ne.shared,at=vt.gl,Fe,ot=0;ot<Gt.length;++ot){var Ue=Gt[ot],Xt=Ue.name,Jt=Ue.info.type,jr=nt.uniforms[Xt],gn=Ne.link(Ue),an=gn+".location",Dn;if(jr){if(!lr(jr))continue;if(Wo(jr)){var pn=jr.value;if(q.command(pn!==null&&typeof pn!="undefined",'missing uniform "'+Xt+'"',Ne.commandStr),Jt===_f||Jt===xf){q.command(typeof pn=="function"&&(Jt===_f&&(pn._reglType==="texture2d"||pn._reglType==="framebuffer")||Jt===xf&&(pn._reglType==="textureCube"||pn._reglType==="framebufferCube")),"invalid texture for uniform "+Xt,Ne.commandStr);var ai=Ne.link(pn._texture||pn.color[0]._texture);be(at,".uniform1i(",an,",",ai+".bind());"),be.exit(ai,".unbind();")}else if(Jt===Bc||Jt===pu||Jt===cc){q.optional(function(){q.command(Ia(pn),"invalid matrix for uniform "+Xt,Ne.commandStr),q.command(Jt===Bc&&pn.length===4||Jt===pu&&pn.length===9||Jt===cc&&pn.length===16,"invalid length for matrix uniform "+Xt,Ne.commandStr)});var Un=Ne.global.def("new Float32Array(["+Array.prototype.slice.call(pn)+"])"),Yn=2;Jt===pu?Yn=3:Jt===cc&&(Yn=4),be(at,".uniformMatrix",Yn,"fv(",an,",false,",Un,");")}else{switch(Jt){case Fc:q.commandType(pn,"number","uniform "+Xt,Ne.commandStr),Fe="1f";break;case mf:q.command(Ia(pn)&&pn.length===2,"uniform "+Xt,Ne.commandStr),Fe="2f";break;case gf:q.command(Ia(pn)&&pn.length===3,"uniform "+Xt,Ne.commandStr),Fe="3f";break;case Cc:q.command(Ia(pn)&&pn.length===4,"uniform "+Xt,Ne.commandStr),Fe="4f";break;case dh:q.commandType(pn,"boolean","uniform "+Xt,Ne.commandStr),Fe="1i";break;case yf:q.commandType(pn,"number","uniform "+Xt,Ne.commandStr),Fe="1i";break;case of:q.command(Ia(pn)&&pn.length===2,"uniform "+Xt,Ne.commandStr),Fe="2i";break;case af:q.command(Ia(pn)&&pn.length===2,"uniform "+Xt,Ne.commandStr),Fe="2i";break;case zf:q.command(Ia(pn)&&pn.length===3,"uniform "+Xt,Ne.commandStr),Fe="3i";break;case Nf:q.command(Ia(pn)&&pn.length===3,"uniform "+Xt,Ne.commandStr),Fe="3i";break;case sf:q.command(Ia(pn)&&pn.length===4,"uniform "+Xt,Ne.commandStr),Fe="4i";break;case lc:q.command(Ia(pn)&&pn.length===4,"uniform "+Xt,Ne.commandStr),Fe="4i";break}be(at,".uniform",Fe,"(",an,",",Ia(pn)?Array.prototype.slice.call(pn):pn,");")}continue}else Dn=jr.append(Ne,be)}else{if(!lr(_h))continue;Dn=be.def(vt.uniforms,"[",Oe.id(Xt),"]")}Jt===_f?(q(!Array.isArray(Dn),"must specify a scalar prop for textures"),be("if(",Dn,"&&",Dn,'._reglType==="framebuffer"){',Dn,"=",Dn,".color[0];","}")):Jt===xf&&(q(!Array.isArray(Dn),"must specify a scalar prop for cube maps"),be("if(",Dn,"&&",Dn,'._reglType==="framebufferCube"){',Dn,"=",Dn,".color[0];","}")),q.optional(function(){function iu(Wu,Gf){Ne.assert(be,Wu,'bad data or missing for uniform "'+Xt+'".  '+Gf)}function Ll(Wu){q(!Array.isArray(Dn),"must not specify an array type for uniform"),iu("typeof "+Dn+'==="'+Wu+'"',"invalid type, expected "+Wu)}function Hu(Wu,Gf){Array.isArray(Dn)?q(Dn.length===Wu,"must have length "+Wu):iu(vt.isArrayLike+"("+Dn+")&&"+Dn+".length==="+Wu,"invalid vector, should have length "+Wu,Ne.commandStr)}function bh(Wu){q(!Array.isArray(Dn),"must not specify a value type"),iu("typeof "+Dn+'==="function"&&'+Dn+'._reglType==="texture'+(Wu===Rh?"2d":"Cube")+'"',"invalid texture type",Ne.commandStr)}switch(Jt){case yf:Ll("number");break;case af:Hu(2,"number");break;case Nf:Hu(3,"number");break;case lc:Hu(4,"number");break;case Fc:Ll("number");break;case mf:Hu(2,"number");break;case gf:Hu(3,"number");break;case Cc:Hu(4,"number");break;case dh:Ll("boolean");break;case of:Hu(2,"boolean");break;case zf:Hu(3,"boolean");break;case sf:Hu(4,"boolean");break;case Bc:Hu(4,"number");break;case pu:Hu(9,"number");break;case cc:Hu(16,"number");break;case _f:bh(Rh);break;case xf:bh(hp);break}});var qn=1;switch(Jt){case _f:case xf:var ei=be.def(Dn,"._texture");be(at,".uniform1i(",an,",",ei,".bind());"),be.exit(ei,".unbind();");continue;case yf:case dh:Fe="1i";break;case af:case of:Fe="2i",qn=2;break;case Nf:case zf:Fe="3i",qn=3;break;case lc:case sf:Fe="4i",qn=4;break;case Fc:Fe="1f";break;case mf:Fe="2f",qn=2;break;case gf:Fe="3f",qn=3;break;case Cc:Fe="4f",qn=4;break;case Bc:Fe="Matrix2fv";break;case pu:Fe="Matrix3fv";break;case cc:Fe="Matrix4fv";break}if(Fe.charAt(0)==="M"){be(at,".uniform",Fe,"(",an,",");var gi=Math.pow(Jt-Bc+2,2),Na=Ne.global.def("new Float32Array(",gi,")");Array.isArray(Dn)?be("false,(",de(gi,function(iu){return Na+"["+iu+"]="+Dn[iu]}),",",Na,")"):be("false,(Array.isArray(",Dn,")||",Dn," instanceof Float32Array)?",Dn,":(",de(gi,function(iu){return Na+"["+iu+"]="+Dn+"["+iu+"]"}),",",Na,")"),be(");")}else if(qn>1){for(var Bo=[],Yl=[],Za=0;Za<qn;++Za)Array.isArray(Dn)?Yl.push(Dn[Za]):Yl.push(be.def(Dn+"["+Za+"]")),xt&&Bo.push(be.def());xt&&be("if(!",Ne.batchId,"||",Bo.map(function(iu,Ll){return iu+"!=="+Yl[Ll]}).join("||"),"){",Bo.map(function(iu,Ll){return iu+"="+Yl[Ll]+";"}).join("")),be(at,".uniform",Fe,"(",an,",",Yl.join(","),");"),xt&&be("}")}else{if(q(!Array.isArray(Dn),"uniform value must not be an array"),xt){var _a=be.def();be("if(!",Ne.batchId,"||",_a,"!==",Dn,"){",_a,"=",Dn,";")}be(at,".uniform",Fe,"(",an,",",Dn,");"),xt&&be("}")}}}function Io(Ne,be,nt,Gt){var lr=Ne.shared,xt=lr.gl,vt=lr.draw,at=Gt.draw;function Fe(){var qn=at.elements,ei,gi=be;return qn?((qn.contextDep&&Gt.contextDynamic||qn.propDep)&&(gi=nt),ei=qn.append(Ne,gi),at.elementsActive&&gi("if("+ei+")"+xt+".bindBuffer("+fh+","+ei+".buffer.buffer);")):(ei=gi.def(),gi(ei,"=",vt,".",uc,";","if(",ei,"){",xt,".bindBuffer(",fh,",",ei,".buffer.buffer);}","else if(",lr.vao,".currentVAO){",ei,"=",Ne.shared.elements+".getElements("+lr.vao,".currentVAO.elements);",Rr?"":"if("+ei+")"+xt+".bindBuffer("+fh+","+ei+".buffer.buffer);","}")),ei}function ot(){var qn=at.count,ei,gi=be;return qn?((qn.contextDep&&Gt.contextDynamic||qn.propDep)&&(gi=nt),ei=qn.append(Ne,gi),q.optional(function(){qn.MISSING&&Ne.assert(be,"false","missing vertex count"),qn.DYNAMIC&&Ne.assert(gi,ei+">=0","missing vertex count")})):(ei=gi.def(vt,".",cs),q.optional(function(){Ne.assert(gi,ei+">=0","missing vertex count")})),ei}var Ue=Fe();function Xt(qn){var ei=at[qn];return ei?ei.contextDep&&Gt.contextDynamic||ei.propDep?ei.append(Ne,nt):ei.append(Ne,be):be.def(vt,".",qn)}var Jt=Xt(Gu),jr=Xt(Rf),gn=ot();if(typeof gn=="number"){if(gn===0)return}else nt("if(",gn,"){"),nt.exit("}");var an,Dn;Qr&&(an=Xt(df),Dn=Ne.instancing);var pn=Ue+".type",ai=at.elements&&Wo(at.elements)&&!at.vaoActive;function Un(){function qn(){nt(Dn,".drawElementsInstancedANGLE(",[Jt,gn,pn,jr+"<<(("+pn+"-"+Gi+")>>1)",an],");")}function ei(){nt(Dn,".drawArraysInstancedANGLE(",[Jt,jr,gn,an],");")}Ue&&Ue!=="null"?ai?qn():(nt("if(",Ue,"){"),qn(),nt("}else{"),ei(),nt("}")):ei()}function Yn(){function qn(){nt(xt+".drawElements("+[Jt,gn,pn,jr+"<<(("+pn+"-"+Gi+")>>1)"]+");")}function ei(){nt(xt+".drawArrays("+[Jt,jr,gn]+");")}Ue&&Ue!=="null"?ai?qn():(nt("if(",Ue,"){"),qn(),nt("}else{"),ei(),nt("}")):ei()}Qr&&(typeof an!="number"||an>=0)?typeof an=="string"?(nt("if(",an,">0){"),Un(),nt("}else if(",an,"<0){"),Yn(),nt("}")):Un():Yn()}function ki(Ne,be,nt,Gt,lr){var xt=Fi(),vt=xt.proc("body",lr);return q.optional(function(){xt.commandStr=be.commandStr,xt.command=xt.link(be.commandStr)}),Qr&&(xt.instancing=vt.def(xt.shared.extensions,".angle_instanced_arrays")),Ne(xt,vt,nt,Gt),xt.compile().body}function ca(Ne,be,nt,Gt){Yo(Ne,be),nt.useVAO?nt.drawVAO?be(Ne.shared.vao,".setVAO(",nt.drawVAO.append(Ne,be),");"):be(Ne.shared.vao,".setVAO(",Ne.shared.vao,".targetVAO);"):(be(Ne.shared.vao,".setVAO(null);"),Zo(Ne,be,nt,Gt.attributes,function(){return!0})),Ma(Ne,be,nt,Gt.uniforms,function(){return!0},!1),Io(Ne,be,be,nt)}function Ja(Ne,be){var nt=Ne.proc("draw",1);Yo(Ne,nt),Uo(Ne,nt,be.context),Is(Ne,nt,be.framebuffer),Ns(Ne,nt,be),Cs(Ne,nt,be.state),wi(Ne,nt,be,!1,!0);var Gt=be.shader.progVar.append(Ne,nt);if(nt(Ne.shared.gl,".useProgram(",Gt,".program);"),be.shader.program)ca(Ne,nt,be,be.shader.program);else{nt(Ne.shared.vao,".setVAO(null);");var lr=Ne.global.def("{}"),xt=nt.def(Gt,".id"),vt=nt.def(lr,"[",xt,"]");nt(Ne.cond(vt).then(vt,".call(this,a0);").else(vt,"=",lr,"[",xt,"]=",Ne.link(function(at){return ki(ca,Ne,be,at,1)}),"(",Gt,");",vt,".call(this,a0);"))}Object.keys(be.state).length>0&&nt(Ne.shared.current,".dirty=true;"),Ne.shared.vao&&nt(Ne.shared.vao,".setVAO(null);")}function bo(Ne,be,nt,Gt){Ne.batchId="a1",Yo(Ne,be);function lr(){return!0}Zo(Ne,be,nt,Gt.attributes,lr),Ma(Ne,be,nt,Gt.uniforms,lr,!1),Io(Ne,be,be,nt)}function pl(Ne,be,nt,Gt){Yo(Ne,be);var lr=nt.contextDep,xt=be.def(),vt="a0",at="a1",Fe=be.def();Ne.shared.props=Fe,Ne.batchId=xt;var ot=Ne.scope(),Ue=Ne.scope();be(ot.entry,"for(",xt,"=0;",xt,"<",at,";++",xt,"){",Fe,"=",vt,"[",xt,"];",Ue,"}",ot.exit);function Xt(pn){return pn.contextDep&&lr||pn.propDep}function Jt(pn){return!Xt(pn)}if(nt.needsContext&&Uo(Ne,Ue,nt.context),nt.needsFramebuffer&&Is(Ne,Ue,nt.framebuffer),Cs(Ne,Ue,nt.state,Xt),nt.profile&&Xt(nt.profile)&&wi(Ne,Ue,nt,!1,!0),Gt)nt.useVAO?nt.drawVAO?Xt(nt.drawVAO)?Ue(Ne.shared.vao,".setVAO(",nt.drawVAO.append(Ne,Ue),");"):ot(Ne.shared.vao,".setVAO(",nt.drawVAO.append(Ne,ot),");"):ot(Ne.shared.vao,".setVAO(",Ne.shared.vao,".targetVAO);"):(ot(Ne.shared.vao,".setVAO(null);"),Zo(Ne,ot,nt,Gt.attributes,Jt),Zo(Ne,Ue,nt,Gt.attributes,Xt)),Ma(Ne,ot,nt,Gt.uniforms,Jt,!1),Ma(Ne,Ue,nt,Gt.uniforms,Xt,!0),Io(Ne,ot,Ue,nt);else{var jr=Ne.global.def("{}"),gn=nt.shader.progVar.append(Ne,Ue),an=Ue.def(gn,".id"),Dn=Ue.def(jr,"[",an,"]");Ue(Ne.shared.gl,".useProgram(",gn,".program);","if(!",Dn,"){",Dn,"=",jr,"[",an,"]=",Ne.link(function(pn){return ki(bo,Ne,nt,pn,2)}),"(",gn,");}",Dn,".call(this,a0[",xt,"],",xt,");")}}function He(Ne,be){var nt=Ne.proc("batch",2);Ne.batchId="0",Yo(Ne,nt);var Gt=!1,lr=!0;Object.keys(be.context).forEach(function(jr){Gt=Gt||be.context[jr].propDep}),Gt||(Uo(Ne,nt,be.context),lr=!1);var xt=be.framebuffer,vt=!1;xt?(xt.propDep?Gt=vt=!0:xt.contextDep&&Gt&&(vt=!0),vt||Is(Ne,nt,xt)):Is(Ne,nt,null),be.state.viewport&&be.state.viewport.propDep&&(Gt=!0);function at(jr){return jr.contextDep&&Gt||jr.propDep}Ns(Ne,nt,be),Cs(Ne,nt,be.state,function(jr){return!at(jr)}),(!be.profile||!at(be.profile))&&wi(Ne,nt,be,!1,"a1"),be.contextDep=Gt,be.needsContext=lr,be.needsFramebuffer=vt;var Fe=be.shader.progVar;if(Fe.contextDep&&Gt||Fe.propDep)pl(Ne,nt,be,null);else{var ot=Fe.append(Ne,nt);if(nt(Ne.shared.gl,".useProgram(",ot,".program);"),be.shader.program)pl(Ne,nt,be,be.shader.program);else{nt(Ne.shared.vao,".setVAO(null);");var Ue=Ne.global.def("{}"),Xt=nt.def(ot,".id"),Jt=nt.def(Ue,"[",Xt,"]");nt(Ne.cond(Jt).then(Jt,".call(this,a0,a1);").else(Jt,"=",Ue,"[",Xt,"]=",Ne.link(function(jr){return ki(pl,Ne,be,jr,2)}),"(",ot,");",Jt,".call(this,a0,a1);"))}}Object.keys(be.state).length>0&&nt(Ne.shared.current,".dirty=true;"),Ne.shared.vao&&nt(Ne.shared.vao,".setVAO(null);")}function ir(Ne,be){var nt=Ne.proc("scope",3);Ne.batchId="a2";var Gt=Ne.shared,lr=Gt.current;Uo(Ne,nt,be.context),be.framebuffer&&be.framebuffer.append(Ne,nt),yh(Object.keys(be.state)).forEach(function(vt){var at=be.state[vt],Fe=at.append(Ne,nt);Ia(Fe)?Fe.forEach(function(ot,Ue){nt.set(Ne.next[vt],"["+Ue+"]",ot)}):nt.set(Gt.next,"."+vt,Fe)}),wi(Ne,nt,be,!0,!0),[uc,Rf,cs,df,Gu].forEach(function(vt){var at=be.draw[vt];!at||nt.set(Gt.draw,"."+vt,""+at.append(Ne,nt))}),Object.keys(be.uniforms).forEach(function(vt){var at=be.uniforms[vt].append(Ne,nt);Array.isArray(at)&&(at="["+at.join()+"]"),nt.set(Gt.uniforms,"["+Oe.id(vt)+"]",at)}),Object.keys(be.attributes).forEach(function(vt){var at=be.attributes[vt].append(Ne,nt),Fe=Ne.scopeAttrib(vt);Object.keys(new Zt).forEach(function(ot){nt.set(Fe,"."+ot,at[ot])})}),be.scopeVAO&&nt.set(Gt.vao,".targetVAO",be.scopeVAO.append(Ne,nt));function xt(vt){var at=be.shader[vt];at&&nt.set(Gt.shader,"."+vt,at.append(Ne,nt))}xt(cl),xt(Vl),Object.keys(be.state).length>0&&(nt(lr,".dirty=true;"),nt.exit(lr,".dirty=true;")),nt("a1(",Ne.shared.context,",a0,",Ne.batchId,");")}function er(Ne){if(!(typeof Ne!="object"||Ia(Ne))){for(var be=Object.keys(Ne),nt=0;nt<be.length;++nt)if(Yr.isDynamic(Ne[be[nt]]))return!0;return!1}}function Xn(Ne,be,nt){var Gt=be.static[nt];if(!Gt||!er(Gt))return;var lr=Ne.global,xt=Object.keys(Gt),vt=!1,at=!1,Fe=!1,ot=Ne.global.def("{}");xt.forEach(function(Xt){var Jt=Gt[Xt];if(Yr.isDynamic(Jt)){typeof Jt=="function"&&(Jt=Gt[Xt]=Yr.unbox(Jt));var jr=Cu(Jt,null);vt=vt||jr.thisDep,Fe=Fe||jr.propDep,at=at||jr.contextDep}else{switch(lr(ot,".",Xt,"="),typeof Jt){case"number":lr(Jt);break;case"string":lr('"',Jt,'"');break;case"object":Array.isArray(Jt)&&lr("[",Jt.join(),"]");break;default:lr(Ne.link(Jt));break}lr(";")}});function Ue(Xt,Jt){xt.forEach(function(jr){var gn=Gt[jr];if(!!Yr.isDynamic(gn)){var an=Xt.invoke(Jt,gn);Jt(ot,".",jr,"=",an,";")}})}be.dynamic[nt]=new Yr.DynamicVariable(ce,{thisDep:vt,contextDep:at,propDep:Fe,ref:ot,append:Ue}),delete be.static[nt]}function fa(Ne,be,nt,Gt,lr){var xt=Fi();xt.stats=xt.link(lr),Object.keys(be.static).forEach(function(at){Xn(xt,be,at)}),lp.forEach(function(at){Xn(xt,Ne,at)});var vt=Xo(Ne,be,nt,Gt,xt);return Ja(xt,vt),ir(xt,vt),He(xt,vt),p(xt.compile(),{destroy:function(){vt.shader.program.destroy()}})}return{next:ln,current:Pn,procs:function(){var Ne=Fi(),be=Ne.proc("poll"),nt=Ne.proc("refresh"),Gt=Ne.block();be(Gt),nt(Gt);var lr=Ne.shared,xt=lr.gl,vt=lr.next,at=lr.current;Gt(at,".dirty=false;"),Is(Ne,be),Is(Ne,nt,null,!0);var Fe;Qr&&(Fe=Ne.link(Qr)),et.oes_vertex_array_object&&nt(Ne.link(et.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ot=0;ot<cr.maxAttributes;++ot){var Ue=nt.def(lr.attributes,"[",ot,"]"),Xt=Ne.cond(Ue,".buffer");Xt.then(xt,".enableVertexAttribArray(",ot,");",xt,".bindBuffer(",rf,",",Ue,".buffer.buffer);",xt,".vertexAttribPointer(",ot,",",Ue,".size,",Ue,".type,",Ue,".normalized,",Ue,".stride,",Ue,".offset);").else(xt,".disableVertexAttribArray(",ot,");",xt,".vertexAttrib4f(",ot,",",Ue,".x,",Ue,".y,",Ue,".z,",Ue,".w);",Ue,".buffer=null;"),nt(Xt),Qr&&nt(Fe,".vertexAttribDivisorANGLE(",ot,",",Ue,".divisor);")}return nt(Ne.shared.vao,".currentVAO=null;",Ne.shared.vao,".setVAO(",Ne.shared.vao,".targetVAO);"),Object.keys(Dr).forEach(function(Jt){var jr=Dr[Jt],gn=Gt.def(vt,".",Jt),an=Ne.block();an("if(",gn,"){",xt,".enable(",jr,")}else{",xt,".disable(",jr,")}",at,".",Jt,"=",gn,";"),nt(an),be("if(",gn,"!==",at,".",Jt,"){",an,"}")}),Object.keys(Pr).forEach(function(Jt){var jr=Pr[Jt],gn=Pn[Jt],an,Dn,pn=Ne.block();if(pn(xt,".",jr,"("),Ia(gn)){var ai=gn.length;an=Ne.global.def(vt,".",Jt),Dn=Ne.global.def(at,".",Jt),pn(de(ai,function(Un){return an+"["+Un+"]"}),");",de(ai,function(Un){return Dn+"["+Un+"]="+an+"["+Un+"];"}).join("")),be("if(",de(ai,function(Un){return an+"["+Un+"]!=="+Dn+"["+Un+"]"}).join("||"),"){",pn,"}")}else an=Gt.def(vt,".",Jt),Dn=Gt.def(at,".",Jt),pn(an,");",at,".",Jt,"=",an,";"),be("if(",an,"!==",Dn,"){",pn,"}");nt(pn)}),Ne.compile()}(),compile:fa}}function zh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var mp=34918,gp=34919,Uh=35007,Zh=function(V,Oe){if(!Oe.ext_disjoint_timer_query)return null;var et=[];function cr(){return et.pop()||Oe.ext_disjoint_timer_query.createQueryEXT()}function Br(Qr){et.push(Qr)}var or=[];function Ir(Qr){var kn=cr();Oe.ext_disjoint_timer_query.beginQueryEXT(Uh,kn),or.push(kn),$r(or.length-1,or.length,Qr)}function Hr(){Oe.ext_disjoint_timer_query.endQueryEXT(Uh)}function Jr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var en=[];function tn(){return en.pop()||new Jr}function on(Qr){en.push(Qr)}var xn=[];function $r(Qr,kn,Rr){var Pn=tn();Pn.startQueryIndex=Qr,Pn.endQueryIndex=kn,Pn.sum=0,Pn.stats=Rr,xn.push(Pn)}var sn=[],Zt=[];function _r(){var Qr,kn,Rr=or.length;if(Rr!==0){Zt.length=Math.max(Zt.length,Rr+1),sn.length=Math.max(sn.length,Rr+1),sn[0]=0,Zt[0]=0;var Pn=0;for(Qr=0,kn=0;kn<or.length;++kn){var ln=or[kn];Oe.ext_disjoint_timer_query.getQueryObjectEXT(ln,gp)?(Pn+=Oe.ext_disjoint_timer_query.getQueryObjectEXT(ln,mp),Br(ln)):or[Qr++]=ln,sn[kn+1]=Pn,Zt[kn+1]=Qr}for(or.length=Qr,Qr=0,kn=0;kn<xn.length;++kn){var pi=xn[kn],Dr=pi.startQueryIndex,Pr=pi.endQueryIndex;pi.sum+=sn[Pr]-sn[Dr];var ni=Zt[Dr],En=Zt[Pr];En===ni?(pi.stats.gpuTime+=pi.sum/1e6,on(pi)):(pi.startQueryIndex=ni,pi.endQueryIndex=En,xn[Qr++]=pi)}xn.length=Qr}}return{beginQuery:Ir,endQuery:Hr,pushScopeStats:$r,update:_r,getNumPendingQueries:function(){return or.length},clear:function(){et.push.apply(et,or);for(var Qr=0;Qr<et.length;Qr++)Oe.ext_disjoint_timer_query.deleteQueryEXT(et[Qr]);or.length=0,et.length=0},restore:function(){or.length=0,et.length=0}}},yp=16384,_p=256,Ef=1024,jh=34962,xh="webglcontextlost",Cf="webglcontextrestored",$a=1,Vh=2,Xl=3;function Nc(V,Oe){for(var et=0;et<V.length;++et)if(V[et]===Oe)return et;return-1}function Gh(V){var Oe=N(V);if(!Oe)return null;var et=Oe.gl,cr=et.getContextAttributes(),Br=et.isContextLost(),or=ae(et,Oe);if(!or)return null;var Ir=St(),Hr=zh(),Jr=or.extensions,en=Zh(et,Jr),tn=Or(),on=et.drawingBufferWidth,xn=et.drawingBufferHeight,$r={tick:0,time:0,viewportWidth:on,viewportHeight:xn,framebufferWidth:on,framebufferHeight:xn,drawingBufferWidth:on,drawingBufferHeight:xn,pixelRatio:Oe.pixelRatio},sn={},Zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},_r=Be(et,Jr),Qr=j(et,Hr,Oe,Pn),kn=Ks(et,Jr,Qr,Hr),Rr=At(et,Jr,_r,Hr,Qr,kn,Zt);function Pn(ki){return Rr.destroyBuffer(ki)}var ln=Wr(et,Ir,Hr,Oe),pi=bi(et,Jr,_r,function(){ni.procs.poll()},$r,Hr,Oe),Dr=qc(et,Jr,_r,Hr,Oe),Pr=Me(et,Jr,_r,pi,Dr,Hr),ni=vp(et,Ir,Jr,_r,Qr,kn,pi,Pr,sn,Rr,ln,Zt,$r,en,Oe),En=li(et,Pr,ni.procs.poll,$r,cr,Jr,_r),rn=ni.next,Mn=et.canvas,On=[],Vi=[],Fi=[],Fn=[Oe.onDestroy],wn=null;function Ti(){if(On.length===0){en&&en.update(),wn=null;return}wn=An.next(Ti),Yo();for(var ki=On.length-1;ki>=0;--ki){var ca=On[ki];ca&&ca($r,null,0)}et.flush(),en&&en.update()}function Ui(){!wn&&On.length>0&&(wn=An.next(Ti))}function va(){wn&&(An.cancel(Ti),wn=null)}function zo(ki){ki.preventDefault(),Br=!0,va(),Vi.forEach(function(ca){ca()})}function xo(ki){et.getError(),Br=!1,or.restore(),ln.restore(),Qr.restore(),pi.restore(),Dr.restore(),Pr.restore(),Rr.restore(),en&&en.restore(),ni.procs.refresh(),Ui(),Fi.forEach(function(ca){ca()})}var sa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!sa&&Mn&&(Mn.addEventListener(xh,zo,!1),Mn.addEventListener(Cf,xo,!1));function hs(){On.length=0,va(),!sa&&Mn&&(Mn.removeEventListener(xh,zo),Mn.removeEventListener(Cf,xo)),ln.clear(),Pr.clear(),Dr.clear(),Rr.clear(),pi.clear(),kn.clear(),Qr.clear(),en&&en.clear(),Fn.forEach(function(ki){ki()})}function oo(ki){q(!!ki,"invalid args to regl({...})"),q.type(ki,"object","invalid args to regl({...})");function ca(xt){var vt=p({},xt);delete vt.uniforms,delete vt.attributes,delete vt.context,delete vt.vao,"stencil"in vt&&vt.stencil.op&&(vt.stencil.opBack=vt.stencil.opFront=vt.stencil.op,delete vt.stencil.op);function at(Fe){if(Fe in vt){var ot=vt[Fe];delete vt[Fe],Object.keys(ot).forEach(function(Ue){vt[Fe+"."+Ue]=ot[Ue]})}}return at("blend"),at("depth"),at("cull"),at("stencil"),at("polygonOffset"),at("scissor"),at("sample"),"vao"in xt&&(vt.vao=xt.vao),vt}function Ja(xt,vt){var at={},Fe={};return Object.keys(xt).forEach(function(ot){var Ue=xt[ot];if(Yr.isDynamic(Ue)){Fe[ot]=Yr.unbox(Ue,ot);return}else if(vt&&Array.isArray(Ue)){for(var Xt=0;Xt<Ue.length;++Xt)if(Yr.isDynamic(Ue[Xt])){Fe[ot]=Yr.unbox(Ue,ot);return}}at[ot]=Ue}),{dynamic:Fe,static:at}}var bo=Ja(ki.context||{},!0),pl=Ja(ki.uniforms||{},!0),He=Ja(ki.attributes||{},!1),ir=Ja(ca(ki),!1),er={gpuTime:0,cpuTime:0,count:0},Xn=ni.compile(ir,He,pl,bo,er),fa=Xn.draw,Ne=Xn.batch,be=Xn.scope,nt=[];function Gt(xt){for(;nt.length<xt;)nt.push(null);return nt}function lr(xt,vt){var at;if(Br&&q.raise("context lost"),typeof xt=="function")return be.call(this,null,xt,0);if(typeof vt=="function")if(typeof xt=="number")for(at=0;at<xt;++at)be.call(this,null,vt,at);else if(Array.isArray(xt))for(at=0;at<xt.length;++at)be.call(this,xt[at],vt,at);else return be.call(this,xt,vt,0);else if(typeof xt=="number"){if(xt>0)return Ne.call(this,Gt(xt|0),xt|0)}else if(Array.isArray(xt)){if(xt.length)return Ne.call(this,xt,xt.length)}else return fa.call(this,xt)}return p(lr,{stats:er,destroy:function(){Xn.destroy()}})}var Xo=Pr.setFBO=oo({framebuffer:Yr.define.call(null,$a,"framebuffer")});function Uo(ki,ca){var Ja=0;ni.procs.poll();var bo=ca.color;bo&&(et.clearColor(+bo[0]||0,+bo[1]||0,+bo[2]||0,+bo[3]||0),Ja|=yp),"depth"in ca&&(et.clearDepth(+ca.depth),Ja|=_p),"stencil"in ca&&(et.clearStencil(ca.stencil|0),Ja|=Ef),q(!!Ja,"called regl.clear with no buffer specified"),et.clear(Ja)}function Is(ki){if(q(typeof ki=="object"&&ki,"regl.clear() takes an object as input"),"framebuffer"in ki)if(ki.framebuffer&&ki.framebuffer_reglType==="framebufferCube")for(var ca=0;ca<6;++ca)Xo(p({framebuffer:ki.framebuffer.faces[ca]},ki),Uo);else Xo(ki,Uo);else Uo(null,ki)}function Ns(ki){q.type(ki,"function","regl.frame() callback must be a function"),On.push(ki);function ca(){var Ja=Nc(On,ki);q(Ja>=0,"cannot cancel a frame twice");function bo(){var pl=Nc(On,bo);On[pl]=On[On.length-1],On.length-=1,On.length<=0&&va()}On[Ja]=bo}return Ui(),{cancel:ca}}function Cs(){var ki=rn.viewport,ca=rn.scissor_box;ki[0]=ki[1]=ca[0]=ca[1]=0,$r.viewportWidth=$r.framebufferWidth=$r.drawingBufferWidth=ki[2]=ca[2]=et.drawingBufferWidth,$r.viewportHeight=$r.framebufferHeight=$r.drawingBufferHeight=ki[3]=ca[3]=et.drawingBufferHeight}function Yo(){$r.tick+=1,$r.time=Zo(),Cs(),ni.procs.poll()}function wi(){pi.refresh(),Cs(),ni.procs.refresh(),en&&en.update()}function Zo(){return(Or()-tn)/1e3}wi();function Ma(ki,ca){q.type(ca,"function","listener callback must be a function");var Ja;switch(ki){case"frame":return Ns(ca);case"lost":Ja=Vi;break;case"restore":Ja=Fi;break;case"destroy":Ja=Fn;break;default:q.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ja.push(ca),{cancel:function(){for(var bo=0;bo<Ja.length;++bo)if(Ja[bo]===ca){Ja[bo]=Ja[Ja.length-1],Ja.pop();return}}}}var Io=p(oo,{clear:Is,prop:Yr.define.bind(null,$a),context:Yr.define.bind(null,Vh),this:Yr.define.bind(null,Xl),draw:oo({}),buffer:function(ki){return Qr.create(ki,jh,!1,!1)},elements:function(ki){return kn.create(ki,!1)},texture:pi.create2D,cube:pi.createCube,renderbuffer:Dr.create,framebuffer:Pr.create,framebufferCube:Pr.createCube,vao:Rr.createVAO,attributes:cr,frame:Ns,on:Ma,limits:_r,hasExtension:function(ki){return _r.extensions.indexOf(ki.toLowerCase())>=0},read:En,destroy:hs,_gl:et,_refresh:wi,poll:function(){Yo(),en&&en.update()},now:Zo,stats:Hr});return Oe.onDone(null,Io),Io}return Gh})},58380:function(Qe){function O(y,z,b){switch(b.length){case 0:return y.call(z);case 1:return y.call(z,b[0]);case 2:return y.call(z,b[0],b[1]);case 3:return y.call(z,b[0],b[1],b[2])}return y.apply(z,b)}Qe.exports=O},77412:function(Qe){function O(y,z){for(var b=-1,p=y==null?0:y.length;++b<p&&z(y[b],b,y)!==!1;);return y}Qe.exports=O},47443:function(Qe,O,y){var z=y(42118);function b(p,X){var U=p==null?0:p.length;return!!U&&z(p,X,0)>-1}Qe.exports=b},1196:function(Qe){function O(y,z,b){for(var p=-1,X=y==null?0:y.length;++p<X;)if(b(z,y[p]))return!0;return!1}Qe.exports=O},29932:function(Qe){function O(y,z){for(var b=-1,p=y==null?0:y.length,X=Array(p);++b<p;)X[b]=z(y[b],b,y);return X}Qe.exports=O},62663:function(Qe){function O(y,z,b,p){var X=-1,U=y==null?0:y.length;for(p&&U&&(b=y[++X]);++X<U;)b=z(b,y[X],X,y);return b}Qe.exports=O},49029:function(Qe){var O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function y(z){return z.match(O)||[]}Qe.exports=y},86556:function(Qe,O,y){var z=y(89465),b=y(77813);function p(X,U,Y){(Y!==void 0&&!b(X[U],Y)||Y===void 0&&!(U in X))&&z(X,U,Y)}Qe.exports=p},34865:function(Qe,O,y){var z=y(89465),b=y(77813),p=Object.prototype,X=p.hasOwnProperty;function U(Y,$,he){var Z=Y[$];(!(X.call(Y,$)&&b(Z,he))||he===void 0&&!($ in Y))&&z(Y,$,he)}Qe.exports=U},44037:function(Qe,O,y){var z=y(98363),b=y(3674);function p(X,U){return X&&z(U,b(U),X)}Qe.exports=p},63886:function(Qe,O,y){var z=y(98363),b=y(81704);function p(X,U){return X&&z(U,b(U),X)}Qe.exports=p},89465:function(Qe,O,y){var z=y(38777);function b(p,X,U){X=="__proto__"&&z?z(p,X,{configurable:!0,enumerable:!0,value:U,writable:!0}):p[X]=U}Qe.exports=b},29750:function(Qe){function O(y,z,b){return y===y&&(b!==void 0&&(y=y<=b?y:b),z!==void 0&&(y=y>=z?y:z)),y}Qe.exports=O},85990:function(Qe,O,y){var z=y(46384),b=y(77412),p=y(34865),X=y(44037),U=y(63886),Y=y(64626),$=y(278),he=y(18805),Z=y(1911),Ie=y(58234),Le=y(46904),rt=y(64160),$t=y(43824),zt=y(29148),Lt=y(38517),Ht=y(1469),Ct=y(44144),yt=y(56688),ft=y(13218),sr=y(72928),re=y(3674),nr=y(81704),Tt=1,$e=2,Mt=4,Ve="[object Arguments]",Ot="[object Array]",pr="[object Boolean]",qt="[object Date]",W="[object Error]",se="[object Function]",ke="[object GeneratorFunction]",_e="[object Map]",Et="[object Number]",gt="[object Object]",jt="[object RegExp]",Ut="[object Set]",zr="[object String]",dn="[object Symbol]",_n="[object WeakMap]",Qi="[object ArrayBuffer]",ur="[object DataView]",ge="[object Float32Array]",Pe="[object Float64Array]",Ge="[object Int8Array]",Re="[object Int16Array]",Nt="[object Int32Array]",ar="[object Uint8Array]",yr="[object Uint8ClampedArray]",Lr="[object Uint16Array]",fr="[object Uint32Array]",Fr={};Fr[Ve]=Fr[Ot]=Fr[Qi]=Fr[ur]=Fr[pr]=Fr[qt]=Fr[ge]=Fr[Pe]=Fr[Ge]=Fr[Re]=Fr[Nt]=Fr[_e]=Fr[Et]=Fr[gt]=Fr[jt]=Fr[Ut]=Fr[zr]=Fr[dn]=Fr[ar]=Fr[yr]=Fr[Lr]=Fr[fr]=!0,Fr[W]=Fr[se]=Fr[_n]=!1;function C(G,Ze,tt,lt,Pt,q){var kt,Er=Ze&Tt,Mr=Ze&$e,Je=Ze&Mt;if(tt&&(kt=Pt?tt(G,lt,Pt,q):tt(G)),kt!==void 0)return kt;if(!ft(G))return G;var ct=Ht(G);if(ct){if(kt=$t(G),!Er)return $(G,kt)}else{var It=rt(G),Bt=It==se||It==ke;if(Ct(G))return Y(G,Er);if(It==gt||It==Ve||Bt&&!Pt){if(kt=Mr||Bt?{}:Lt(G),!Er)return Mr?Z(G,U(kt,G)):he(G,X(kt,G))}else{if(!Fr[It])return Pt?G:{};kt=zt(G,It,Er)}}q||(q=new z);var br=q.get(G);if(br)return br;q.set(G,kt),sr(G)?G.forEach(function(Gr){kt.add(C(Gr,Ze,tt,Gr,G,q))}):yt(G)&&G.forEach(function(Gr,Yr){kt.set(Yr,C(Gr,Ze,tt,Yr,G,q))});var Tr=Je?Mr?Le:Ie:Mr?nr:re,qe=ct?void 0:Tr(G);return b(qe||G,function(Gr,Yr){qe&&(Yr=Gr,Gr=G[Yr]),p(kt,Yr,C(Gr,Ze,tt,Yr,G,q))}),kt}Qe.exports=C},3118:function(Qe,O,y){var z=y(13218),b=Object.create,p=function(){function X(){}return function(U){if(!z(U))return{};if(b)return b(U);X.prototype=U;var Y=new X;return X.prototype=void 0,Y}}();Qe.exports=p},41848:function(Qe){function O(y,z,b,p){for(var X=y.length,U=b+(p?1:-1);p?U--:++U<X;)if(z(y[U],U,y))return U;return-1}Qe.exports=O},28483:function(Qe,O,y){var z=y(25063),b=z();Qe.exports=b},42118:function(Qe,O,y){var z=y(41848),b=y(62722),p=y(42351);function X(U,Y,$){return Y===Y?p(U,Y,$):z(U,b,$)}Qe.exports=X},25588:function(Qe,O,y){var z=y(64160),b=y(37005),p="[object Map]";function X(U){return b(U)&&z(U)==p}Qe.exports=X},62722:function(Qe){function O(y){return y!==y}Qe.exports=O},29221:function(Qe,O,y){var z=y(64160),b=y(37005),p="[object Set]";function X(U){return b(U)&&z(U)==p}Qe.exports=X},10313:function(Qe,O,y){var z=y(13218),b=y(25726),p=y(33498),X=Object.prototype,U=X.hasOwnProperty;function Y($){if(!z($))return p($);var he=b($),Z=[];for(var Ie in $)Ie=="constructor"&&(he||!U.call($,Ie))||Z.push(Ie);return Z}Qe.exports=Y},42980:function(Qe,O,y){var z=y(46384),b=y(86556),p=y(28483),X=y(59783),U=y(13218),Y=y(81704),$=y(36390);function he(Z,Ie,Le,rt,$t){Z!==Ie&&p(Ie,function(zt,Lt){if($t||($t=new z),U(zt))X(Z,Ie,Lt,Le,he,rt,$t);else{var Ht=rt?rt($(Z,Lt),zt,Lt+"",Z,Ie,$t):void 0;Ht===void 0&&(Ht=zt),b(Z,Lt,Ht)}},Y)}Qe.exports=he},59783:function(Qe,O,y){var z=y(86556),b=y(64626),p=y(77133),X=y(278),U=y(38517),Y=y(35694),$=y(1469),he=y(29246),Z=y(44144),Ie=y(23560),Le=y(13218),rt=y(68630),$t=y(36719),zt=y(36390),Lt=y(59881);function Ht(Ct,yt,ft,sr,re,nr,Tt){var $e=zt(Ct,ft),Mt=zt(yt,ft),Ve=Tt.get(Mt);if(Ve){z(Ct,ft,Ve);return}var Ot=nr?nr($e,Mt,ft+"",Ct,yt,Tt):void 0,pr=Ot===void 0;if(pr){var qt=$(Mt),W=!qt&&Z(Mt),se=!qt&&!W&&$t(Mt);Ot=Mt,qt||W||se?$($e)?Ot=$e:he($e)?Ot=X($e):W?(pr=!1,Ot=b(Mt,!0)):se?(pr=!1,Ot=p(Mt,!0)):Ot=[]:rt(Mt)||Y(Mt)?(Ot=$e,Y($e)?Ot=Lt($e):(!Le($e)||Ie($e))&&(Ot=U(Mt))):pr=!1}pr&&(Tt.set(Mt,Ot),re(Ot,Mt,sr,nr,Tt),Tt.delete(Mt)),z(Ct,ft,Ot)}Qe.exports=Ht},40371:function(Qe){function O(y){return function(z){return z==null?void 0:z[y]}}Qe.exports=O},18674:function(Qe){function O(y){return function(z){return y==null?void 0:y[z]}}Qe.exports=O},5976:function(Qe,O,y){var z=y(6557),b=y(45357),p=y(30061);function X(U,Y){return p(b(U,Y,z),U+"")}Qe.exports=X},56560:function(Qe,O,y){var z=y(75703),b=y(38777),p=y(6557),X=b?function(U,Y){return b(U,"toString",{configurable:!0,enumerable:!1,value:z(Y),writable:!0})}:p;Qe.exports=X},80531:function(Qe,O,y){var z=y(62705),b=y(29932),p=y(1469),X=y(33448),U=1/0,Y=z?z.prototype:void 0,$=Y?Y.toString:void 0;function he(Z){if(typeof Z=="string")return Z;if(p(Z))return b(Z,he)+"";if(X(Z))return $?$.call(Z):"";var Ie=Z+"";return Ie=="0"&&1/Z==-U?"-0":Ie}Qe.exports=he},45652:function(Qe,O,y){var z=y(88668),b=y(47443),p=y(1196),X=y(74757),U=y(23593),Y=y(21814),$=200;function he(Z,Ie,Le){var rt=-1,$t=b,zt=Z.length,Lt=!0,Ht=[],Ct=Ht;if(Le)Lt=!1,$t=p;else if(zt>=$){var yt=Ie?null:U(Z);if(yt)return Y(yt);Lt=!1,$t=X,Ct=new z}else Ct=Ie?[]:Ht;e:for(;++rt<zt;){var ft=Z[rt],sr=Ie?Ie(ft):ft;if(ft=Le||ft!==0?ft:0,Lt&&sr===sr){for(var re=Ct.length;re--;)if(Ct[re]===sr)continue e;Ie&&Ct.push(sr),Ht.push(ft)}else $t(Ct,sr,Le)||(Ct!==Ht&&Ct.push(sr),Ht.push(ft))}return Ht}Qe.exports=he},74318:function(Qe,O,y){var z=y(11149);function b(p){var X=new p.constructor(p.byteLength);return new z(X).set(new z(p)),X}Qe.exports=b},64626:function(Qe,O,y){Qe=y.nmd(Qe);var z=y(55639),b=O&&!O.nodeType&&O,p=b&&!0&&Qe&&!Qe.nodeType&&Qe,X=p&&p.exports===b,U=X?z.Buffer:void 0,Y=U?U.allocUnsafe:void 0;function $(he,Z){if(Z)return he.slice();var Ie=he.length,Le=Y?Y(Ie):new he.constructor(Ie);return he.copy(Le),Le}Qe.exports=$},57157:function(Qe,O,y){var z=y(74318);function b(p,X){var U=X?z(p.buffer):p.buffer;return new p.constructor(U,p.byteOffset,p.byteLength)}Qe.exports=b},93147:function(Qe){var O=/\w*$/;function y(z){var b=new z.constructor(z.source,O.exec(z));return b.lastIndex=z.lastIndex,b}Qe.exports=y},40419:function(Qe,O,y){var z=y(62705),b=z?z.prototype:void 0,p=b?b.valueOf:void 0;function X(U){return p?Object(p.call(U)):{}}Qe.exports=X},77133:function(Qe,O,y){var z=y(74318);function b(p,X){var U=X?z(p.buffer):p.buffer;return new p.constructor(U,p.byteOffset,p.length)}Qe.exports=b},278:function(Qe){function O(y,z){var b=-1,p=y.length;for(z||(z=Array(p));++b<p;)z[b]=y[b];return z}Qe.exports=O},98363:function(Qe,O,y){var z=y(34865),b=y(89465);function p(X,U,Y,$){var he=!Y;Y||(Y={});for(var Z=-1,Ie=U.length;++Z<Ie;){var Le=U[Z],rt=$?$(Y[Le],X[Le],Le,Y,X):void 0;rt===void 0&&(rt=X[Le]),he?b(Y,Le,rt):z(Y,Le,rt)}return Y}Qe.exports=p},18805:function(Qe,O,y){var z=y(98363),b=y(99551);function p(X,U){return z(X,b(X),U)}Qe.exports=p},1911:function(Qe,O,y){var z=y(98363),b=y(51442);function p(X,U){return z(X,b(X),U)}Qe.exports=p},21463:function(Qe,O,y){var z=y(5976),b=y(16612);function p(X){return z(function(U,Y){var $=-1,he=Y.length,Z=he>1?Y[he-1]:void 0,Ie=he>2?Y[2]:void 0;for(Z=X.length>3&&typeof Z=="function"?(he--,Z):void 0,Ie&&b(Y[0],Y[1],Ie)&&(Z=he<3?void 0:Z,he=1),U=Object(U);++$<he;){var Le=Y[$];Le&&X(U,Le,$,Z)}return U})}Qe.exports=p},25063:function(Qe){function O(y){return function(z,b,p){for(var X=-1,U=Object(z),Y=p(z),$=Y.length;$--;){var he=Y[y?$:++X];if(b(U[he],he,U)===!1)break}return z}}Qe.exports=O},98805:function(Qe,O,y){var z=y(40180),b=y(62689),p=y(83140),X=y(79833);function U(Y){return function($){$=X($);var he=b($)?p($):void 0,Z=he?he[0]:$.charAt(0),Ie=he?z(he,1).join(""):$.slice(1);return Z[Y]()+Ie}}Qe.exports=U},35393:function(Qe,O,y){var z=y(62663),b=y(53816),p=y(58748),X="['\u2019]",U=RegExp(X,"g");function Y($){return function(he){return z(p(b(he).replace(U,"")),$,"")}}Qe.exports=Y},23593:function(Qe,O,y){var z=y(58525),b=y(50308),p=y(21814),X=1/0,U=z&&1/p(new z([,-0]))[1]==X?function(Y){return new z(Y)}:b;Qe.exports=U},69389:function(Qe,O,y){var z=y(18674),b={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=z(b);Qe.exports=p},38777:function(Qe,O,y){var z=y(10852),b=function(){try{var p=z(Object,"defineProperty");return p({},"",{}),p}catch(X){}}();Qe.exports=b},46904:function(Qe,O,y){var z=y(68866),b=y(51442),p=y(81704);function X(U){return z(U,p,b)}Qe.exports=X},85924:function(Qe,O,y){var z=y(5569),b=z(Object.getPrototypeOf,Object);Qe.exports=b},51442:function(Qe,O,y){var z=y(62488),b=y(85924),p=y(99551),X=y(70479),U=Object.getOwnPropertySymbols,Y=U?function($){for(var he=[];$;)z(he,p($)),$=b($);return he}:X;Qe.exports=Y},93157:function(Qe){var O=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function y(z){return O.test(z)}Qe.exports=y},43824:function(Qe){var O=Object.prototype,y=O.hasOwnProperty;function z(b){var p=b.length,X=new b.constructor(p);return p&&typeof b[0]=="string"&&y.call(b,"index")&&(X.index=b.index,X.input=b.input),X}Qe.exports=z},29148:function(Qe,O,y){var z=y(74318),b=y(57157),p=y(93147),X=y(40419),U=y(77133),Y="[object Boolean]",$="[object Date]",he="[object Map]",Z="[object Number]",Ie="[object RegExp]",Le="[object Set]",rt="[object String]",$t="[object Symbol]",zt="[object ArrayBuffer]",Lt="[object DataView]",Ht="[object Float32Array]",Ct="[object Float64Array]",yt="[object Int8Array]",ft="[object Int16Array]",sr="[object Int32Array]",re="[object Uint8Array]",nr="[object Uint8ClampedArray]",Tt="[object Uint16Array]",$e="[object Uint32Array]";function Mt(Ve,Ot,pr){var qt=Ve.constructor;switch(Ot){case zt:return z(Ve);case Y:case $:return new qt(+Ve);case Lt:return b(Ve,pr);case Ht:case Ct:case yt:case ft:case sr:case re:case nr:case Tt:case $e:return U(Ve,pr);case he:return new qt;case Z:case rt:return new qt(Ve);case Ie:return p(Ve);case Le:return new qt;case $t:return X(Ve)}}Qe.exports=Mt},38517:function(Qe,O,y){var z=y(3118),b=y(85924),p=y(25726);function X(U){return typeof U.constructor=="function"&&!p(U)?z(b(U)):{}}Qe.exports=X},16612:function(Qe,O,y){var z=y(77813),b=y(98612),p=y(65776),X=y(13218);function U(Y,$,he){if(!X(he))return!1;var Z=typeof $;return(Z=="number"?b(he)&&p($,he.length):Z=="string"&&$ in he)?z(he[$],Y):!1}Qe.exports=U},33498:function(Qe){function O(y){var z=[];if(y!=null)for(var b in Object(y))z.push(b);return z}Qe.exports=O},45357:function(Qe,O,y){var z=y(58380),b=Math.max;function p(X,U,Y){return U=b(U===void 0?X.length-1:U,0),function(){for(var $=arguments,he=-1,Z=b($.length-U,0),Ie=Array(Z);++he<Z;)Ie[he]=$[U+he];he=-1;for(var Le=Array(U+1);++he<U;)Le[he]=$[he];return Le[U]=Y(Ie),z(X,this,Le)}}Qe.exports=p},36390:function(Qe){function O(y,z){if(!(z==="constructor"&&typeof y[z]=="function")&&z!="__proto__")return y[z]}Qe.exports=O},30061:function(Qe,O,y){var z=y(56560),b=y(21275),p=b(z);Qe.exports=p},21275:function(Qe){var O=800,y=16,z=Date.now;function b(p){var X=0,U=0;return function(){var Y=z(),$=y-(Y-U);if(U=Y,$>0){if(++X>=O)return arguments[0]}else X=0;return p.apply(void 0,arguments)}}Qe.exports=b},42351:function(Qe){function O(y,z,b){for(var p=b-1,X=y.length;++p<X;)if(y[p]===z)return p;return-1}Qe.exports=O},2757:function(Qe){var O="\\ud800-\\udfff",y="\\u0300-\\u036f",z="\\ufe20-\\ufe2f",b="\\u20d0-\\u20ff",p=y+z+b,X="\\u2700-\\u27bf",U="a-z\\xdf-\\xf6\\xf8-\\xff",Y="\\xac\\xb1\\xd7\\xf7",$="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",he="\\u2000-\\u206f",Z=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ie="A-Z\\xc0-\\xd6\\xd8-\\xde",Le="\\ufe0e\\ufe0f",rt=Y+$+he+Z,$t="['\u2019]",zt="["+rt+"]",Lt="["+p+"]",Ht="\\d+",Ct="["+X+"]",yt="["+U+"]",ft="[^"+O+rt+Ht+X+U+Ie+"]",sr="\\ud83c[\\udffb-\\udfff]",re="(?:"+Lt+"|"+sr+")",nr="[^"+O+"]",Tt="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",Mt="["+Ie+"]",Ve="\\u200d",Ot="(?:"+yt+"|"+ft+")",pr="(?:"+Mt+"|"+ft+")",qt="(?:"+$t+"(?:d|ll|m|re|s|t|ve))?",W="(?:"+$t+"(?:D|LL|M|RE|S|T|VE))?",se=re+"?",ke="["+Le+"]?",_e="(?:"+Ve+"(?:"+[nr,Tt,$e].join("|")+")"+ke+se+")*",Et="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",jt=ke+se+_e,Ut="(?:"+[Ct,Tt,$e].join("|")+")"+jt,zr=RegExp([Mt+"?"+yt+"+"+qt+"(?="+[zt,Mt,"$"].join("|")+")",pr+"+"+W+"(?="+[zt,Mt+Ot,"$"].join("|")+")",Mt+"?"+Ot+"+"+qt,Mt+"+"+W,gt,Et,Ht,Ut].join("|"),"g");function dn(_n){return _n.match(zr)||[]}Qe.exports=dn},68929:function(Qe,O,y){var z=y(48403),b=y(35393),p=b(function(X,U,Y){return U=U.toLowerCase(),X+(Y?z(U):U)});Qe.exports=p},48403:function(Qe,O,y){var z=y(79833),b=y(11700);function p(X){return b(z(X).toLowerCase())}Qe.exports=p},74691:function(Qe,O,y){var z=y(29750),b=y(14841);function p(X,U,Y){return Y===void 0&&(Y=U,U=void 0),Y!==void 0&&(Y=b(Y),Y=Y===Y?Y:0),U!==void 0&&(U=b(U),U=U===U?U:0),z(b(X),U,Y)}Qe.exports=p},50361:function(Qe,O,y){var z=y(85990),b=1,p=4;function X(U){return z(U,b|p)}Qe.exports=X},75703:function(Qe){function O(y){return function(){return y}}Qe.exports=O},53816:function(Qe,O,y){var z=y(69389),b=y(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,X="\\u0300-\\u036f",U="\\ufe20-\\ufe2f",Y="\\u20d0-\\u20ff",$=X+U+Y,he="["+$+"]",Z=RegExp(he,"g");function Ie(Le){return Le=b(Le),Le&&Le.replace(p,z).replace(Z,"")}Qe.exports=Ie},6557:function(Qe){function O(y){return y}Qe.exports=O},29246:function(Qe,O,y){var z=y(98612),b=y(37005);function p(X){return b(X)&&z(X)}Qe.exports=p},56688:function(Qe,O,y){var z=y(25588),b=y(7518),p=y(31167),X=p&&p.isMap,U=X?b(X):z;Qe.exports=U},14293:function(Qe){function O(y){return y==null}Qe.exports=O},81763:function(Qe,O,y){var z=y(44239),b=y(37005),p="[object Number]";function X(U){return typeof U=="number"||b(U)&&z(U)==p}Qe.exports=X},68630:function(Qe,O,y){var z=y(44239),b=y(85924),p=y(37005),X="[object Object]",U=Function.prototype,Y=Object.prototype,$=U.toString,he=Y.hasOwnProperty,Z=$.call(Object);function Ie(Le){if(!p(Le)||z(Le)!=X)return!1;var rt=b(Le);if(rt===null)return!0;var $t=he.call(rt,"constructor")&&rt.constructor;return typeof $t=="function"&&$t instanceof $t&&$.call($t)==Z}Qe.exports=Ie},72928:function(Qe,O,y){var z=y(29221),b=y(7518),p=y(31167),X=p&&p.isSet,U=X?b(X):z;Qe.exports=U},47037:function(Qe,O,y){var z=y(44239),b=y(1469),p=y(37005),X="[object String]";function U(Y){return typeof Y=="string"||!b(Y)&&p(Y)&&z(Y)==X}Qe.exports=U},81704:function(Qe,O,y){var z=y(14636),b=y(10313),p=y(98612);function X(U){return p(U)?z(U,!0):b(U)}Qe.exports=X},82492:function(Qe,O,y){var z=y(42980),b=y(21463),p=b(function(X,U,Y){z(X,U,Y)});Qe.exports=p},30236:function(Qe,O,y){var z=y(42980),b=y(21463),p=b(function(X,U,Y,$){z(X,U,Y,$)});Qe.exports=p},50308:function(Qe){function O(){}Qe.exports=O},59881:function(Qe,O,y){var z=y(98363),b=y(81704);function p(X){return z(X,b(X))}Qe.exports=p},79833:function(Qe,O,y){var z=y(80531);function b(p){return p==null?"":z(p)}Qe.exports=b},44908:function(Qe,O,y){var z=y(45652);function b(p){return p&&p.length?z(p):[]}Qe.exports=b},11700:function(Qe,O,y){var z=y(98805),b=z("toUpperCase");Qe.exports=b},58748:function(Qe,O,y){var z=y(49029),b=y(93157),p=y(79833),X=y(2757);function U(Y,$,he){return Y=p(Y),$=he?void 0:$,$===void 0?b(Y)?X(Y):z(Y):Y.match($)||[]}Qe.exports=U},6158:function(Qe){(function(O,y){Qe.exports=y()})(this,function(){"use strict";var O,y,z;function b(p,X){if(!O)O=X;else if(!y)y=X;else{var U="var sharedChunk = {}; ("+O+")(sharedChunk); ("+y+")(sharedChunk);",Y={};O(Y),z=X(Y),typeof window!="undefined"&&(z.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}return b(["exports"],function(p){"use strict";function X(e,t){return e(t={exports:{}},t.exports),t.exports}var U=Y;function Y(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}Y.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Y.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Y.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Y.prototype.solveCurveX=function(e,t){var r,f,v,g,S;for(t===void 0&&(t=1e-6),v=e,S=0;S<8;S++){if(g=this.sampleCurveX(v)-e,Math.abs(g)<t)return v;var P=this.sampleCurveDerivativeX(v);if(Math.abs(P)<1e-6)break;v-=g/P}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(g=this.sampleCurveX(v),Math.abs(g-e)<t)return v;e>g?r=v:f=v,v=.5*(f-r)+r}return v},Y.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var $=he;function he(e,t){this.x=e,this.y=t}he.prototype={clone:function(){return new he(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},he.convert=function(e){return e instanceof he?e:Array.isArray(e)?new he(e[0],e[1]):e};var Z=typeof self!="undefined"?self:{},Ie=Math.pow(2,53)-1;function Le(e,t,r,f){var v=new U(e,t,r,f);return function(g){return v.solve(g)}}var rt=Le(.25,.1,.25,1);function $t(e,t,r){return Math.min(r,Math.max(t,e))}function zt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Lt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var S in g)e[S]=g[S]}return e}var Ht=1;function Ct(){return Ht++}function yt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function ft(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function sr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function re(e,t){return e.indexOf(t,e.length-t.length)!==-1}function nr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function Tt(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function $e(e){return Array.isArray(e)?e.map($e):typeof e=="object"&&e?nr(e,$e):e}var Mt={};function Ve(e){Mt[e]||(typeof console!="undefined"&&console.warn(e),Mt[e]=!0)}function Ot(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function pr(e){for(var t=0,r=0,f=e.length,v=f-1,g=void 0,S=void 0;r<f;v=r++)t+=((S=e[v]).x-(g=e[r]).x)*(g.y+S.y);return t}function qt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function W(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,g,S){var P=g||S;return t[v]=!P||P.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var se=null;function ke(e){if(se==null){var t=e.navigator?e.navigator.userAgent:null;se=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return se}function _e(e){try{var t=Z[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var Et,gt,jt,Ut,zr=Z.performance&&Z.performance.now?Z.performance.now.bind(Z.performance):Date.now.bind(Date),dn=Z.requestAnimationFrame||Z.mozRequestAnimationFrame||Z.webkitRequestAnimationFrame||Z.msRequestAnimationFrame,_n=Z.cancelAnimationFrame||Z.mozCancelAnimationFrame||Z.webkitCancelAnimationFrame||Z.msCancelAnimationFrame,Qi={now:zr,frame:function(e){var t=dn(e);return{cancel:function(){return _n(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=Z.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return Et||(Et=Z.document.createElement("a")),Et.href=e,Et.href},hardwareConcurrency:Z.navigator&&Z.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Z.devicePixelRatio},get prefersReducedMotion(){return!!Z.matchMedia&&(gt==null&&(gt=Z.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},ur={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ge={supported:!1,testSupport:function(e){!Pe&&Ut&&(Ge?Re(e):jt=e)}},Pe=!1,Ge=!1;function Re(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ut),e.isContextLost())return;ge.supported=!0}catch(r){}e.deleteTexture(t),Pe=!0}Z.document&&((Ut=Z.document.createElement("img")).onload=function(){jt&&Re(jt),jt=null,Ge=!0},Ut.onerror=function(){Pe=!0,jt=null},Ut.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Nt="01",ar=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function yr(e){return e.indexOf("mapbox:")===0}ar.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Nt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},ar.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ar.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},ar.prototype.normalizeStyleURL=function(e,t){if(!yr(e))return e;var r=C(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},ar.prototype.normalizeGlyphsURL=function(e,t){if(!yr(e))return e;var r=C(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},ar.prototype.normalizeSourceURL=function(e,t){if(!yr(e))return e;var r=C(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},ar.prototype.normalizeSpriteURL=function(e,t,r,f){var v=C(e);return yr(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,G(v))},ar.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!yr(e))return e;var r=C(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Qi.devicePixelRatio>=2||t===512?"@2x":"")+(ge.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var g=0,S=v;g<S.length;g+=1){var P=S[g].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(r.params)||ur.ACCESS_TOKEN;return ur.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},ar.prototype.canonicalizeTileURL=function(e,t){var r=C(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(g){return!g.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},ar.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&yr(t),f=[],v=0,g=e.tiles||[];v<g.length;v+=1){var S=g[v];fr(S)?f.push(this.canonicalizeTileURL(S,r)):f.push(S)}return f},ar.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=C(ur.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!ur.REQUIRE_ACCESS_TOKEN)return G(e);if(!(t=t||ur.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(g){return g.indexOf("access_token")===-1}),e.params.push("access_token="+t),G(e)};var Lr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function fr(e){return Lr.test(e)}var Fr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(e){var t=e.match(Fr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function G(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ze(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(Z.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var tt=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};tt.prototype.getStorageKey=function(e){var t,r=Ze(ur.ACCESS_TOKEN);return t=r&&r.u?Z.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):ur.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},tt.prototype.fetchEventData=function(){var e=_e("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=Z.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=Z.localStorage.getItem(r);v&&(this.anonId=v)}catch(g){Ve("Unable to read from LocalStorage")}},tt.prototype.saveEventData=function(){var e=_e("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{Z.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&Z.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Ve("Unable to write to LocalStorage")}},tt.prototype.processRequests=function(e){},tt.prototype.postEvent=function(e,t,r,f){var v=this;if(ur.EVENTS_URL){var g=C(ur.EVENTS_URL);g.params.push("access_token="+(f||ur.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Nt,userId:this.anonId},P=t?Lt(S,t):S,F={url:G(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Ur(F,function(H){v.pendingRequest=null,r(H),v.saveEventData(),v.processRequests(f)})}},tt.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var lt,Pt,q=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,g){this.skuToken=v,(ur.EVENTS_URL&&g||ur.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(S){return yr(S)||fr(S)}))&&this.queueRequest({id:f,timestamp:Date.now()},g)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),g=v.id,S=v.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),ft(this.anonId)||(this.anonId=yt()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||g&&(f.success[g]=!0)},r))}},t}(tt),kt=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){ur.EVENTS_URL&&ur.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return yr(v)||fr(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ze(ur.ACCESS_TOKEN),g=v?v.u:ur.ACCESS_TOKEN,S=g!==this.eventData.tokenU;ft(this.anonId)||(this.anonId=yt(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),H=new Date(P),Q=(P-this.eventData.lastSuccess)/864e5;S=S||Q>=1||Q<-1||F.getDate()!==H.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(oe){oe||(f.eventData.lastSuccess=P,f.eventData.tokenU=g)},r)}},t}(tt)),Er=kt.postTurnstileEvent.bind(kt),Mr=new q,Je=Mr.postMapLoadEvent.bind(Mr),ct=500,It=50;function Bt(){Z.caches&&!lt&&(lt=Z.caches.open("mapbox-tiles"))}function br(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Tr,qe=1/0;function Gr(){return Tr==null&&(Tr=Z.OffscreenCanvas&&new Z.OffscreenCanvas(1,1).getContext("2d")&&typeof Z.createImageBitmap=="function"),Tr}var Yr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Yr);var An=function(e){function t(r,f,v){f===401&&fr(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),vr=qt()?function(){return self.worker&&self.worker.referrer}:function(){return(Z.location.protocol==="blob:"?Z.parent:Z).location.href},Or,St,Kn=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(vr())&&!/^\w+:/.test(r))){if(Z.fetch&&Z.Request&&Z.AbortController&&Z.Request.prototype.hasOwnProperty("signal"))return function(f,v){var g,S=new Z.AbortController,P=new Z.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:vr(),signal:S.signal}),F=!1,H=!1,Q=(g=P.url).indexOf("sku=")>0&&fr(g);f.type==="json"&&P.headers.set("Accept","application/json");var oe=function(Se,We,Ke){if(!H){if(Se&&Se.message!=="SecurityError"&&Ve(Se),We&&Ke)return ve(We);var bt=Date.now();Z.fetch(P).then(function(it){if(it.ok){var Dt=Q?it.clone():null;return ve(it,Dt,bt)}return v(new An(it.statusText,it.status,f.url))}).catch(function(it){it.code!==20&&v(new Error(it.message))})}},ve=function(Se,We,Ke){(f.type==="arrayBuffer"?Se.arrayBuffer():f.type==="json"?Se.json():Se.text()).then(function(bt){H||(We&&Ke&&function(it,Dt,Qt){if(Bt(),lt){var mr={status:Dt.status,statusText:Dt.statusText,headers:new Z.Headers};Dt.headers.forEach(function(Nr,un){return mr.headers.set(un,Nr)});var xr=W(Dt.headers.get("Cache-Control")||"");xr["no-store"]||(xr["max-age"]&&mr.headers.set("Expires",new Date(Qt+1e3*xr["max-age"]).toUTCString()),new Date(mr.headers.get("Expires")).getTime()-Qt<42e4||function(Nr,un){if(Pt===void 0)try{new Response(new ReadableStream),Pt=!0}catch(Cn){Pt=!1}Pt?un(Nr.body):Nr.blob().then(un)}(Dt,function(Nr){var un=new Z.Response(Nr,mr);Bt(),lt&&lt.then(function(Cn){return Cn.put(br(it.url),un)}).catch(function(Cn){return Ve(Cn.message)})}))}}(P,We,Ke),F=!0,v(null,bt,Se.headers.get("Cache-Control"),Se.headers.get("Expires")))}).catch(function(bt){H||v(new Error(bt.message))})};return Q?function(Se,We){if(Bt(),!lt)return We(null);var Ke=br(Se.url);lt.then(function(bt){bt.match(Ke).then(function(it){var Dt=function(Qt){if(!Qt)return!1;var mr=new Date(Qt.headers.get("Expires")||0),xr=W(Qt.headers.get("Cache-Control")||"");return mr>Date.now()&&!xr["no-cache"]}(it);bt.delete(Ke),Dt&&bt.put(Ke,it.clone()),We(null,it,Dt)}).catch(We)}).catch(We)}(P,oe):oe(null,null),{cancel:function(){H=!0,F||S.abort()}}}(e,t);if(qt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var g=new Z.XMLHttpRequest;for(var S in g.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(g.responseType="arraybuffer"),f.headers)g.setRequestHeader(S,f.headers[S]);return f.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=f.credentials==="include",g.onerror=function(){v(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var P=g.response;if(f.type==="json")try{P=JSON.parse(g.response)}catch(F){return v(F)}v(null,P,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else v(new An(g.statusText,g.status,f.url))},g.send(f.body),{cancel:function(){return g.abort()}}}(e,t)},Ln=function(e,t){return Kn(Lt(e,{type:"arrayBuffer"}),t)},Ur=function(e,t){return Kn(Lt(e,{method:"POST"}),t)},ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Or=[],St=0;var fe=function(e,t){if(ge.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),St>=ur.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Or.push(r),r}St++;var f=!1,v=function(){if(!f)for(f=!0,St--;Or.length&&St<ur.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Or.shift();S.cancelled||(S.cancel=fe(S.requestParameters,S.callback).cancel)}},g=Ln(e,function(S,P,F,H){v(),S?t(S):P&&(Gr()?function(Q,oe){var ve=new Z.Blob([new Uint8Array(Q)],{type:"image/png"});Z.createImageBitmap(ve).then(function(Se){oe(null,Se)}).catch(function(Se){oe(new Error("Could not load image because of "+Se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,t):function(Q,oe,ve,Se){var We=new Z.Image,Ke=Z.URL;We.onload=function(){oe(null,We),Ke.revokeObjectURL(We.src),We.onload=null,Z.requestAnimationFrame(function(){We.src=ee})},We.onerror=function(){return oe(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var bt=new Z.Blob([new Uint8Array(Q)],{type:"image/png"});We.cacheControl=ve,We.expires=Se,We.src=Q.byteLength?Ke.createObjectURL(bt):ee}(P,t,F,H))});return{cancel:function(){g.cancel(),v()}}};function me(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function N(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var ae=function(e,t){t===void 0&&(t={}),Lt(this,t),this.type=e},de=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Lt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ae),Te=function(){};Te.prototype.on=function(e,t){return this._listeners=this._listeners||{},me(e,t,this._listeners),this},Te.prototype.off=function(e,t){return N(e,t,this._listeners),N(e,t,this._oneTimeListeners),this},Te.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},me(e,t,this._oneTimeListeners),this},Te.prototype.fire=function(e,t){typeof e=="string"&&(e=new ae(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var g=0,S=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];g<S.length;g+=1){var P=S[g];N(r,P,this._oneTimeListeners),P.call(this,e)}var F=this._eventedParent;F&&(Lt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(e))}else e instanceof de&&console.error(e.error);return this},Te.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Te.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},xe=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function pt(e){var t=e.value;return t?[new xe(e.key,t,"constants have been deprecated as of v8")]:[]}function Cr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var S in g)e[S]=g[S]}return e}function Kt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function rr(e){if(Array.isArray(e))return e.map(rr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=rr(e[r]);return t}return Kt(e)}var Zr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Nn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Nn.prototype.concat=function(e){return new Nn(this,e)},Nn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Nn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Bn={kind:"null"},tr={kind:"number"},In={kind:"string"},hn={kind:"boolean"},yn={kind:"color"},Ni={kind:"object"},Tn={kind:"value"},Di={kind:"collator"},ra={kind:"formatted"},hi={kind:"resolvedImage"};function na(e,t){return{kind:"array",itemType:e,N:t}}function Xi(e){if(e.kind==="array"){var t=Xi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Ii=[Bn,tr,In,hn,yn,ra,Ni,na(Tn),hi];function ma(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ma(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Ii;r<f.length;r+=1)if(!ma(f[r],t))return null}}return"Expected "+Xi(e)+" but found "+Xi(t)+" instead."}function Da(e,t){return t.some(function(r){return r.kind===e.kind})}function Yi(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var zi=X(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(P){return(P=Math.round(P))<0?0:P>255?255:P}function v(P){return f(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function g(P){return(F=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:F>1?1:F;var F}function S(P,F,H){return H<0?H+=1:H>1&&(H-=1),6*H<1?P+(F-P)*H*6:2*H<1?F:3*H<2?P+(F-P)*(2/3-H)*6:P}try{t.parseCSSColor=function(P){var F,H=P.replace(/ /g,"").toLowerCase();if(H in r)return r[H].slice();if(H[0]==="#")return H.length===4?(F=parseInt(H.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:H.length===7&&(F=parseInt(H.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var Q=H.indexOf("("),oe=H.indexOf(")");if(Q!==-1&&oe+1===H.length){var ve=H.substr(0,Q),Se=H.substr(Q+1,oe-(Q+1)).split(","),We=1;switch(ve){case"rgba":if(Se.length!==4)return null;We=g(Se.pop());case"rgb":return Se.length!==3?null:[v(Se[0]),v(Se[1]),v(Se[2]),We];case"hsla":if(Se.length!==4)return null;We=g(Se.pop());case"hsl":if(Se.length!==3)return null;var Ke=(parseFloat(Se[0])%360+360)%360/360,bt=g(Se[1]),it=g(Se[2]),Dt=it<=.5?it*(bt+1):it+bt-it*bt,Qt=2*it-Dt;return[f(255*S(Qt,Dt,Ke+1/3)),f(255*S(Qt,Dt,Ke)),f(255*S(Qt,Dt,Ke-1/3)),We];default:return null}}return null}}catch(P){}}).parseCSSColor,Ki=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Ki.parse=function(e){if(e){if(e instanceof Ki)return e;if(typeof e=="string"){var t=zi(e);if(t)return new Ki(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Ki.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Ki.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Ki.black=new Ki(0,0,0,1),Ki.white=new Ki(1,1,1,1),Ki.transparent=new Ki(0,0,0,0),Ki.red=new Ki(1,0,0,1);var to=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};to.prototype.compare=function(e,t){return this.collator.compare(e,t)},to.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var $o=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},Ba=function(e){this.sections=e};Ba.fromString=function(e){return new Ba([new $o(e,null,null,null,null)])},Ba.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},Ba.factory=function(e){return e instanceof Ba?e:Ba.fromString(e)},Ba.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},Ba.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var qi=function(e){this.name=e.name,this.available=e.available};function su(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Au(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Ki||e instanceof to||e instanceof Ba||e instanceof qi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Au(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Au(e[f]))return!1;return!0}return!1}function $i(e){if(e===null)return Bn;if(typeof e=="string")return In;if(typeof e=="boolean")return hn;if(typeof e=="number")return tr;if(e instanceof Ki)return yn;if(e instanceof to)return Di;if(e instanceof Ba)return ra;if(e instanceof qi)return hi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var g=$i(v[f]);if(t){if(t===g)continue;t=Tn;break}t=g}return na(t||Tn,r)}return Ni}function yo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Ki||e instanceof Ba||e instanceof qi?e.toString():JSON.stringify(e)}qi.prototype.toString=function(){return this.name},qi.fromString=function(e){return e?new qi({name:e,available:!1}):null},qi.prototype.serialize=function(){return["image",this.name]};var Ji=function(e,t){this.type=e,this.value=t};Ji.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Au(e[1]))return t.error("invalid value");var r=e[1],f=$i(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Ji(f,r)},Ji.prototype.evaluate=function(){return this.value},Ji.prototype.eachChild=function(){},Ji.prototype.outputDefined=function(){return!0},Ji.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ki?["rgba"].concat(this.value.toArray()):this.value instanceof Ba?this.value.serialize():this.value};var Wa=function(e){this.name="ExpressionEvaluationError",this.message=e};Wa.prototype.toJSON=function(){return this.message};var Jo={string:In,number:tr,boolean:hn,object:Ni},ba=function(e,t){this.type=e,this.args=t};ba.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var g,S;if(e.length>2){var P=e[1];if(typeof P!="string"||!(P in Jo)||P==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);g=Jo[P],f++}else g=Tn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}r=na(g,S)}else r=Jo[v];for(var F=[];f<e.length;f++){var H=t.parse(e[f],f,Tn);if(!H)return null;F.push(H)}return new ba(r,F)},ba.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ma(this.type,$i(r)))return r;if(t===this.args.length-1)throw new Wa("Expected value to be of type "+Xi(this.type)+", but found "+Xi($i(r))+" instead.")}return null},ba.prototype.eachChild=function(e){this.args.forEach(e)},ba.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ba.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Lo=function(e){this.type=ra,this.sections=e};Lo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,g=1;g<=e.length-1;++g){var S=e[g];if(v&&typeof S=="object"&&!Array.isArray(S)){v=!1;var P=null;if(S["font-scale"]&&!(P=t.parse(S["font-scale"],1,tr)))return null;var F=null;if(S["text-font"]&&!(F=t.parse(S["text-font"],1,na(In))))return null;var H=null;if(S["text-color"]&&!(H=t.parse(S["text-color"],1,yn)))return null;var Q=f[f.length-1];Q.scale=P,Q.font=F,Q.textColor=H}else{var oe=t.parse(e[g],1,Tn);if(!oe)return null;var ve=oe.type.kind;if(ve!=="string"&&ve!=="value"&&ve!=="null"&&ve!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:oe,scale:null,font:null,textColor:null})}}return new Lo(f)},Lo.prototype.evaluate=function(e){return new Ba(this.sections.map(function(t){var r=t.content.evaluate(e);return $i(r)===hi?new $o("",r,null,null,null):new $o(yo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Lo.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Ro=function(e){this.type=hi,this.input=e};Ro.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,In);return r?new Ro(r):t.error("No image name provided.")},Ro.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=qi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Ro.prototype.eachChild=function(e){e(this.input)},Ro.prototype.outputDefined=function(){return!1},Ro.prototype.serialize=function(){return["image",this.input.serialize()]};var Rs={"to-boolean":hn,"to-color":yn,"to-number":tr,"to-string":In},ho=function(e,t){this.type=e,this.args=t};ho.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=Rs[r],v=[],g=1;g<e.length;g++){var S=t.parse(e[g],g,Tn);if(!S)return null;v.push(S)}return new ho(f,v)},ho.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Ki)return t;if(typeof t=="string"){var g=e.parseColor(t);if(g)return g}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":su(t[0],t[1],t[2],t[3])))return new Ki(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Wa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,F=this.args;P<F.length;P+=1){if((S=F[P].evaluate(e))===null)return 0;var H=Number(S);if(!isNaN(H))return H}throw new Wa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Ba.fromString(yo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qi.fromString(yo(this.args[0].evaluate(e))):yo(this.args[0].evaluate(e))},ho.prototype.eachChild=function(e){this.args.forEach(e)},ho.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ho.prototype.serialize=function(){if(this.type.kind==="formatted")return new Lo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ro(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Vo=["Unknown","Point","LineString","Polygon"],ka=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ka.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ka.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Vo[this.feature.type]:this.feature.type:null},ka.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ka.prototype.canonicalID=function(){return this.canonical},ka.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ka.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ki.parse(e)),t};var so=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};so.prototype.evaluate=function(e){return this._evaluate(e,this.args)},so.prototype.eachChild=function(e){this.args.forEach(e)},so.prototype.outputDefined=function(){return!1},so.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},so.parse=function(e,t){var r,f=e[0],v=so.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(v)?v[0]:v.type,S=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=S.filter(function(ci){var $n=ci[0];return!Array.isArray($n)||$n.length===e.length-1}),F=null,H=0,Q=P;H<Q.length;H+=1){var oe=Q[H],ve=oe[0],Se=oe[1];F=new zs(t.registry,t.path,null,t.scope);for(var We=[],Ke=!1,bt=1;bt<e.length;bt++){var it=e[bt],Dt=Array.isArray(ve)?ve[bt-1]:ve.type,Qt=F.parse(it,1+We.length,Dt);if(!Qt){Ke=!0;break}We.push(Qt)}if(!Ke)if(Array.isArray(ve)&&ve.length!==We.length)F.error("Expected "+ve.length+" arguments, but found "+We.length+" instead.");else{for(var mr=0;mr<We.length;mr++){var xr=Array.isArray(ve)?ve[mr]:ve.type,Nr=We[mr];F.concat(mr+1).checkSubtype(xr,Nr.type)}if(F.errors.length===0)return new so(f,g,Se,We)}}if(P.length===1)(r=t.errors).push.apply(r,F.errors);else{for(var un=(P.length?P:S).map(function(ci){var $n;return $n=ci[0],Array.isArray($n)?"("+$n.map(Xi).join(", ")+")":"("+Xi($n.type)+"...)"}).join(" | "),Cn=[],ti=1;ti<e.length;ti++){var Zn=t.parse(e[ti],1+Cn.length);if(!Zn)return null;Cn.push(Xi(Zn.type))}t.error("Expected arguments of type "+un+", but found ("+Cn.join(", ")+") instead.")}return null},so.register=function(e,t){for(var r in so.definitions=t,t)e[r]=so};var as=function(e,t,r){this.type=Di,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Do(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ee(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Be(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function mt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function R(e,t){for(var r,f,v,g,S,P,F,H=!1,Q=0,oe=t.length;Q<oe;Q++)for(var ve=t[Q],Se=0,We=ve.length;Se<We-1;Se++){if((g=(r=e)[0]-(f=ve[Se])[0])*(F=r[1]-(v=ve[Se+1])[1])-(P=r[0]-v[0])*(S=r[1]-f[1])==0&&g*P<=0&&S*F<=0)return!1;mt(e,ve[Se],ve[Se+1])&&(H=!H)}return H}function qr(e,t){for(var r=0;r<t.length;r++)if(R(e,t[r]))return!0;return!1}function oi(e,t,r,f){var v=f[0]-r[0],g=f[1]-r[1],S=(e[0]-r[0])*g-v*(e[1]-r[1]),P=(t[0]-r[0])*g-v*(t[1]-r[1]);return S>0&&P<0||S<0&&P>0}function Ai(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var g=v[f],S=0;S<g.length-1;++S)if((oe=[(Q=g[S+1])[0]-(H=g[S])[0],Q[1]-H[1]])[0]*(ve=[(F=t)[0]-(P=e)[0],F[1]-P[1]])[1]-oe[1]*ve[0]!=0&&oi(P,F,H,Q)&&oi(H,Q,P,F))return!0;var P,F,H,Q,oe,ve;return!1}function uo(e,t){for(var r=0;r<e.length;++r)if(!R(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Ai(e[f],e[f+1],t))return!1;return!0}function Xa(e,t){for(var r=0;r<t.length;r++)if(uo(e,t[r]))return!0;return!1}function ja(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var g=[],S=0;S<e[v].length;S++){var P=Be(e[v][S],r);Do(t,P),g.push(P)}f.push(g)}return f}function os(e,t,r){for(var f=[],v=0;v<e.length;v++){var g=ja(e[v],t,r);f.push(g)}return f}function uu(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,g=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;g===0&&(g=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=g}Do(t,e)}function Tu(e,t,r,f){for(var v=8192*Math.pow(2,f.z),g=[8192*f.x,8192*f.y],S=[],P=0,F=e;P<F.length;P+=1)for(var H=0,Q=F[P];H<Q.length;H+=1){var oe=Q[H],ve=[oe.x+g[0],oe.y+g[1]];uu(ve,t,r,v),S.push(ve)}return S}function Ku(e,t,r,f){for(var v,g=8192*Math.pow(2,f.z),S=[8192*f.x,8192*f.y],P=[],F=0,H=e;F<H.length;F+=1){for(var Q=[],oe=0,ve=H[F];oe<ve.length;oe+=1){var Se=ve[oe],We=[Se.x+S[0],Se.y+S[1]];Do(t,We),Q.push(We)}P.push(Q)}if(t[2]-t[0]<=g/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Ke=0,bt=P;Ke<bt.length;Ke+=1)for(var it=0,Dt=bt[Ke];it<Dt.length;it+=1)uu(Dt[it],t,r,g)}return P}as.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,hn);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,hn);if(!v)return null;var g=null;return r.locale&&!(g=t.parse(r.locale,1,In))?null:new as(f,v,g)},as.prototype.evaluate=function(e){return new to(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},as.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},as.prototype.outputDefined=function(){return!1},as.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Qo=function(e,t){this.type=hn,this.geojson=e,this.geometries=t};function qo(e){if(e instanceof so&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Qo)return!1;var t=!0;return e.eachChild(function(r){t&&!qo(r)&&(t=!1)}),t}function ss(e){if(e instanceof so&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ss(r)&&(t=!1)}),t}function ws(e,t){if(e instanceof so&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!ws(f,t)&&(r=!1)}),r}Qo.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Au(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Qo(r,r.features[f].geometry)}else if(r.type==="Feature"){var g=r.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Qo(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Qo(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Qo.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var S=ja(r.coordinates,v,g),P=Tu(t.geometry(),f,v,g);if(!Ee(f,v))return!1;for(var F=0,H=P;F<H.length;F+=1)if(!R(H[F],S))return!1}if(r.type==="MultiPolygon"){var Q=os(r.coordinates,v,g),oe=Tu(t.geometry(),f,v,g);if(!Ee(f,v))return!1;for(var ve=0,Se=oe;ve<Se.length;ve+=1)if(!qr(Se[ve],Q))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var S=ja(r.coordinates,v,g),P=Ku(t.geometry(),f,v,g);if(!Ee(f,v))return!1;for(var F=0,H=P;F<H.length;F+=1)if(!uo(H[F],S))return!1}if(r.type==="MultiPolygon"){var Q=os(r.coordinates,v,g),oe=Ku(t.geometry(),f,v,g);if(!Ee(f,v))return!1;for(var ve=0,Se=oe;ve<Se.length;ve+=1)if(!Xa(Se[ve],Q))return!1}return!0}(e,this.geometries)}return!1},Qo.prototype.eachChild=function(){},Qo.prototype.outputDefined=function(){return!0},Qo.prototype.serialize=function(){return["within",this.geojson]};var us=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};us.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new us(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},us.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},us.prototype.eachChild=function(){},us.prototype.outputDefined=function(){return!1},us.prototype.serialize=function(){return["var",this.name]};var zs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Nn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(g){return"["+g+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Xs(e,t){for(var r,f=e.length-1,v=0,g=f,S=0;v<=g;)if((r=e[S=Math.floor((v+g)/2)])<=t){if(S===f||t<e[S+1])return S;v=S+1}else{if(!(r>t))throw new Wa("Input is not a number.");g=S-1}return 0}zs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},zs.prototype._parse=function(e,t){function r(H,Q,oe){return oe==="assert"?new ba(Q,[H]):oe==="coerce"?new ho(Q,[H]):H}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var g=v.parse(e,this);if(!g)return null;if(this.expectedType){var S=this.expectedType,P=g.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else g=r(g,S,t.typeAnnotation||"coerce");else g=r(g,S,t.typeAnnotation||"assert")}if(!(g instanceof Ji)&&g.type.kind!=="resolvedImage"&&function H(Q){if(Q instanceof us)return H(Q.boundExpression);if(Q instanceof so&&Q.name==="error"||Q instanceof as||Q instanceof Qo)return!1;var oe=Q instanceof ho||Q instanceof ba,ve=!0;return Q.eachChild(function(Se){ve=oe?ve&&H(Se):ve&&Se instanceof Ji}),!!ve&&qo(Q)&&ws(Q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var F=new ka;try{g=new Ji(g.type,g.evaluate(F))}catch(H){return this.error(H.message),null}}return g}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},zs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new zs(this.registry,f,t||null,v,this.errors)},zs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Zr(f,e))},zs.prototype.checkSubtype=function(e,t){var r=ma(e,t);return r&&this.error(r),r};var As=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var g=v[f],S=g[1];this.labels.push(g[0]),this.outputs.push(S)}};function Ca(e,t,r){return e*(1-r)+t*r}As.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,tr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var g=1;g<e.length;g+=2){var S=g===1?-1/0:e[g],P=e[g+1],F=g,H=g+1;if(typeof S!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(f.length&&f[f.length-1][0]>=S)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var Q=t.parse(P,H,v);if(!Q)return null;v=v||Q.type,f.push([S,Q])}return new As(v,r,f)},As.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Xs(t,f)].evaluate(e)},As.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},As.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},As.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Co=Object.freeze({__proto__:null,number:Ca,color:function(e,t,r){return new Ki(Ca(e.r,t.r,r),Ca(e.g,t.g,r),Ca(e.b,t.b,r),Ca(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Ca(f,t[v],r)})}}),vl=6/29*3*(6/29),ml=Math.PI/180,$u=180/Math.PI;function Jl(e){return e>.008856451679035631?Math.pow(e,1/3):e/vl+4/29}function gl(e){return e>6/29?e*e*e:vl*(e-4/29)}function Lu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Us(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function yl(e){var t=Us(e.r),r=Us(e.g),f=Us(e.b),v=Jl((.4124564*t+.3575761*r+.1804375*f)/.95047),g=Jl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*g-16,a:500*(v-g),b:200*(g-Jl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*gl(t),r=.95047*gl(r),f=1.08883*gl(f),new Ki(Lu(3.2404542*r-1.5371385*t-.4985314*f),Lu(-.969266*r+1.8760108*t+.041556*f),Lu(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function w(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var j={forward:yl,reverse:m,interpolate:function(e,t,r){return{l:Ca(e.l,t.l,r),a:Ca(e.a,t.a,r),b:Ca(e.b,t.b,r),alpha:Ca(e.alpha,t.alpha,r)}}},I={forward:function(e){var t=yl(e),r=t.l,f=t.a,v=t.b,g=Math.atan2(v,f)*$u;return{h:g<0?g+360:g,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*ml,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:w(e.h,t.h,r),c:Ca(e.c,t.c,r),l:Ca(e.l,t.l,r),alpha:Ca(e.alpha,t.alpha,r)}}},pe=Object.freeze({__proto__:null,lab:j,hcl:I}),De=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var g=0,S=v;g<S.length;g+=1){var P=S[g],F=P[1];this.labels.push(P[0]),this.outputs.push(F)}};function ht(e,t,r,f){var v=f-r,g=e-r;return v===0?0:t===1?g/v:(Math.pow(t,g)-1)/(Math.pow(t,v)-1)}De.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=ht(t,e.base,r,f);else if(e.name==="linear")v=ht(t,1,r,f);else if(e.name==="cubic-bezier"){var g=e.controlPoints;v=new U(g[0],g[1],g[2],g[3]).solve(ht(t,1,r,f))}return v},De.parse=function(e,t){var r=e[0],f=e[1],v=e[2],g=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var S=f[1];if(typeof S!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:S}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var P=f.slice(1);if(P.length!==4||P.some(function(bt){return typeof bt!="number"||bt<0||bt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,tr)))return null;var F=[],H=null;r==="interpolate-hcl"||r==="interpolate-lab"?H=yn:t.expectedType&&t.expectedType.kind!=="value"&&(H=t.expectedType);for(var Q=0;Q<g.length;Q+=2){var oe=g[Q],ve=g[Q+1],Se=Q+3,We=Q+4;if(typeof oe!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Se);if(F.length&&F[F.length-1][0]>=oe)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Se);var Ke=t.parse(ve,We,H);if(!Ke)return null;H=H||Ke.type,F.push([oe,Ke])}return H.kind==="number"||H.kind==="color"||H.kind==="array"&&H.itemType.kind==="number"&&typeof H.N=="number"?new De(H,r,f,v,F):t.error("Type "+Xi(H)+" is not interpolatable.")},De.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var g=Xs(t,f),S=De.interpolationFactor(this.interpolation,f,t[g],t[g+1]),P=r[g].evaluate(e),F=r[g+1].evaluate(e);return this.operator==="interpolate"?Co[this.type.kind.toLowerCase()](P,F,S):this.operator==="interpolate-hcl"?I.reverse(I.interpolate(I.forward(P),I.forward(F),S)):j.reverse(j.interpolate(j.forward(P),j.forward(F),S))},De.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},De.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},De.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Vt=function(e,t){this.type=e,this.args=t};Vt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],g=0,S=e.slice(1);g<S.length;g+=1){var P=t.parse(S[g],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!P)return null;r=r||P.type,v.push(P)}var F=f&&v.some(function(H){return ma(f,H.type)});return new Vt(F?Tn:r,v)},Vt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,g=this.args;v<g.length&&(f++,(r=g[v].evaluate(e))&&r instanceof qi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Vt.prototype.eachChild=function(e){this.args.forEach(e)},Vt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Vt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Wt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Wt.prototype.evaluate=function(e){return this.result.evaluate(e)},Wt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Wt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var g=t.parse(e[f+1],f+1);if(!g)return null;r.push([v,g])}var S=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return S?new Wt(r,S):null},Wt.prototype.outputDefined=function(){return this.result.outputDefined()},Wt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var kr=function(e,t,r){this.type=e,this.index=t,this.input=r};kr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,tr),f=t.parse(e[2],2,na(t.expectedType||Tn));return r&&f?new kr(f.type.itemType,r,f):null},kr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Wa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Wa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Wa("Array index must be an integer, but found "+t+" instead.");return r[t]},kr.prototype.eachChild=function(e){e(this.index),e(this.input)},kr.prototype.outputDefined=function(){return!1},kr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Kr=function(e,t){this.type=hn,this.needle=e,this.haystack=t};Kr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Tn),f=t.parse(e[2],2,Tn);return r&&f?Da(r.type,[hn,In,tr,Bn,Tn])?new Kr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Xi(r.type)+" instead"):null},Kr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Yi(t,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Xi($i(t))+" instead.");if(!Yi(r,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Xi($i(r))+" instead.");return r.indexOf(t)>=0},Kr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Kr.prototype.outputDefined=function(){return!0},Kr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var cn=function(e,t,r){this.type=tr,this.needle=e,this.haystack=t,this.fromIndex=r};cn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Tn),f=t.parse(e[2],2,Tn);if(!r||!f)return null;if(!Da(r.type,[hn,In,tr,Bn,Tn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Xi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,tr);return v?new cn(r,f,v):null}return new cn(r,f)},cn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Yi(t,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Xi($i(t))+" instead.");if(!Yi(r,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Xi($i(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},cn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},cn.prototype.outputDefined=function(){return!1},cn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Oi=function(e,t,r,f,v,g){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=g};Oi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},g=[],S=2;S<e.length-1;S+=2){var P=e[S],F=e[S+1];Array.isArray(P)||(P=[P]);var H=t.concat(S);if(P.length===0)return H.error("Expected at least one branch label.");for(var Q=0,oe=P;Q<oe.length;Q+=1){var ve=oe[Q];if(typeof ve!="number"&&typeof ve!="string")return H.error("Branch labels must be numbers or strings.");if(typeof ve=="number"&&Math.abs(ve)>Number.MAX_SAFE_INTEGER)return H.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ve=="number"&&Math.floor(ve)!==ve)return H.error("Numeric branch labels must be integer values.");if(r){if(H.checkSubtype(r,$i(ve)))return null}else r=$i(ve);if(v[String(ve)]!==void 0)return H.error("Branch labels must be unique.");v[String(ve)]=g.length}var Se=t.parse(F,S,f);if(!Se)return null;f=f||Se.type,g.push(Se)}var We=t.parse(e[1],1,Tn);if(!We)return null;var Ke=t.parse(e[e.length-1],e.length-1,f);return Ke?We.type.kind!=="value"&&t.concat(1).checkSubtype(r,We.type)?null:new Oi(r,f,We,v,g,Ke):null},Oi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return($i(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Oi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Oi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Oi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,g=Object.keys(this.cases).sort();v<g.length;v+=1){var S=g[v];(oe=f[this.cases[S]])===void 0?(f[this.cases[S]]=r.length,r.push([this.cases[S],[S]])):r[oe][1].push(S)}for(var P=function(Se){return e.inputType.kind==="number"?Number(Se):Se},F=0,H=r;F<H.length;F+=1){var Q=H[F],oe=Q[0],ve=Q[1];t.push(ve.length===1?P(ve[0]):ve.map(P)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Ei=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Ei.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var g=t.parse(e[v],v,hn);if(!g)return null;var S=t.parse(e[v+1],v+1,r);if(!S)return null;f.push([g,S]),r=r||S.type}var P=t.parse(e[e.length-1],e.length-1,r);return P?new Ei(r,f,P):null},Ei.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Ei.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},Ei.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Ei.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ha=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Pa(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ga(e,t,r,f){return f.compare(t,r)===0}function _i(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(g,S,P){this.type=hn,this.lhs=g,this.rhs=S,this.collator=P,this.hasUntypedArgument=g.type.kind==="value"||S.type.kind==="value"}return v.parse=function(g,S){if(g.length!==3&&g.length!==4)return S.error("Expected two or three arguments.");var P=g[0],F=S.parse(g[1],1,Tn);if(!F)return null;if(!Pa(P,F.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+Xi(F.type)+"'.");var H=S.parse(g[2],2,Tn);if(!H)return null;if(!Pa(P,H.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+Xi(H.type)+"'.");if(F.type.kind!==H.type.kind&&F.type.kind!=="value"&&H.type.kind!=="value")return S.error("Cannot compare types '"+Xi(F.type)+"' and '"+Xi(H.type)+"'.");f&&(F.type.kind==="value"&&H.type.kind!=="value"?F=new ba(H.type,[F]):F.type.kind!=="value"&&H.type.kind==="value"&&(H=new ba(F.type,[H])));var Q=null;if(g.length===4){if(F.type.kind!=="string"&&H.type.kind!=="string"&&F.type.kind!=="value"&&H.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Q=S.parse(g[3],3,Di)))return null}return new v(F,H,Q)},v.prototype.evaluate=function(g){var S=this.lhs.evaluate(g),P=this.rhs.evaluate(g);if(f&&this.hasUntypedArgument){var F=$i(S),H=$i(P);if(F.kind!==H.kind||F.kind!=="string"&&F.kind!=="number")throw new Wa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+F.kind+", "+H.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var Q=$i(S),oe=$i(P);if(Q.kind!=="string"||oe.kind!=="string")return t(g,S,P)}return this.collator?r(g,S,P,this.collator.evaluate(g)):t(g,S,P)},v.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var g=[e];return this.eachChild(function(S){g.push(S.serialize())}),g},v}()}ha.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Tn),f=t.parse(e[2],2,tr);if(!r||!f)return null;if(!Da(r.type,[na(Tn),In,Tn]))return t.error("Expected first argument to be of type array or string, but found "+Xi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,tr);return v?new ha(r.type,r,f,v):null}return new ha(r.type,r,f)},ha.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Yi(t,["string","array"]))throw new Wa("Expected first argument to be of type array or string, but found "+Xi($i(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},ha.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var po=_i("==",function(e,t,r){return t===r},ga),wo=_i("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ga(0,t,r,f)}),Ys=_i("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),lu=_i(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Ks=_i("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),Ru=_i(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Go=function(e,t,r,f,v){this.type=In,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Go.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,tr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,In)))return null;var g=null;if(f.currency&&!(g=t.parse(f.currency,1,In)))return null;var S=null;if(f["min-fraction-digits"]&&!(S=t.parse(f["min-fraction-digits"],1,tr)))return null;var P=null;return f["max-fraction-digits"]&&!(P=t.parse(f["max-fraction-digits"],1,tr))?null:new Go(r,v,g,S,P)},Go.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Go.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var ys=function(e){this.type=tr,this.input=e};ys.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Xi(r.type)+" instead."):new ys(r):null},ys.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Wa("Expected value to be of type string or array, but found "+Xi($i(t))+" instead.")},ys.prototype.eachChild=function(e){e(this.input)},ys.prototype.outputDefined=function(){return!1},ys.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ro={"==":po,"!=":wo,">":lu,"<":Ys,">=":Ru,"<=":Ks,array:ba,at:kr,boolean:ba,case:Ei,coalesce:Vt,collator:as,format:Lo,image:Ro,in:Kr,"index-of":cn,interpolate:De,"interpolate-hcl":De,"interpolate-lab":De,length:ys,let:Wt,literal:Ji,match:Oi,number:ba,"number-format":Go,object:ba,slice:ha,step:As,string:ba,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:us,within:Qo};function Ia(e,t){var r=t[0],f=t[1],v=t[2],g=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var S=g?g.evaluate(e):1,P=su(r,f,v,S);if(P)throw new Wa(P);return new Ki(r/255*S,f/255*S,v/255*S,S)}function $s(e,t){return e in t}function _l(e,t){var r=t[e];return r===void 0?null:r}function _s(e){return{type:e}}function Dl(e){return{result:"success",value:e}}function Js(e){return{result:"error",value:e}}function Qs(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function yc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Du(e){return!!e.expression&&e.expression.interpolated}function Oa(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function xl(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Kc(e){return e}function ku(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function bl(e,t,r,f,v){return ku(typeof r===v?f[r]:void 0,e.default,t.default)}function $c(e,t,r){if(Oa(r)!=="number")return ku(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Xs(e.stops.map(function(g){return g[0]}),r);return e.stops[v][1]}function Ju(e,t,r){var f=e.base!==void 0?e.base:1;if(Oa(r)!=="number")return ku(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var g=Xs(e.stops.map(function(oe){return oe[0]}),r),S=function(oe,ve,Se,We){var Ke=We-Se,bt=oe-Se;return Ke===0?0:ve===1?bt/Ke:(Math.pow(ve,bt)-1)/(Math.pow(ve,Ke)-1)}(r,f,e.stops[g][0],e.stops[g+1][0]),P=e.stops[g][1],F=e.stops[g+1][1],H=Co[t.type]||Kc;if(e.colorSpace&&e.colorSpace!=="rgb"){var Q=pe[e.colorSpace];H=function(oe,ve){return Q.reverse(Q.interpolate(Q.forward(oe),Q.forward(ve),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var oe=[],ve=arguments.length;ve--;)oe[ve]=arguments[ve];var Se=P.evaluate.apply(void 0,oe),We=F.evaluate.apply(void 0,oe);if(Se!==void 0&&We!==void 0)return H(Se,We,S)}}:H(P,F,S)}function Ql(e,t,r){return t.type==="color"?r=Ki.parse(r):t.type==="formatted"?r=Ba.fromString(r.toString()):t.type==="resolvedImage"?r=qi.fromString(r.toString()):Oa(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),ku(r,e.default,t.default)}so.register(ro,{error:[{kind:"error"},[In],function(e,t){throw new Wa(t[0].evaluate(e))}],typeof:[In,[Tn],function(e,t){return Xi($i(t[0].evaluate(e)))}],"to-rgba":[na(tr,4),[yn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[yn,[tr,tr,tr],Ia],rgba:[yn,[tr,tr,tr,tr],Ia],has:{type:hn,overloads:[[[In],function(e,t){return $s(t[0].evaluate(e),e.properties())}],[[In,Ni],function(e,t){var r=t[1];return $s(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:Tn,overloads:[[[In],function(e,t){return _l(t[0].evaluate(e),e.properties())}],[[In,Ni],function(e,t){var r=t[1];return _l(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[Tn,[In],function(e,t){return _l(t[0].evaluate(e),e.featureState||{})}],properties:[Ni,[],function(e){return e.properties()}],"geometry-type":[In,[],function(e){return e.geometryType()}],id:[Tn,[],function(e){return e.id()}],zoom:[tr,[],function(e){return e.globals.zoom}],"heatmap-density":[tr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[tr,[],function(e){return e.globals.lineProgress||0}],accumulated:[Tn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[tr,_s(tr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[tr,_s(tr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:tr,overloads:[[[tr,tr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[tr],function(e,t){return-t[0].evaluate(e)}]]},"/":[tr,[tr,tr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[tr,[tr,tr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[tr,[],function(){return Math.LN2}],pi:[tr,[],function(){return Math.PI}],e:[tr,[],function(){return Math.E}],"^":[tr,[tr,tr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[tr,[tr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[tr,[tr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[tr,[tr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[tr,[tr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[tr,[tr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[tr,[tr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[tr,[tr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[tr,[tr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[tr,[tr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[tr,[tr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[tr,_s(tr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[tr,_s(tr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[tr,[tr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[tr,[tr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[tr,[tr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[tr,[tr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[hn,[In,Tn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[hn,[Tn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[hn,[In],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[hn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<g}],"filter-id-<":[hn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[hn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>g}],"filter-id->":[hn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[hn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<=g}],"filter-id-<=":[hn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[hn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>=g}],"filter-id->=":[hn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[hn,[Tn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[hn,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[hn,[na(In)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[hn,[na(Tn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[hn,[In,na(Tn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[hn,[In,na(Tn)],function(e,t){var r=t[0],f=t[1];return function(v,g,S,P){for(;S<=P;){var F=S+P>>1;if(g[F]===v)return!0;g[F]>v?P=F-1:S=F+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:hn,overloads:[[[hn,hn],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[_s(hn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:hn,overloads:[[[hn,hn],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[_s(hn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[hn,[hn],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[hn,[In],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[In,[In],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[In,[In],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[In,_s(Tn),function(e,t){return t.map(function(r){return yo(r.evaluate(e))}).join("")}],"resolved-locale":[In,[Di],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Pu=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ka,this._defaultValue=t?function(r){return r.type==="color"&&xl(r.default)?new Ki(0,0,0,0):r.type==="color"?Ki.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Qu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in ro}function Sl(e,t){var r=new zs(ro,[],t?function(v){var g={color:yn,string:In,number:tr,enum:In,boolean:hn,formatted:ra,resolvedImage:hi};return v.type==="array"?na(g[v.value]||Tn,v.length):g[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Dl(new Pu(f,t)):Js(r.errors)}Pu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},Pu.prototype.evaluate=function(e,t,r,f,v,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var El=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ss(t.expression)};El.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},El.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)};var qu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ss(t.expression),this.interpolationType=f};function Cl(e,t){if((e=Sl(e,t)).result==="error")return e;var r=e.value.expression,f=qo(r);if(!f&&!Qs(t))return Js([new Zr("","data expressions not supported")]);var v=ws(r,["zoom"]);if(!v&&!yc(t))return Js([new Zr("","zoom expressions not supported")]);var g=function S(P){var F=null;if(P instanceof Wt)F=S(P.result);else if(P instanceof Vt)for(var H=0,Q=P.args;H<Q.length&&!(F=S(Q[H]));H+=1);else(P instanceof As||P instanceof De)&&P.input instanceof so&&P.input.name==="zoom"&&(F=P);return F instanceof Zr||P.eachChild(function(oe){var ve=S(oe);ve instanceof Zr?F=ve:!F&&ve?F=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&ve&&F!==ve&&(F=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(r);return g||v?g instanceof Zr?Js([g]):g instanceof De&&!Du(t)?Js([new Zr("",'"interpolate" expressions cannot be used with this property')]):Dl(g?new qu(f?"camera":"composite",e.value,g.labels,g instanceof De?g.interpolation:void 0):new El(f?"constant":"source",e.value)):Js([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}qu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},qu.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)},qu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?De.interpolationFactor(this.interpolationType,e,t,r):0};var el=function(e,t){this._parameters=e,this._specification=t,Cr(this,function r(f,v){var g,S,P,F=v.type==="color",H=f.stops&&typeof f.stops[0][0]=="object",Q=H||!(H||f.property!==void 0),oe=f.type||(Du(v)?"exponential":"interval");if(F&&((f=Cr({},f)).stops&&(f.stops=f.stops.map(function(Zn){return[Zn[0],Ki.parse(Zn[1])]})),f.default=Ki.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!pe[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(oe==="exponential")g=Ju;else if(oe==="interval")g=$c;else if(oe==="categorical"){g=bl,S=Object.create(null);for(var ve=0,Se=f.stops;ve<Se.length;ve+=1){var We=Se[ve];S[We[0]]=We[1]}P=typeof f.stops[0][0]}else{if(oe!=="identity")throw new Error('Unknown function type "'+oe+'"');g=Ql}if(H){for(var Ke={},bt=[],it=0;it<f.stops.length;it++){var Dt=f.stops[it],Qt=Dt[0].zoom;Ke[Qt]===void 0&&(Ke[Qt]={zoom:Qt,type:f.type,property:f.property,default:f.default,stops:[]},bt.push(Qt)),Ke[Qt].stops.push([Dt[0].value,Dt[1]])}for(var mr=[],xr=0,Nr=bt;xr<Nr.length;xr+=1){var un=Nr[xr];mr.push([Ke[un].zoom,r(Ke[un],v)])}var Cn={name:"linear"};return{kind:"composite",interpolationType:Cn,interpolationFactor:De.interpolationFactor.bind(void 0,Cn),zoomStops:mr.map(function(Zn){return Zn[0]}),evaluate:function(Zn,ci){var $n=Zn.zoom;return Ju({stops:mr,base:f.base},v,$n).evaluate($n,ci)}}}if(Q){var ti=oe==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:ti,interpolationFactor:De.interpolationFactor.bind(void 0,ti),zoomStops:f.stops.map(function(Zn){return Zn[0]}),evaluate:function(Zn){return g(f,v,Zn.zoom,S,P)}}}return{kind:"source",evaluate:function(Zn,ci){var $n=ci&&ci.properties?ci.properties[f.property]:void 0;return $n===void 0?ku(f.default,v.default):g(f,v,$n,S,P)}}}(this._parameters,this._specification))};function qs(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},g=e.style,S=e.styleSpec,P=[],F=Oa(r);if(F!=="object")return[new xe(t,r,"object expected, "+F+" found")];for(var H in r){var Q=H.split(".")[0],oe=f[Q]||f["*"],ve=void 0;if(v[Q])ve=v[Q];else if(f[Q])ve=la;else if(v["*"])ve=v["*"];else{if(!f["*"]){P.push(new xe(t,r[H],'unknown property "'+H+'"'));continue}ve=la}P=P.concat(ve({key:(t&&t+".")+H,value:r[H],valueSpec:oe,style:g,styleSpec:S,object:r,objectKey:H},r))}for(var Se in f)v[Se]||f[Se].required&&f[Se].default===void 0&&r[Se]===void 0&&P.push(new xe(t,r,'missing required property "'+Se+'"'));return P}function ql(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,g=e.key,S=e.arrayElementValidator||la;if(Oa(t)!=="array")return[new xe(g,t,"array expected, "+Oa(t)+" found")];if(r.length&&t.length!==r.length)return[new xe(g,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new xe(g,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var P={type:r.value,values:r.values};v.$version<7&&(P.function=r.function),Oa(r.value)==="object"&&(P=r.value);for(var F=[],H=0;H<t.length;H++)F=F.concat(S({array:t,arrayIndex:H,value:t[H],valueSpec:P,style:f,styleSpec:v,key:g+"["+H+"]"}));return F}function Fu(e){var t=e.key,r=e.value,f=e.valueSpec,v=Oa(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new xe(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new xe(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new xe(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Oc(e){var t,r,f,v=e.valueSpec,g=Kt(e.value.type),S={},P=g!=="categorical"&&e.value.property===void 0,F=!P,H=Oa(e.value.stops)==="array"&&Oa(e.value.stops[0])==="array"&&Oa(e.value.stops[0][0])==="object",Q=qs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(Se){if(g==="identity")return[new xe(Se.key,Se.value,'identity function may not have a "stops" property')];var We=[],Ke=Se.value;return We=We.concat(ql({key:Se.key,value:Ke,valueSpec:Se.valueSpec,style:Se.style,styleSpec:Se.styleSpec,arrayElementValidator:oe})),Oa(Ke)==="array"&&Ke.length===0&&We.push(new xe(Se.key,Ke,"array must have at least one stop")),We},default:function(Se){return la({key:Se.key,value:Se.value,valueSpec:v,style:Se.style,styleSpec:Se.styleSpec})}}});return g==="identity"&&P&&Q.push(new xe(e.key,e.value,'missing required property "property"')),g==="identity"||e.value.stops||Q.push(new xe(e.key,e.value,'missing required property "stops"')),g==="exponential"&&e.valueSpec.expression&&!Du(e.valueSpec)&&Q.push(new xe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(F&&!Qs(e.valueSpec)?Q.push(new xe(e.key,e.value,"property functions not supported")):P&&!yc(e.valueSpec)&&Q.push(new xe(e.key,e.value,"zoom functions not supported"))),g!=="categorical"&&!H||e.value.property!==void 0||Q.push(new xe(e.key,e.value,'"property" property is required')),Q;function oe(Se){var We=[],Ke=Se.value,bt=Se.key;if(Oa(Ke)!=="array")return[new xe(bt,Ke,"array expected, "+Oa(Ke)+" found")];if(Ke.length!==2)return[new xe(bt,Ke,"array length 2 expected, length "+Ke.length+" found")];if(H){if(Oa(Ke[0])!=="object")return[new xe(bt,Ke,"object expected, "+Oa(Ke[0])+" found")];if(Ke[0].zoom===void 0)return[new xe(bt,Ke,"object stop key must have zoom")];if(Ke[0].value===void 0)return[new xe(bt,Ke,"object stop key must have value")];if(f&&f>Kt(Ke[0].zoom))return[new xe(bt,Ke[0].zoom,"stop zoom values must appear in ascending order")];Kt(Ke[0].zoom)!==f&&(f=Kt(Ke[0].zoom),r=void 0,S={}),We=We.concat(qs({key:bt+"[0]",value:Ke[0],valueSpec:{zoom:{}},style:Se.style,styleSpec:Se.styleSpec,objectElementValidators:{zoom:Fu,value:ve}}))}else We=We.concat(ve({key:bt+"[0]",value:Ke[0],valueSpec:{},style:Se.style,styleSpec:Se.styleSpec},Ke));return Qu(rr(Ke[1]))?We.concat([new xe(bt+"[1]",Ke[1],"expressions are not allowed in function stops.")]):We.concat(la({key:bt+"[1]",value:Ke[1],valueSpec:v,style:Se.style,styleSpec:Se.styleSpec}))}function ve(Se,We){var Ke=Oa(Se.value),bt=Kt(Se.value),it=Se.value!==null?Se.value:We;if(t){if(Ke!==t)return[new xe(Se.key,it,Ke+" stop domain type must match previous stop domain type "+t)]}else t=Ke;if(Ke!=="number"&&Ke!=="string"&&Ke!=="boolean")return[new xe(Se.key,it,"stop domain value must be a number, string, or boolean")];if(Ke!=="number"&&g!=="categorical"){var Dt="number expected, "+Ke+" found";return Qs(v)&&g===void 0&&(Dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xe(Se.key,it,Dt)]}return g!=="categorical"||Ke!=="number"||isFinite(bt)&&Math.floor(bt)===bt?g!=="categorical"&&Ke==="number"&&r!==void 0&&bt<r?[new xe(Se.key,it,"stop domain values must appear in ascending order")]:(r=bt,g==="categorical"&&bt in S?[new xe(Se.key,it,"stop domain values must be unique")]:(S[bt]=!0,[])):[new xe(Se.key,it,"integer expected, found "+bt)]}}function tl(e){var t=(e.expressionContext==="property"?Cl:Sl)(rr(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new xe(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new xe(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ss(r))return[new xe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ss(r))return[new xe(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!ws(r,["zoom","feature-state"]))return[new xe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!qo(r))return[new xe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Kt(r))===-1&&v.push(new xe(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Kt(r))===-1&&v.push(new xe(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function kl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!kl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}el.deserialize=function(e){return new el(e._parameters,e._specification)},el.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var _c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};kl(e)||(e=ec(e));var t=Sl(e,_c);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Lc(e,t){return e<t?-1:e>t?1:0}function ec(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Zs(e[1],e[2],"=="):r==="!="?Bu(Zs(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Zs(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(ec))):r==="all"?["all"].concat(e.slice(1).map(ec)):r==="none"?["all"].concat(e.slice(1).map(ec).map(Bu)):r==="in"?no(e[1],e.slice(2)):r==="!in"?Bu(no(e[1],e.slice(2))):r==="has"?_o(e[1]):r==="!has"?Bu(_o(e[1])):r!=="within"||e}function Zs(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function no(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Lc)]]:["filter-in-small",e,["literal",t]]}}function _o(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Bu(e){return["!",e]}function Ds(e){return kl(rr(e.value))?tl(Cr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Oa(f)!=="array")return[new xe(v,f,"array expected, "+Oa(f)+" found")];var g,S=r.styleSpec,P=[];if(f.length<1)return[new xe(v,f,"filter array must have at least 1 element")];switch(P=P.concat(wl({key:v+"[0]",value:f[0],valueSpec:S.filter_operator,style:r.style,styleSpec:r.styleSpec})),Kt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Kt(f[1])==="$type"&&P.push(new xe(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&P.push(new xe(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(g=Oa(f[1]))!=="string"&&P.push(new xe(v+"[1]",f[1],"string expected, "+g+" found"));for(var F=2;F<f.length;F++)g=Oa(f[F]),Kt(f[1])==="$type"?P=P.concat(wl({key:v+"["+F+"]",value:f[F],valueSpec:S.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&P.push(new xe(v+"["+F+"]",f[F],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var H=1;H<f.length;H++)P=P.concat(t({key:v+"["+H+"]",value:f[H],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Oa(f[1]),f.length!==2?P.push(new xe(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="string"&&P.push(new xe(v+"[1]",f[1],"string expected, "+g+" found"));break;case"within":g=Oa(f[1]),f.length!==2?P.push(new xe(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="object"&&P.push(new xe(v+"[1]",f[1],"object expected, "+g+" found"))}return P}(e)}function Bl(e,t){var r=e.key,f=e.style,v=e.styleSpec,g=e.value,S=e.objectKey,P=v[t+"_"+e.layerType];if(!P)return[];var F=S.match(/^(.*)-transition$/);if(t==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return la({key:r,value:g,valueSpec:v.transition,style:f,styleSpec:v});var H,Q=e.valueSpec||P[S];if(!Q)return[new xe(r,g,'unknown property "'+S+'"')];if(Oa(g)==="string"&&Qs(Q)&&!Q.tokens&&(H=/^{([^}]+)}$/.exec(g)))return[new xe(r,g,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(H[1])+" }`.")];var oe=[];return e.layerType==="symbol"&&(S==="text-field"&&f&&!f.glyphs&&oe.push(new xe(r,g,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&xl(rr(g))&&Kt(g.type)==="identity"&&oe.push(new xe(r,g,'"text-font" does not support identity functions'))),oe.concat(la({key:e.key,value:g,valueSpec:Q,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:S}))}function tc(e){return Bl(e,"paint")}function gu(e){return Bl(e,"layout")}function rc(e){var t=[],r=e.value,f=e.key,v=e.style,g=e.styleSpec;r.type||r.ref||t.push(new xe(f,r,'either "type" or "ref" is required'));var S,P=Kt(r.type),F=Kt(r.ref);if(r.id)for(var H=Kt(r.id),Q=0;Q<e.arrayIndex;Q++){var oe=v.layers[Q];Kt(oe.id)===H&&t.push(new xe(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+oe.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(We){We in r&&t.push(new xe(f,r[We],'"'+We+'" is prohibited for ref layers'))}),v.layers.forEach(function(We){Kt(We.id)===F&&(S=We)}),S?S.ref?t.push(new xe(f,r.ref,"ref cannot reference another ref layer")):P=Kt(S.type):t.push(new xe(f,r.ref,'ref layer "'+F+'" not found'));else if(P!=="background")if(r.source){var ve=v.sources&&v.sources[r.source],Se=ve&&Kt(ve.type);ve?Se==="vector"&&P==="raster"?t.push(new xe(f,r.source,'layer "'+r.id+'" requires a raster source')):Se==="raster"&&P!=="raster"?t.push(new xe(f,r.source,'layer "'+r.id+'" requires a vector source')):Se!=="vector"||r["source-layer"]?Se==="raster-dem"&&P!=="hillshade"?t.push(new xe(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!r.paint||!r.paint["line-gradient"]||Se==="geojson"&&ve.lineMetrics||t.push(new xe(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new xe(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new xe(f,r.source,'source "'+r.source+'" not found'))}else t.push(new xe(f,r,'missing required property "source"'));return t=t.concat(qs({key:f,value:r,valueSpec:g.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return la({key:f+".type",value:r.type,valueSpec:g.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Ds,layout:function(We){return qs({layer:r,key:We.key,value:We.value,style:We.style,styleSpec:We.styleSpec,objectElementValidators:{"*":function(Ke){return gu(Cr({layerType:P},Ke))}}})},paint:function(We){return qs({layer:r,key:We.key,value:We.value,style:We.style,styleSpec:We.styleSpec,objectElementValidators:{"*":function(Ke){return tc(Cr({layerType:P},Ke))}}})}}}))}function Nu(e){var t=e.value,r=e.key,f=Oa(t);return f!=="string"?[new xe(r,t,"string expected, "+f+" found")]:[]}var io={promoteId:function(e){var t=e.key,r=e.value;if(Oa(r)==="string")return Nu({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,Nu({key:t+"."+v,value:r[v]}));return f}};function Nl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new xe(r,t,'"type" is required')];var g,S=Kt(t.type);switch(S){case"vector":case"raster":case"raster-dem":return qs({key:r,value:t,valueSpec:f["source_"+S.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:io});case"geojson":if(g=qs({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:io}),t.cluster)for(var P in t.clusterProperties){var F=t.clusterProperties[P],H=F[0],Q=typeof H=="string"?[H,["accumulated"],["get",P]]:H;g.push.apply(g,tl({key:r+"."+P+".map",value:F[1],expressionContext:"cluster-map"})),g.push.apply(g,tl({key:r+"."+P+".reduce",value:Q,expressionContext:"cluster-reduce"}))}return g;case"video":return qs({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return qs({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new xe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function js(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,g=[],S=Oa(t);if(t===void 0)return g;if(S!=="object")return g.concat([new xe("light",t,"object expected, "+S+" found")]);for(var P in t){var F=P.match(/^(.*)-transition$/);g=g.concat(F&&f[F[1]]&&f[F[1]].transition?la({key:P,value:t[P],valueSpec:r.transition,style:v,styleSpec:r}):f[P]?la({key:P,value:t[P],valueSpec:f[P],style:v,styleSpec:r}):[new xe(P,t[P],'unknown property "'+P+'"')])}return g}var cu={"*":function(){return[]},array:ql,boolean:function(e){var t=e.value,r=e.key,f=Oa(t);return f!=="boolean"?[new xe(r,t,"boolean expected, "+f+" found")]:[]},number:Fu,color:function(e){var t=e.key,r=e.value,f=Oa(r);return f!=="string"?[new xe(t,r,"color expected, "+f+" found")]:zi(r)===null?[new xe(t,r,'color expected, "'+r+'" found')]:[]},constants:pt,enum:wl,filter:Ds,function:Oc,layer:rc,object:qs,source:Nl,light:js,string:Nu,formatted:function(e){return Nu(e).length===0?[]:tl(e)},resolvedImage:function(e){return Nu(e).length===0?[]:tl(e)}};function la(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&xl(Kt(t))?Oc(e):r.expression&&Qu(rr(t))?tl(e):r.type&&cu[r.type]?cu[r.type](e):qs(Cr({},e,{valueSpec:r.type?f[r.type]:r}))}function Pi(e){var t=e.value,r=e.key,f=Nu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new xe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new xe(r,t,'"glyphs" url must include a "{range}" token'))),f}function xs(e,t){t===void 0&&(t=ue);var r=[];return r=r.concat(la({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Pi,"*":function(){return[]}}})),e.constants&&(r=r.concat(pt({key:"constants",value:e.constants,style:e,styleSpec:t}))),fu(r)}function fu(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function rl(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return fu(e.apply(this,t))}}xs.source=rl(Nl),xs.light=rl(js),xs.layer=rl(rc),xs.filter=rl(Ds),xs.paintProperty=rl(tc),xs.layoutProperty=rl(gu);var es=xs,Jc=es.light,Rc=es.paintProperty,Al=es.layoutProperty;function zl(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new de(new Error(v[f].message))),r=!0;return r}var yu=Ao;function Ao(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var g=0;g<this.d*this.d;g++){var S=v[3+g],P=v[3+g+1];f.push(S===P?null:v.subarray(S,P))}var F=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],F),this.bboxes=v.subarray(F),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var H=0;H<this.d*this.d;H++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var Q=r/t*e;this.min=-Q,this.max=e+Q}Ao.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Ao.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ao.prototype._insertCell=function(e,t,r,f,v,g){this.cells[v].push(g)},Ao.prototype.query=function(e,t,r,f,v){var g=this.min,S=this.max;if(e<=g&&t<=g&&S<=r&&S<=f&&!v)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(e,t,r,f,this._queryCell,P,{},v),P},Ao.prototype._queryCell=function(e,t,r,f,v,g,S,P){var F=this.cells[v];if(F!==null)for(var H=this.keys,Q=this.bboxes,oe=0;oe<F.length;oe++){var ve=F[oe];if(S[ve]===void 0){var Se=4*ve;(P?P(Q[Se+0],Q[Se+1],Q[Se+2],Q[Se+3]):e<=Q[Se+2]&&t<=Q[Se+3]&&r>=Q[Se+0]&&f>=Q[Se+1])?(S[ve]=!0,g.push(H[ve])):S[ve]=!1}}},Ao.prototype._forEachCell=function(e,t,r,f,v,g,S,P){for(var F=this._convertToCellCoord(e),H=this._convertToCellCoord(t),Q=this._convertToCellCoord(r),oe=this._convertToCellCoord(f),ve=F;ve<=Q;ve++)for(var Se=H;Se<=oe;Se++){var We=this.d*Se+ve;if((!P||P(this._convertFromCellCoord(ve),this._convertFromCellCoord(Se),this._convertFromCellCoord(ve+1),this._convertFromCellCoord(Se+1)))&&v.call(this,e,t,r,f,We,g,S,P))return}},Ao.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ao.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ao.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var g=t,S=0;S<e.length;S++){var P=e[S];v[3+S]=g,v.set(P,g),g+=P.length}return v[3+e.length]=g,v.set(this.keys,g),v[3+e.length+1]=g+=this.keys.length,v.set(this.bboxes,g),g+=this.bboxes.length,v.buffer};var zu=Z.ImageData,Tl=Z.ImageBitmap,To={};function Rn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),To[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var lo in Rn("Object",Object),yu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},yu.deserialize=function(e){return new yu(e.buffer)},Rn("Grid",yu),Rn("Color",Ki),Rn("Error",Error),Rn("ResolvedImage",qi),Rn("StylePropertyFunction",el),Rn("StyleExpression",Pu,{omit:["_evaluator"]}),Rn("ZoomDependentExpression",qu),Rn("ZoomConstantExpression",El),Rn("CompoundExpression",so,{omit:["_evaluate"]}),ro)ro[lo]._classRegistryKey||Rn("Expression_"+lo,ro[lo]);function _u(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Uu(e){return Tl&&e instanceof Tl}function Ya(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(_u(e)||Uu(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof zu)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,g=e;v<g.length;v+=1)f.push(Ya(g[v],t));return f}if(typeof e=="object"){var S=e.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var F=S.serialize?S.serialize(e,t):{};if(!S.serialize){for(var H in e)if(e.hasOwnProperty(H)&&!(To[P].omit.indexOf(H)>=0)){var Q=e[H];F[H]=To[P].shallow.indexOf(H)>=0?Q:Ya(Q,t)}e instanceof Error&&(F.message=e.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(F.$name=P),F}throw new Error("can't serialize object of type "+typeof e)}function ks(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||_u(e)||Uu(e)||ArrayBuffer.isView(e)||e instanceof zu)return e;if(Array.isArray(e))return e.map(ks);if(typeof e=="object"){var t=e.$name||"Object",r=To[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,g=Object.keys(e);v<g.length;v+=1){var S=g[v];if(S!=="$name"){var P=e[S];f[S]=To[t].shallow.indexOf(S)>=0?P:ks(P)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var xc=function(){this.first=!0};xc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Sn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Mu(e){for(var t=0,r=e;t<r.length;t+=1)if(bc(r[t].charCodeAt(0)))return!0;return!1}function bc(e){return!(e!==746&&e!==747&&(e<4352||!(Sn["Bopomofo Extended"](e)||Sn.Bopomofo(e)||Sn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Sn["CJK Compatibility Ideographs"](e)||Sn["CJK Compatibility"](e)||Sn["CJK Radicals Supplement"](e)||Sn["CJK Strokes"](e)||!(!Sn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Sn["CJK Unified Ideographs Extension A"](e)||Sn["CJK Unified Ideographs"](e)||Sn["Enclosed CJK Letters and Months"](e)||Sn["Hangul Compatibility Jamo"](e)||Sn["Hangul Jamo Extended-A"](e)||Sn["Hangul Jamo Extended-B"](e)||Sn["Hangul Jamo"](e)||Sn["Hangul Syllables"](e)||Sn.Hiragana(e)||Sn["Ideographic Description Characters"](e)||Sn.Kanbun(e)||Sn["Kangxi Radicals"](e)||Sn["Katakana Phonetic Extensions"](e)||Sn.Katakana(e)&&e!==12540||!(!Sn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Sn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Sn["Unified Canadian Aboriginal Syllabics"](e)||Sn["Unified Canadian Aboriginal Syllabics Extended"](e)||Sn["Vertical Forms"](e)||Sn["Yijing Hexagram Symbols"](e)||Sn["Yi Syllables"](e)||Sn["Yi Radicals"](e))))}function eu(e){return!(bc(e)||function(t){return!!(Sn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Sn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Sn["Letterlike Symbols"](t)||Sn["Number Forms"](t)||Sn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Sn["Control Pictures"](t)&&t!==9251||Sn["Optical Character Recognition"](t)||Sn["Enclosed Alphanumerics"](t)||Sn["Geometric Shapes"](t)||Sn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Sn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Sn["CJK Symbols and Punctuation"](t)||Sn.Katakana(t)||Sn["Private Use Area"](t)||Sn["CJK Compatibility Forms"](t)||Sn["Small Form Variants"](t)||Sn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Ua(e){return e>=1424&&e<=2303||Sn["Arabic Presentation Forms-A"](e)||Sn["Arabic Presentation Forms-B"](e)}function bs(e,t){return!(!t&&Ua(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Sn.Khmer(e))}function Pl(e){for(var t=0,r=e;t<r.length;t+=1)if(Ua(r[t].charCodeAt(0)))return!0;return!1}var tu=null,Ts="unavailable",xu=null,Qc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Ts="error"),tu&&tu(e)};function nc(){ic.fire(new ae("pluginStateChange",{pluginStatus:Ts,pluginURL:xu}))}var ic=new Te,ko=function(){return Ts},Vs=function(){if(Ts!=="deferred"||!xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ts="loading",nc(),xu&&Ln({url:xu},function(e){e?Qc(e):(Ts="loaded",nc())})},Po={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ts==="loaded"||Po.applyArabicShaping!=null},isLoading:function(){return Ts==="loading"},setState:function(e){Ts=e.pluginStatus,xu=e.pluginURL},isParsed:function(){return Po.applyArabicShaping!=null&&Po.processBidirectionalText!=null&&Po.processStyledBidirectionalText!=null},getPluginURL:function(){return xu}},ta=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xc,this.transition={})};ta.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!bs(v[f].charCodeAt(0),r))return!1;return!0}(e,Po.isLoaded())},ta.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ta.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Zu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(xl(r))return new el(r,f);if(Qu(r)){var v=Cl(r,f);if(v.result==="error")throw new Error(v.value.map(function(S){return S.key+": "+S.message}).join(", "));return v.value}var g=r;return typeof r=="string"&&f.type==="color"&&(g=Ki.parse(r)),{kind:"constant",evaluate:function(){return g}}}(t===void 0?e.specification.default:t,e.specification)};Zu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Zu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var hu=function(e){this.property=e,this.value=new Zu(e,void 0)};hu.prototype.transitioned=function(e,t){return new nl(this.property,this.value,t,Lt({},e.transition,this.transition),e.now)},hu.prototype.untransitioned=function(){return new nl(this.property,this.value,null,{},0)};var Ho=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Ho.prototype.getValue=function(e){return $e(this._values[e].value.value)},Ho.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new hu(this._values[e].property)),this._values[e].value=new Zu(this._values[e].property,t===null?void 0:$e(t))},Ho.prototype.getTransition=function(e){return $e(this._values[e].transition)},Ho.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new hu(this._values[e].property)),this._values[e].transition=$e(t)||void 0},Ho.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var g=this.getTransition(f);g!==void 0&&(e[f+"-transition"]=g)}return e},Ho.prototype.transitioned=function(e,t){for(var r=new bu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var g=v[f];r._values[g]=this._values[g].transitioned(e,t._values[g])}return r},Ho.prototype.untransitioned=function(){for(var e=new bu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var nl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};nl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),g=this.prior;if(g){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return g.possiblyEvaluate(e,t,r);var S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,t,r),v,function(P){if(P<=0)return 0;if(P>=1)return 1;var F=P*P,H=F*P;return 4*(P<.5?H:3*(P-F)+H-.75)}(S))}return v};var bu=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};bu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Ml(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var S=g[v];f._values[S]=this._values[S].possiblyEvaluate(e,t,r)}return f},bu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var bi=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};bi.prototype.getValue=function(e){return $e(this._values[e].value)},bi.prototype.setValue=function(e,t){this._values[e]=new Zu(this._values[e].property,t===null?void 0:$e(t))},bi.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},bi.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Ml(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var S=g[v];f._values[S]=this._values[S].possiblyEvaluate(e,t,r)}return f};var co=function(e,t,r){this.property=e,this.value=t,this.parameters=r};co.prototype.isConstant=function(){return this.value.kind==="constant"},co.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},co.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Ml=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Ml.prototype.get=function(e){return this._values[e]};var Vn=function(e){this.specification=e};Vn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Vn.prototype.interpolate=function(e,t,r){var f=Co[this.specification.type];return f?f(e,t,r):e};var Gn=function(e,t){this.specification=e,this.overrides=t};Gn.prototype.possiblyEvaluate=function(e,t,r,f){return new co(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Gn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new co(this,{kind:"constant",value:void 0},e.parameters);var f=Co[this.specification.type];return f?new co(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Gn.prototype.evaluate=function(e,t,r,f,v,g){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,g)};var il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,g){if(r.value===void 0)return new co(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var S=r.expression.evaluate(f,null,{},v,g),P=r.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,F=this._calculate(P,P,P,f);return new co(this,{kind:"constant",value:F},f)}if(r.expression.kind==="camera"){var H=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new co(this,{kind:"constant",value:H},f)}return new co(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,g,S,P){if(r.kind==="source"){var F=r.evaluate(f,v,g,S,P);return this._calculate(F,F,F,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,g),r.evaluate({zoom:Math.floor(f.zoom)},v,g),r.evaluate({zoom:Math.floor(f.zoom)+1},v,g),f):r.value},t.prototype._calculate=function(r,f,v,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Gn),ts=function(e){this.specification=e};ts.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new ta(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ta(Math.floor(t.zoom),t)),e.expression.evaluate(new ta(Math.floor(t.zoom+1),t)),t)}},ts.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ts.prototype.interpolate=function(e){return e};var ls=function(e){this.specification=e};ls.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},ls.prototype.interpolate=function(){return!1};var Mo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Zu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new hu(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Rn("DataDrivenProperty",Gn),Rn("DataConstantProperty",Vn),Rn("CrossFadedDataDrivenProperty",il),Rn("CrossFadedProperty",ts),Rn("ColorRampProperty",ls);var ru=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new bi(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Ho(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var g in r.layout)this.setLayoutProperty(g,r.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ml(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Al,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return re(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Rc,"layers."+this.id+".paint."+r,r,f,v))return!1;if(re(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var g=this._transitionablePaint._values[r],S=g.property.specification["property-type"]==="cross-faded-data-driven",P=g.value.isDataDriven(),F=g.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var H=this._transitionablePaint._values[r].value;return H.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(r,F,H)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Tt(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,g,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&zl(this,r.call(es,{key:f,layerType:this.type,objectKey:v,value:g,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof co&&Qs(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Te),Dc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ac=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Wi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Zi(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var g=Dc[v.type].BYTES_PER_ELEMENT,S=r=qc(r,Math.max(t,g)),P=v.components||1;return f=Math.max(f,g),r+=g*P,{name:v.name,type:v.type,components:P,offset:S}}),size:qc(r,Math.max(f,t)),alignment:t}}function qc(e,t){return Math.ceil(e/t)*t}Wi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Wi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Wi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Wi.prototype.clear=function(){this.length=0},Wi.prototype.resize=function(e){this.reserve(e),this.length=e},Wi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Wi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ps=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.int16[g+0]=f,this.int16[g+1]=v,r},t}(Wi);Ps.prototype.bytesPerElement=4,Rn("StructArrayLayout2i4",Ps);var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,S){var P=4*r;return this.int16[P+0]=f,this.int16[P+1]=v,this.int16[P+2]=g,this.int16[P+3]=S,r},t}(Wi);Il.prototype.bytesPerElement=8,Rn("StructArrayLayout4i8",Il);var Ms=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,g,S,P)},t.prototype.emplace=function(r,f,v,g,S,P,F){var H=6*r;return this.int16[H+0]=f,this.int16[H+1]=v,this.int16[H+2]=g,this.int16[H+3]=S,this.int16[H+4]=P,this.int16[H+5]=F,r},t}(Wi);Ms.prototype.bytesPerElement=12,Rn("StructArrayLayout2i4i12",Ms);var Va=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,g,S,P)},t.prototype.emplace=function(r,f,v,g,S,P,F){var H=4*r,Q=8*r;return this.int16[H+0]=f,this.int16[H+1]=v,this.uint8[Q+4]=g,this.uint8[Q+5]=S,this.uint8[Q+6]=P,this.uint8[Q+7]=F,r},t}(Wi);Va.prototype.bytesPerElement=8,Rn("StructArrayLayout2i4ub8",Va);var nu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.float32[g+0]=f,this.float32[g+1]=v,r},t}(Wi);nu.prototype.bytesPerElement=8,Rn("StructArrayLayout2f8",nu);var Ss=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P,F,H,Q,oe){var ve=this.length;return this.resize(ve+1),this.emplace(ve,r,f,v,g,S,P,F,H,Q,oe)},t.prototype.emplace=function(r,f,v,g,S,P,F,H,Q,oe,ve){var Se=10*r;return this.uint16[Se+0]=f,this.uint16[Se+1]=v,this.uint16[Se+2]=g,this.uint16[Se+3]=S,this.uint16[Se+4]=P,this.uint16[Se+5]=F,this.uint16[Se+6]=H,this.uint16[Se+7]=Q,this.uint16[Se+8]=oe,this.uint16[Se+9]=ve,r},t}(Wi);Ss.prototype.bytesPerElement=20,Rn("StructArrayLayout10ui20",Ss);var ju=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P,F,H,Q,oe,ve,Se){var We=this.length;return this.resize(We+1),this.emplace(We,r,f,v,g,S,P,F,H,Q,oe,ve,Se)},t.prototype.emplace=function(r,f,v,g,S,P,F,H,Q,oe,ve,Se,We){var Ke=12*r;return this.int16[Ke+0]=f,this.int16[Ke+1]=v,this.int16[Ke+2]=g,this.int16[Ke+3]=S,this.uint16[Ke+4]=P,this.uint16[Ke+5]=F,this.uint16[Ke+6]=H,this.uint16[Ke+7]=Q,this.int16[Ke+8]=oe,this.int16[Ke+9]=ve,this.int16[Ke+10]=Se,this.int16[Ke+11]=We,r},t}(Wi);ju.prototype.bytesPerElement=24,Rn("StructArrayLayout4i4ui4i24",ju);var al=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=3*r;return this.float32[S+0]=f,this.float32[S+1]=v,this.float32[S+2]=g,r},t}(Wi);al.prototype.bytesPerElement=12,Rn("StructArrayLayout3f12",al);var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Wi);Ol.prototype.bytesPerElement=4,Rn("StructArrayLayout1ul4",Ol);var oc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P,F,H,Q){var oe=this.length;return this.resize(oe+1),this.emplace(oe,r,f,v,g,S,P,F,H,Q)},t.prototype.emplace=function(r,f,v,g,S,P,F,H,Q,oe){var ve=10*r,Se=5*r;return this.int16[ve+0]=f,this.int16[ve+1]=v,this.int16[ve+2]=g,this.int16[ve+3]=S,this.int16[ve+4]=P,this.int16[ve+5]=F,this.uint32[Se+3]=H,this.uint16[ve+8]=Q,this.uint16[ve+9]=oe,r},t}(Wi);oc.prototype.bytesPerElement=20,Rn("StructArrayLayout6i1ul2ui20",oc);var ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,g,S,P)},t.prototype.emplace=function(r,f,v,g,S,P,F){var H=6*r;return this.int16[H+0]=f,this.int16[H+1]=v,this.int16[H+2]=g,this.int16[H+3]=S,this.int16[H+4]=P,this.int16[H+5]=F,r},t}(Wi);ol.prototype.bytesPerElement=12,Rn("StructArrayLayout2i2i2i12",ol);var sl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S){var P=this.length;return this.resize(P+1),this.emplace(P,r,f,v,g,S)},t.prototype.emplace=function(r,f,v,g,S,P){var F=4*r,H=8*r;return this.float32[F+0]=f,this.float32[F+1]=v,this.float32[F+2]=g,this.int16[H+6]=S,this.int16[H+7]=P,r},t}(Wi);sl.prototype.bytesPerElement=16,Rn("StructArrayLayout2f1f2i16",sl);var ul=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,S){var P=12*r,F=3*r;return this.uint8[P+0]=f,this.uint8[P+1]=v,this.float32[F+1]=g,this.float32[F+2]=S,r},t}(Wi);ul.prototype.bytesPerElement=12,Rn("StructArrayLayout2ub2f12",ul);var Su=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=3*r;return this.uint16[S+0]=f,this.uint16[S+1]=v,this.uint16[S+2]=g,r},t}(Wi);Su.prototype.bytesPerElement=6,Rn("StructArrayLayout3ui6",Su);var Vu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke,bt,it,Dt){var Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke,bt,it,Dt)},t.prototype.emplace=function(r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke,bt,it,Dt,Qt){var mr=24*r,xr=12*r,Nr=48*r;return this.int16[mr+0]=f,this.int16[mr+1]=v,this.uint16[mr+2]=g,this.uint16[mr+3]=S,this.uint32[xr+2]=P,this.uint32[xr+3]=F,this.uint32[xr+4]=H,this.uint16[mr+10]=Q,this.uint16[mr+11]=oe,this.uint16[mr+12]=ve,this.float32[xr+7]=Se,this.float32[xr+8]=We,this.uint8[Nr+36]=Ke,this.uint8[Nr+37]=bt,this.uint8[Nr+38]=it,this.uint32[xr+10]=Dt,this.int16[mr+22]=Qt,r},t}(Wi);Vu.prototype.bytesPerElement=48,Rn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vu);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke,bt,it,Dt,Qt,mr,xr,Nr,un,Cn,ti,Zn,ci,$n,ia){var Ri=this.length;return this.resize(Ri+1),this.emplace(Ri,r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke,bt,it,Dt,Qt,mr,xr,Nr,un,Cn,ti,Zn,ci,$n,ia)},t.prototype.emplace=function(r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke,bt,it,Dt,Qt,mr,xr,Nr,un,Cn,ti,Zn,ci,$n,ia,Ri){var si=34*r,ua=17*r;return this.int16[si+0]=f,this.int16[si+1]=v,this.int16[si+2]=g,this.int16[si+3]=S,this.int16[si+4]=P,this.int16[si+5]=F,this.int16[si+6]=H,this.int16[si+7]=Q,this.uint16[si+8]=oe,this.uint16[si+9]=ve,this.uint16[si+10]=Se,this.uint16[si+11]=We,this.uint16[si+12]=Ke,this.uint16[si+13]=bt,this.uint16[si+14]=it,this.uint16[si+15]=Dt,this.uint16[si+16]=Qt,this.uint16[si+17]=mr,this.uint16[si+18]=xr,this.uint16[si+19]=Nr,this.uint16[si+20]=un,this.uint16[si+21]=Cn,this.uint16[si+22]=ti,this.uint32[ua+12]=Zn,this.float32[ua+13]=ci,this.float32[ua+14]=$n,this.float32[ua+15]=ia,this.float32[ua+16]=Ri,r},t}(Wi);Sc.prototype.bytesPerElement=68,Rn("StructArrayLayout8i15ui1ul4f68",Sc);var Eu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Wi);Eu.prototype.bytesPerElement=4,Rn("StructArrayLayout1f4",Eu);var Fs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=3*r;return this.int16[S+0]=f,this.int16[S+1]=v,this.int16[S+2]=g,r},t}(Wi);Fs.prototype.bytesPerElement=6,Rn("StructArrayLayout3i6",Fs);var kc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=4*r;return this.uint32[2*r+0]=f,this.uint16[S+2]=v,this.uint16[S+3]=g,r},t}(Wi);kc.prototype.bytesPerElement=8,Rn("StructArrayLayout1ul2ui8",kc);var sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.uint16[g+0]=f,this.uint16[g+1]=v,r},t}(Wi);sc.prototype.bytesPerElement=4,Rn("StructArrayLayout2ui4",sc);var Ul=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Wi);Ul.prototype.bytesPerElement=2,Rn("StructArrayLayout1ui2",Ul);var ll=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,S){var P=4*r;return this.float32[P+0]=f,this.float32[P+1]=v,this.float32[P+2]=g,this.float32[P+3]=S,r},t}(Wi);ll.prototype.bytesPerElement=16,Rn("StructArrayLayout4f16",ll);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new $(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(ac);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(oc);Rn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(ac);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(Vu);Rn("PlacedSymbolArray",h);var _=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(ac);_.prototype.size=68;var E=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new _(this,r)},t}(Sc);Rn("SymbolInstanceArray",E);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Eu);Rn("GlyphOffsetArray",T);var k=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Fs);Rn("SymbolLineVertexArray",k);var K=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(ac);K.prototype.size=8;var le=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new K(this,r)},t}(kc);Rn("FeatureIndexArray",le);var Ce=Zi([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Me(e,t){return 256*(e=$t(Math.floor(e),0,255))+$t(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&Ve("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rn("SegmentVector",we);var Ye=Zi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Xe=X(function(e){e.exports=function(t,r){var f,v,g,S,P,F,H,Q;for(v=t.length-(f=3&t.length),g=r,P=3432918353,F=461845907,Q=0;Q<v;)H=255&t.charCodeAt(Q)|(255&t.charCodeAt(++Q))<<8|(255&t.charCodeAt(++Q))<<16|(255&t.charCodeAt(++Q))<<24,++Q,g=27492+(65535&(S=5*(65535&(g=(g^=H=(65535&(H=(H=(65535&H)*P+(((H>>>16)*P&65535)<<16)&4294967295)<<15|H>>>17))*F+(((H>>>16)*F&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(H=0,f){case 3:H^=(255&t.charCodeAt(Q+2))<<16;case 2:H^=(255&t.charCodeAt(Q+1))<<8;case 1:g^=H=(65535&(H=(H=(65535&(H^=255&t.charCodeAt(Q)))*P+(((H>>>16)*P&65535)<<16)&4294967295)<<15|H>>>17))*F+(((H>>>16)*F&65535)<<16)&4294967295}return g^=t.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),st=X(function(e){e.exports=function(t,r){for(var f,v=t.length,g=r^v,S=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++S;switch(v){case 3:g^=(255&t.charCodeAt(S+2))<<16;case 2:g^=(255&t.charCodeAt(S+1))<<8;case 1:g=1540483477*(65535&(g^=255&t.charCodeAt(S)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),je=Xe,ut=st;je.murmur3=Xe,je.murmur2=ut;var At=function(){this.ids=[],this.positions=[],this.indexed=!1};At.prototype.add=function(e,t,r,f){this.ids.push(Sr(e)),this.positions.push(t,r,f)},At.prototype.getPositions=function(e){for(var t=Sr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var g=[];this.ids[r]===t;)g.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return g},At.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(g,S,P,F){for(;P<F;){for(var H=g[P+F>>1],Q=P-1,oe=F+1;;){do Q++;while(g[Q]<H);do oe--;while(g[oe]>H);if(Q>=oe)break;dr(g,Q,oe),dr(S,3*Q,3*oe),dr(S,3*Q+1,3*oe+1),dr(S,3*Q+2,3*oe+2)}oe-P<F-oe?(v(g,S,P,oe),P=oe+1):(v(g,S,oe+1,F),F=oe)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},At.deserialize=function(e){var t=new At;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Yt=Math.pow(2,53)-1;function Sr(e){var t=+e;return!isNaN(t)&&t<=Yt?t:je(String(e))}function dr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Rn("FeaturePositionMap",At);var wr=function(e,t){this.gl=e.gl,this.location=t},Wr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(wr),fn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(wr),nn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(wr),jn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(wr),ui=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(wr),li=function(e){function t(r,f){e.call(this,r,f),this.current=Ki.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(wr),mn=new Float32Array(16),aa=function(e){function t(r,f){e.call(this,r,f),this.current=mn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(wr);function Hn(e){return[Me(255*e.r,255*e.g),Me(255*e.b,255*e.a)]}var xi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};xi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},xi.prototype.getBinding=function(e,t,r){return this.type==="color"?new li(e,t):new fn(e,t)};var Gi=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Gi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Gi.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Gi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ui(e,t):new fn(e,t)};var vi=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};vi.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.paintVertexArray.length,S=this.expression.evaluate(new ta(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(g,e,S)},vi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},vi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Hn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var g=e;g<t;g++)this.paintVertexArray.emplace(g,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},vi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ci=function(e,t,r,f,v,g){this.expression=e,this.uniformNames=t.map(function(S){return"u_"+S+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(S){return{name:"a_"+S,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new g};Ci.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.expression.evaluate(new ta(this.zoom),t,{},f,[],v),S=this.expression.evaluate(new ta(this.zoom+1),t,{},f,[],v),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,g,S)},Ci.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),g=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,g)},Ci.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Hn(r),g=Hn(f),S=e;S<t;S++)this.paintVertexArray.emplace(S,v[0],v[1],g[0],g[1]);else{for(var P=e;P<t;P++)this.paintVertexArray.emplace(P,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},Ci.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ci.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ci.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=$t(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},Ci.prototype.getBinding=function(e,t,r){return new fn(e,t)};var ie=function(e,t,r,f,v,g){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=g,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};ie.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},ie.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},ie.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],g=f[r.mid],S=f[r.max];if(v&&g&&S)for(var P=e;P<t;P++)this.zoomInPaintVertexArray.emplace(P,g.tl[0],g.tl[1],g.br[0],g.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],g.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,g.tl[0],g.tl[1],g.br[0],g.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],g.pixelRatio,S.pixelRatio)}},ie.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ye.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ye.members,this.expression.isStateDependent))},ie.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ne=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var g=e.paint.get(v);if(g instanceof co&&Qs(g.property.specification)){var S=B(v,e.type),P=g.value,F=g.property.specification.type,H=g.property.useIntegerZoom,Q=g.property.specification["property-type"],oe=Q==="cross-faded"||Q==="cross-faded-data-driven";if(P.kind==="constant")this.binders[v]=oe?new Gi(P.value,S):new xi(P.value,S,F),f.push("/u_"+v);else if(P.kind==="source"||oe){var ve=ce(v,F,"source");this.binders[v]=oe?new ie(P,F,H,t,ve,e.id):new vi(P,S,F,ve),f.push("/a_"+v)}else{var Se=ce(v,F,"composite");this.binders[v]=new Ci(P,S,F,H,t,Se),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};ne.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof vi||t instanceof Ci?t.maxValue:0},ne.prototype.populatePaintArrays=function(e,t,r,f,v){for(var g in this.binders){var S=this.binders[g];(S instanceof vi||S instanceof Ci||S instanceof ie)&&S.populatePaintArray(e,t,r,f,v)}},ne.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Gi&&f.setConstantPatternPositions(e,t)}},ne.prototype.updatePaintArrays=function(e,t,r,f,v){var g=!1;for(var S in e)for(var P=0,F=t.getPositions(S);P<F.length;P+=1){var H=F[P],Q=r.feature(H.index);for(var oe in this.binders){var ve=this.binders[oe];if((ve instanceof vi||ve instanceof Ci||ve instanceof ie)&&ve.expression.isStateDependent===!0){var Se=f.paint.get(oe);ve.expression=Se.value,ve.updatePaintArray(H.start,H.end,Q,e[S],v),g=!0}}}return g},ne.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof xi||r instanceof Gi)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},ne.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof vi||r instanceof Ci)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof ie)for(var v=0;v<Ye.members.length;v++)e.push(Ye.members[v].name)}return e},ne.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof xi||r instanceof Gi||r instanceof Ci)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},ne.prototype.getPaintVertexBuffers=function(){return this._buffers},ne.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof xi||v instanceof Gi||v instanceof Ci)for(var g=0,S=v.uniformNames;g<S.length;g+=1){var P=S[g];if(t[P]){var F=v.getBinding(e,t[P],P);r.push({name:P,property:f,binding:F})}}}return r},ne.prototype.setUniforms=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1){var S=g[v],P=S.name,F=S.property;this.binders[F].setUniform(S.binding,f,r.get(F),P)}},ne.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof ie){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof vi||r instanceof Ci)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ne.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof vi||r instanceof Ci||r instanceof ie)&&r.upload(e)}this.updatePaintBuffers()},ne.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof vi||t instanceof Ci||t instanceof ie)&&t.destroy()}};var L=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var g=v[f];this.programConfigurations[g.id]=new ne(g,t,r)}this.needsUpload=!1,this._featureMap=new At,this._bufferOffset=0};function B(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function ce(e,t,r){var f={color:{source:nu,composite:ll},number:{source:Eu,composite:nu}},v=function(g){return{"line-pattern":{source:Ss,composite:Ss},"fill-pattern":{source:Ss,composite:Ss},"fill-extrusion-pattern":{source:Ss,composite:Ss}}[g]}(e);return v&&v[r]||f[t][r]}L.prototype.populatePaintArrays=function(e,t,r,f,v,g){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,t,f,v,g);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},L.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,g=r;v<g.length;v+=1){var S=g[v];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,t,S,f)||this.needsUpload}},L.prototype.get=function(e){return this.programConfigurations[e]},L.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},L.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Rn("ConstantBinder",xi),Rn("CrossFadedConstantBinder",Gi),Rn("SourceExpressionBinder",vi),Rn("CrossFadedCompositeBinder",ie),Rn("CompositeExpressionBinder",Ci),Rn("ProgramConfiguration",ne,{omit:["_buffers"]}),Rn("ProgramConfigurationSet",L);var Ae=Math.pow(2,14)-1,_t=-Ae-1;function Rt(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],g=0;g<v.length;g++){var S=v[g],P=Math.round(S.x*t),F=Math.round(S.y*t);S.x=$t(P,_t,Ae),S.y=$t(F,_t,Ae),(P<S.x||P>S.x+1||F<S.y||F>S.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function wt(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Rt(e):[]}}function hr(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Xr=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ps,this.indexArray=new Su,this.segments=new we,this.programConfigurations=new L(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Qn(e,t){for(var r=0;r<e.length;r++)if(wa(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(wa(e,t[f]))return!0;return!!Li(e,t)}function Wn(e,t,r){return!!wa(e,t)||!!pa(t,e,r)}function fi(e,t){if(e.length===1)return vo(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(wa(e,f[v]))return!0;for(var g=0;g<e.length;g++)if(vo(t,e[g]))return!0;for(var S=0;S<t.length;S++)if(Li(e,t[S]))return!0;return!1}function mi(e,t,r){if(e.length>1){if(Li(e,t))return!0;for(var f=0;f<t.length;f++)if(pa(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(pa(e[v],t,r))return!0;return!1}function Li(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],g=0;g<t.length-1;g++)if(oa(f,v,t[g],t[g+1]))return!0;return!1}function oa(e,t,r,f){return Ot(e,r,f)!==Ot(t,r,f)&&Ot(e,t,r)!==Ot(e,t,f)}function pa(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(Sa(e,t[v-1],t[v])<f)return!0;return!1}function Sa(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function vo(e,t){for(var r,f,v,g=!1,S=0;S<e.length;S++)for(var P=0,F=(r=e[S]).length-1;P<r.length;F=P++)(f=r[P]).y>t.y!=(v=r[F]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(g=!g);return g}function wa(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var g=e[f],S=e[v];g.y>t.y!=S.y>t.y&&t.x<(S.x-g.x)*(t.y-g.y)/(S.y-g.y)+g.x&&(r=!r)}return r}function Fo(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var g=Ot(e,t,r[0]);return g!==Ot(e,t,r[1])||g!==Ot(e,t,r[2])||g!==Ot(e,t,r[3])}function Fa(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ji(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function da(e,t,r,f,v){if(!t[0]&&!t[1])return e;var g=$.convert(t)._mult(v);r==="viewport"&&g._rotate(-f);for(var S=[],P=0;P<e.length;P++)S.push(e[P].sub(g));return S}Xr.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],g=null;f.type==="circle"&&(g=f.layout.get("circle-sort-key"));for(var S=0,P=e;S<P.length;S+=1){var F=P[S],H=F.feature,Q=F.id,oe=F.index,ve=F.sourceLayerIndex,Se=this.layers[0]._featureFilter.needGeometry,We=wt(H,Se);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),We,r)){var Ke=g?g.evaluate(We,{},r):void 0,bt={id:Q,properties:H.properties,type:H.type,sourceLayerIndex:ve,index:oe,geometry:Se?We.geometry:Rt(H),patterns:{},sortKey:Ke};v.push(bt)}}g&&v.sort(function(Cn,ti){return Cn.sortKey-ti.sortKey});for(var it=0,Dt=v;it<Dt.length;it+=1){var Qt=Dt[it],mr=Qt.geometry,xr=Qt.index,Nr=Qt.sourceLayerIndex,un=e[xr].feature;this.addFeature(Qt,mr,xr,r),t.featureIndex.insert(un,mr,xr,Nr,this.index)}},Xr.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Xr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xr.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Xr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xr.prototype.addFeature=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1)for(var S=0,P=g[v];S<P.length;S+=1){var F=P[S],H=F.x,Q=F.y;if(!(H<0||H>=8192||Q<0||Q>=8192)){var oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ve=oe.vertexLength;hr(this.layoutVertexArray,H,Q,-1,-1),hr(this.layoutVertexArray,H,Q,1,-1),hr(this.layoutVertexArray,H,Q,1,1),hr(this.layoutVertexArray,H,Q,-1,1),this.indexArray.emplaceBack(ve,ve+1,ve+2),this.indexArray.emplaceBack(ve,ve+3,ve+2),oe.vertexLength+=4,oe.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Rn("CircleBucket",Xr,{omit:["layers"]});var Ka=new Mo({"circle-sort-key":new Gn(ue.layout_circle["circle-sort-key"])}),mo={paint:new Mo({"circle-radius":new Gn(ue.paint_circle["circle-radius"]),"circle-color":new Gn(ue.paint_circle["circle-color"]),"circle-blur":new Gn(ue.paint_circle["circle-blur"]),"circle-opacity":new Gn(ue.paint_circle["circle-opacity"]),"circle-translate":new Vn(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Vn(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vn(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vn(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gn(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gn(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gn(ue.paint_circle["circle-stroke-opacity"])}),layout:Ka},Mi=typeof Float32Array!="undefined"?Float32Array:Array;function ao(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ga(e,t,r){var f=t[0],v=t[1],g=t[2],S=t[3],P=t[4],F=t[5],H=t[6],Q=t[7],oe=t[8],ve=t[9],Se=t[10],We=t[11],Ke=t[12],bt=t[13],it=t[14],Dt=t[15],Qt=r[0],mr=r[1],xr=r[2],Nr=r[3];return e[0]=Qt*f+mr*P+xr*oe+Nr*Ke,e[1]=Qt*v+mr*F+xr*ve+Nr*bt,e[2]=Qt*g+mr*H+xr*Se+Nr*it,e[3]=Qt*S+mr*Q+xr*We+Nr*Dt,e[4]=(Qt=r[4])*f+(mr=r[5])*P+(xr=r[6])*oe+(Nr=r[7])*Ke,e[5]=Qt*v+mr*F+xr*ve+Nr*bt,e[6]=Qt*g+mr*H+xr*Se+Nr*it,e[7]=Qt*S+mr*Q+xr*We+Nr*Dt,e[8]=(Qt=r[8])*f+(mr=r[9])*P+(xr=r[10])*oe+(Nr=r[11])*Ke,e[9]=Qt*v+mr*F+xr*ve+Nr*bt,e[10]=Qt*g+mr*H+xr*Se+Nr*it,e[11]=Qt*S+mr*Q+xr*We+Nr*Dt,e[12]=(Qt=r[12])*f+(mr=r[13])*P+(xr=r[14])*oe+(Nr=r[15])*Ke,e[13]=Qt*v+mr*F+xr*ve+Nr*bt,e[14]=Qt*g+mr*H+xr*Se+Nr*it,e[15]=Qt*S+mr*Q+xr*We+Nr*Dt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Gs,Zl=Ga;function Bs(e,t,r){var f=t[0],v=t[1],g=t[2],S=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*g+r[12]*S,e[1]=r[1]*f+r[5]*v+r[9]*g+r[13]*S,e[2]=r[2]*f+r[6]*v+r[10]*g+r[14]*S,e[3]=r[3]*f+r[7]*v+r[11]*g+r[15]*S,e}Gs=new Mi(3),Mi!=Float32Array&&(Gs[0]=0,Gs[1]=0,Gs[2]=0),function(){var e=new Mi(4);Mi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Iu=(function(){var e=new Mi(2);Mi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,mo)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Xr(r)},t.prototype.queryRadius=function(r){var f=r;return Fa("circle-radius",this,f)+Fa("circle-stroke-width",this,f)+ji(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,P,F,H){for(var Q=da(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,F),oe=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),ve=this.paint.get("circle-pitch-alignment")==="map",Se=ve?Q:function(un,Cn){return un.map(function(ti){return Ou(ti,Cn)})}(Q,H),We=ve?oe*F:oe,Ke=0,bt=g;Ke<bt.length;Ke+=1)for(var it=0,Dt=bt[Ke];it<Dt.length;it+=1){var Qt=Dt[it],mr=ve?Qt:Ou(Qt,H),xr=We,Nr=Bs([],[Qt.x,Qt.y,0,1],H);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xr*=Nr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xr*=P.cameraToCenterDistance/Nr[3]),Wn(Se,mr,xr))return!0}return!1},t}(ru));function Ou(e,t){var r=Bs([],[e.x,e.y,0,1],t);return new $(r[0]/r[3],r[1]/r[3])}var jl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Xr);function cl(e,t,r,f){var v=t.width,g=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*g*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*g*r);return e.width=v,e.height=g,e.data=f,e}function Vl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var g=cl({},{width:f,height:v},r);uc(e,g,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=g.data}}function uc(e,t,r,f,v,g){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=e.data,P=t.data,F=0;F<v.height;F++)for(var H=((r.y+F)*e.width+r.x)*g,Q=((f.y+F)*t.width+f.x)*g,oe=0;oe<v.width*g;oe++)P[Q+oe]=S[H+oe];return t}Rn("HeatmapBucket",jl,{omit:["layers"]});var Gu=function(e,t){cl(this,e,1,t)};Gu.prototype.resize=function(e){Vl(this,e,1)},Gu.prototype.clone=function(){return new Gu({width:this.width,height:this.height},new Uint8Array(this.data))},Gu.copy=function(e,t,r,f,v){uc(e,t,r,f,v,1)};var cs=function(e,t){cl(this,e,4,t)};cs.prototype.resize=function(e){Vl(this,e,4)},cs.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},cs.prototype.clone=function(){return new cs({width:this.width,height:this.height},new Uint8Array(this.data))},cs.copy=function(e,t,r,f,v){uc(e,t,r,f,v,4)},Rn("AlphaImage",Gu),Rn("RGBAImage",cs);var Rf={paint:new Mo({"heatmap-radius":new Gn(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gn(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vn(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ls(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vn(ue.paint_heatmap["heatmap-opacity"])})};function df(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new cs({width:r,height:f}),g=function(We,Ke,bt){t[e.evaluationKey]=bt;var it=e.expression.evaluate(t);v.data[We+Ke+0]=Math.floor(255*it.r/it.a),v.data[We+Ke+1]=Math.floor(255*it.g/it.a),v.data[We+Ke+2]=Math.floor(255*it.b/it.a),v.data[We+Ke+3]=Math.floor(255*it.a)};if(e.clips)for(var S=0,P=0;S<f;++S,P+=4*r)for(var F=0,H=0;F<r;F++,H+=4){var Q=F/(r-1),oe=e.clips[S];g(P,H,oe.start*(1-Q)+oe.end*Q)}else for(var ve=0,Se=0;ve<r;ve++,Se+=4)g(0,Se,ve/(r-1));return v}var vf=function(e){function t(r){e.call(this,r,Rf),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new jl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=df({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(ru),uh={paint:new Mo({"hillshade-illumination-direction":new Vn(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vn(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vn(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vn(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vn(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vn(ue.paint_hillshade["hillshade-accent-color"])})},lh=function(e){function t(r){e.call(this,r,uh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(ru),ef=Zi([{name:"a_pos",components:2,type:"Int16"}],4).members,Ec=Df,up=Df;function Df(e,t,r){r=r||2;var f,v,g,S,P,F,H,Q=t&&t.length,oe=Q?t[0]*r:e.length,ve=ch(e,0,oe,r,!0),Se=[];if(!ve||ve.next===ve.prev)return Se;if(Q&&(ve=function(Ke,bt,it,Dt){var Qt,mr,xr,Nr=[];for(Qt=0,mr=bt.length;Qt<mr;Qt++)(xr=ch(Ke,bt[Qt]*Dt,Qt<mr-1?bt[Qt+1]*Dt:Ke.length,Dt,!1))===xr.next&&(xr.steiner=!0),Nr.push(Dh(xr));for(Nr.sort(fp),Qt=0;Qt<Nr.length;Qt++)Rh(Nr[Qt],it),it=Gl(it,it.next);return it}(e,t,ve,r)),e.length>80*r){f=g=e[0],v=S=e[1];for(var We=r;We<oe;We+=r)(P=e[We])<f&&(f=P),(F=e[We+1])<v&&(v=F),P>g&&(g=P),F>S&&(S=F);H=(H=Math.max(g-f,S-v))!==0?1/H:0}return tf(ve,Se,r,f,v,H),Se}function ch(e,t,r,f,v){var g,S;if(v===af(e,t,r,f)>0)for(g=t;g<r;g+=f)S=gf(g,e[g],e[g+1],S);else for(g=r-f;g>=t;g-=f)S=gf(g,e[g],e[g+1],S);return S&&kf(S,S.next)&&(Cc(S),S=S.next),S}function Gl(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!kf(f,f.next)&&rs(f.prev,f,f.next)!==0)f=f.next;else{if(Cc(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function tf(e,t,r,f,v,g,S){if(e){!S&&g&&function(Q,oe,ve,Se){var We=Q;do We.z===null&&(We.z=hh(We.x,We.y,oe,ve,Se)),We.prevZ=We.prev,We.nextZ=We.next,We=We.next;while(We!==Q);We.prevZ.nextZ=null,We.prevZ=null,function(Ke){var bt,it,Dt,Qt,mr,xr,Nr,un,Cn=1;do{for(it=Ke,Ke=null,mr=null,xr=0;it;){for(xr++,Dt=it,Nr=0,bt=0;bt<Cn&&(Nr++,Dt=Dt.nextZ);bt++);for(un=Cn;Nr>0||un>0&&Dt;)Nr!==0&&(un===0||!Dt||it.z<=Dt.z)?(Qt=it,it=it.nextZ,Nr--):(Qt=Dt,Dt=Dt.nextZ,un--),mr?mr.nextZ=Qt:Ke=Qt,Qt.prevZ=mr,mr=Qt;it=Dt}mr.nextZ=null,Cn*=2}while(xr>1)}(We)}(e,f,v,g);for(var P,F,H=e;e.prev!==e.next;)if(P=e.prev,F=e.next,g?rf(e,f,v,g):lp(e))t.push(P.i/r),t.push(e.i/r),t.push(F.i/r),Cc(e),e=F.next,H=F.next;else if((e=F)===H){S?S===1?tf(e=fh(Gl(e),t,r),t,r,f,v,g,2):S===2&&cp(e,t,r,f,v,g):tf(Gl(e),t,r,f,v,g,1);break}}}function lp(e){var t=e.prev,r=e,f=e.next;if(rs(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(nf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&rs(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function rf(e,t,r,f){var v=e.prev,g=e,S=e.next;if(rs(v,g,S)>=0)return!1;for(var P=v.x>g.x?v.x>S.x?v.x:S.x:g.x>S.x?g.x:S.x,F=v.y>g.y?v.y>S.y?v.y:S.y:g.y>S.y?g.y:S.y,H=hh(v.x<g.x?v.x<S.x?v.x:S.x:g.x<S.x?g.x:S.x,v.y<g.y?v.y<S.y?v.y:S.y:g.y<S.y?g.y:S.y,t,r,f),Q=hh(P,F,t,r,f),oe=e.prevZ,ve=e.nextZ;oe&&oe.z>=H&&ve&&ve.z<=Q;){if(oe!==e.prev&&oe!==e.next&&nf(v.x,v.y,g.x,g.y,S.x,S.y,oe.x,oe.y)&&rs(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ve!==e.prev&&ve!==e.next&&nf(v.x,v.y,g.x,g.y,S.x,S.y,ve.x,ve.y)&&rs(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;oe&&oe.z>=H;){if(oe!==e.prev&&oe!==e.next&&nf(v.x,v.y,g.x,g.y,S.x,S.y,oe.x,oe.y)&&rs(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ve&&ve.z<=Q;){if(ve!==e.prev&&ve!==e.next&&nf(v.x,v.y,g.x,g.y,S.x,S.y,ve.x,ve.y)&&rs(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function fh(e,t,r){var f=e;do{var v=f.prev,g=f.next.next;!kf(v,g)&&ph(v,f,f.next,g)&&Fc(v,g)&&Fc(g,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(g.i/r),Cc(f),Cc(f.next),f=e=g),f=f.next}while(f!==e);return Gl(f)}function cp(e,t,r,f,v,g){var S=e;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&pp(S,P)){var F=mf(S,P);return S=Gl(S,S.next),F=Gl(F,F.next),tf(S,t,r,f,v,g),void tf(F,t,r,f,v,g)}P=P.next}S=S.next}while(S!==e)}function fp(e,t){return e.x-t.x}function Rh(e,t){if(t=function(f,v){var g,S=v,P=f.x,F=f.y,H=-1/0;do{if(F<=S.y&&F>=S.next.y&&S.next.y!==S.y){var Q=S.x+(F-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Q<=P&&Q>H){if(H=Q,Q===P){if(F===S.y)return S;if(F===S.next.y)return S.next}g=S.x<S.next.x?S:S.next}}S=S.next}while(S!==v);if(!g)return null;if(P===H)return g;var oe,ve=g,Se=g.x,We=g.y,Ke=1/0;S=g;do P>=S.x&&S.x>=Se&&P!==S.x&&nf(F<We?P:H,F,Se,We,F<We?H:P,F,S.x,S.y)&&(oe=Math.abs(F-S.y)/(P-S.x),Fc(S,f)&&(oe<Ke||oe===Ke&&(S.x>g.x||S.x===g.x&&hp(g,S)))&&(g=S,Ke=oe)),S=S.next;while(S!==ve);return g}(e,t)){var r=mf(t,e);Gl(t,t.next),Gl(r,r.next)}}function hp(e,t){return rs(e.prev,e,t.prev)<0&&rs(t.next,e,e.next)<0}function hh(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function nf(e,t,r,f,v,g,S,P){return(v-S)*(t-P)-(e-S)*(g-P)>=0&&(e-S)*(f-P)-(r-S)*(t-P)>=0&&(r-S)*(g-P)-(v-S)*(f-P)>=0}function pp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&ph(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Fc(e,t)&&Fc(t,e)&&function(r,f){var v=r,g=!1,S=(r.x+f.x)/2,P=(r.y+f.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&S<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(g=!g),v=v.next;while(v!==r);return g}(e,t)&&(rs(e.prev,e,t.prev)||rs(e,t.prev,t))||kf(e,t)&&rs(e.prev,e,e.next)>0&&rs(t.prev,t,t.next)>0)}function rs(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function kf(e,t){return e.x===t.x&&e.y===t.y}function ph(e,t,r,f){var v=Bf(rs(e,t,r)),g=Bf(rs(e,t,f)),S=Bf(rs(r,f,e)),P=Bf(rs(r,f,t));return v!==g&&S!==P||!(v!==0||!Ff(e,r,t))||!(g!==0||!Ff(e,f,t))||!(S!==0||!Ff(r,e,f))||!(P!==0||!Ff(r,t,f))}function Ff(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Bf(e){return e>0?1:e<0?-1:0}function Fc(e,t){return rs(e.prev,e,e.next)<0?rs(e,t,e.next)>=0&&rs(e,e.prev,t)>=0:rs(e,t,e.prev)<0||rs(e,e.next,t)<0}function mf(e,t){var r=new yf(e.i,e.x,e.y),f=new yf(t.i,t.x,t.y),v=e.next,g=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,g.next=f,f.prev=g,f}function gf(e,t,r,f){var v=new yf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Cc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function yf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function af(e,t,r,f){for(var v=0,g=t,S=r-f;g<r;g+=f)v+=(e[S]-e[g])*(e[g+1]+e[S+1]),S=g;return v}function Nf(e,t,r,f,v){(function g(S,P,F,H,Q){for(;H>F;){if(H-F>600){var oe=H-F+1,ve=P-F+1,Se=Math.log(oe),We=.5*Math.exp(2*Se/3),Ke=.5*Math.sqrt(Se*We*(oe-We)/oe)*(ve-oe/2<0?-1:1);g(S,P,Math.max(F,Math.floor(P-ve*We/oe+Ke)),Math.min(H,Math.floor(P+(oe-ve)*We/oe+Ke)),Q)}var bt=S[P],it=F,Dt=H;for(lc(S,F,P),Q(S[H],bt)>0&&lc(S,F,H);it<Dt;){for(lc(S,it,Dt),it++,Dt--;Q(S[it],bt)<0;)it++;for(;Q(S[Dt],bt)>0;)Dt--}Q(S[F],bt)===0?lc(S,F,Dt):lc(S,++Dt,H),Dt<=P&&(F=Dt+1),P<=Dt&&(H=Dt-1)}})(e,t,r||0,f||e.length-1,v||dh)}function lc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function dh(e,t){return e<t?-1:e>t?1:0}function of(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,g=[],S=0;S<r;S++){var P=pr(e[S]);P!==0&&(e[S].area=Math.abs(P),v===void 0&&(v=P<0),v===P<0?(f&&g.push(f),f=[e[S]]):f.push(e[S]))}if(f&&g.push(f),t>1)for(var F=0;F<g.length;F++)g[F].length<=t||(Nf(g[F],t,1,g[F].length-1,zf),g[F]=g[F].slice(0,t));return g}function zf(e,t){return t.area-e.area}function sf(e,t,r){for(var f=r.patternDependencies,v=!1,g=0,S=t;g<S.length;g+=1){var P=S[g].paint.get(e+"-pattern");P.isConstant()||(v=!0);var F=P.constantOr(null);F&&(v=!0,f[F.to]=!0,f[F.from]=!0)}return v}function Bc(e,t,r,f,v){for(var g=v.patternDependencies,S=0,P=t;S<P.length;S+=1){var F=P[S],H=F.paint.get(e+"-pattern").value;if(H.kind!=="constant"){var Q=H.evaluate({zoom:f-1},r,{},v.availableImages),oe=H.evaluate({zoom:f},r,{},v.availableImages),ve=H.evaluate({zoom:f+1},r,{},v.availableImages);oe=oe&&oe.name?oe.name:oe,ve=ve&&ve.name?ve.name:ve,g[Q=Q&&Q.name?Q.name:Q]=!0,g[oe]=!0,g[ve]=!0,r.patterns[F.id]={min:Q,mid:oe,max:ve}}}return r}Df.deviation=function(e,t,r,f){var v=t&&t.length,g=Math.abs(af(e,0,v?t[0]*r:e.length,r));if(v)for(var S=0,P=t.length;S<P;S++)g-=Math.abs(af(e,t[S]*r,S<P-1?t[S+1]*r:e.length,r));var F=0;for(S=0;S<f.length;S+=3){var H=f[S]*r,Q=f[S+1]*r,oe=f[S+2]*r;F+=Math.abs((e[H]-e[oe])*(e[Q+1]-e[H+1])-(e[H]-e[Q])*(e[oe+1]-e[H+1]))}return g===0&&F===0?0:Math.abs((F-g)/g)},Df.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var g=0;g<e[v].length;g++)for(var S=0;S<t;S++)r.vertices.push(e[v][g][S]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Ec.default=up;var pu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ps,this.indexArray=new Su,this.indexArray2=new sc,this.programConfigurations=new L(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};pu.prototype.populate=function(e,t,r){this.hasPattern=sf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],g=0,S=e;g<S.length;g+=1){var P=S[g],F=P.feature,H=P.id,Q=P.index,oe=P.sourceLayerIndex,ve=this.layers[0]._featureFilter.needGeometry,Se=wt(F,ve);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),Se,r)){var We=f?f.evaluate(Se,{},r,t.availableImages):void 0,Ke={id:H,properties:F.properties,type:F.type,sourceLayerIndex:oe,index:Q,geometry:ve?Se.geometry:Rt(F),patterns:{},sortKey:We};v.push(Ke)}}f&&v.sort(function(un,Cn){return un.sortKey-Cn.sortKey});for(var bt=0,it=v;bt<it.length;bt+=1){var Dt=it[bt],Qt=Dt.geometry,mr=Dt.index,xr=Dt.sourceLayerIndex;if(this.hasPattern){var Nr=Bc("fill",this.layers,Dt,this.zoom,t);this.patternFeatures.push(Nr)}else this.addFeature(Dt,Qt,mr,r,{});t.featureIndex.insert(e[mr].feature,Qt,mr,xr,this.index)}},pu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},pu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},pu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},pu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},pu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},pu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},pu.prototype.addFeature=function(e,t,r,f,v){for(var g=0,S=of(t,500);g<S.length;g+=1){for(var P=S[g],F=0,H=0,Q=P;H<Q.length;H+=1)F+=Q[H].length;for(var oe=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),ve=oe.vertexLength,Se=[],We=[],Ke=0,bt=P;Ke<bt.length;Ke+=1){var it=bt[Ke];if(it.length!==0){it!==P[0]&&We.push(Se.length/2);var Dt=this.segments2.prepareSegment(it.length,this.layoutVertexArray,this.indexArray2),Qt=Dt.vertexLength;this.layoutVertexArray.emplaceBack(it[0].x,it[0].y),this.indexArray2.emplaceBack(Qt+it.length-1,Qt),Se.push(it[0].x),Se.push(it[0].y);for(var mr=1;mr<it.length;mr++)this.layoutVertexArray.emplaceBack(it[mr].x,it[mr].y),this.indexArray2.emplaceBack(Qt+mr-1,Qt+mr),Se.push(it[mr].x),Se.push(it[mr].y);Dt.vertexLength+=it.length,Dt.primitiveLength+=it.length}}for(var xr=Ec(Se,We),Nr=0;Nr<xr.length;Nr+=3)this.indexArray.emplaceBack(ve+xr[Nr],ve+xr[Nr+1],ve+xr[Nr+2]);oe.vertexLength+=F,oe.primitiveLength+=xr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Rn("FillBucket",pu,{omit:["layers","patternFeatures"]});var cc=new Mo({"fill-sort-key":new Gn(ue.layout_fill["fill-sort-key"])}),_f={paint:new Mo({"fill-antialias":new Vn(ue.paint_fill["fill-antialias"]),"fill-opacity":new Gn(ue.paint_fill["fill-opacity"]),"fill-color":new Gn(ue.paint_fill["fill-color"]),"fill-outline-color":new Gn(ue.paint_fill["fill-outline-color"]),"fill-translate":new Vn(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Vn(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new il(ue.paint_fill["fill-pattern"])}),layout:cc},xf=function(e){function t(r){e.call(this,r,_f)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new pu(r)},t.prototype.queryRadius=function(){return ji(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,P,F){return fi(da(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,F),g)},t.prototype.isTileClipped=function(){return!0},t}(ru),Uf=Zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,uf=fl;function fl(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(kh,this,t)}function kh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var g=f.readVarint()+f.pos;f.pos<g;){var S=v._keys[f.readVarint()],P=v._values[f.readVarint()];v.properties[S]=P}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Zf(e){for(var t,r,f=0,v=0,g=e.length,S=g-1;v<g;S=v++)f+=((r=e[S]).x-(t=e[v]).x)*(t.y+r.y);return f}fl.types=["Unknown","Point","LineString","Polygon"],fl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,g=0,S=0,P=[];e.pos<r;){if(v<=0){var F=e.readVarint();f=7&F,v=F>>3}if(v--,f===1||f===2)g+=e.readSVarint(),S+=e.readSVarint(),f===1&&(t&&P.push(t),t=[]),t.push(new $(g,S));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&P.push(t),P},fl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,g=0,S=1/0,P=-1/0,F=1/0,H=-1/0;e.pos<t;){if(f<=0){var Q=e.readVarint();r=7&Q,f=Q>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<S&&(S=v),v>P&&(P=v),(g+=e.readSVarint())<F&&(F=g),g>H&&(H=g);else if(r!==7)throw new Error("unknown command "+r)}return[S,F,P,H]},fl.prototype.toGeoJSON=function(e,t,r){var f,v,g=this.extent*Math.pow(2,r),S=this.extent*e,P=this.extent*t,F=this.loadGeometry(),H=fl.types[this.type];function Q(Se){for(var We=0;We<Se.length;We++){var Ke=Se[We];Se[We]=[360*(Ke.x+S)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ke.y+P)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var oe=[];for(f=0;f<F.length;f++)oe[f]=F[f][0];Q(F=oe);break;case 2:for(f=0;f<F.length;f++)Q(F[f]);break;case 3:for(F=function(Se){var We=Se.length;if(We<=1)return[Se];for(var Ke,bt,it=[],Dt=0;Dt<We;Dt++){var Qt=Zf(Se[Dt]);Qt!==0&&(bt===void 0&&(bt=Qt<0),bt===Qt<0?(Ke&&it.push(Ke),Ke=[Se[Dt]]):Ke.push(Se[Dt]))}return Ke&&it.push(Ke),it}(F),f=0;f<F.length;f++)for(v=0;v<F[f].length;v++)Q(F[f][v])}F.length===1?F=F[0]:H="Multi"+H;var ve={type:"Feature",geometry:{type:H,coordinates:F},properties:this.properties};return"id"in this&&(ve.id=this.id),ve};var Fh=vh;function vh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Bh,this,t),this.length=this._features.length}function Bh(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,g=f.readVarint()+f.pos;f.pos<g;){var S=f.readVarint()>>3;v=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return v}(r))}function fc(e,t,r){if(e===3){var f=new Fh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}vh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new uf(this._pbf,t,this.extent,this._keys,this._values)};var wc={VectorTile:function(e,t){this.layers=e.readFields(fc,{},t)},VectorTileFeature:uf,VectorTileLayer:Fh},Nh=wc.VectorTileFeature.types,jf=Math.pow(2,13);function bf(e,t,r,f,v,g,S,P){e.emplaceBack(t,r,2*Math.floor(f*jf)+S,v*jf*2,g*jf*2,Math.round(P))}var hl=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ms,this.indexArray=new Su,this.programConfigurations=new L(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function dp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}hl.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=sf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var g=v[f],S=g.feature,P=g.id,F=g.index,H=g.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,oe=wt(S,Q);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),oe,r)){var ve={id:P,sourceLayerIndex:H,index:F,geometry:Q?oe.geometry:Rt(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Bc("fill-extrusion",this.layers,ve,this.zoom,t)):this.addFeature(ve,ve.geometry,F,r,{}),t.featureIndex.insert(S,ve.geometry,F,H,this.index,!0)}}},hl.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},hl.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},hl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hl.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Uf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},hl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hl.prototype.addFeature=function(e,t,r,f,v){for(var g=0,S=of(t,500);g<S.length;g+=1){for(var P=S[g],F=0,H=0,Q=P;H<Q.length;H+=1)F+=Q[H].length;for(var oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ve=0,Se=P;ve<Se.length;ve+=1){var We=Se[ve];if(We.length!==0&&!((ua=We).every(function(Hi){return Hi.x<0})||ua.every(function(Hi){return Hi.x>8192})||ua.every(function(Hi){return Hi.y<0})||ua.every(function(Hi){return Hi.y>8192})))for(var Ke=0,bt=0;bt<We.length;bt++){var it=We[bt];if(bt>=1){var Dt=We[bt-1];if(!dp(it,Dt)){oe.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Qt=it.sub(Dt)._perp()._unit(),mr=Dt.dist(it);Ke+mr>32768&&(Ke=0),bf(this.layoutVertexArray,it.x,it.y,Qt.x,Qt.y,0,0,Ke),bf(this.layoutVertexArray,it.x,it.y,Qt.x,Qt.y,0,1,Ke),bf(this.layoutVertexArray,Dt.x,Dt.y,Qt.x,Qt.y,0,0,Ke+=mr),bf(this.layoutVertexArray,Dt.x,Dt.y,Qt.x,Qt.y,0,1,Ke);var xr=oe.vertexLength;this.indexArray.emplaceBack(xr,xr+2,xr+1),this.indexArray.emplaceBack(xr+1,xr+2,xr+3),oe.vertexLength+=4,oe.primitiveLength+=2}}}}if(oe.vertexLength+F>we.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),Nh[e.type]==="Polygon"){for(var Nr=[],un=[],Cn=oe.vertexLength,ti=0,Zn=P;ti<Zn.length;ti+=1){var ci=Zn[ti];if(ci.length!==0){ci!==P[0]&&un.push(Nr.length/2);for(var $n=0;$n<ci.length;$n++){var ia=ci[$n];bf(this.layoutVertexArray,ia.x,ia.y,0,0,1,1,0),Nr.push(ia.x),Nr.push(ia.y)}}}for(var Ri=Ec(Nr,un),si=0;si<Ri.length;si+=3)this.indexArray.emplaceBack(Cn+Ri[si],Cn+Ri[si+2],Cn+Ri[si+1]);oe.primitiveLength+=Ri.length/3,oe.vertexLength+=F}}var ua;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Rn("FillExtrusionBucket",hl,{omit:["layers","features"]});var Hl={paint:new Mo({"fill-extrusion-opacity":new Vn(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gn(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vn(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vn(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new il(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gn(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gn(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vn(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},mh=function(e){function t(r){e.call(this,r,Hl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new hl(r)},t.prototype.queryRadius=function(){return ji(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,P,F,H){var Q=da(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,F),oe=this.paint.get("fill-extrusion-height").evaluate(f,v),ve=this.paint.get("fill-extrusion-base").evaluate(f,v),Se=function(Ke,bt,it,Dt){for(var Qt=[],mr=0,xr=Ke;mr<xr.length;mr+=1){var Nr=xr[mr],un=[Nr.x,Nr.y,0,1];Bs(un,un,bt),Qt.push(new $(un[0]/un[3],un[1]/un[3]))}return Qt}(Q,H),We=function(Ke,bt,it,Dt){for(var Qt=[],mr=[],xr=Dt[8]*bt,Nr=Dt[9]*bt,un=Dt[10]*bt,Cn=Dt[11]*bt,ti=Dt[8]*it,Zn=Dt[9]*it,ci=Dt[10]*it,$n=Dt[11]*it,ia=0,Ri=Ke;ia<Ri.length;ia+=1){for(var si=[],ua=[],Hi=0,Ea=Ri[ia];Hi<Ea.length;Hi+=1){var di=Ea[Hi],La=di.x,Ha=di.y,No=Dt[0]*La+Dt[4]*Ha+Dt[12],So=Dt[1]*La+Dt[5]*Ha+Dt[13],Oo=Dt[2]*La+Dt[6]*Ha+Dt[14],Ko=Dt[3]*La+Dt[7]*Ha+Dt[15],jo=Oo+un,Ls=Ko+Cn,du=No+ti,Hs=So+Zn,wu=Oo+ci,ds=Ko+$n,Ws=new $((No+xr)/Ls,(So+Nr)/Ls);Ws.z=jo/Ls,si.push(Ws);var xa=new $(du/ds,Hs/ds);xa.z=wu/ds,ua.push(xa)}Qt.push(si),mr.push(ua)}return[Qt,mr]}(g,ve,oe,H);return function(Ke,bt,it){var Dt=1/0;fi(it,bt)&&(Dt=hc(it,bt[0]));for(var Qt=0;Qt<bt.length;Qt++)for(var mr=bt[Qt],xr=Ke[Qt],Nr=0;Nr<mr.length-1;Nr++){var un=mr[Nr],Cn=[un,mr[Nr+1],xr[Nr+1],xr[Nr],un];Qn(it,Cn)&&(Dt=Math.min(Dt,hc(it,Cn)))}return Dt!==1/0&&Dt}(We[0],We[1],Se)},t}(ru);function Wl(e,t){return e.x*t.x+e.y*t.y}function hc(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var g=t[f],S=e[0],P=r.sub(v),F=g.sub(v),H=S.sub(v),Q=Wl(P,P),oe=Wl(P,F),ve=Wl(F,F),Se=Wl(H,P),We=Wl(H,F),Ke=Q*ve-oe*oe,bt=(ve*Se-oe*We)/Ke,it=(Q*We-oe*Se)/Ke,Dt=v.z*(1-bt-it)+r.z*bt+g.z*it;if(isFinite(Dt))return Dt}return 1/0}for(var Qt=1/0,mr=0,xr=t;mr<xr.length;mr+=1)Qt=Math.min(Qt,xr[mr].z);return Qt}var gh=Zi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Vf=Zi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Sf=wc.VectorTileFeature.types,yh=Math.cos(Math.PI/180*37.5),Es=Math.pow(2,14)/.5,Wo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Va,this.layoutVertexArray2=new nu,this.indexArray=new Su,this.programConfigurations=new L(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Wo.prototype.populate=function(e,t,r){this.hasPattern=sf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],g=0,S=e;g<S.length;g+=1){var P=S[g],F=P.feature,H=P.id,Q=P.index,oe=P.sourceLayerIndex,ve=this.layers[0]._featureFilter.needGeometry,Se=wt(F,ve);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),Se,r)){var We=f?f.evaluate(Se,{},r):void 0,Ke={id:H,properties:F.properties,type:F.type,sourceLayerIndex:oe,index:Q,geometry:ve?Se.geometry:Rt(F),patterns:{},sortKey:We};v.push(Ke)}}f&&v.sort(function(un,Cn){return un.sortKey-Cn.sortKey});for(var bt=0,it=v;bt<it.length;bt+=1){var Dt=it[bt],Qt=Dt.geometry,mr=Dt.index,xr=Dt.sourceLayerIndex;if(this.hasPattern){var Nr=Bc("line",this.layers,Dt,this.zoom,t);this.patternFeatures.push(Nr)}else this.addFeature(Dt,Qt,mr,r,{});t.featureIndex.insert(e[mr].feature,Qt,mr,xr,this.index)}},Wo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Wo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Wo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Vf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Wo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Wo.prototype.addFeature=function(e,t,r,f,v){var g=this.layers[0].layout,S=g.get("line-join").evaluate(e,{}),P=g.get("line-cap"),F=g.get("line-miter-limit"),H=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var Q=0,oe=t;Q<oe.length;Q+=1)this.addLine(oe[Q],e,S,P,F,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Wo.prototype.addLine=function(e,t,r,f,v,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<e.length-1;S++)this.totalDistance+=e[S].dist(e[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Sf[t.type]==="Polygon",F=e.length;F>=2&&e[F-1].equals(e[F-2]);)F--;for(var H=0;H<F-1&&e[H].equals(e[H+1]);)H++;if(!(F<(P?3:2))){r==="bevel"&&(v=1.05);var Q,oe=this.overscaling<=16?122880/(512*this.overscaling):0,ve=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),Se=void 0,We=void 0,Ke=void 0,bt=void 0;this.e1=this.e2=-1,P&&(bt=e[H].sub(Q=e[F-2])._unit()._perp());for(var it=H;it<F;it++)if(!(We=it===F-1?P?e[H+1]:void 0:e[it+1])||!e[it].equals(We)){bt&&(Ke=bt),Q&&(Se=Q),Q=e[it],bt=We?We.sub(Q)._unit()._perp():Ke;var Dt=(Ke=Ke||bt).add(bt);Dt.x===0&&Dt.y===0||Dt._unit();var Qt=Ke.x*bt.x+Ke.y*bt.y,mr=Dt.x*bt.x+Dt.y*bt.y,xr=mr!==0?1/mr:1/0,Nr=2*Math.sqrt(2-2*mr),un=mr<yh&&Se&&We,Cn=Ke.x*bt.y-Ke.y*bt.x>0;if(un&&it>H){var ti=Q.dist(Se);if(ti>2*oe){var Zn=Q.sub(Q.sub(Se)._mult(oe/ti)._round());this.updateDistance(Se,Zn),this.addCurrentVertex(Zn,Ke,0,0,ve),Se=Zn}}var ci=Se&&We,$n=ci?r:P?"butt":f;if(ci&&$n==="round"&&(xr<g?$n="miter":xr<=2&&($n="fakeround")),$n==="miter"&&xr>v&&($n="bevel"),$n==="bevel"&&(xr>2&&($n="flipbevel"),xr<v&&($n="miter")),Se&&this.updateDistance(Se,Q),$n==="miter")Dt._mult(xr),this.addCurrentVertex(Q,Dt,0,0,ve);else if($n==="flipbevel"){if(xr>100)Dt=bt.mult(-1);else{var ia=xr*Ke.add(bt).mag()/Ke.sub(bt).mag();Dt._perp()._mult(ia*(Cn?-1:1))}this.addCurrentVertex(Q,Dt,0,0,ve),this.addCurrentVertex(Q,Dt.mult(-1),0,0,ve)}else if($n==="bevel"||$n==="fakeround"){var Ri=-Math.sqrt(xr*xr-1),si=Cn?Ri:0,ua=Cn?0:Ri;if(Se&&this.addCurrentVertex(Q,Ke,si,ua,ve),$n==="fakeround")for(var Hi=Math.round(180*Nr/Math.PI/20),Ea=1;Ea<Hi;Ea++){var di=Ea/Hi;if(di!==.5){var La=di-.5;di+=di*La*(di-1)*((1.0904+Qt*(Qt*(3.55645-1.43519*Qt)-3.2452))*La*La+(.848013+Qt*(.215638*Qt-1.06021)))}var Ha=bt.sub(Ke)._mult(di)._add(Ke)._unit()._mult(Cn?-1:1);this.addHalfVertex(Q,Ha.x,Ha.y,!1,Cn,0,ve)}We&&this.addCurrentVertex(Q,bt,-si,-ua,ve)}else if($n==="butt")this.addCurrentVertex(Q,Dt,0,0,ve);else if($n==="square"){var No=Se?1:-1;this.addCurrentVertex(Q,Dt,No,No,ve)}else $n==="round"&&(Se&&(this.addCurrentVertex(Q,Ke,0,0,ve),this.addCurrentVertex(Q,Ke,1,1,ve,!0)),We&&(this.addCurrentVertex(Q,bt,-1,-1,ve,!0),this.addCurrentVertex(Q,bt,0,0,ve)));if(un&&it<F-1){var So=Q.dist(We);if(So>2*oe){var Oo=Q.add(We.sub(Q)._mult(oe/So)._round());this.updateDistance(Q,Oo),this.addCurrentVertex(Oo,bt,0,0,ve),Q=Oo}}}}},Wo.prototype.addCurrentVertex=function(e,t,r,f,v,g){g===void 0&&(g=!1);var S=t.y*f-t.x,P=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,g,!1,r,v),this.addHalfVertex(e,S,P,g,!0,-f,v),this.distance>Es/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,g))},Wo.prototype.addHalfVertex=function(e,t,r,f,v,g,S){var P=.5*(this.lineClips?this.scaledDistance*(Es-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(g===0?0:g<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),S.primitiveLength++),v?this.e2=F:this.e1=F},Wo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Wo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Rn("LineBucket",Wo,{omit:["layers","patternFeatures"]});var fs=new Mo({"line-cap":new Vn(ue.layout_line["line-cap"]),"line-join":new Gn(ue.layout_line["line-join"]),"line-miter-limit":new Vn(ue.layout_line["line-miter-limit"]),"line-round-limit":new Vn(ue.layout_line["line-round-limit"]),"line-sort-key":new Gn(ue.layout_line["line-sort-key"])}),Cu={paint:new Mo({"line-opacity":new Gn(ue.paint_line["line-opacity"]),"line-color":new Gn(ue.paint_line["line-color"]),"line-translate":new Vn(ue.paint_line["line-translate"]),"line-translate-anchor":new Vn(ue.paint_line["line-translate-anchor"]),"line-width":new Gn(ue.paint_line["line-width"]),"line-gap-width":new Gn(ue.paint_line["line-gap-width"]),"line-offset":new Gn(ue.paint_line["line-offset"]),"line-blur":new Gn(ue.paint_line["line-blur"]),"line-dasharray":new ts(ue.paint_line["line-dasharray"]),"line-pattern":new il(ue.paint_line["line-pattern"]),"line-gradient":new ls(ue.paint_line["line-gradient"])}),layout:fs},_h=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new ta(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,g){return f=Lt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,g)},t}(Gn))(Cu.paint.properties["line-width"].specification);_h.useIntegerZoom=!0;var vp=function(e){function t(r){e.call(this,r,Cu),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof As,this.gradientVersion=(this.gradientVersion+1)%Ie)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=_h.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Wo(r)},t.prototype.queryRadius=function(r){var f=r,v=zh(Fa("line-width",this,f),Fa("line-gap-width",this,f)),g=Fa("line-offset",this,f);return v/2+Math.abs(g)+ji(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,P,F){var H=da(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,F),Q=F/2*zh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),oe=this.paint.get("line-offset").evaluate(f,v);return oe&&(g=function(ve,Se){for(var We=[],Ke=new $(0,0),bt=0;bt<ve.length;bt++){for(var it=ve[bt],Dt=[],Qt=0;Qt<it.length;Qt++){var mr=it[Qt],xr=it[Qt+1],Nr=Qt===0?Ke:mr.sub(it[Qt-1])._unit()._perp(),un=Qt===it.length-1?Ke:xr.sub(mr)._unit()._perp(),Cn=Nr._add(un)._unit();Cn._mult(1/(Cn.x*un.x+Cn.y*un.y)),Dt.push(Cn._mult(Se)._add(mr))}We.push(Dt)}return We}(g,oe*F)),function(ve,Se,We){for(var Ke=0;Ke<Se.length;Ke++){var bt=Se[Ke];if(ve.length>=3){for(var it=0;it<bt.length;it++)if(wa(ve,bt[it]))return!0}if(mi(ve,bt,We))return!0}return!1}(H,g,Q)},t.prototype.isTileClipped=function(){return!0},t}(ru);function zh(e,t){return t>0?t+2*e:e}var mp=Zi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gp=Zi([{name:"a_projected_pos",components:3,type:"Float32"}],4),Uh=(Zi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Zi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Zh=(Zi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),yp=Zi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function _p(e,t,r){return e.sections.forEach(function(f){f.text=function(v,g,S){var P=g.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),Po.applyArabicShaping&&(v=Po.applyArabicShaping(v)),v}(f.text,t,r)}),e}Zi([{name:"triangle",components:3,type:"Uint16"}]),Zi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Zi([{type:"Float32",name:"offsetX"}]),Zi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},jh=function(e,t,r,f,v){var g,S,P=8*v-f-1,F=(1<<P)-1,H=F>>1,Q=-7,oe=r?v-1:0,ve=r?-1:1,Se=e[t+oe];for(oe+=ve,g=Se&(1<<-Q)-1,Se>>=-Q,Q+=P;Q>0;g=256*g+e[t+oe],oe+=ve,Q-=8);for(S=g&(1<<-Q)-1,g>>=-Q,Q+=f;Q>0;S=256*S+e[t+oe],oe+=ve,Q-=8);if(g===0)g=1-H;else{if(g===F)return S?NaN:1/0*(Se?-1:1);S+=Math.pow(2,f),g-=H}return(Se?-1:1)*S*Math.pow(2,g-f)},xh=function(e,t,r,f,v,g){var S,P,F,H=8*g-v-1,Q=(1<<H)-1,oe=Q>>1,ve=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,Se=f?0:g-1,We=f?1:-1,Ke=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(P=isNaN(t)?1:0,S=Q):(S=Math.floor(Math.log(t)/Math.LN2),t*(F=Math.pow(2,-S))<1&&(S--,F*=2),(t+=S+oe>=1?ve/F:ve*Math.pow(2,1-oe))*F>=2&&(S++,F/=2),S+oe>=Q?(P=0,S=Q):S+oe>=1?(P=(t*F-1)*Math.pow(2,v),S+=oe):(P=t*Math.pow(2,oe-1)*Math.pow(2,v),S=0));v>=8;e[r+Se]=255&P,Se+=We,P/=256,v-=8);for(S=S<<v|P,H+=v;H>0;e[r+Se]=255&S,Se+=We,S/=256,H-=8);e[r+Se-We]|=128*Ke},Cf=$a;function $a(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}$a.Varint=0,$a.Fixed64=1,$a.Bytes=2,$a.Fixed32=5;var Vh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Xl(e){return e.type===$a.Bytes?e.readVarint()+e.pos:e.pos+1}function Nc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Gh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function V(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Oe(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function et(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function cr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Br(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function or(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Ir(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Hr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Jr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function en(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function tn(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function on(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function xn(e,t,r){e===1&&r.readMessage($r,t)}function $r(e,t,r){if(e===3){var f=r.readMessage(sn,{}),v=f.width,g=f.height,S=f.left,P=f.top,F=f.advance;t.push({id:f.id,bitmap:new Gu({width:v+6,height:g+6},f.bitmap),metrics:{width:v,height:g,left:S,top:P,advance:F}})}}function sn(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Zt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var g=v[f];t+=g.w*g.h,r=Math.max(r,g.w)}e.sort(function(Ke,bt){return bt.h-Ke.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],P=0,F=0,H=0,Q=e;H<Q.length;H+=1)for(var oe=Q[H],ve=S.length-1;ve>=0;ve--){var Se=S[ve];if(!(oe.w>Se.w||oe.h>Se.h)){if(oe.x=Se.x,oe.y=Se.y,F=Math.max(F,oe.y+oe.h),P=Math.max(P,oe.x+oe.w),oe.w===Se.w&&oe.h===Se.h){var We=S.pop();ve<S.length&&(S[ve]=We)}else oe.h===Se.h?(Se.x+=oe.w,Se.w-=oe.w):oe.w===Se.w?(Se.y+=oe.h,Se.h-=oe.h):(S.push({x:Se.x+oe.w,y:Se.y,w:Se.w-oe.w,h:oe.h}),Se.y+=oe.h,Se.h-=oe.h);break}}return{w:P,h:F,fill:t/(P*F)||0}}$a.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,g=this.pos;this.type=7&f,e(v,t,this),this.pos===g&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=en(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=on(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=en(this.buf,this.pos)+4294967296*en(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=en(this.buf,this.pos)+4294967296*on(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=jh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=jh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,g,S){var P,F,H=S.buf;if(P=(112&(F=H[S.pos++]))>>4,F<128||(P|=(127&(F=H[S.pos++]))<<3,F<128)||(P|=(127&(F=H[S.pos++]))<<10,F<128)||(P|=(127&(F=H[S.pos++]))<<17,F<128)||(P|=(127&(F=H[S.pos++]))<<24,F<128)||(P|=(1&(F=H[S.pos++]))<<31,F<128))return Nc(v,P,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Vh?function(r,f,v){return Vh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var g="",S=f;S<v;){var P,F,H,Q=r[S],oe=null,ve=Q>239?4:Q>223?3:Q>191?2:1;if(S+ve>v)break;ve===1?Q<128&&(oe=Q):ve===2?(192&(P=r[S+1]))==128&&(oe=(31&Q)<<6|63&P)<=127&&(oe=null):ve===3?(F=r[S+2],(192&(P=r[S+1]))==128&&(192&F)==128&&((oe=(15&Q)<<12|(63&P)<<6|63&F)<=2047||oe>=55296&&oe<=57343)&&(oe=null)):ve===4&&(F=r[S+2],H=r[S+3],(192&(P=r[S+1]))==128&&(192&F)==128&&(192&H)==128&&((oe=(15&Q)<<18|(63&P)<<12|(63&F)<<6|63&H)<=65535||oe>=1114112)&&(oe=null)),oe===null?(oe=65533,ve=1):oe>65535&&(oe-=65536,g+=String.fromCharCode(oe>>>10&1023|55296),oe=56320|1023&oe),g+=String.fromCharCode(oe),S+=ve}return g}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==$a.Bytes)return e.push(this.readVarint(t));var r=Xl(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==$a.Bytes)return e.push(this.readSVarint());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==$a.Bytes)return e.push(this.readBoolean());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==$a.Bytes)return e.push(this.readFloat());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==$a.Bytes)return e.push(this.readDouble());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed32());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed32());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed64());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed64());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===$a.Varint)for(;this.buf[this.pos++]>127;);else if(t===$a.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$a.Fixed32)this.pos+=4;else{if(t!==$a.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),tn(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),tn(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),tn(this.buf,-1&e,this.pos),tn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),tn(this.buf,-1&e,this.pos),tn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,S,P){P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,P.buf[P.pos]=127&(g>>>=7)}(f,0,r),function(g,S){var P=(7&g)<<4;S.buf[S.pos++]|=P|((g>>>=3)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,g){for(var S,P,F=0;F<v.length;F++){if((S=v.charCodeAt(F))>55295&&S<57344){if(!P){S>56319||F+1===v.length?(f[g++]=239,f[g++]=191,f[g++]=189):P=S;continue}if(S<56320){f[g++]=239,f[g++]=191,f[g++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(f[g++]=239,f[g++]=191,f[g++]=189,P=null);S<128?f[g++]=S:(S<2048?f[g++]=S>>6|192:(S<65536?f[g++]=S>>12|224:(f[g++]=S>>18|240,f[g++]=S>>12&63|128),f[g++]=S>>6&63|128),f[g++]=63&S|128)}return g}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Gh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),xh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),xh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&Gh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,$a.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,V,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Oe,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Br,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,et,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,cr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,or,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Ir,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Hr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Jr,t)},writeBytesField:function(e,t){this.writeTag(e,$a.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,$a.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,$a.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var _r=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,g=t.stretchY,S=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=g,this.content=S,this.version=f},Qr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Qr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Qr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Qr.tlbr.get=function(){return this.tl.concat(this.br)},Qr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(_r.prototype,Qr);var kn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var g=Zt(v),S=new cs({width:g.w||1,height:g.h||1});for(var P in e){var F=e[P],H=r[P].paddedRect;cs.copy(F.data,S,{x:0,y:0},{x:H.x+1,y:H.y+1},F.data)}for(var Q in t){var oe=t[Q],ve=f[Q].paddedRect,Se=ve.x+1,We=ve.y+1,Ke=oe.data.width,bt=oe.data.height;cs.copy(oe.data,S,{x:0,y:0},{x:Se,y:We},oe.data),cs.copy(oe.data,S,{x:0,y:bt-1},{x:Se,y:We-1},{width:Ke,height:1}),cs.copy(oe.data,S,{x:0,y:0},{x:Se,y:We+bt},{width:Ke,height:1}),cs.copy(oe.data,S,{x:Ke-1,y:0},{x:Se-1,y:We},{width:1,height:bt}),cs.copy(oe.data,S,{x:0,y:0},{x:Se+Ke,y:We},{width:1,height:bt})}this.image=S,this.iconPositions=r,this.patternPositions=f};kn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],g={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(g),t[f]=new _r(g,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},kn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},kn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Rn("ImagePosition",_r),Rn("ImageAtlas",kn);var Rr={horizontal:1,vertical:2,horizontalOnly:3},Pn=function(){this.scale=1,this.fontStack="",this.imageName=null};Pn.forText=function(e,t){var r=new Pn;return r.scale=e||1,r.fontStack=t,r},Pn.forImage=function(e){var t=new Pn;return t.imageName=e,t};var ln=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function pi(e,t,r,f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke){var bt,it=ln.fromFeature(e,v);oe===Rr.vertical&&it.verticalizePunctuation();var Dt=Po.processBidirectionalText,Qt=Po.processStyledBidirectionalText;if(Dt&&it.sections.length===1){bt=[];for(var mr=0,xr=Dt(it.toString(),On(it,H,g,t,f,Se,We));mr<xr.length;mr+=1){var Nr=xr[mr],un=new ln;un.text=Nr,un.sections=it.sections;for(var Cn=0;Cn<Nr.length;Cn++)un.sectionIndex.push(0);bt.push(un)}}else if(Qt){bt=[];for(var ti=0,Zn=Qt(it.text,it.sectionIndex,On(it,H,g,t,f,Se,We));ti<Zn.length;ti+=1){var ci=Zn[ti],$n=new ln;$n.text=ci[0],$n.sectionIndex=ci[1],$n.sections=it.sections,bt.push($n)}}else bt=function(si,ua){for(var Hi=[],Ea=si.text,di=0,La=0,Ha=ua;La<Ha.length;La+=1){var No=Ha[La];Hi.push(si.substring(di,No)),di=No}return di<Ea.length&&Hi.push(si.substring(di,Ea.length)),Hi}(it,On(it,H,g,t,f,Se,We));var ia=[],Ri={positionedLines:ia,text:it.toString(),top:Q[1],bottom:Q[1],left:Q[0],right:Q[0],writingMode:oe,iconsInText:!1,verticalizable:!1};return function(si,ua,Hi,Ea,di,La,Ha,No,So,Oo,Ko,jo){for(var Ls=0,du=-17,Hs=0,wu=0,ds=No==="right"?1:No==="left"?0:.5,Ws=0,xa=0,fo=di;xa<fo.length;xa+=1){var Qa=fo[xa];Qa.trim();var Aa=Qa.getMaxScale(),au=24*(Aa-1),vu={positionedGlyphs:[],lineOffset:0};si.positionedLines[Ws]=vu;var go=vu.positionedGlyphs,vs=0;if(Qa.length()){for(var mu=0;mu<Qa.length();mu++){var Ra=Qa.getSection(mu),Ac=Qa.getSectionIndex(mu),Rl=Qa.getCharCode(mu),pc=0,ns=null,jc=null,Xu=null,Yf=24,Kf=!(So===Rr.horizontal||!Ko&&!bc(Rl)||Ko&&(Dr[Rl]||(ff=Rl,Sn.Arabic(ff)||Sn["Arabic Supplement"](ff)||Sn["Arabic Extended-A"](ff)||Sn["Arabic Presentation Forms-A"](ff)||Sn["Arabic Presentation Forms-B"](ff))));if(Ra.imageName){var Kl=Ea[Ra.imageName];if(!Kl)continue;Xu=Ra.imageName,si.iconsInText=si.iconsInText||!0,jc=Kl.paddedRect;var Tc=Kl.displaySize;Ra.scale=24*Ra.scale/jo,pc=au+(24-Tc[1]*Ra.scale),Yf=(ns={width:Tc[0],height:Tc[1],left:1,top:-3,advance:Kf?Tc[1]:Tc[0]}).advance;var Vc=Kf?Tc[0]*Ra.scale-24*Aa:Tc[1]*Ra.scale-24*Aa;Vc>0&&Vc>vs&&(vs=Vc)}else{var Xh=Hi[Ra.fontStack],$f=Xh&&Xh[Rl];if($f&&$f.rect)jc=$f.rect,ns=$f.metrics;else{var Pc=ua[Ra.fontStack],Yh=Pc&&Pc[Rl];if(!Yh)continue;ns=Yh.metrics}pc=24*(Aa-Ra.scale)}Kf?(si.verticalizable=!0,go.push({glyph:Rl,imageName:Xu,x:Ls,y:du+pc,vertical:Kf,scale:Ra.scale,fontStack:Ra.fontStack,sectionIndex:Ac,metrics:ns,rect:jc}),Ls+=Yf*Ra.scale+Oo):(go.push({glyph:Rl,imageName:Xu,x:Ls,y:du+pc,vertical:Kf,scale:Ra.scale,fontStack:Ra.fontStack,sectionIndex:Ac,metrics:ns,rect:jc}),Ls+=ns.advance*Ra.scale+Oo)}go.length!==0&&(Hs=Math.max(Ls-Oo,Hs),Fi(go,0,go.length-1,ds,vs)),Ls=0;var Kh=La*Aa+vs;vu.lineOffset=Math.max(vs,au),du+=Kh,wu=Math.max(Kh,wu),++Ws}else du+=La,++Ws}var ff,$h=du- -17,Sh=Vi(Ha),Af=Sh.horizontalAlign,Eh=Sh.verticalAlign;(function(Sp,Ep,Jf,Qf,Cp,Tf,Gc,Jh,qf){var hf,pf=(Ep-Jf)*Cp;hf=Tf!==Gc?-Jh*Qf- -17:(-Qf*qf+.5)*Gc;for(var eh=0,th=Sp;eh<th.length;eh+=1)for(var ms=0,Ch=th[eh].positionedGlyphs;ms<Ch.length;ms+=1){var rh=Ch[ms];rh.x+=pf,rh.y+=hf}})(si.positionedLines,ds,Af,Eh,Hs,wu,La,$h,di.length),si.top+=-Eh*$h,si.bottom=si.top+$h,si.left+=-Af*Hs,si.right=si.left+Hs}(Ri,t,r,f,bt,S,P,F,oe,H,ve,Ke),!function(si){for(var ua=0,Hi=si;ua<Hi.length;ua+=1)if(Hi[ua].positionedGlyphs.length!==0)return!1;return!0}(ia)&&Ri}ln.fromFeature=function(e,t){for(var r=new ln,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},ln.prototype.length=function(){return this.text.length},ln.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},ln.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},ln.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},ln.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&eu(f)&&!Ef[e[r+1]]||v&&eu(v)&&!Ef[e[r-1]]||!Ef[e[r]]?e[r]:Ef[e[r]]}return t}(this.text)},ln.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Dr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Dr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},ln.prototype.substring=function(e,t){var r=new ln;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},ln.prototype.toString=function(){return this.text},ln.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},ln.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Pn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},ln.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Pn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}else Ve("Can't add FormattedSection with an empty image.")},ln.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Dr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pr={};function ni(e,t,r,f,v,g){if(t.imageName){var S=f[t.imageName];return S?S.displaySize[0]*t.scale*24/g+v:0}var P=r[t.fontStack],F=P&&P[e];return F?F.metrics.advance*t.scale+v:0}function En(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function rn(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function Mn(e,t,r,f,v,g){for(var S=null,P=En(t,r,v,g),F=0,H=f;F<H.length;F+=1){var Q=H[F],oe=En(t-Q.x,r,v,g)+Q.badness;oe<=P&&(S=Q,P=oe)}return{index:e,x:t,priorBreak:S,badness:P}}function On(e,t,r,f,v,g,S){if(g!=="point")return[];if(!e)return[];for(var P,F=[],H=function(bt,it,Dt,Qt,mr,xr){for(var Nr=0,un=0;un<bt.length();un++){var Cn=bt.getSection(un);Nr+=ni(bt.getCharCode(un),Cn,Qt,mr,it,xr)}return Nr/Math.max(1,Math.ceil(Nr/Dt))}(e,t,r,f,v,S),Q=e.text.indexOf("\u200B")>=0,oe=0,ve=0;ve<e.length();ve++){var Se=e.getSection(ve),We=e.getCharCode(ve);if(Dr[We]||(oe+=ni(We,Se,f,v,t,S)),ve<e.length()-1){var Ke=!((P=We)<11904||!(Sn["Bopomofo Extended"](P)||Sn.Bopomofo(P)||Sn["CJK Compatibility Forms"](P)||Sn["CJK Compatibility Ideographs"](P)||Sn["CJK Compatibility"](P)||Sn["CJK Radicals Supplement"](P)||Sn["CJK Strokes"](P)||Sn["CJK Symbols and Punctuation"](P)||Sn["CJK Unified Ideographs Extension A"](P)||Sn["CJK Unified Ideographs"](P)||Sn["Enclosed CJK Letters and Months"](P)||Sn["Halfwidth and Fullwidth Forms"](P)||Sn.Hiragana(P)||Sn["Ideographic Description Characters"](P)||Sn["Kangxi Radicals"](P)||Sn["Katakana Phonetic Extensions"](P)||Sn.Katakana(P)||Sn["Vertical Forms"](P)||Sn["Yi Radicals"](P)||Sn["Yi Syllables"](P)));(Pr[We]||Ke||Se.imageName)&&F.push(Mn(ve+1,oe,H,F,rn(We,e.getCharCode(ve+1),Ke&&Q),!1))}}return function bt(it){return it?bt(it.priorBreak).concat(it.index):[]}(Mn(e.length(),oe,H,F,0,!0))}function Vi(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Fi(e,t,r,f,v){if(f||v)for(var g=e[r],S=(e[r].x+g.metrics.advance*g.scale)*f,P=t;P<=r;P++)e[P].x-=S,e[P].y+=v}function Fn(e,t,r,f,v,g){var S,P=e.image;if(P.content){var F=P.content,H=P.pixelRatio||1;S=[F[0]/H,F[1]/H,P.displaySize[0]-F[2]/H,P.displaySize[1]-F[3]/H]}var Q,oe,ve,Se,We=t.left*g,Ke=t.right*g;r==="width"||r==="both"?(Se=v[0]+We-f[3],oe=v[0]+Ke+f[1]):oe=(Se=v[0]+(We+Ke-P.displaySize[0])/2)+P.displaySize[0];var bt=t.top*g,it=t.bottom*g;return r==="height"||r==="both"?(Q=v[1]+bt-f[0],ve=v[1]+it+f[2]):ve=(Q=v[1]+(bt+it-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:Q,right:oe,bottom:ve,left:Se,collisionPadding:S}}Pr[10]=!0,Pr[32]=!0,Pr[38]=!0,Pr[40]=!0,Pr[41]=!0,Pr[43]=!0,Pr[45]=!0,Pr[47]=!0,Pr[173]=!0,Pr[183]=!0,Pr[8203]=!0,Pr[8208]=!0,Pr[8211]=!0,Pr[8231]=!0;var wn=function(e){function t(r,f,v,g){e.call(this,r,f),this.angle=v,g!==void 0&&(this.segment=g)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}($);function Ti(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ta(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,g=0;g<f.length&&f[g]<=e;)g++;for(var S=g=Math.max(0,g-1);S<f.length&&f[S]<e+1;)S++;S=Math.min(f.length-1,S);var P=f[g],F=f[S];return r.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:F,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:F,minSize:r.evaluate(new ta(P)),maxSize:r.evaluate(new ta(F)),interpolationType:v}}function Ui(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Ca(v/128,r.upperSize/128,t.uSizeT):f}function va(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,g=v?$t(De.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Ca(e.minSize,e.maxSize,g):r=g}return{uSizeT:r,uSize:f}}Rn("Anchor",wn);var zo=Object.freeze({__proto__:null,getSizeData:Ti,evaluateSizeForFeature:Ui,evaluateSizeForZoom:va,SIZE_PACK_FACTOR:128});function xo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var g=t,S=t.segment+1,P=0;P>-r/2;){if(--S<0)return!1;P-=e[S].dist(g),g=e[S]}P+=e[S].dist(e[S+1]),S++;for(var F=[],H=0;P<r/2;){var Q=e[S],oe=e[S+1];if(!oe)return!1;var ve=e[S-1].angleTo(Q)-Q.angleTo(oe);for(ve=Math.abs((ve+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:P,angleDelta:ve}),H+=ve;P-F[0].distance>f;)H-=F.shift().angleDelta;if(H>v)return!1;S++,P+=Q.dist(oe)}return!0}function sa(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function hs(e,t,r){return e?.6*t*r:0}function oo(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Xo(e,t,r,f,v,g){for(var S=hs(r,v,g),P=oo(r,f)*g,F=0,H=sa(e)/2,Q=0;Q<e.length-1;Q++){var oe=e[Q],ve=e[Q+1],Se=oe.dist(ve);if(F+Se>H){var We=(H-F)/Se,Ke=Ca(oe.x,ve.x,We),bt=Ca(oe.y,ve.y,We),it=new wn(Ke,bt,ve.angleTo(oe),Q);return it._round(),!S||xo(e,it,P,S,t)?it:void 0}F+=Se}}function Uo(e,t,r,f,v,g,S,P,F){var H=hs(f,g,S),Q=oo(f,v),oe=Q*S,ve=e[0].x===0||e[0].x===F||e[0].y===0||e[0].y===F;return t-oe<t/4&&(t=oe+t/4),function Se(We,Ke,bt,it,Dt,Qt,mr,xr,Nr){for(var un=Qt/2,Cn=sa(We),ti=0,Zn=Ke-bt,ci=[],$n=0;$n<We.length-1;$n++){for(var ia=We[$n],Ri=We[$n+1],si=ia.dist(Ri),ua=Ri.angleTo(ia);Zn+bt<ti+si;){var Hi=((Zn+=bt)-ti)/si,Ea=Ca(ia.x,Ri.x,Hi),di=Ca(ia.y,Ri.y,Hi);if(Ea>=0&&Ea<Nr&&di>=0&&di<Nr&&Zn-un>=0&&Zn+un<=Cn){var La=new wn(Ea,di,ua,$n);La._round(),it&&!xo(We,La,Qt,it,Dt)||ci.push(La)}}ti+=si}return xr||ci.length||mr||(ci=Se(We,ti/2,bt,it,Dt,Qt,mr,!0,Nr)),ci}(e,ve?t/2*P%t:(Q/2+2*g)*S*P%t,t,H,r,oe,ve,!1,F)}function Is(e,t,r,f,v){for(var g=[],S=0;S<e.length;S++)for(var P=e[S],F=void 0,H=0;H<P.length-1;H++){var Q=P[H],oe=P[H+1];Q.x<t&&oe.x<t||(Q.x<t?Q=new $(t,Q.y+(t-Q.x)/(oe.x-Q.x)*(oe.y-Q.y))._round():oe.x<t&&(oe=new $(t,Q.y+(t-Q.x)/(oe.x-Q.x)*(oe.y-Q.y))._round()),Q.y<r&&oe.y<r||(Q.y<r?Q=new $(Q.x+(r-Q.y)/(oe.y-Q.y)*(oe.x-Q.x),r)._round():oe.y<r&&(oe=new $(Q.x+(r-Q.y)/(oe.y-Q.y)*(oe.x-Q.x),r)._round()),Q.x>=f&&oe.x>=f||(Q.x>=f?Q=new $(f,Q.y+(f-Q.x)/(oe.x-Q.x)*(oe.y-Q.y))._round():oe.x>=f&&(oe=new $(f,Q.y+(f-Q.x)/(oe.x-Q.x)*(oe.y-Q.y))._round()),Q.y>=v&&oe.y>=v||(Q.y>=v?Q=new $(Q.x+(v-Q.y)/(oe.y-Q.y)*(oe.x-Q.x),v)._round():oe.y>=v&&(oe=new $(Q.x+(v-Q.y)/(oe.y-Q.y)*(oe.x-Q.x),v)._round()),F&&Q.equals(F[F.length-1])||g.push(F=[Q]),F.push(oe)))))}return g}function Ns(e,t,r,f){var v=[],g=e.image,S=g.pixelRatio,P=g.paddedRect.w-2,F=g.paddedRect.h-2,H=e.right-e.left,Q=e.bottom-e.top,oe=g.stretchX||[[0,P]],ve=g.stretchY||[[0,F]],Se=function(Ea,di){return Ea+di[1]-di[0]},We=oe.reduce(Se,0),Ke=ve.reduce(Se,0),bt=P-We,it=F-Ke,Dt=0,Qt=We,mr=0,xr=Ke,Nr=0,un=bt,Cn=0,ti=it;if(g.content&&f){var Zn=g.content;Dt=Cs(oe,0,Zn[0]),mr=Cs(ve,0,Zn[1]),Qt=Cs(oe,Zn[0],Zn[2]),xr=Cs(ve,Zn[1],Zn[3]),Nr=Zn[0]-Dt,Cn=Zn[1]-mr,un=Zn[2]-Zn[0]-Qt,ti=Zn[3]-Zn[1]-xr}var ci=function(Ea,di,La,Ha){var No=wi(Ea.stretch-Dt,Qt,H,e.left),So=Zo(Ea.fixed-Nr,un,Ea.stretch,We),Oo=wi(di.stretch-mr,xr,Q,e.top),Ko=Zo(di.fixed-Cn,ti,di.stretch,Ke),jo=wi(La.stretch-Dt,Qt,H,e.left),Ls=Zo(La.fixed-Nr,un,La.stretch,We),du=wi(Ha.stretch-mr,xr,Q,e.top),Hs=Zo(Ha.fixed-Cn,ti,Ha.stretch,Ke),wu=new $(No,Oo),ds=new $(jo,Oo),Ws=new $(jo,du),xa=new $(No,du),fo=new $(So/S,Ko/S),Qa=new $(Ls/S,Hs/S),Aa=t*Math.PI/180;if(Aa){var au=Math.sin(Aa),vu=Math.cos(Aa),go=[vu,-au,au,vu];wu._matMult(go),ds._matMult(go),xa._matMult(go),Ws._matMult(go)}var vs=Ea.stretch+Ea.fixed,mu=di.stretch+di.fixed;return{tl:wu,tr:ds,bl:xa,br:Ws,tex:{x:g.paddedRect.x+1+vs,y:g.paddedRect.y+1+mu,w:La.stretch+La.fixed-vs,h:Ha.stretch+Ha.fixed-mu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fo,pixelOffsetBR:Qa,minFontScaleX:un/S/H,minFontScaleY:ti/S/Q,isSDF:r}};if(f&&(g.stretchX||g.stretchY))for(var $n=Yo(oe,bt,We),ia=Yo(ve,it,Ke),Ri=0;Ri<$n.length-1;Ri++)for(var si=$n[Ri],ua=$n[Ri+1],Hi=0;Hi<ia.length-1;Hi++)v.push(ci(si,ia[Hi],ua,ia[Hi+1]));else v.push(ci({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:F+1}));return v}function Cs(e,t,r){for(var f=0,v=0,g=e;v<g.length;v+=1){var S=g[v];f+=Math.max(t,Math.min(r,S[1]))-Math.max(t,Math.min(r,S[0]))}return f}function Yo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,g=e;v<g.length;v+=1){var S=g[v],P=S[0],F=S[1],H=f[f.length-1];f.push({fixed:P-H.stretch,stretch:H.stretch}),f.push({fixed:P-H.stretch,stretch:H.stretch+(F-P)})}return f.push({fixed:t+1,stretch:r}),f}function wi(e,t,r,f){return e/t*r+f}function Zo(e,t,r,f){return e-t*r/f}var Ma=function(e,t,r,f,v,g,S,P,F,H){if(this.boxStartIndex=e.length,F){var Q=g.top,oe=g.bottom,ve=g.collisionPadding;ve&&(Q-=ve[1],oe+=ve[3]);var Se=oe-Q;Se>0&&(Se=Math.max(10,Se),this.circleDiameter=Se)}else{var We=g.top*S-P,Ke=g.bottom*S+P,bt=g.left*S-P,it=g.right*S+P,Dt=g.collisionPadding;if(Dt&&(bt-=Dt[0]*S,We-=Dt[1]*S,it+=Dt[2]*S,Ke+=Dt[3]*S),H){var Qt=new $(bt,We),mr=new $(it,We),xr=new $(bt,Ke),Nr=new $(it,Ke),un=H*Math.PI/180;Qt._rotate(un),mr._rotate(un),xr._rotate(un),Nr._rotate(un),bt=Math.min(Qt.x,mr.x,xr.x,Nr.x),it=Math.max(Qt.x,mr.x,xr.x,Nr.x),We=Math.min(Qt.y,mr.y,xr.y,Nr.y),Ke=Math.max(Qt.y,mr.y,xr.y,Nr.y)}e.emplaceBack(t.x,t.y,bt,We,it,Ke,r,f,v)}this.boxEndIndex=e.length},Io=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=ki),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function ki(e,t){return e<t?-1:e>t?1:0}function ca(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,g=-1/0,S=-1/0,P=e[0],F=0;F<P.length;F++){var H=P[F];(!F||H.x<f)&&(f=H.x),(!F||H.y<v)&&(v=H.y),(!F||H.x>g)&&(g=H.x),(!F||H.y>S)&&(S=H.y)}var Q=Math.min(g-f,S-v),oe=Q/2,ve=new Io([],Ja);if(Q===0)return new $(f,v);for(var Se=f;Se<g;Se+=Q)for(var We=v;We<S;We+=Q)ve.push(new bo(Se+oe,We+oe,oe,e));for(var Ke=function(Dt){for(var Qt=0,mr=0,xr=0,Nr=Dt[0],un=0,Cn=Nr.length,ti=Cn-1;un<Cn;ti=un++){var Zn=Nr[un],ci=Nr[ti],$n=Zn.x*ci.y-ci.x*Zn.y;mr+=(Zn.x+ci.x)*$n,xr+=(Zn.y+ci.y)*$n,Qt+=3*$n}return new bo(mr/Qt,xr/Qt,0,Dt)}(e),bt=ve.length;ve.length;){var it=ve.pop();(it.d>Ke.d||!Ke.d)&&(Ke=it,r&&console.log("found best %d after %d probes",Math.round(1e4*it.d)/1e4,bt)),it.max-Ke.d<=t||(ve.push(new bo(it.p.x-(oe=it.h/2),it.p.y-oe,oe,e)),ve.push(new bo(it.p.x+oe,it.p.y-oe,oe,e)),ve.push(new bo(it.p.x-oe,it.p.y+oe,oe,e)),ve.push(new bo(it.p.x+oe,it.p.y+oe,oe,e)),bt+=4)}return r&&(console.log("num probes: "+bt),console.log("best distance: "+Ke.d)),Ke.p}function Ja(e,t){return t.max-e.max}function bo(e,t,r,f){this.p=new $(e,t),this.h=r,this.d=function(v,g){for(var S=!1,P=1/0,F=0;F<g.length;F++)for(var H=g[F],Q=0,oe=H.length,ve=oe-1;Q<oe;ve=Q++){var Se=H[Q],We=H[ve];Se.y>v.y!=We.y>v.y&&v.x<(We.x-Se.x)*(v.y-Se.y)/(We.y-Se.y)+Se.x&&(S=!S),P=Math.min(P,Sa(v,Se,We))}return(S?1:-1)*Math.sqrt(P)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}Io.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Io.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Io.prototype.peek=function(){return this.data[0]},Io.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,g=t[v];if(r(f,g)>=0)break;t[e]=g,e=v}t[e]=f},Io.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var g=1+(e<<1),S=t[g],P=g+1;if(P<this.length&&r(t[P],S)<0&&(g=P,S=t[P]),r(S,v)>=0)break;t[e]=S,e=g}t[e]=v};var pl=Number.POSITIVE_INFINITY;function He(e,t){return t[1]!==pl?function(r,f,v){var g=0,S=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":S=v-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-v}switch(r){case"top-right":case"bottom-right":case"right":g=-f;break;case"top-left":case"bottom-left":case"left":g=f}return[g,S]}(e,t[0],t[1]):function(r,f){var v=0,g=0;f<0&&(f=0);var S=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=S-7;break;case"bottom-right":case"bottom-left":g=7-S;break;case"bottom":g=7-f;break;case"top":g=f-7}switch(r){case"top-right":case"bottom-right":v=-S;break;case"top-left":case"bottom-left":v=S;break;case"left":v=f;break;case"right":v=-f}return[v,g]}(e,t[0])}function ir(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function er(e,t,r,f,v,g,S,P,F,H,Q,oe,ve,Se,We){var Ke=function(mr,xr,Nr,un,Cn,ti,Zn,ci){for(var $n=un.layout.get("text-rotate").evaluate(ti,{})*Math.PI/180,ia=[],Ri=0,si=xr.positionedLines;Ri<si.length;Ri+=1)for(var ua=si[Ri],Hi=0,Ea=ua.positionedGlyphs;Hi<Ea.length;Hi+=1){var di=Ea[Hi];if(di.rect){var La=di.rect||{},Ha=4,No=!0,So=1,Oo=0,Ko=(Cn||ci)&&di.vertical,jo=di.metrics.advance*di.scale/2;if(ci&&xr.verticalizable&&(Oo=ua.lineOffset/2-(di.imageName?-(24-di.metrics.width*di.scale)/2:24*(di.scale-1))),di.imageName){var Ls=Zn[di.imageName];No=Ls.sdf,Ha=1/(So=Ls.pixelRatio)}var du=Cn?[di.x+jo,di.y]:[0,0],Hs=Cn?[0,0]:[di.x+jo+Nr[0],di.y+Nr[1]-Oo],wu=[0,0];Ko&&(wu=Hs,Hs=[0,0]);var ds=(di.metrics.left-Ha)*di.scale-jo+Hs[0],Ws=(-di.metrics.top-Ha)*di.scale+Hs[1],xa=ds+La.w*di.scale/So,fo=Ws+La.h*di.scale/So,Qa=new $(ds,Ws),Aa=new $(xa,Ws),au=new $(ds,fo),vu=new $(xa,fo);if(Ko){var go=new $(-jo,jo- -17),vs=-Math.PI/2,mu=12-jo,Ra=new $(22-mu,-(di.imageName?mu:0)),Ac=new(Function.prototype.bind.apply($,[null].concat(wu)));Qa._rotateAround(vs,go)._add(Ra)._add(Ac),Aa._rotateAround(vs,go)._add(Ra)._add(Ac),au._rotateAround(vs,go)._add(Ra)._add(Ac),vu._rotateAround(vs,go)._add(Ra)._add(Ac)}if($n){var Rl=Math.sin($n),pc=Math.cos($n),ns=[pc,-Rl,Rl,pc];Qa._matMult(ns),Aa._matMult(ns),au._matMult(ns),vu._matMult(ns)}var jc=new $(0,0),Xu=new $(0,0);ia.push({tl:Qa,tr:Aa,bl:au,br:vu,tex:La,writingMode:xr.writingMode,glyphOffset:du,sectionIndex:di.sectionIndex,isSDF:No,pixelOffsetTL:jc,pixelOffsetBR:Xu,minFontScaleX:0,minFontScaleY:0})}}return ia}(0,r,P,v,g,S,f,e.allowVerticalPlacement),bt=e.textSizeData,it=null;bt.kind==="source"?(it=[128*v.layout.get("text-size").evaluate(S,{})])[0]>32640&&Ve(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):bt.kind==="composite"&&((it=[128*Se.compositeTextSizes[0].evaluate(S,{},We),128*Se.compositeTextSizes[1].evaluate(S,{},We)])[0]>32640||it[1]>32640)&&Ve(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Ke,it,P,g,S,H,t,F.lineStartIndex,F.lineLength,ve,We);for(var Dt=0,Qt=Q;Dt<Qt.length;Dt+=1)oe[Qt[Dt]]=e.text.placedSymbolArray.length-1;return 4*Ke.length}function Xn(e){for(var t in e)return e[t];return null}function fa(e,t,r,f){var v=e.compareText;if(t in v){for(var g=v[t],S=g.length-1;S>=0;S--)if(f.dist(g[S])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Ne=wc.VectorTileFeature.types,be=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nt(e,t,r,f,v,g,S,P,F,H,Q,oe,ve){var Se=P?Math.min(32640,Math.round(P[0])):0,We=P?Math.min(32640,Math.round(P[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),g,S,(Se<<1)+(F?1:0),We,16*H,16*Q,256*oe,256*ve)}function Gt(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function lr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Pl(r[t].text))return!0;return!1}var xt=function(e){this.layoutVertexArray=new ju,this.indexArray=new Su,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new al,this.opacityVertexArray=new Ol,this.placedSymbolArray=new h};xt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},xt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,gp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,be,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},xt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Rn("SymbolBuffers",xt);var vt=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new ul};vt.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Uh.members,!0)},vt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Rn("CollisionBuffers",vt);var at=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ao([]),this.placementViewportMatrix=ao([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ti(this.zoom,t["text-size"]),this.iconSizeData=Ti(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(g){return Rr[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=e.sourceID};at.prototype.createArrays=function(){this.text=new xt(new L(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new xt(new L(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new k,this.symbolInstances=new E},at.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var g=0;g<e.length;g++)if(t[e.charCodeAt(g)]=!0,(r||f)&&v){var S=Ef[e.charAt(g)];S&&(t[S.charCodeAt(0)]=!0)}},at.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,g=v.get("text-font"),S=v.get("text-field"),P=v.get("icon-image"),F=(S.value.kind!=="constant"||S.value.value instanceof Ba&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),H=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Q=v.get("symbol-sort-key");if(this.features=[],F||H){for(var oe=t.iconDependencies,ve=t.glyphDependencies,Se=t.availableImages,We=new ta(this.zoom),Ke=0,bt=e;Ke<bt.length;Ke+=1){var it=bt[Ke],Dt=it.feature,Qt=it.id,mr=it.index,xr=it.sourceLayerIndex,Nr=f._featureFilter.needGeometry,un=wt(Dt,Nr);if(f._featureFilter.filter(We,un,r)){Nr||(un.geometry=Rt(Dt));var Cn=void 0;if(F){var ti=f.getValueAndResolveTokens("text-field",un,r,Se),Zn=Ba.factory(ti);lr(Zn)&&(this.hasRTLText=!0),(!this.hasRTLText||ko()==="unavailable"||this.hasRTLText&&Po.isParsed())&&(Cn=_p(Zn,f,un))}var ci=void 0;if(H){var $n=f.getValueAndResolveTokens("icon-image",un,r,Se);ci=$n instanceof qi?$n:qi.fromString($n)}if(Cn||ci){var ia=this.sortFeaturesByKey?Q.evaluate(un,{},r):void 0;if(this.features.push({id:Qt,text:Cn,icon:ci,index:mr,sourceLayerIndex:xr,geometry:un.geometry,properties:Dt.properties,type:Ne[Dt.type],sortKey:ia}),ci&&(oe[ci.name]=!0),Cn){var Ri=g.evaluate(un,{},r).join(","),si=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rr.vertical)>=0;for(var ua=0,Hi=Cn.sections;ua<Hi.length;ua+=1){var Ea=Hi[ua];if(Ea.image)oe[Ea.image.name]=!0;else{var di=Mu(Cn.toString()),La=Ea.fontStack||Ri,Ha=ve[La]=ve[La]||{};this.calculateGlyphDependencies(Ea.text,Ha,si,this.allowVerticalPlacement,di)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(No){var So={},Oo={},Ko=[],jo=0;function Ls(go){Ko.push(No[go]),jo++}function du(go,vs,mu){var Ra=Oo[go];return delete Oo[go],Oo[vs]=Ra,Ko[Ra].geometry[0].pop(),Ko[Ra].geometry[0]=Ko[Ra].geometry[0].concat(mu[0]),Ra}function Hs(go,vs,mu){var Ra=So[vs];return delete So[vs],So[go]=Ra,Ko[Ra].geometry[0].shift(),Ko[Ra].geometry[0]=mu[0].concat(Ko[Ra].geometry[0]),Ra}function wu(go,vs,mu){var Ra=mu?vs[0][vs[0].length-1]:vs[0][0];return go+":"+Ra.x+":"+Ra.y}for(var ds=0;ds<No.length;ds++){var Ws=No[ds],xa=Ws.geometry,fo=Ws.text?Ws.text.toString():null;if(fo){var Qa=wu(fo,xa),Aa=wu(fo,xa,!0);if(Qa in Oo&&Aa in So&&Oo[Qa]!==So[Aa]){var au=Hs(Qa,Aa,xa),vu=du(Qa,Aa,Ko[au].geometry);delete So[Qa],delete Oo[Aa],Oo[wu(fo,Ko[vu].geometry,!0)]=vu,Ko[au].geometry=null}else Qa in Oo?du(Qa,Aa,xa):Aa in So?Hs(Qa,Aa,xa):(Ls(ds),So[Qa]=jo-1,Oo[Aa]=jo-1)}else Ls(ds)}return Ko.filter(function(go){return go.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(No,So){return No.sortKey-So.sortKey})}},at.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},at.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},at.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},at.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},at.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},at.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},at.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),g={},S=e.segment+1;S<t.length;S++)g[S]={x:t[S].x,y:t[S].y,tileUnitDistanceFromAnchor:f},S<t.length-1&&(f+=t[S+1].dist(t[S]));for(var P=e.segment||0;P>=0;P--)g[P]={x:t[P].x,y:t[P].y,tileUnitDistanceFromAnchor:v},P>0&&(v+=t[P-1].dist(t[P]));for(var F=0;F<t.length;F++){var H=g[F];this.lineVertexArray.emplaceBack(H.x,H.y,H.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},at.prototype.addSymbols=function(e,t,r,f,v,g,S,P,F,H,Q,oe){for(var ve=e.indexArray,Se=e.layoutVertexArray,We=e.segments.prepareSegment(4*t.length,Se,ve,this.canOverlap?g.sortKey:void 0),Ke=this.glyphOffsetArray.length,bt=We.vertexLength,it=this.allowVerticalPlacement&&S===Rr.vertical?Math.PI/2:0,Dt=g.text&&g.text.sections,Qt=0;Qt<t.length;Qt++){var mr=t[Qt],xr=mr.tl,Nr=mr.tr,un=mr.bl,Cn=mr.br,ti=mr.tex,Zn=mr.pixelOffsetTL,ci=mr.pixelOffsetBR,$n=mr.minFontScaleX,ia=mr.minFontScaleY,Ri=mr.glyphOffset,si=mr.isSDF,ua=mr.sectionIndex,Hi=We.vertexLength,Ea=Ri[1];nt(Se,P.x,P.y,xr.x,Ea+xr.y,ti.x,ti.y,r,si,Zn.x,Zn.y,$n,ia),nt(Se,P.x,P.y,Nr.x,Ea+Nr.y,ti.x+ti.w,ti.y,r,si,ci.x,Zn.y,$n,ia),nt(Se,P.x,P.y,un.x,Ea+un.y,ti.x,ti.y+ti.h,r,si,Zn.x,ci.y,$n,ia),nt(Se,P.x,P.y,Cn.x,Ea+Cn.y,ti.x+ti.w,ti.y+ti.h,r,si,ci.x,ci.y,$n,ia),Gt(e.dynamicLayoutVertexArray,P,it),ve.emplaceBack(Hi,Hi+1,Hi+2),ve.emplaceBack(Hi+1,Hi+2,Hi+3),We.vertexLength+=4,We.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ri[0]),Qt!==t.length-1&&ua===t[Qt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Se.length,g,g.index,{},oe,Dt&&Dt[ua])}e.placedSymbolArray.emplaceBack(P.x,P.y,Ke,this.glyphOffsetArray.length-Ke,bt,F,H,P.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],S,0,!1,0,Q)},at.prototype._addCollisionDebugVertex=function(e,t,r,f,v,g){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(g.x),Math.round(g.y))},at.prototype.addCollisionDebugVertices=function(e,t,r,f,v,g,S){var P=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),F=P.vertexLength,H=v.layoutVertexArray,Q=v.collisionVertexArray,oe=S.anchorX,ve=S.anchorY;this._addCollisionDebugVertex(H,Q,g,oe,ve,new $(e,t)),this._addCollisionDebugVertex(H,Q,g,oe,ve,new $(r,t)),this._addCollisionDebugVertex(H,Q,g,oe,ve,new $(r,f)),this._addCollisionDebugVertex(H,Q,g,oe,ve,new $(e,f)),P.vertexLength+=4;var Se=v.indexArray;Se.emplaceBack(F,F+1),Se.emplaceBack(F+1,F+2),Se.emplaceBack(F+2,F+3),Se.emplaceBack(F+3,F),P.primitiveLength+=4},at.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var g=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,f?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,r)}},at.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vt(ol,Zh.members,sc),this.iconCollisionBox=new vt(ol,Zh.members,sc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},at.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,g,S,P,F){for(var H={},Q=t;Q<r;Q++){var oe=e.get(Q);H.textBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},H.textFeatureIndex=oe.featureIndex;break}for(var ve=f;ve<v;ve++){var Se=e.get(ve);H.verticalTextBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},H.verticalTextFeatureIndex=Se.featureIndex;break}for(var We=g;We<S;We++){var Ke=e.get(We);H.iconBox={x1:Ke.x1,y1:Ke.y1,x2:Ke.x2,y2:Ke.y2,anchorPointX:Ke.anchorPointX,anchorPointY:Ke.anchorPointY},H.iconFeatureIndex=Ke.featureIndex;break}for(var bt=P;bt<F;bt++){var it=e.get(bt);H.verticalIconBox={x1:it.x1,y1:it.y1,x2:it.x2,y2:it.y2,anchorPointX:it.anchorPointX,anchorPointY:it.anchorPointY},H.verticalIconFeatureIndex=it.featureIndex;break}return H},at.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},at.prototype.hasTextData=function(){return this.text.segments.get().length>0},at.prototype.hasIconData=function(){return this.icon.segments.get().length>0},at.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},at.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},at.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},at.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},at.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],g=[],S=0;S<this.symbolInstances.length;++S){g.push(S);var P=this.symbolInstances.get(S);f.push(0|Math.round(t*P.anchorX+r*P.anchorY)),v.push(P.featureIndex)}return g.sort(function(F,H){return f[F]-f[H]||v[H]-v[F]}),g},at.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},at.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(g,S,P){g>=0&&P.indexOf(g)===S&&t.addIndicesForPlacedSymbol(t.text,g)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Rn("SymbolBucket",at,{omit:["layers","collisionBoxArray","features","compareText"]}),at.MAX_GLYPHS=65535,at.addDynamicAttributes=Gt;var Fe=new Mo({"symbol-placement":new Vn(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Vn(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vn(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gn(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vn(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vn(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Vn(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vn(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vn(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gn(ue.layout_symbol["icon-size"]),"icon-text-fit":new Vn(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vn(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gn(ue.layout_symbol["icon-image"]),"icon-rotate":new Gn(ue.layout_symbol["icon-rotate"]),"icon-padding":new Vn(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Vn(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Gn(ue.layout_symbol["icon-offset"]),"icon-anchor":new Gn(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vn(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vn(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vn(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Gn(ue.layout_symbol["text-field"]),"text-font":new Gn(ue.layout_symbol["text-font"]),"text-size":new Gn(ue.layout_symbol["text-size"]),"text-max-width":new Gn(ue.layout_symbol["text-max-width"]),"text-line-height":new Vn(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Gn(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Gn(ue.layout_symbol["text-justify"]),"text-radial-offset":new Gn(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vn(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Gn(ue.layout_symbol["text-anchor"]),"text-max-angle":new Vn(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Vn(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Gn(ue.layout_symbol["text-rotate"]),"text-padding":new Vn(ue.layout_symbol["text-padding"]),"text-keep-upright":new Vn(ue.layout_symbol["text-keep-upright"]),"text-transform":new Gn(ue.layout_symbol["text-transform"]),"text-offset":new Gn(ue.layout_symbol["text-offset"]),"text-allow-overlap":new Vn(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Vn(ue.layout_symbol["text-ignore-placement"]),"text-optional":new Vn(ue.layout_symbol["text-optional"])}),ot={paint:new Mo({"icon-opacity":new Gn(ue.paint_symbol["icon-opacity"]),"icon-color":new Gn(ue.paint_symbol["icon-color"]),"icon-halo-color":new Gn(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gn(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gn(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Vn(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vn(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gn(ue.paint_symbol["text-opacity"]),"text-color":new Gn(ue.paint_symbol["text-color"],{runtimeType:yn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Gn(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Gn(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Gn(ue.paint_symbol["text-halo-blur"]),"text-translate":new Vn(ue.paint_symbol["text-translate"]),"text-translate-anchor":new Vn(ue.paint_symbol["text-translate-anchor"])}),layout:Fe},Ue=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Bn,this.defaultValue=e};Ue.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Ue.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return null},Rn("FormatSectionOverride",Ue,{omit:["defaultValue"]});var Xt=function(e){function t(r){e.call(this,r,ot)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var g=[],S=0,P=v;S<P.length;S+=1){var F=P[S];g.indexOf(F)<0&&g.push(F)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,g){var S=this.layout.get(r).evaluate(f,{},v,g),P=this._unevaluatedLayout._values[r];return P.isDataDriven()||Qu(P.value)||!S?S:function(F,H){return H.replace(/{([^{}]+)}/g,function(Q,oe){return oe in F?String(F[oe]):""})}(f.properties,S)},t.prototype.createBucket=function(r){return new at(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=ot.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var g,S=this.paint.get(v),P=new Ue(S),F=new Pu(P,S.property.specification);g=S.value.kind==="constant"||S.value.kind==="source"?new El("source",F):new qu("composite",F,S.value.zoomStops,S.value._interpolationType),this.paint._values[v]=new co(S.property,g,S.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),g=ot.paint.properties[f],S=!1,P=function(Q){for(var oe=0,ve=Q;oe<ve.length;oe+=1)if(g.overrides&&g.overrides.hasOverride(ve[oe]))return void(S=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Ba)P(v.value.value.sections);else if(v.value.kind==="source"){var F=function(Q){S||(Q instanceof Ji&&$i(Q.value)===ra?P(Q.value.sections):Q instanceof Lo?P(Q.sections):Q.eachChild(F))},H=v.value;H._styleExpression&&F(H._styleExpression.expression)}return S},t}(ru),Jt={paint:new Mo({"background-color":new Vn(ue.paint_background["background-color"]),"background-pattern":new ts(ue.paint_background["background-pattern"]),"background-opacity":new Vn(ue.paint_background["background-opacity"])})},jr=function(e){function t(r){e.call(this,r,Jt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ru),gn={paint:new Mo({"raster-opacity":new Vn(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vn(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vn(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vn(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Vn(ue.paint_raster["raster-saturation"]),"raster-contrast":new Vn(ue.paint_raster["raster-contrast"]),"raster-resampling":new Vn(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Vn(ue.paint_raster["raster-fade-duration"])})},an=function(e){function t(r){e.call(this,r,gn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ru),Dn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(ru),pn={circle:Iu,heatmap:vf,hillshade:lh,fill:xf,"fill-extrusion":mh,line:vp,symbol:Xt,background:jr,raster:an},ai=Z.HTMLImageElement,Un=Z.HTMLCanvasElement,Yn=Z.HTMLVideoElement,qn=Z.ImageData,ei=Z.ImageBitmap,gi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};gi.prototype.update=function(e,t,r){var f=e.width,v=e.height,g=!(this.size&&this.size[0]===f&&this.size[1]===v||r),S=this.context,P=S.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!t||t.premultiply!==!1)),g)this.size=[f,v],e instanceof ai||e instanceof Un||e instanceof Yn||e instanceof qn||ei&&e instanceof ei?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,f,v,0,this.format,P.UNSIGNED_BYTE,e.data);else{var F=r||{x:0,y:0},H=F.x,Q=F.y;e instanceof ai||e instanceof Un||e instanceof Yn||e instanceof qn||ei&&e instanceof ei?P.texSubImage2D(P.TEXTURE_2D,0,H,Q,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,H,Q,f,v,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},gi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},gi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},gi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Na=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Na.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Na.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Bo=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},sr(["receive","process"],this),this.invoker=new Na(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=qt()?e:Z};function Yl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Bo.prototype.send=function(e,t,r,f,v){var g=this;v===void 0&&(v=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[S]=r);var P=ke(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:Ya(t,P)},P),{cancel:function(){r&&delete g.callbacks[S],g.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:g.mapId})}}},Bo.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else qt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Bo.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Bo.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(ks(t.error)):f(null,ks(t.data)))}else{var v=!1,g=ke(this.globalScope)?void 0:[],S=t.hasCallback?function(Q,oe){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:Q?Ya(Q):null,data:Ya(oe,g)},g)}:function(Q){v=!0},P=null,F=ks(t.data);if(this.parent[t.type])P=this.parent[t.type](t.sourceMapId,F,S);else if(this.parent.getWorkerSource){var H=t.type.split(".");P=this.parent.getWorkerSource(t.sourceMapId,H[0],F.source)[H[1]](F,S)}else S(new Error("Could not find function "+t.type));!v&&P&&P.cancel&&(this.cancelCallbacks[e]=P.cancel)}},Bo.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Za=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Za.prototype.setNorthEast=function(e){return this._ne=e instanceof _a?new _a(e.lng,e.lat):_a.convert(e),this},Za.prototype.setSouthWest=function(e){return this._sw=e instanceof _a?new _a(e.lng,e.lat):_a.convert(e),this},Za.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof _a)t=e,r=e;else{if(!(e instanceof Za))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Za.convert(e)):this.extend(_a.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new _a(t.lng,t.lat),this._ne=new _a(r.lng,r.lat)),this},Za.prototype.getCenter=function(){return new _a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Za.prototype.getSouthWest=function(){return this._sw},Za.prototype.getNorthEast=function(){return this._ne},Za.prototype.getNorthWest=function(){return new _a(this.getWest(),this.getNorth())},Za.prototype.getSouthEast=function(){return new _a(this.getEast(),this.getSouth())},Za.prototype.getWest=function(){return this._sw.lng},Za.prototype.getSouth=function(){return this._sw.lat},Za.prototype.getEast=function(){return this._ne.lng},Za.prototype.getNorth=function(){return this._ne.lat},Za.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Za.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Za.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Za.prototype.contains=function(e){var t=_a.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Za.convert=function(e){return!e||e instanceof Za?e:new Za(e)};var _a=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_a.prototype.wrap=function(){return new _a(zt(this.lng,-180,180),this.lat)},_a.prototype.toArray=function(){return[this.lng,this.lat]},_a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_a.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},_a.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Za(new _a(this.lng-r,this.lat-t),new _a(this.lng+r,this.lat+t))},_a.convert=function(e){if(e instanceof _a)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new _a(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new _a(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var iu=2*Math.PI*63710088e-1;function Ll(e){return iu*Math.cos(e*Math.PI/180)}function Hu(e){return(180+e)/360}function bh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Wu(e,t){return e/Ll(t)}function Gf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var lf=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};lf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=_a.convert(e);return new lf(Hu(r.lng),bh(r.lat),Wu(t,r.lat))},lf.prototype.toLngLat=function(){return new _a(360*this.x-180,Gf(this.y))},lf.prototype.toAltitude=function(){return this.z*Ll(Gf(this.y))},lf.prototype.meterInMercatorCoordinateUnits=function(){return 1/iu*(e=Gf(this.y),1/Math.cos(e*Math.PI/180));var e};var cf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Hf(0,e,e,t,r)};cf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},cf.prototype.url=function(e,t){var r,f,v,g,S,P=(f=this.y,v=this.z,g=Yl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),S=Yl(256*(r+1),256*(f+1),v),g[0]+","+g[1]+","+S[0]+","+S[1]),F=function(H,Q,oe){for(var ve,Se="",We=H;We>0;We--)Se+=(Q&(ve=1<<We-1)?1:0)+(oe&ve?2:0);return Se}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",P)},cf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new $(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},cf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var xp=function(e,t){this.wrap=e,this.canonical=t,this.key=Hf(e,t.z,t.z,t.x,t.y)},ps=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new cf(r,+f,+v),this.key=Hf(t,e,r,f,v)};function Hf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var g=1<<r;return(g*g*e+g*v+f).toString(36)+r.toString(36)+t.toString(36)}ps.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ps.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ps(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ps(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ps.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Hf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Hf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ps.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ps.prototype.children=function(e){if(this.overscaledZ>=e)return[new ps(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new ps(t,this.wrap,t,r,f),new ps(t,this.wrap,t,r+1,f),new ps(t,this.wrap,t,r,f+1),new ps(t,this.wrap,t,r+1,f+1)]},ps.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ps.prototype.wrapped=function(){return new ps(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ps.prototype.unwrapTo=function(e){return new ps(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ps.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ps.prototype.toUnwrapped=function(){return new xp(this.wrap,this.canonical)},ps.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ps.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new lf(e.x-this.wrap,e.y))},Rn("CanonicalTileID",cf),Rn("OverscaledTileID",ps,{omit:["posMatrix"]});var zc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Ve('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};zc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},zc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},zc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},zc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},zc.prototype.getPixels=function(){return new cs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,g=r*this.dim,S=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:g=S-1;break;case 1:S=g+1}for(var P=-t*this.dim,F=-r*this.dim,H=g;H<S;H++)for(var Q=f;Q<v;Q++)this.data[this._idx(Q,H)]=e.data[this._idx(Q+P,H+F)]},Rn("DEMData",zc);var wf=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};wf.prototype.encode=function(e){return this._stringToNumber[e]},wf.prototype.decode=function(e){return this._numberToString[e]};var Wf=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Hh={geometry:{configurable:!0}};Hh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Hh.geometry.set=function(e){this._geometry=e},Wf.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Wf.prototype,Hh);var Xf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Xf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Lt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var g in this.deletedStates[e][f]={},this.state[e][f])r[g]||(this.deletedStates[e][f][g]=null);else for(var S in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][S]===null&&delete this.deletedStates[e][f][S]},Xf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Xf.prototype.getState=function(e,t){var r=String(t),f=Lt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var g in v)delete f[g]}return f},Xf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Xf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var g in this.stateChanges[f])this.state[f][g]||(this.state[f][g]={}),Lt(this.state[f][g],this.stateChanges[f][g]),v[g]=this.state[f][g];r[f]=v}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var F in this.state[S])P[F]={},this.state[S][F]={};else for(var H in this.deletedStates[S]){if(this.deletedStates[S][H]===null)this.state[S][H]={};else for(var Q=0,oe=Object.keys(this.deletedStates[S][H]);Q<oe.length;Q+=1)delete this.state[S][H][oe[Q]];P[H]=this.state[S][H]}r[S]=r[S]||{},Lt(r[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var ve in e)e[ve].setFeatureState(r,t)};var Uc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yu(8192,16,0),this.grid3D=new yu(8192,16,0),this.featureIndexArray=new le,this.promoteId=t};function Gp(e,t,r,f,v){return nr(e,function(g,S){var P=t instanceof Ml?t.get(S):null;return P&&P.evaluate?P.evaluate(r,f,v):P})}function Hp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,g=0,S=e;g<S.length;g+=1){var P=S[g];t=Math.min(t,P.x),r=Math.min(r,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Wh(e,t){return t-e}Uc.prototype.insert=function(e,t,r,f,v,g){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var P=g?this.grid3D:this.grid,F=0;F<t.length;F++){for(var H=t[F],Q=[1/0,1/0,-1/0,-1/0],oe=0;oe<H.length;oe++){var ve=H[oe];Q[0]=Math.min(Q[0],ve.x),Q[1]=Math.min(Q[1],ve.y),Q[2]=Math.max(Q[2],ve.x),Q[3]=Math.max(Q[3],ve.y)}Q[0]<8192&&Q[1]<8192&&Q[2]>=0&&Q[3]>=0&&P.insert(S,Q[0],Q[1],Q[2],Q[3])}},Uc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new wc.VectorTile(new Cf(this.rawTileData)).layers,this.sourceLayerCoder=new wf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Uc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var g=e.params||{},S=8192/e.tileSize/e.scale,P=Fl(g.filter),F=e.queryGeometry,H=e.queryPadding*S,Q=Hp(F),oe=this.grid.query(Q.minX-H,Q.minY-H,Q.maxX+H,Q.maxY+H),ve=Hp(e.cameraQueryGeometry),Se=this.grid3D.query(ve.minX-H,ve.minY-H,ve.maxX+H,ve.maxY+H,function(mr,xr,Nr,un){return function(Cn,ti,Zn,ci,$n){for(var ia=0,Ri=Cn;ia<Ri.length;ia+=1){var si=Ri[ia];if(ti<=si.x&&Zn<=si.y&&ci>=si.x&&$n>=si.y)return!0}var ua=[new $(ti,Zn),new $(ti,$n),new $(ci,$n),new $(ci,Zn)];if(Cn.length>2){for(var Hi=0,Ea=ua;Hi<Ea.length;Hi+=1)if(wa(Cn,Ea[Hi]))return!0}for(var di=0;di<Cn.length-1;di++)if(Fo(Cn[di],Cn[di+1],ua))return!0;return!1}(e.cameraQueryGeometry,mr-H,xr-H,Nr+H,un+H)}),We=0,Ke=Se;We<Ke.length;We+=1)oe.push(Ke[We]);oe.sort(Wh);for(var bt,it={},Dt=function(mr){var xr=oe[mr];if(xr!==bt){bt=xr;var Nr=v.featureIndexArray.get(xr),un=null;v.loadMatchingFeature(it,Nr.bucketIndex,Nr.sourceLayerIndex,Nr.featureIndex,P,g.layers,g.availableImages,t,r,f,function(Cn,ti,Zn){return un||(un=Rt(Cn)),ti.queryIntersectsFeature(F,Cn,Zn,un,v.z,e.transform,S,e.pixelPosMatrix)})}},Qt=0;Qt<oe.length;Qt++)Dt(Qt);return it},Uc.prototype.loadMatchingFeature=function(e,t,r,f,v,g,S,P,F,H,Q){var oe=this.bucketLayerIDs[t];if(!g||function(Cn,ti){for(var Zn=0;Zn<Cn.length;Zn++)if(ti.indexOf(Cn[Zn])>=0)return!0;return!1}(g,oe)){var ve=this.sourceLayerCoder.decode(r),Se=this.vtLayers[ve].feature(f);if(v.needGeometry){var We=wt(Se,!0);if(!v.filter(new ta(this.tileID.overscaledZ),We,this.tileID.canonical))return}else if(!v.filter(new ta(this.tileID.overscaledZ),Se))return;for(var Ke=this.getId(Se,ve),bt=0;bt<oe.length;bt++){var it=oe[bt];if(!(g&&g.indexOf(it)<0)){var Dt=P[it];if(Dt){var Qt={};Ke!==void 0&&H&&(Qt=H.getState(Dt.sourceLayer||"_geojsonTileLayer",Ke));var mr=Lt({},F[it]);mr.paint=Gp(mr.paint,Dt.paint,Se,Qt,S),mr.layout=Gp(mr.layout,Dt.layout,Se,Qt,S);var xr=!Q||Q(Se,Dt,Qt);if(xr){var Nr=new Wf(Se,this.z,this.x,this.y,Ke);Nr.layer=mr;var un=e[it];un===void 0&&(un=e[it]=[]),un.push({featureIndex:f,feature:Nr,intersectionZ:xr})}}}}}},Uc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,g,S,P){var F={};this.loadVTLayers();for(var H=Fl(v),Q=0,oe=e;Q<oe.length;Q+=1)this.loadMatchingFeature(F,r,f,oe[Q],H,g,S,P,t);return F},Uc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Uc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Rn("FeatureIndex",Uc,{omit:["rawTileData","sourceLayerCoder"]});var Os=function(e,t){this.tileID=e,this.uid=Ct(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Os.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Qi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Os.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(H,Q){var oe={};if(!Q)return oe;for(var ve=function(){var Ke=We[Se],bt=Ke.layerIds.map(function(Qt){return Q.getLayer(Qt)}).filter(Boolean);if(bt.length!==0){Ke.layers=bt,Ke.stateDependentLayerIds&&(Ke.stateDependentLayers=Ke.stateDependentLayerIds.map(function(Qt){return bt.filter(function(mr){return mr.id===Qt})[0]}));for(var it=0,Dt=bt;it<Dt.length;it+=1)oe[Dt[it].id]=Ke}},Se=0,We=H;Se<We.length;Se+=1)ve();return oe}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof at){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var S=this.buckets[g];if(S instanceof at&&S.hasRTLText){this.hasRTLText=!0,Po.isLoading()||Po.isLoaded()||ko()!=="deferred"||Vs();break}}for(var P in this.queryPadding=0,this.buckets){var F=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(P).queryRadius(F))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Os.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Os.prototype.getBucket=function(e){return this.buckets[e.id]},Os.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Os.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Os.prototype.queryRenderedFeatures=function(e,t,r,f,v,g,S,P,F,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:g,tileSize:this.tileSize,pixelPosMatrix:H,transform:P,params:S,queryPadding:this.queryPadding*F},e,t,r):{}},Os.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",g=f._geojsonTileLayer||f[v];if(g)for(var S=Fl(t&&t.filter),P=this.tileID.canonical,F=P.z,H=P.x,Q=P.y,oe={z:F,x:H,y:Q},ve=0;ve<g.length;ve++){var Se=g.feature(ve);if(S.needGeometry){var We=wt(Se,!0);if(!S.filter(new ta(this.tileID.overscaledZ),We,this.tileID.canonical))continue}else if(!S.filter(new ta(this.tileID.overscaledZ),Se))continue;var Ke=r.getId(Se,v),bt=new Wf(Se,F,H,Q,Ke);bt.tile=oe,e.push(bt)}}},Os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Os.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=W(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var g=this.expirationTime-t;g?this.expirationTime=f+Math.max(g,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Os.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],g=v.layers[0].sourceLayer||"_geojsonTileLayer",S=r[g],P=e[g];if(S&&P&&Object.keys(P).length!==0){v.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=t&&t.style&&t.style.getLayer(f);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}}},Os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qi.now()},Os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Os.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Qi.now()+e},Os.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Os.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var g=0,S=t;g<S.length;g+=1)if(v[S[g]])return!0}}return!1};var Zc=Z.performance,bp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},Zc.mark(this._marks.start)};bp.prototype.finish=function(){Zc.mark(this._marks.end);var e=Zc.getEntriesByName(this._marks.measure);return e.length===0&&(Zc.measure(this._marks.measure,this._marks.start,this._marks.end),e=Zc.getEntriesByName(this._marks.measure),Zc.clearMarks(this._marks.start),Zc.clearMarks(this._marks.end),Zc.clearMeasures(this._marks.measure)),e},p.Actor=Bo,p.AlphaImage=Gu,p.CanonicalTileID=cf,p.CollisionBoxArray=u,p.Color=Ki,p.DEMData=zc,p.DataConstantProperty=Vn,p.DictionaryCoder=wf,p.EXTENT=8192,p.ErrorEvent=de,p.EvaluationParameters=ta,p.Event=ae,p.Evented=Te,p.FeatureIndex=Uc,p.FillBucket=pu,p.FillExtrusionBucket=hl,p.ImageAtlas=kn,p.ImagePosition=_r,p.LineBucket=Wo,p.LngLat=_a,p.LngLatBounds=Za,p.MercatorCoordinate=lf,p.ONE_EM=24,p.OverscaledTileID=ps,p.Point=$,p.Point$1=$,p.Properties=Mo,p.Protobuf=Cf,p.RGBAImage=cs,p.RequestManager=ar,p.RequestPerformance=bp,p.ResourceType=Yr,p.SegmentVector=we,p.SourceFeatureState=Xf,p.StructArrayLayout1ui2=Ul,p.StructArrayLayout2f1f2i16=sl,p.StructArrayLayout2i4=Ps,p.StructArrayLayout3ui6=Su,p.StructArrayLayout4i8=Il,p.SymbolBucket=at,p.Texture=gi,p.Tile=Os,p.Transitionable=Ho,p.Uniform1f=fn,p.Uniform1i=Wr,p.Uniform2f=nn,p.Uniform3f=jn,p.Uniform4f=ui,p.UniformColor=li,p.UniformMatrix4f=aa,p.UnwrappedTileID=xp,p.ValidationError=xe,p.WritingMode=Rr,p.ZoomHistory=xc,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Gt,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),g=null;e.forEach(function(S,P){t(S,function(F,H){F&&(g=F),v[P]=H,--f==0&&r(g,v)})})},p.bezier=Le,p.bindAll=sr,p.browser=Qi,p.cacheEntryPossiblyAdded=function(e){++qe>It&&(e.getActor().send("enforceCacheSizeLimit",ct),qe=0)},p.clamp=$t,p.clearTileCache=function(e){var t=Z.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=Is,p.clone=function(e){var t=new Mi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=$e,p.clone$2=function(e){var t=new Mi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=yp,p.config=ur,p.create=function(){var e=new Mi(16);return Mi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Mi(9);return Mi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Mi(4);return Mi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=X,p.createExpression=Sl,p.createLayout=Zi,p.createStyleLayer=function(e){return e.type==="custom"?new Dn(e):new pn[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],g=t[2],S=r[0],P=r[1],F=r[2];return e[0]=v*F-g*P,e[1]=g*S-f*F,e[2]=f*P-v*S,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=rt,p.emitValidationErrors=zl,p.endsWith=re,p.enforceCacheSizeLimit=function(e){Bt(),lt&&lt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Ui,p.evaluateSizeForZoom=va,p.evaluateVariableOffset=He,p.evented=ic,p.extend=Lt,p.featureFilter=Fl,p.filterObject=Tt,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Vi,p.getAnchorJustification=ir,p.getArrayBuffer=Ln,p.getImage=fe,p.getJSON=function(e,t){return Kn(Lt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=ko,p.getReferrer=vr,p.getVideo=function(e,t){var r,f,v=Z.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var g=0;g<e.length;g++){var S=Z.document.createElement("source");r=e[g],f=void 0,(f=Z.document.createElement("a")).href=r,(f.protocol!==Z.document.location.protocol||f.host!==Z.document.location.host)&&(v.crossOrigin="Anonymous"),S.src=e[g],v.appendChild(S)}return{cancel:function(){}}},p.identity=ao,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],g=t[3],S=t[4],P=t[5],F=t[6],H=t[7],Q=t[8],oe=t[9],ve=t[10],Se=t[11],We=t[12],Ke=t[13],bt=t[14],it=t[15],Dt=r*P-f*S,Qt=r*F-v*S,mr=r*H-g*S,xr=f*F-v*P,Nr=f*H-g*P,un=v*H-g*F,Cn=Q*Ke-oe*We,ti=Q*bt-ve*We,Zn=Q*it-Se*We,ci=oe*bt-ve*Ke,$n=oe*it-Se*Ke,ia=ve*it-Se*bt,Ri=Dt*ia-Qt*$n+mr*ci+xr*Zn-Nr*ti+un*Cn;return Ri?(e[0]=(P*ia-F*$n+H*ci)*(Ri=1/Ri),e[1]=(v*$n-f*ia-g*ci)*Ri,e[2]=(Ke*un-bt*Nr+it*xr)*Ri,e[3]=(ve*Nr-oe*un-Se*xr)*Ri,e[4]=(F*Zn-S*ia-H*ti)*Ri,e[5]=(r*ia-v*Zn+g*ti)*Ri,e[6]=(bt*mr-We*un-it*Qt)*Ri,e[7]=(Q*un-ve*mr+Se*Qt)*Ri,e[8]=(S*$n-P*Zn+H*Cn)*Ri,e[9]=(f*Zn-r*$n-g*Cn)*Ri,e[10]=(We*Nr-Ke*mr+it*Dt)*Ri,e[11]=(oe*mr-Q*Nr-Se*Dt)*Ri,e[12]=(P*ti-S*ci-F*Cn)*Ri,e[13]=(r*ci-f*ti+v*Cn)*Ri,e[14]=(Ke*Qt-We*xr-bt*Dt)*Ri,e[15]=(Q*xr-oe*Qt+ve*Dt)*Ri,e):null},p.isChar=Sn,p.isMapboxURL=yr,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Kn,p.mapObject=nr,p.mercatorXfromLng=Hu,p.mercatorYfromLat=bh,p.mercatorZfromAltitude=Wu,p.mul=Zl,p.multiply=Ga,p.mvt=wc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],g=r*r+f*f+v*v;return g>0&&(g=1/Math.sqrt(g)),e[0]=t[0]*g,e[1]=t[1]*g,e[2]=t[2]*g,e},p.number=Ca,p.offscreenCanvasSupported=Gr,p.ortho=function(e,t,r,f,v,g,S){var P=1/(t-r),F=1/(f-v),H=1/(g-S);return e[0]=-2*P,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*F,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*H,e[11]=0,e[12]=(t+r)*P,e[13]=(v+f)*F,e[14]=(S+g)*H,e[15]=1,e},p.parseGlyphPBF=function(e){return new Cf(e).readFields(xn,[])},p.pbf=Cf,p.performSymbolLayout=function(e,t,r,f,v,g,S){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var P=e.layers[0].layout,F=e.layers[0]._unevaluatedLayout._values,H={};if(e.textSizeData.kind==="composite"){var Q=e.textSizeData,oe=Q.maxZoom;H.compositeTextSizes=[F["text-size"].possiblyEvaluate(new ta(Q.minZoom),S),F["text-size"].possiblyEvaluate(new ta(oe),S)]}if(e.iconSizeData.kind==="composite"){var ve=e.iconSizeData,Se=ve.maxZoom;H.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new ta(ve.minZoom),S),F["icon-size"].possiblyEvaluate(new ta(Se),S)]}H.layoutTextSize=F["text-size"].possiblyEvaluate(new ta(e.zoom+1),S),H.layoutIconSize=F["icon-size"].possiblyEvaluate(new ta(e.zoom+1),S),H.textMaxSize=F["text-size"].possiblyEvaluate(new ta(18));for(var We=24*P.get("text-line-height"),Ke=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",bt=P.get("text-keep-upright"),it=P.get("text-size"),Dt=function(){var xr=mr[Qt],Nr=P.get("text-font").evaluate(xr,{},S).join(","),un=it.evaluate(xr,{},S),Cn=H.layoutTextSize.evaluate(xr,{},S),ti=H.layoutIconSize.evaluate(xr,{},S),Zn={horizontal:{},vertical:void 0},ci=xr.text,$n=[0,0];if(ci){var ia=ci.toString(),Ri=24*P.get("text-letter-spacing").evaluate(xr,{},S),si=function(xa){for(var fo=0,Qa=xa;fo<Qa.length;fo+=1)if(Aa=Qa[fo].charCodeAt(0),Sn.Arabic(Aa)||Sn["Arabic Supplement"](Aa)||Sn["Arabic Extended-A"](Aa)||Sn["Arabic Presentation Forms-A"](Aa)||Sn["Arabic Presentation Forms-B"](Aa))return!1;var Aa;return!0}(ia)?Ri:0,ua=P.get("text-anchor").evaluate(xr,{},S),Hi=P.get("text-variable-anchor");if(!Hi){var Ea=P.get("text-radial-offset").evaluate(xr,{},S);$n=Ea?He(ua,[24*Ea,pl]):P.get("text-offset").evaluate(xr,{},S).map(function(xa){return 24*xa})}var di=Ke?"center":P.get("text-justify").evaluate(xr,{},S),La=P.get("symbol-placement"),Ha=La==="point"?24*P.get("text-max-width").evaluate(xr,{},S):0,No=function(){e.allowVerticalPlacement&&Mu(ia)&&(Zn.vertical=pi(ci,t,r,v,Nr,Ha,We,ua,"left",si,$n,Rr.vertical,!0,La,Cn,un))};if(!Ke&&Hi){for(var So=di==="auto"?Hi.map(function(xa){return ir(xa)}):[di],Oo=!1,Ko=0;Ko<So.length;Ko++){var jo=So[Ko];if(!Zn.horizontal[jo])if(Oo)Zn.horizontal[jo]=Zn.horizontal[0];else{var Ls=pi(ci,t,r,v,Nr,Ha,We,"center",jo,si,$n,Rr.horizontal,!1,La,Cn,un);Ls&&(Zn.horizontal[jo]=Ls,Oo=Ls.positionedLines.length===1)}}No()}else{di==="auto"&&(di=ir(ua));var du=pi(ci,t,r,v,Nr,Ha,We,ua,di,si,$n,Rr.horizontal,!1,La,Cn,un);du&&(Zn.horizontal[di]=du),No(),Mu(ia)&&Ke&&bt&&(Zn.vertical=pi(ci,t,r,v,Nr,Ha,We,ua,di,si,$n,Rr.vertical,!1,La,Cn,un))}}var Hs=void 0,wu=!1;if(xr.icon&&xr.icon.name){var ds=f[xr.icon.name];ds&&(Hs=function(xa,fo,Qa){var Aa=Vi(Qa),au=fo[0]-xa.displaySize[0]*Aa.horizontalAlign,vu=fo[1]-xa.displaySize[1]*Aa.verticalAlign;return{image:xa,top:vu,bottom:vu+xa.displaySize[1],left:au,right:au+xa.displaySize[0]}}(v[xr.icon.name],P.get("icon-offset").evaluate(xr,{},S),P.get("icon-anchor").evaluate(xr,{},S)),wu=ds.sdf,e.sdfIcons===void 0?e.sdfIcons=ds.sdf:e.sdfIcons!==ds.sdf&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ds.pixelRatio!==e.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Ws=Xn(Zn.horizontal)||Zn.vertical;e.iconsInText=!!Ws&&Ws.iconsInText,(Ws||Hs)&&function(xa,fo,Qa,Aa,au,vu,go,vs,mu,Ra,Ac){var Rl=vu.textMaxSize.evaluate(fo,{});Rl===void 0&&(Rl=go);var pc,ns=xa.layers[0].layout,jc=ns.get("icon-offset").evaluate(fo,{},Ac),Xu=Xn(Qa.horizontal),Yf=go/24,Kf=xa.tilePixelRatio*Yf,Kl=xa.tilePixelRatio*Rl/24,Tc=xa.tilePixelRatio*vs,Vc=xa.tilePixelRatio*ns.get("symbol-spacing"),Xh=ns.get("text-padding")*xa.tilePixelRatio,$f=ns.get("icon-padding")*xa.tilePixelRatio,Pc=ns.get("text-max-angle")/180*Math.PI,Yh=ns.get("text-rotation-alignment")==="map"&&ns.get("symbol-placement")!=="point",Kh=ns.get("icon-rotation-alignment")==="map"&&ns.get("symbol-placement")!=="point",ff=ns.get("symbol-placement"),$h=Vc/2,Sh=ns.get("icon-text-fit");Aa&&Sh!=="none"&&(xa.allowVerticalPlacement&&Qa.vertical&&(pc=Fn(Aa,Qa.vertical,Sh,ns.get("icon-text-fit-padding"),jc,Yf)),Xu&&(Aa=Fn(Aa,Xu,Sh,ns.get("icon-text-fit-padding"),jc,Yf)));var Af=function(Pd,wh){wh.x<0||wh.x>=8192||wh.y<0||wh.y>=8192||function(is,dc,Xp,Hc,Ap,Yp,Qh,vc,qh,ih,ep,tp,Tp,Kp,Ah,$p,Jp,Pp,Qp,qp,dl,Th,ed,Mc,Md){var td,Mf,ah,If,oh,sh=is.addToLineVertexArray(dc,Xp),rd=0,nd=0,id=0,ad=0,Mp=-1,Ip=-1,Ic={},od=je(""),Op=0,Lp=0;if(vc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Op=(td=vc.layout.get("text-offset").evaluate(dl,{},Mc).map(function(Ih){return 24*Ih}))[0],Lp=td[1]):(Op=24*vc.layout.get("text-radial-offset").evaluate(dl,{},Mc),Lp=pl),is.allowVerticalPlacement&&Hc.vertical){var Rp=vc.layout.get("text-rotate").evaluate(dl,{},Mc)+90;If=new Ma(qh,dc,ih,ep,tp,Hc.vertical,Tp,Kp,Ah,Rp),Qh&&(oh=new Ma(qh,dc,ih,ep,tp,Qh,Jp,Pp,Ah,Rp))}if(Ap){var Dp=vc.layout.get("icon-rotate").evaluate(dl,{}),sd=vc.layout.get("icon-text-fit")!=="none",ud=Ns(Ap,Dp,ed,sd),kp=Qh?Ns(Qh,Dp,ed,sd):void 0;ah=new Ma(qh,dc,ih,ep,tp,Ap,Jp,Pp,!1,Dp),rd=4*ud.length;var ld=is.iconSizeData,Ph=null;ld.kind==="source"?(Ph=[128*vc.layout.get("icon-size").evaluate(dl,{})])[0]>32640&&Ve(is.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ld.kind==="composite"&&((Ph=[128*Th.compositeIconSizes[0].evaluate(dl,{},Mc),128*Th.compositeIconSizes[1].evaluate(dl,{},Mc)])[0]>32640||Ph[1]>32640)&&Ve(is.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),is.addSymbols(is.icon,ud,Ph,qp,Qp,dl,!1,dc,sh.lineStartIndex,sh.lineLength,-1,Mc),Mp=is.icon.placedSymbolArray.length-1,kp&&(nd=4*kp.length,is.addSymbols(is.icon,kp,Ph,qp,Qp,dl,Rr.vertical,dc,sh.lineStartIndex,sh.lineLength,-1,Mc),Ip=is.icon.placedSymbolArray.length-1)}for(var Fp in Hc.horizontal){var rp=Hc.horizontal[Fp];if(!Mf){od=je(rp.text);var Id=vc.layout.get("text-rotate").evaluate(dl,{},Mc);Mf=new Ma(qh,dc,ih,ep,tp,rp,Tp,Kp,Ah,Id)}var cd=rp.positionedLines.length===1;if(id+=er(is,dc,rp,Yp,vc,Ah,dl,$p,sh,Hc.vertical?Rr.horizontal:Rr.horizontalOnly,cd?Object.keys(Hc.horizontal):[Fp],Ic,Mp,Th,Mc),cd)break}Hc.vertical&&(ad+=er(is,dc,Hc.vertical,Yp,vc,Ah,dl,$p,sh,Rr.vertical,["vertical"],Ic,Ip,Th,Mc));var Od=Mf?Mf.boxStartIndex:is.collisionBoxArray.length,Ld=Mf?Mf.boxEndIndex:is.collisionBoxArray.length,Rd=If?If.boxStartIndex:is.collisionBoxArray.length,Dd=If?If.boxEndIndex:is.collisionBoxArray.length,kd=ah?ah.boxStartIndex:is.collisionBoxArray.length,fd=ah?ah.boxEndIndex:is.collisionBoxArray.length,hd=oh?oh.boxStartIndex:is.collisionBoxArray.length,pd=oh?oh.boxEndIndex:is.collisionBoxArray.length,Yu=-1,Mh=function(Ih,vd){return Ih&&Ih.circleDiameter?Math.max(Ih.circleDiameter,vd):vd};Yu=Mh(Mf,Yu),Yu=Mh(If,Yu),Yu=Mh(ah,Yu);var dd=(Yu=Mh(oh,Yu))>-1?1:0;dd&&(Yu*=Md/24),is.glyphOffsetArray.length>=at.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dl.sortKey!==void 0&&is.addToSortKeyRanges(is.symbolInstances.length,dl.sortKey),is.symbolInstances.emplaceBack(dc.x,dc.y,Ic.right>=0?Ic.right:-1,Ic.center>=0?Ic.center:-1,Ic.left>=0?Ic.left:-1,Ic.vertical||-1,Mp,Ip,od,Od,Ld,Rd,Dd,kd,fd,hd,pd,ih,id,ad,rd,nd,dd,0,Tp,Op,Lp,Yu)}(xa,wh,Pd,Qa,Aa,au,pc,xa.layers[0],xa.collisionBoxArray,fo.index,fo.sourceLayerIndex,xa.index,Kf,Xh,Yh,mu,Tc,$f,Kh,jc,fo,vu,Ra,Ac,go)};if(ff==="line")for(var Eh=0,Sp=Is(fo.geometry,0,0,8192,8192);Eh<Sp.length;Eh+=1)for(var Ep=Sp[Eh],Jf=0,Qf=Uo(Ep,Vc,Pc,Qa.vertical||Xu,Aa,24,Kl,xa.overscaling,8192);Jf<Qf.length;Jf+=1){var Cp=Qf[Jf];Xu&&fa(xa,Xu.text,$h,Cp)||Af(Ep,Cp)}else if(ff==="line-center")for(var Tf=0,Gc=fo.geometry;Tf<Gc.length;Tf+=1){var Jh=Gc[Tf];if(Jh.length>1){var qf=Xo(Jh,Pc,Qa.vertical||Xu,Aa,24,Kl);qf&&Af(Jh,qf)}}else if(fo.type==="Polygon")for(var hf=0,pf=of(fo.geometry,0);hf<pf.length;hf+=1){var eh=pf[hf],th=ca(eh,16);Af(eh[0],new wn(th.x,th.y,0))}else if(fo.type==="LineString")for(var ms=0,Ch=fo.geometry;ms<Ch.length;ms+=1){var rh=Ch[ms];Af(rh,new wn(rh[0].x,rh[0].y,0))}else if(fo.type==="Point")for(var qa=0,Wp=fo.geometry;qa<Wp.length;qa+=1)for(var Pf=0,nh=Wp[qa];Pf<nh.length;Pf+=1){var wp=nh[Pf];Af([wp],new wn(wp.x,wp.y,0))}}(e,xr,Zn,Hs,f,H,Cn,ti,$n,wu,S)},Qt=0,mr=e.features;Qt<mr.length;Qt+=1)Dt();g&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var g,S=1/Math.tan(t/2);return e[0]=S/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=S,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(g=1/(f-v)),e[14]=2*v*f*g):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Po,p.polygonIntersectsPolygon=Qn,p.postMapLoadEvent=Je,p.postTurnstileEvent=Er,p.potpack=Zt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Rn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Ts,pluginURL:xu}),ic.on("pluginStateChange",e),e},p.renderColorRamp=df,p.rotate=function(e,t,r){var f=t[0],v=t[1],g=t[2],S=t[3],P=Math.sin(r),F=Math.cos(r);return e[0]=f*F+g*P,e[1]=v*F+S*P,e[2]=f*-P+g*F,e[3]=v*-P+S*F,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[4],S=t[5],P=t[6],F=t[7],H=t[8],Q=t[9],oe=t[10],ve=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=g*v+H*f,e[5]=S*v+Q*f,e[6]=P*v+oe*f,e[7]=F*v+ve*f,e[8]=H*v-g*f,e[9]=Q*v-S*f,e[10]=oe*v-P*f,e[11]=ve*v-F*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[0],S=t[1],P=t[2],F=t[3],H=t[4],Q=t[5],oe=t[6],ve=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=g*v+H*f,e[1]=S*v+Q*f,e[2]=P*v+oe*f,e[3]=F*v+ve*f,e[4]=H*v-g*f,e[5]=Q*v-S*f,e[6]=oe*v-P*f,e[7]=ve*v-F*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],g=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*g,e[9]=t[9]*g,e[10]=t[10]*g,e[11]=t[11]*g,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){ct=e,It=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Ts==="deferred"||Ts==="loading"||Ts==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");xu=Qi.resolveURL(e),Ts="deferred",tu=t,nc(),r||Vs()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=ue,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=zo,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],g=t[2];return e[0]=f*r[0]+v*r[3]+g*r[6],e[1]=f*r[1]+v*r[4]+g*r[7],e[2]=f*r[2]+v*r[5]+g*r[8],e},p.transformMat4=Bs,p.translate=function(e,t,r){var f,v,g,S,P,F,H,Q,oe,ve,Se,We,Ke=r[0],bt=r[1],it=r[2];return t===e?(e[12]=t[0]*Ke+t[4]*bt+t[8]*it+t[12],e[13]=t[1]*Ke+t[5]*bt+t[9]*it+t[13],e[14]=t[2]*Ke+t[6]*bt+t[10]*it+t[14],e[15]=t[3]*Ke+t[7]*bt+t[11]*it+t[15]):(v=t[1],g=t[2],S=t[3],P=t[4],F=t[5],H=t[6],Q=t[7],oe=t[8],ve=t[9],Se=t[10],We=t[11],e[0]=f=t[0],e[1]=v,e[2]=g,e[3]=S,e[4]=P,e[5]=F,e[6]=H,e[7]=Q,e[8]=oe,e[9]=ve,e[10]=Se,e[11]=We,e[12]=f*Ke+P*bt+oe*it+t[12],e[13]=v*Ke+F*bt+ve*it+t[13],e[14]=g*Ke+H*bt+Se*it+t[14],e[15]=S*Ke+Q*bt+We*it+t[15]),e},p.triggerPluginCompletionEvent=Qc,p.uniqueId=Ct,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=Jc,p.validateStyle=es,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=wc,p.version="1.13.2",p.warnOnce=Ve,p.webpSupported=ge,p.window=Z,p.wrap=zt}),b(["./shared"],function(p){"use strict";function X(ee){var fe=typeof ee;if(fe==="number"||fe==="boolean"||fe==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){for(var me="[",N=0,ae=ee;N<ae.length;N+=1)me+=X(ae[N])+",";return me+"]"}for(var de=Object.keys(ee).sort(),Te="{",ue=0;ue<de.length;ue++)Te+=JSON.stringify(de[ue])+":"+X(ee[de[ue]])+",";return Te+"}"}function U(ee){for(var fe="",me=0,N=p.refProperties;me<N.length;me+=1)fe+="/"+X(ee[N[me]]);return fe}var Y=function(ee){this.keyCache={},ee&&this.replace(ee)};Y.prototype.replace=function(ee){this._layerConfigs={},this._layers={},this.update(ee,[])},Y.prototype.update=function(ee,fe){for(var me=this,N=0,ae=ee;N<ae.length;N+=1){var de=ae[N];this._layerConfigs[de.id]=de;var Te=this._layers[de.id]=p.createStyleLayer(de);Te._featureFilter=p.featureFilter(Te.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(var ue=0,xe=fe;ue<xe.length;ue+=1){var pt=xe[ue];delete this.keyCache[pt],delete this._layerConfigs[pt],delete this._layers[pt]}this.familiesBySource={};for(var Cr=0,Kt=function(hn,yn){for(var Ni={},Tn=0;Tn<hn.length;Tn++){var Di=yn&&yn[hn[Tn].id]||U(hn[Tn]);yn&&(yn[hn[Tn].id]=Di);var ra=Ni[Di];ra||(ra=Ni[Di]=[]),ra.push(hn[Tn])}var hi=[];for(var na in Ni)hi.push(Ni[na]);return hi}(p.values(this._layerConfigs),this.keyCache);Cr<Kt.length;Cr+=1){var rr=Kt[Cr].map(function(hn){return me._layers[hn.id]}),Zr=rr[0];if(Zr.visibility!=="none"){var Nn=Zr.source||"",Bn=this.familiesBySource[Nn];Bn||(Bn=this.familiesBySource[Nn]={});var tr=Zr.sourceLayer||"_geojsonTileLayer",In=Bn[tr];In||(In=Bn[tr]=[]),In.push(rr)}}};var $=function(ee){var fe={},me=[];for(var N in ee){var ae=ee[N],de=fe[N]={};for(var Te in ae){var ue=ae[+Te];if(ue&&ue.bitmap.width!==0&&ue.bitmap.height!==0){var xe={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};me.push(xe),de[Te]={rect:xe,metrics:ue.metrics}}}}var pt=p.potpack(me),Cr=new p.AlphaImage({width:pt.w||1,height:pt.h||1});for(var Kt in ee){var rr=ee[Kt];for(var Zr in rr){var Nn=rr[+Zr];if(Nn&&Nn.bitmap.width!==0&&Nn.bitmap.height!==0){var Bn=fe[Kt][Zr].rect;p.AlphaImage.copy(Nn.bitmap,Cr,{x:0,y:0},{x:Bn.x+1,y:Bn.y+1},Nn.bitmap)}}}this.image=Cr,this.positions=fe};p.register("GlyphAtlas",$);var he=function(ee){this.tileID=new p.OverscaledTileID(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId};function Z(ee,fe,me){for(var N=new p.EvaluationParameters(fe),ae=0,de=ee;ae<de.length;ae+=1)de[ae].recalculate(N,me)}function Ie(ee,fe){var me=p.getArrayBuffer(ee.request,function(N,ae,de,Te){N?fe(N):ae&&fe(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ae)),rawData:ae,cacheControl:de,expires:Te})});return function(){me.cancel(),fe()}}he.prototype.parse=function(ee,fe,me,N,ae){var de=this;this.status="parsing",this.data=ee,this.collisionBoxArray=new p.CollisionBoxArray;var Te=new p.DictionaryCoder(Object.keys(ee.layers).sort()),ue=new p.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var xe,pt,Cr,Kt,rr={},Zr={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},Nn=fe.familiesBySource[this.source];for(var Bn in Nn){var tr=ee.layers[Bn];if(tr){tr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+Bn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var In=Te.encode(Bn),hn=[],yn=0;yn<tr.length;yn++){var Ni=tr.feature(yn),Tn=ue.getId(Ni,Bn);hn.push({feature:Ni,id:Tn,index:yn,sourceLayerIndex:In})}for(var Di=0,ra=Nn[Bn];Di<ra.length;Di+=1){var hi=ra[Di],na=hi[0];na.minzoom&&this.zoom<Math.floor(na.minzoom)||na.maxzoom&&this.zoom>=na.maxzoom||na.visibility!=="none"&&(Z(hi,this.zoom,me),(rr[na.id]=na.createBucket({index:ue.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source})).populate(hn,Zr,this.tileID.canonical),ue.bucketLayerIDs.push(hi.map(function(Yi){return Yi.id})))}}}var Xi=p.mapObject(Zr.glyphDependencies,function(Yi){return Object.keys(Yi).map(Number)});Object.keys(Xi).length?N.send("getGlyphs",{uid:this.uid,stacks:Xi},function(Yi,zi){xe||(xe=Yi,pt=zi,Da.call(de))}):pt={};var Ii=Object.keys(Zr.iconDependencies);Ii.length?N.send("getImages",{icons:Ii,source:this.source,tileID:this.tileID,type:"icons"},function(Yi,zi){xe||(xe=Yi,Cr=zi,Da.call(de))}):Cr={};var ma=Object.keys(Zr.patternDependencies);function Da(){if(xe)return ae(xe);if(pt&&Cr&&Kt){var Yi=new $(pt),zi=new p.ImageAtlas(Cr,Kt);for(var Ki in rr){var to=rr[Ki];to instanceof p.SymbolBucket?(Z(to.layers,this.zoom,me),p.performSymbolLayout(to,pt,Yi.positions,Cr,zi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):to.hasPattern&&(to instanceof p.LineBucket||to instanceof p.FillBucket||to instanceof p.FillExtrusionBucket)&&(Z(to.layers,this.zoom,me),to.addFeatures(Zr,this.tileID.canonical,zi.patternPositions))}this.status="done",ae(null,{buckets:p.values(rr).filter(function($o){return!$o.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yi.image,imageAtlas:zi,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?Cr:null,glyphPositions:this.returnDependencies?Yi.positions:null})}}ma.length?N.send("getImages",{icons:ma,source:this.source,tileID:this.tileID,type:"patterns"},function(Yi,zi){xe||(xe=Yi,Kt=zi,Da.call(de))}):Kt={},Da.call(this)};var Le=function(ee,fe,me,N){this.actor=ee,this.layerIndex=fe,this.availableImages=me,this.loadVectorData=N||Ie,this.loading={},this.loaded={}};Le.prototype.loadTile=function(ee,fe){var me=this,N=ee.uid;this.loading||(this.loading={});var ae=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new p.RequestPerformance(ee.request),de=this.loading[N]=new he(ee);de.abort=this.loadVectorData(ee,function(Te,ue){if(delete me.loading[N],Te||!ue)return de.status="done",me.loaded[N]=de,fe(Te);var xe=ue.rawData,pt={};ue.expires&&(pt.expires=ue.expires),ue.cacheControl&&(pt.cacheControl=ue.cacheControl);var Cr={};if(ae){var Kt=ae.finish();Kt&&(Cr.resourceTiming=JSON.parse(JSON.stringify(Kt)))}de.vectorTile=ue.vectorTile,de.parse(ue.vectorTile,me.layerIndex,me.availableImages,me.actor,function(rr,Zr){if(rr||!Zr)return fe(rr);fe(null,p.extend({rawTileData:xe.slice(0)},Zr,pt,Cr))}),me.loaded=me.loaded||{},me.loaded[N]=de})},Le.prototype.reloadTile=function(ee,fe){var me=this,N=this.loaded,ae=ee.uid,de=this;if(N&&N[ae]){var Te=N[ae];Te.showCollisionBoxes=ee.showCollisionBoxes;var ue=function(xe,pt){var Cr=Te.reloadCallback;Cr&&(delete Te.reloadCallback,Te.parse(Te.vectorTile,de.layerIndex,me.availableImages,de.actor,Cr)),fe(xe,pt)};Te.status==="parsing"?Te.reloadCallback=ue:Te.status==="done"&&(Te.vectorTile?Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},Le.prototype.abortTile=function(ee,fe){var me=this.loading,N=ee.uid;me&&me[N]&&me[N].abort&&(me[N].abort(),delete me[N]),fe()},Le.prototype.removeTile=function(ee,fe){var me=this.loaded,N=ee.uid;me&&me[N]&&delete me[N],fe()};var rt=p.window.ImageBitmap,$t=function(){this.loaded={}};function zt(ee,fe){if(ee.length!==0){Lt(ee[0],fe);for(var me=1;me<ee.length;me++)Lt(ee[me],!fe)}}function Lt(ee,fe){for(var me=0,N=0,ae=ee.length,de=ae-1;N<ae;de=N++)me+=(ee[N][0]-ee[de][0])*(ee[de][1]+ee[N][1]);me>=0!=!!fe&&ee.reverse()}$t.prototype.loadTile=function(ee,fe){var me=ee.uid,N=ee.encoding,ae=ee.rawImageData,de=rt&&ae instanceof rt?this.getImageData(ae):ae,Te=new p.DEMData(me,de,N);this.loaded=this.loaded||{},this.loaded[me]=Te,fe(null,Te)},$t.prototype.getImageData=function(ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);var fe=this.offscreenCanvasContext.getImageData(-1,-1,ee.width+2,ee.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:fe.width,height:fe.height},fe.data)},$t.prototype.removeTile=function(ee){var fe=this.loaded,me=ee.uid;fe&&fe[me]&&delete fe[me]};var Ht=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ct=function(ee){this._feature=ee,this.extent=p.EXTENT,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))};Ct.prototype.loadGeometry=function(){if(this._feature.type===1){for(var ee=[],fe=0,me=this._feature.geometry;fe<me.length;fe+=1){var N=me[fe];ee.push([new p.Point$1(N[0],N[1])])}return ee}for(var ae=[],de=0,Te=this._feature.geometry;de<Te.length;de+=1){for(var ue=[],xe=0,pt=Te[de];xe<pt.length;xe+=1){var Cr=pt[xe];ue.push(new p.Point$1(Cr[0],Cr[1]))}ae.push(ue)}return ae},Ct.prototype.toGeoJSON=function(ee,fe,me){return Ht.call(this,ee,fe,me)};var yt=function(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=ee.length,this._features=ee};yt.prototype.feature=function(ee){return new Ct(this._features[ee])};var ft=p.vectorTile.VectorTileFeature,sr=re;function re(ee,fe){this.options=fe||{},this.features=ee,this.length=ee.length}function nr(ee,fe){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=fe||4096}re.prototype.feature=function(ee){return new nr(this.features[ee],this.options.extent)},nr.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var fe=0;fe<ee.length;fe++){for(var me=ee[fe],N=[],ae=0;ae<me.length;ae++)N.push(new p.Point$1(me[ae][0],me[ae][1]));this.geometry.push(N)}return this.geometry},nr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,fe=1/0,me=-1/0,N=1/0,ae=-1/0,de=0;de<ee.length;de++)for(var Te=ee[de],ue=0;ue<Te.length;ue++){var xe=Te[ue];fe=Math.min(fe,xe.x),me=Math.max(me,xe.x),N=Math.min(N,xe.y),ae=Math.max(ae,xe.y)}return[fe,N,me,ae]},nr.prototype.toGeoJSON=ft.prototype.toGeoJSON;var Tt=Mt,$e=sr;function Mt(ee){var fe=new p.pbf;return function(me,N){for(var ae in me.layers)N.writeMessage(3,Ve,me.layers[ae])}(ee,fe),fe.finish()}function Ve(ee,fe){var me;fe.writeVarintField(15,ee.version||1),fe.writeStringField(1,ee.name||""),fe.writeVarintField(5,ee.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<ee.length;me++)N.feature=ee.feature(me),fe.writeMessage(2,Ot,N);var ae=N.keys;for(me=0;me<ae.length;me++)fe.writeStringField(3,ae[me]);var de=N.values;for(me=0;me<de.length;me++)fe.writeMessage(4,ke,de[me])}function Ot(ee,fe){var me=ee.feature;me.id!==void 0&&fe.writeVarintField(1,me.id),fe.writeMessage(2,pr,ee),fe.writeVarintField(3,me.type),fe.writeMessage(4,se,me)}function pr(ee,fe){var me=ee.feature,N=ee.keys,ae=ee.values,de=ee.keycache,Te=ee.valuecache;for(var ue in me.properties){var xe=de[ue];xe===void 0&&(N.push(ue),de[ue]=xe=N.length-1),fe.writeVarint(xe);var pt=me.properties[ue],Cr=typeof pt;Cr!=="string"&&Cr!=="boolean"&&Cr!=="number"&&(pt=JSON.stringify(pt));var Kt=Cr+":"+pt,rr=Te[Kt];rr===void 0&&(ae.push(pt),Te[Kt]=rr=ae.length-1),fe.writeVarint(rr)}}function qt(ee,fe){return(fe<<3)+(7&ee)}function W(ee){return ee<<1^ee>>31}function se(ee,fe){for(var me=ee.loadGeometry(),N=ee.type,ae=0,de=0,Te=me.length,ue=0;ue<Te;ue++){var xe=me[ue],pt=1;N===1&&(pt=xe.length),fe.writeVarint(qt(1,pt));for(var Cr=N===3?xe.length-1:xe.length,Kt=0;Kt<Cr;Kt++){Kt===1&&N!==1&&fe.writeVarint(qt(2,Cr-1));var rr=xe[Kt].x-ae,Zr=xe[Kt].y-de;fe.writeVarint(W(rr)),fe.writeVarint(W(Zr)),ae+=rr,de+=Zr}N===3&&fe.writeVarint(qt(7,1))}}function ke(ee,fe){var me=typeof ee;me==="string"?fe.writeStringField(1,ee):me==="boolean"?fe.writeBooleanField(7,ee):me==="number"&&(ee%1!=0?fe.writeDoubleField(3,ee):ee<0?fe.writeSVarintField(6,ee):fe.writeVarintField(5,ee))}function _e(ee,fe,me,N){Et(ee,me,N),Et(fe,2*me,2*N),Et(fe,2*me+1,2*N+1)}function Et(ee,fe,me){var N=ee[fe];ee[fe]=ee[me],ee[me]=N}function gt(ee,fe,me,N){var ae=ee-me,de=fe-N;return ae*ae+de*de}Tt.fromVectorTileJs=Mt,Tt.fromGeojsonVt=function(ee,fe){fe=fe||{};var me={};for(var N in ee)me[N]=new sr(ee[N].features,fe),me[N].name=N,me[N].version=fe.version,me[N].extent=fe.extent;return Mt({layers:me})},Tt.GeoJSONWrapper=$e;var jt=function(ee){return ee[0]},Ut=function(ee){return ee[1]},zr=function(ee,fe,me,N,ae){fe===void 0&&(fe=jt),me===void 0&&(me=Ut),N===void 0&&(N=64),ae===void 0&&(ae=Float64Array),this.nodeSize=N,this.points=ee;for(var de=ee.length<65536?Uint16Array:Uint32Array,Te=this.ids=new de(ee.length),ue=this.coords=new ae(2*ee.length),xe=0;xe<ee.length;xe++)Te[xe]=xe,ue[2*xe]=fe(ee[xe]),ue[2*xe+1]=me(ee[xe]);(function pt(Cr,Kt,rr,Zr,Nn,Bn){if(!(Nn-Zr<=rr)){var tr=Zr+Nn>>1;(function In(hn,yn,Ni,Tn,Di,ra){for(;Di>Tn;){if(Di-Tn>600){var hi=Di-Tn+1,na=Ni-Tn+1,Xi=Math.log(hi),Ii=.5*Math.exp(2*Xi/3),ma=.5*Math.sqrt(Xi*Ii*(hi-Ii)/hi)*(na-hi/2<0?-1:1);In(hn,yn,Ni,Math.max(Tn,Math.floor(Ni-na*Ii/hi+ma)),Math.min(Di,Math.floor(Ni+(hi-na)*Ii/hi+ma)),ra)}var Da=yn[2*Ni+ra],Yi=Tn,zi=Di;for(_e(hn,yn,Tn,Ni),yn[2*Di+ra]>Da&&_e(hn,yn,Tn,Di);Yi<zi;){for(_e(hn,yn,Yi,zi),Yi++,zi--;yn[2*Yi+ra]<Da;)Yi++;for(;yn[2*zi+ra]>Da;)zi--}yn[2*Tn+ra]===Da?_e(hn,yn,Tn,zi):_e(hn,yn,++zi,Di),zi<=Ni&&(Tn=zi+1),Ni<=zi&&(Di=zi-1)}})(Cr,Kt,tr,Zr,Nn,Bn%2),pt(Cr,Kt,rr,Zr,tr-1,Bn+1),pt(Cr,Kt,rr,tr+1,Nn,Bn+1)}})(Te,ue,N,0,Te.length-1,0)};zr.prototype.range=function(ee,fe,me,N){return function(ae,de,Te,ue,xe,pt,Cr){for(var Kt,rr,Zr=[0,ae.length-1,0],Nn=[];Zr.length;){var Bn=Zr.pop(),tr=Zr.pop(),In=Zr.pop();if(tr-In<=Cr)for(var hn=In;hn<=tr;hn++)rr=de[2*hn+1],(Kt=de[2*hn])>=Te&&Kt<=xe&&rr>=ue&&rr<=pt&&Nn.push(ae[hn]);else{var yn=Math.floor((In+tr)/2);rr=de[2*yn+1],(Kt=de[2*yn])>=Te&&Kt<=xe&&rr>=ue&&rr<=pt&&Nn.push(ae[yn]);var Ni=(Bn+1)%2;(Bn===0?Te<=Kt:ue<=rr)&&(Zr.push(In),Zr.push(yn-1),Zr.push(Ni)),(Bn===0?xe>=Kt:pt>=rr)&&(Zr.push(yn+1),Zr.push(tr),Zr.push(Ni))}}return Nn}(this.ids,this.coords,ee,fe,me,N,this.nodeSize)},zr.prototype.within=function(ee,fe,me){return function(N,ae,de,Te,ue,xe){for(var pt=[0,N.length-1,0],Cr=[],Kt=ue*ue;pt.length;){var rr=pt.pop(),Zr=pt.pop(),Nn=pt.pop();if(Zr-Nn<=xe)for(var Bn=Nn;Bn<=Zr;Bn++)gt(ae[2*Bn],ae[2*Bn+1],de,Te)<=Kt&&Cr.push(N[Bn]);else{var tr=Math.floor((Nn+Zr)/2),In=ae[2*tr],hn=ae[2*tr+1];gt(In,hn,de,Te)<=Kt&&Cr.push(N[tr]);var yn=(rr+1)%2;(rr===0?de-ue<=In:Te-ue<=hn)&&(pt.push(Nn),pt.push(tr-1),pt.push(yn)),(rr===0?de+ue>=In:Te+ue>=hn)&&(pt.push(tr+1),pt.push(Zr),pt.push(yn))}}return Cr}(this.ids,this.coords,ee,fe,me,this.nodeSize)};var dn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ee){return ee}},_n=function(ee){this.options=Nt(Object.create(dn),ee),this.trees=new Array(this.options.maxZoom+1)};function Qi(ee,fe,me,N,ae){return{x:ee,y:fe,zoom:1/0,id:me,parentId:-1,numPoints:N,properties:ae}}function ur(ee,fe){var me=ee.geometry.coordinates,N=me[1];return{x:Ge(me[0]),y:Re(N),zoom:1/0,index:fe,parentId:-1}}function ge(ee){return{type:"Feature",id:ee.id,properties:Pe(ee),geometry:{type:"Point",coordinates:[(N=ee.x,360*(N-.5)),(fe=ee.y,me=(180-360*fe)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var fe,me,N}function Pe(ee){var fe=ee.numPoints,me=fe>=1e4?Math.round(fe/1e3)+"k":fe>=1e3?Math.round(fe/100)/10+"k":fe;return Nt(Nt({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:fe,point_count_abbreviated:me})}function Ge(ee){return ee/360+.5}function Re(ee){var fe=Math.sin(ee*Math.PI/180),me=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return me<0?0:me>1?1:me}function Nt(ee,fe){for(var me in fe)ee[me]=fe[me];return ee}function ar(ee){return ee.x}function yr(ee){return ee.y}function Lr(ee,fe,me,N,ae,de){var Te=ae-me,ue=de-N;if(Te!==0||ue!==0){var xe=((ee-me)*Te+(fe-N)*ue)/(Te*Te+ue*ue);xe>1?(me=ae,N=de):xe>0&&(me+=Te*xe,N+=ue*xe)}return(Te=ee-me)*Te+(ue=fe-N)*ue}function fr(ee,fe,me,N){var ae={id:ee===void 0?null:ee,type:fe,geometry:me,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Te=de.geometry,ue=de.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Fr(de,Te);else if(ue==="Polygon"||ue==="MultiLineString")for(var xe=0;xe<Te.length;xe++)Fr(de,Te[xe]);else if(ue==="MultiPolygon")for(xe=0;xe<Te.length;xe++)for(var pt=0;pt<Te[xe].length;pt++)Fr(de,Te[xe][pt])}(ae),ae}function Fr(ee,fe){for(var me=0;me<fe.length;me+=3)ee.minX=Math.min(ee.minX,fe[me]),ee.minY=Math.min(ee.minY,fe[me+1]),ee.maxX=Math.max(ee.maxX,fe[me]),ee.maxY=Math.max(ee.maxY,fe[me+1])}function C(ee,fe,me,N){if(fe.geometry){var ae=fe.geometry.coordinates,de=fe.geometry.type,Te=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),ue=[],xe=fe.id;if(me.promoteId?xe=fe.properties[me.promoteId]:me.generateId&&(xe=N||0),de==="Point")G(ae,ue);else if(de==="MultiPoint")for(var pt=0;pt<ae.length;pt++)G(ae[pt],ue);else if(de==="LineString")Ze(ae,ue,Te,!1);else if(de==="MultiLineString"){if(me.lineMetrics){for(pt=0;pt<ae.length;pt++)Ze(ae[pt],ue=[],Te,!1),ee.push(fr(xe,"LineString",ue,fe.properties));return}tt(ae,ue,Te,!1)}else if(de==="Polygon")tt(ae,ue,Te,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(pt=0;pt<fe.geometry.geometries.length;pt++)C(ee,{id:xe,geometry:fe.geometry.geometries[pt],properties:fe.properties},me,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pt=0;pt<ae.length;pt++){var Cr=[];tt(ae[pt],Cr,Te,!0),ue.push(Cr)}}ee.push(fr(xe,de,ue,fe.properties))}}function G(ee,fe){fe.push(lt(ee[0])),fe.push(Pt(ee[1])),fe.push(0)}function Ze(ee,fe,me,N){for(var ae,de,Te=0,ue=0;ue<ee.length;ue++){var xe=lt(ee[ue][0]),pt=Pt(ee[ue][1]);fe.push(xe),fe.push(pt),fe.push(0),ue>0&&(Te+=N?(ae*pt-xe*de)/2:Math.sqrt(Math.pow(xe-ae,2)+Math.pow(pt-de,2))),ae=xe,de=pt}var Cr=fe.length-3;fe[2]=1,function Kt(rr,Zr,Nn,Bn){for(var tr,In=Bn,hn=Nn-Zr>>1,yn=Nn-Zr,Ni=rr[Zr],Tn=rr[Zr+1],Di=rr[Nn],ra=rr[Nn+1],hi=Zr+3;hi<Nn;hi+=3){var na=Lr(rr[hi],rr[hi+1],Ni,Tn,Di,ra);if(na>In)tr=hi,In=na;else if(na===In){var Xi=Math.abs(hi-hn);Xi<yn&&(tr=hi,yn=Xi)}}In>Bn&&(tr-Zr>3&&Kt(rr,Zr,tr,Bn),rr[tr+2]=In,Nn-tr>3&&Kt(rr,tr,Nn,Bn))}(fe,0,Cr,me),fe[Cr+2]=1,fe.size=Math.abs(Te),fe.start=0,fe.end=fe.size}function tt(ee,fe,me,N){for(var ae=0;ae<ee.length;ae++){var de=[];Ze(ee[ae],de,me,N),fe.push(de)}}function lt(ee){return ee/360+.5}function Pt(ee){var fe=Math.sin(ee*Math.PI/180),me=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return me<0?0:me>1?1:me}function q(ee,fe,me,N,ae,de,Te,ue){if(N/=fe,de>=(me/=fe)&&Te<N)return ee;if(Te<me||de>=N)return null;for(var xe=[],pt=0;pt<ee.length;pt++){var Cr=ee[pt],Kt=Cr.geometry,rr=Cr.type,Zr=ae===0?Cr.minX:Cr.minY,Nn=ae===0?Cr.maxX:Cr.maxY;if(Zr>=me&&Nn<N)xe.push(Cr);else if(!(Nn<me||Zr>=N)){var Bn=[];if(rr==="Point"||rr==="MultiPoint")kt(Kt,Bn,me,N,ae);else if(rr==="LineString")Er(Kt,Bn,me,N,ae,!1,ue.lineMetrics);else if(rr==="MultiLineString")Je(Kt,Bn,me,N,ae,!1);else if(rr==="Polygon")Je(Kt,Bn,me,N,ae,!0);else if(rr==="MultiPolygon")for(var tr=0;tr<Kt.length;tr++){var In=[];Je(Kt[tr],In,me,N,ae,!0),In.length&&Bn.push(In)}if(Bn.length){if(ue.lineMetrics&&rr==="LineString"){for(tr=0;tr<Bn.length;tr++)xe.push(fr(Cr.id,rr,Bn[tr],Cr.tags));continue}rr!=="LineString"&&rr!=="MultiLineString"||(Bn.length===1?(rr="LineString",Bn=Bn[0]):rr="MultiLineString"),rr!=="Point"&&rr!=="MultiPoint"||(rr=Bn.length===3?"Point":"MultiPoint"),xe.push(fr(Cr.id,rr,Bn,Cr.tags))}}}return xe.length?xe:null}function kt(ee,fe,me,N,ae){for(var de=0;de<ee.length;de+=3){var Te=ee[de+ae];Te>=me&&Te<=N&&(fe.push(ee[de]),fe.push(ee[de+1]),fe.push(ee[de+2]))}}function Er(ee,fe,me,N,ae,de,Te){for(var ue,xe,pt=Mr(ee),Cr=ae===0?It:Bt,Kt=ee.start,rr=0;rr<ee.length-3;rr+=3){var Zr=ee[rr],Nn=ee[rr+1],Bn=ee[rr+2],tr=ee[rr+3],In=ee[rr+4],hn=ae===0?Zr:Nn,yn=ae===0?tr:In,Ni=!1;Te&&(ue=Math.sqrt(Math.pow(Zr-tr,2)+Math.pow(Nn-In,2))),hn<me?yn>me&&(xe=Cr(pt,Zr,Nn,tr,In,me),Te&&(pt.start=Kt+ue*xe)):hn>N?yn<N&&(xe=Cr(pt,Zr,Nn,tr,In,N),Te&&(pt.start=Kt+ue*xe)):ct(pt,Zr,Nn,Bn),yn<me&&hn>=me&&(xe=Cr(pt,Zr,Nn,tr,In,me),Ni=!0),yn>N&&hn<=N&&(xe=Cr(pt,Zr,Nn,tr,In,N),Ni=!0),!de&&Ni&&(Te&&(pt.end=Kt+ue*xe),fe.push(pt),pt=Mr(ee)),Te&&(Kt+=ue)}var Tn=ee.length-3;Zr=ee[Tn],Nn=ee[Tn+1],Bn=ee[Tn+2],(hn=ae===0?Zr:Nn)>=me&&hn<=N&&ct(pt,Zr,Nn,Bn),Tn=pt.length-3,de&&Tn>=3&&(pt[Tn]!==pt[0]||pt[Tn+1]!==pt[1])&&ct(pt,pt[0],pt[1],pt[2]),pt.length&&fe.push(pt)}function Mr(ee){var fe=[];return fe.size=ee.size,fe.start=ee.start,fe.end=ee.end,fe}function Je(ee,fe,me,N,ae,de){for(var Te=0;Te<ee.length;Te++)Er(ee[Te],fe,me,N,ae,de,!1)}function ct(ee,fe,me,N){ee.push(fe),ee.push(me),ee.push(N)}function It(ee,fe,me,N,ae,de){var Te=(de-fe)/(N-fe);return ee.push(de),ee.push(me+(ae-me)*Te),ee.push(1),Te}function Bt(ee,fe,me,N,ae,de){var Te=(de-me)/(ae-me);return ee.push(fe+(N-fe)*Te),ee.push(de),ee.push(1),Te}function br(ee,fe){for(var me=[],N=0;N<ee.length;N++){var ae,de=ee[N],Te=de.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")ae=Tr(de.geometry,fe);else if(Te==="MultiLineString"||Te==="Polygon"){ae=[];for(var ue=0;ue<de.geometry.length;ue++)ae.push(Tr(de.geometry[ue],fe))}else if(Te==="MultiPolygon")for(ae=[],ue=0;ue<de.geometry.length;ue++){for(var xe=[],pt=0;pt<de.geometry[ue].length;pt++)xe.push(Tr(de.geometry[ue][pt],fe));ae.push(xe)}me.push(fr(de.id,Te,ae,de.tags))}return me}function Tr(ee,fe){var me=[];me.size=ee.size,ee.start!==void 0&&(me.start=ee.start,me.end=ee.end);for(var N=0;N<ee.length;N+=3)me.push(ee[N]+fe,ee[N+1],ee[N+2]);return me}function qe(ee,fe){if(ee.transformed)return ee;var me,N,ae,de=1<<ee.z,Te=ee.x,ue=ee.y;for(me=0;me<ee.features.length;me++){var xe=ee.features[me],pt=xe.geometry,Cr=xe.type;if(xe.geometry=[],Cr===1)for(N=0;N<pt.length;N+=2)xe.geometry.push(Gr(pt[N],pt[N+1],fe,de,Te,ue));else for(N=0;N<pt.length;N++){var Kt=[];for(ae=0;ae<pt[N].length;ae+=2)Kt.push(Gr(pt[N][ae],pt[N][ae+1],fe,de,Te,ue));xe.geometry.push(Kt)}}return ee.transformed=!0,ee}function Gr(ee,fe,me,N,ae,de){return[Math.round(me*(ee*N-ae)),Math.round(me*(fe*N-de))]}function Yr(ee,fe,me,N,ae){for(var de=fe===ae.maxZoom?0:ae.tolerance/((1<<fe)*ae.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:N,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<ee.length;ue++){Te.numFeatures++,An(Te,ee[ue],de,ae);var xe=ee[ue].minX,pt=ee[ue].minY,Cr=ee[ue].maxX,Kt=ee[ue].maxY;xe<Te.minX&&(Te.minX=xe),pt<Te.minY&&(Te.minY=pt),Cr>Te.maxX&&(Te.maxX=Cr),Kt>Te.maxY&&(Te.maxY=Kt)}return Te}function An(ee,fe,me,N){var ae=fe.geometry,de=fe.type,Te=[];if(de==="Point"||de==="MultiPoint")for(var ue=0;ue<ae.length;ue+=3)Te.push(ae[ue]),Te.push(ae[ue+1]),ee.numPoints++,ee.numSimplified++;else if(de==="LineString")vr(Te,ae,ee,me,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ue=0;ue<ae.length;ue++)vr(Te,ae[ue],ee,me,de==="Polygon",ue===0);else if(de==="MultiPolygon")for(var xe=0;xe<ae.length;xe++){var pt=ae[xe];for(ue=0;ue<pt.length;ue++)vr(Te,pt[ue],ee,me,!0,ue===0)}if(Te.length){var Cr=fe.tags||null;if(de==="LineString"&&N.lineMetrics){for(var Kt in Cr={},fe.tags)Cr[Kt]=fe.tags[Kt];Cr.mapbox_clip_start=ae.start/ae.size,Cr.mapbox_clip_end=ae.end/ae.size}var rr={geometry:Te,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Cr};fe.id!==null&&(rr.id=fe.id),ee.features.push(rr)}}function vr(ee,fe,me,N,ae,de){var Te=N*N;if(N>0&&fe.size<(ae?Te:N))me.numPoints+=fe.length/3;else{for(var ue=[],xe=0;xe<fe.length;xe+=3)(N===0||fe[xe+2]>Te)&&(me.numSimplified++,ue.push(fe[xe]),ue.push(fe[xe+1])),me.numPoints++;ae&&function(pt,Cr){for(var Kt=0,rr=0,Zr=pt.length,Nn=Zr-2;rr<Zr;Nn=rr,rr+=2)Kt+=(pt[rr]-pt[Nn])*(pt[rr+1]+pt[Nn+1]);if(Kt>0===Cr)for(rr=0,Zr=pt.length;rr<Zr/2;rr+=2){var Bn=pt[rr],tr=pt[rr+1];pt[rr]=pt[Zr-2-rr],pt[rr+1]=pt[Zr-1-rr],pt[Zr-2-rr]=Bn,pt[Zr-1-rr]=tr}}(ue,de),ee.push(ue)}}function Or(ee,fe){var me=(fe=this.options=function(ae,de){for(var Te in de)ae[Te]=de[Te];return ae}(Object.create(this.options),fe)).debug;if(me&&console.time("preprocess data"),fe.maxZoom<0||fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(fe.promoteId&&fe.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(ae,de){var Te=[];if(ae.type==="FeatureCollection")for(var ue=0;ue<ae.features.length;ue++)C(Te,ae.features[ue],de,ue);else C(Te,ae.type==="Feature"?ae:{geometry:ae},de);return Te}(ee,fe);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",fe.indexMaxZoom,fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(N=function(ae,de){var Te=de.buffer/de.extent,ue=ae,xe=q(ae,1,-1-Te,Te,0,-1,2,de),pt=q(ae,1,1-Te,2+Te,0,-1,2,de);return(xe||pt)&&(ue=q(ae,1,-Te,1+Te,0,-1,2,de)||[],xe&&(ue=br(xe,1).concat(ue)),pt&&(ue=ue.concat(br(pt,-1)))),ue}(N,fe)).length&&this.splitTile(N,0,0,0),me&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function St(ee,fe,me){return 32*((1<<ee)*me+fe)+ee}function Kn(ee,fe){var me=ee.tileID.canonical;if(!this._geoJSONIndex)return fe(null,null);var N=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!N)return fe(null,null);var ae=new yt(N.features),de=Tt(ae);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),fe(null,{vectorTile:ae,rawData:de.buffer})}_n.prototype.load=function(ee){var fe=this.options,me=fe.log,N=fe.minZoom,ae=fe.maxZoom,de=fe.nodeSize;me&&console.time("total time");var Te="prepare "+ee.length+" points";me&&console.time(Te),this.points=ee;for(var ue=[],xe=0;xe<ee.length;xe++)ee[xe].geometry&&ue.push(ur(ee[xe],xe));this.trees[ae+1]=new zr(ue,ar,yr,de,Float32Array),me&&console.timeEnd(Te);for(var pt=ae;pt>=N;pt--){var Cr=+Date.now();ue=this._cluster(ue,pt),this.trees[pt]=new zr(ue,ar,yr,de,Float32Array),me&&console.log("z%d: %d clusters in %dms",pt,ue.length,+Date.now()-Cr)}return me&&console.timeEnd("total time"),this},_n.prototype.getClusters=function(ee,fe){var me=((ee[0]+180)%360+360)%360-180,N=Math.max(-90,Math.min(90,ee[1])),ae=ee[2]===180?180:((ee[2]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)me=-180,ae=180;else if(me>ae){var Te=this.getClusters([me,N,180,de],fe),ue=this.getClusters([-180,N,ae,de],fe);return Te.concat(ue)}for(var xe=this.trees[this._limitZoom(fe)],pt=[],Cr=0,Kt=xe.range(Ge(me),Re(de),Ge(ae),Re(N));Cr<Kt.length;Cr+=1){var rr=xe.points[Kt[Cr]];pt.push(rr.numPoints?ge(rr):this.points[rr.index])}return pt},_n.prototype.getChildren=function(ee){var fe=this._getOriginId(ee),me=this._getOriginZoom(ee),N="No cluster with the specified id.",ae=this.trees[me];if(!ae)throw new Error(N);var de=ae.points[fe];if(!de)throw new Error(N);for(var Te=this.options.radius/(this.options.extent*Math.pow(2,me-1)),ue=[],xe=0,pt=ae.within(de.x,de.y,Te);xe<pt.length;xe+=1){var Cr=ae.points[pt[xe]];Cr.parentId===ee&&ue.push(Cr.numPoints?ge(Cr):this.points[Cr.index])}if(ue.length===0)throw new Error(N);return ue},_n.prototype.getLeaves=function(ee,fe,me){var N=[];return this._appendLeaves(N,ee,fe=fe||10,me=me||0,0),N},_n.prototype.getTile=function(ee,fe,me){var N=this.trees[this._limitZoom(ee)],ae=Math.pow(2,ee),de=this.options,Te=de.radius/de.extent,ue=(me-Te)/ae,xe=(me+1+Te)/ae,pt={features:[]};return this._addTileFeatures(N.range((fe-Te)/ae,ue,(fe+1+Te)/ae,xe),N.points,fe,me,ae,pt),fe===0&&this._addTileFeatures(N.range(1-Te/ae,ue,1,xe),N.points,ae,me,ae,pt),fe===ae-1&&this._addTileFeatures(N.range(0,ue,Te/ae,xe),N.points,-1,me,ae,pt),pt.features.length?pt:null},_n.prototype.getClusterExpansionZoom=function(ee){for(var fe=this._getOriginZoom(ee)-1;fe<=this.options.maxZoom;){var me=this.getChildren(ee);if(fe++,me.length!==1)break;ee=me[0].properties.cluster_id}return fe},_n.prototype._appendLeaves=function(ee,fe,me,N,ae){for(var de=0,Te=this.getChildren(fe);de<Te.length;de+=1){var ue=Te[de],xe=ue.properties;if(xe&&xe.cluster?ae+xe.point_count<=N?ae+=xe.point_count:ae=this._appendLeaves(ee,xe.cluster_id,me,N,ae):ae<N?ae++:ee.push(ue),ee.length===me)break}return ae},_n.prototype._addTileFeatures=function(ee,fe,me,N,ae,de){for(var Te=0,ue=ee;Te<ue.length;Te+=1){var xe=fe[ue[Te]],pt=xe.numPoints,Cr={type:1,geometry:[[Math.round(this.options.extent*(xe.x*ae-me)),Math.round(this.options.extent*(xe.y*ae-N))]],tags:pt?Pe(xe):this.points[xe.index].properties},Kt=void 0;pt?Kt=xe.id:this.options.generateId?Kt=xe.index:this.points[xe.index].id&&(Kt=this.points[xe.index].id),Kt!==void 0&&(Cr.id=Kt),de.features.push(Cr)}},_n.prototype._limitZoom=function(ee){return Math.max(this.options.minZoom,Math.min(+ee,this.options.maxZoom+1))},_n.prototype._cluster=function(ee,fe){for(var me=[],N=this.options,ae=N.reduce,de=N.minPoints,Te=N.radius/(N.extent*Math.pow(2,fe)),ue=0;ue<ee.length;ue++){var xe=ee[ue];if(!(xe.zoom<=fe)){xe.zoom=fe;for(var pt=this.trees[fe+1],Cr=pt.within(xe.x,xe.y,Te),Kt=xe.numPoints||1,rr=Kt,Zr=0,Nn=Cr;Zr<Nn.length;Zr+=1){var Bn=pt.points[Nn[Zr]];Bn.zoom>fe&&(rr+=Bn.numPoints||1)}if(rr>=de){for(var tr=xe.x*Kt,In=xe.y*Kt,hn=ae&&Kt>1?this._map(xe,!0):null,yn=(ue<<5)+(fe+1)+this.points.length,Ni=0,Tn=Cr;Ni<Tn.length;Ni+=1){var Di=pt.points[Tn[Ni]];if(!(Di.zoom<=fe)){Di.zoom=fe;var ra=Di.numPoints||1;tr+=Di.x*ra,In+=Di.y*ra,Di.parentId=yn,ae&&(hn||(hn=this._map(xe,!0)),ae(hn,this._map(Di)))}}xe.parentId=yn,me.push(Qi(tr/rr,In/rr,yn,rr,hn))}else if(me.push(xe),rr>1)for(var hi=0,na=Cr;hi<na.length;hi+=1){var Xi=pt.points[na[hi]];Xi.zoom<=fe||(Xi.zoom=fe,me.push(Xi))}}}return me},_n.prototype._getOriginId=function(ee){return ee-this.points.length>>5},_n.prototype._getOriginZoom=function(ee){return(ee-this.points.length)%32},_n.prototype._map=function(ee,fe){if(ee.numPoints)return fe?Nt({},ee.properties):ee.properties;var me=this.points[ee.index].properties,N=this.options.map(me);return fe&&N===me?Nt({},N):N},Or.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Or.prototype.splitTile=function(ee,fe,me,N,ae,de,Te){for(var ue=[ee,fe,me,N],xe=this.options,pt=xe.debug;ue.length;){N=ue.pop(),me=ue.pop(),fe=ue.pop(),ee=ue.pop();var Cr=1<<fe,Kt=St(fe,me,N),rr=this.tiles[Kt];if(!rr&&(pt>1&&console.time("creation"),rr=this.tiles[Kt]=Yr(ee,fe,me,N,xe),this.tileCoords.push({z:fe,x:me,y:N}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",fe,me,N,rr.numFeatures,rr.numPoints,rr.numSimplified),console.timeEnd("creation"));var Zr="z"+fe;this.stats[Zr]=(this.stats[Zr]||0)+1,this.total++}if(rr.source=ee,ae){if(fe===xe.maxZoom||fe===ae)continue;var Nn=1<<ae-fe;if(me!==Math.floor(de/Nn)||N!==Math.floor(Te/Nn))continue}else if(fe===xe.indexMaxZoom||rr.numPoints<=xe.indexMaxPoints)continue;if(rr.source=null,ee.length!==0){pt>1&&console.time("clipping");var Bn,tr,In,hn,yn,Ni,Tn=.5*xe.buffer/xe.extent,Di=.5-Tn,ra=.5+Tn,hi=1+Tn;Bn=tr=In=hn=null,yn=q(ee,Cr,me-Tn,me+ra,0,rr.minX,rr.maxX,xe),Ni=q(ee,Cr,me+Di,me+hi,0,rr.minX,rr.maxX,xe),ee=null,yn&&(Bn=q(yn,Cr,N-Tn,N+ra,1,rr.minY,rr.maxY,xe),tr=q(yn,Cr,N+Di,N+hi,1,rr.minY,rr.maxY,xe),yn=null),Ni&&(In=q(Ni,Cr,N-Tn,N+ra,1,rr.minY,rr.maxY,xe),hn=q(Ni,Cr,N+Di,N+hi,1,rr.minY,rr.maxY,xe),Ni=null),pt>1&&console.timeEnd("clipping"),ue.push(Bn||[],fe+1,2*me,2*N),ue.push(tr||[],fe+1,2*me,2*N+1),ue.push(In||[],fe+1,2*me+1,2*N),ue.push(hn||[],fe+1,2*me+1,2*N+1)}}},Or.prototype.getTile=function(ee,fe,me){var N=this.options,ae=N.extent,de=N.debug;if(ee<0||ee>24)return null;var Te=1<<ee,ue=St(ee,fe=(fe%Te+Te)%Te,me);if(this.tiles[ue])return qe(this.tiles[ue],ae);de>1&&console.log("drilling down to z%d-%d-%d",ee,fe,me);for(var xe,pt=ee,Cr=fe,Kt=me;!xe&&pt>0;)pt--,Cr=Math.floor(Cr/2),Kt=Math.floor(Kt/2),xe=this.tiles[St(pt,Cr,Kt)];return xe&&xe.source?(de>1&&console.log("found parent tile z%d-%d-%d",pt,Cr,Kt),de>1&&console.time("drilling down"),this.splitTile(xe.source,pt,Cr,Kt,ee,fe,me),de>1&&console.timeEnd("drilling down"),this.tiles[ue]?qe(this.tiles[ue],ae):null):null};var Ln=function(ee){function fe(me,N,ae,de){ee.call(this,me,N,ae,Kn),de&&(this.loadGeoJSON=de)}return ee&&(fe.__proto__=ee),(fe.prototype=Object.create(ee&&ee.prototype)).constructor=fe,fe.prototype.loadData=function(me,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=N,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},fe.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var N=this._pendingCallback,ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var de=!!(ae&&ae.request&&ae.request.collectResourceTiming)&&new p.RequestPerformance(ae.request);this.loadGeoJSON(ae,function(Te,ue){if(Te||!ue)return N(Te);if(typeof ue!="object")return N(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."));(function rr(Zr,Nn){var Bn,tr=Zr&&Zr.type;if(tr==="FeatureCollection")for(Bn=0;Bn<Zr.features.length;Bn++)rr(Zr.features[Bn],Nn);else if(tr==="GeometryCollection")for(Bn=0;Bn<Zr.geometries.length;Bn++)rr(Zr.geometries[Bn],Nn);else if(tr==="Feature")rr(Zr.geometry,Nn);else if(tr==="Polygon")zt(Zr.coordinates,Nn);else if(tr==="MultiPolygon")for(Bn=0;Bn<Zr.coordinates.length;Bn++)zt(Zr.coordinates[Bn],Nn);return Zr})(ue,!0);try{if(ae.filter){var xe=p.createExpression(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(function(rr){return rr.key+": "+rr.message}).join(", "));var pt=ue.features.filter(function(rr){return xe.value.evaluate({zoom:0},rr)});ue={type:"FeatureCollection",features:pt}}me._geoJSONIndex=ae.cluster?new _n(function(rr){var Zr=rr.superclusterOptions,Nn=rr.clusterProperties;if(!Nn||!Zr)return Zr;for(var Bn={},tr={},In={accumulated:null,zoom:0},hn={properties:null},yn=Object.keys(Nn),Ni=0,Tn=yn;Ni<Tn.length;Ni+=1){var Di=Tn[Ni],ra=Nn[Di],hi=ra[0],na=p.createExpression(ra[1]),Xi=p.createExpression(typeof hi=="string"?[hi,["accumulated"],["get",Di]]:hi);Bn[Di]=na.value,tr[Di]=Xi.value}return Zr.map=function(Ii){hn.properties=Ii;for(var ma={},Da=0,Yi=yn;Da<Yi.length;Da+=1){var zi=Yi[Da];ma[zi]=Bn[zi].evaluate(In,hn)}return ma},Zr.reduce=function(Ii,ma){hn.properties=ma;for(var Da=0,Yi=yn;Da<Yi.length;Da+=1){var zi=Yi[Da];In.accumulated=Ii[zi],Ii[zi]=tr[zi].evaluate(In,hn)}},Zr}(ae)).load(ue.features):function(rr,Zr){return new Or(rr,Zr)}(ue,ae.geojsonVtOptions)}catch(rr){return N(rr)}me.loaded={};var Cr={};if(de){var Kt=de.finish();Kt&&(Cr.resourceTiming={},Cr.resourceTiming[ae.source]=JSON.parse(JSON.stringify(Kt)))}N(null,Cr)})}},fe.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},fe.prototype.reloadTile=function(me,N){var ae=this.loaded;return ae&&ae[me.uid]?ee.prototype.reloadTile.call(this,me,N):this.loadTile(me,N)},fe.prototype.loadGeoJSON=function(me,N){if(me.request)p.getJSON(me.request,N);else{if(typeof me.data!="string")return N(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return N(null,JSON.parse(me.data))}catch(ae){return N(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},fe.prototype.removeSource=function(me,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()},fe.prototype.getClusterExpansionZoom=function(me,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(ae){N(ae)}},fe.prototype.getClusterChildren=function(me,N){try{N(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(ae){N(ae)}},fe.prototype.getClusterLeaves=function(me,N){try{N(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(ae){N(ae)}},fe}(Le),Ur=function(ee){var fe=this;this.self=ee,this.actor=new p.Actor(ee,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Le,geojson:Ln},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,N){if(fe.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');fe.workerSourceTypes[me]=N},this.self.registerRTLTextPlugin=function(me){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=me.applyArabicShaping,p.plugin.processBidirectionalText=me.processBidirectionalText,p.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return Ur.prototype.setReferrer=function(ee,fe){this.referrer=fe},Ur.prototype.setImages=function(ee,fe,me){for(var N in this.availableImages[ee]=fe,this.workerSources[ee]){var ae=this.workerSources[ee][N];for(var de in ae)ae[de].availableImages=fe}me()},Ur.prototype.setLayers=function(ee,fe,me){this.getLayerIndex(ee).replace(fe),me()},Ur.prototype.updateLayers=function(ee,fe,me){this.getLayerIndex(ee).update(fe.layers,fe.removedIds),me()},Ur.prototype.loadTile=function(ee,fe,me){this.getWorkerSource(ee,fe.type,fe.source).loadTile(fe,me)},Ur.prototype.loadDEMTile=function(ee,fe,me){this.getDEMWorkerSource(ee,fe.source).loadTile(fe,me)},Ur.prototype.reloadTile=function(ee,fe,me){this.getWorkerSource(ee,fe.type,fe.source).reloadTile(fe,me)},Ur.prototype.abortTile=function(ee,fe,me){this.getWorkerSource(ee,fe.type,fe.source).abortTile(fe,me)},Ur.prototype.removeTile=function(ee,fe,me){this.getWorkerSource(ee,fe.type,fe.source).removeTile(fe,me)},Ur.prototype.removeDEMTile=function(ee,fe){this.getDEMWorkerSource(ee,fe.source).removeTile(fe)},Ur.prototype.removeSource=function(ee,fe,me){if(this.workerSources[ee]&&this.workerSources[ee][fe.type]&&this.workerSources[ee][fe.type][fe.source]){var N=this.workerSources[ee][fe.type][fe.source];delete this.workerSources[ee][fe.type][fe.source],N.removeSource!==void 0?N.removeSource(fe,me):me()}},Ur.prototype.loadWorkerSource=function(ee,fe,me){try{this.self.importScripts(fe.url),me()}catch(N){me(N.toString())}},Ur.prototype.syncRTLPluginState=function(ee,fe,me){try{p.plugin.setState(fe);var N=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&N!=null){this.self.importScripts(N);var ae=p.plugin.isParsed();me(ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+N),ae)}}catch(de){me(de.toString())}},Ur.prototype.getAvailableImages=function(ee){var fe=this.availableImages[ee];return fe||(fe=[]),fe},Ur.prototype.getLayerIndex=function(ee){var fe=this.layerIndexes[ee];return fe||(fe=this.layerIndexes[ee]=new Y),fe},Ur.prototype.getWorkerSource=function(ee,fe,me){var N=this;return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][fe]||(this.workerSources[ee][fe]={}),this.workerSources[ee][fe][me]||(this.workerSources[ee][fe][me]=new this.workerSourceTypes[fe]({send:function(ae,de,Te){N.actor.send(ae,de,Te,ee)}},this.getLayerIndex(ee),this.getAvailableImages(ee))),this.workerSources[ee][fe][me]},Ur.prototype.getDEMWorkerSource=function(ee,fe){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][fe]||(this.demWorkerSources[ee][fe]=new $t),this.demWorkerSources[ee][fe]},Ur.prototype.enforceCacheSizeLimit=function(ee,fe){p.enforceCacheSizeLimit(fe)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ur(self)),Ur}),b(["./shared"],function(p){"use strict";var X=p.createCommonjsModule(function(i){function u(_){return!o(_)}function o(_){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,k,K=new Blob([""],{type:"text/javascript"}),le=URL.createObjectURL(K);try{k=new Worker(le),T=!0}catch(Ce){T=!1}return k&&k.terminate(),URL.revokeObjectURL(le),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var k=T.getContext("2d");if(!k)return!1;var K=k.getImageData(0,0,1,1);return K&&K.width===T.width}()?(h[E=_&&_.failIfMajorPerformanceCaveat]===void 0&&(h[E]=function(T){var k=function(le){var Ce=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=le,Ce.probablySupportsContext?Ce.probablySupportsContext("webgl",we)||Ce.probablySupportsContext("experimental-webgl",we):Ce.supportsContext?Ce.supportsContext("webgl",we)||Ce.supportsContext("experimental-webgl",we):Ce.getContext("webgl",we)||Ce.getContext("experimental-webgl",we)}(T);if(!k)return!1;var K=k.createShader(k.VERTEX_SHADER);return!(!K||k.isContextLost())&&(k.shaderSource(K,"void main() {}"),k.compileShader(K),k.getShaderParameter(K,k.COMPILE_STATUS)===!0)}(E)),h[E]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var E}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),U={create:function(i,u,o){var h=p.window.document.createElement(i);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(i,u){return p.window.document.createElementNS(i,u)}},Y=p.window.document&&p.window.document.documentElement.style;function $(i){if(!Y)return i[0];for(var u=0;u<i.length;u++)if(i[u]in Y)return i[u];return i[0]}var he,Z=$(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);U.disableDrag=function(){Y&&Z&&(he=Y[Z],Y[Z]="none")},U.enableDrag=function(){Y&&Z&&(Y[Z]=he)};var Ie=$(["transform","WebkitTransform"]);U.setTransform=function(i,u){i.style[Ie]=u};var Le=!1;try{var rt=Object.defineProperty({},"passive",{get:function(){Le=!0}});p.window.addEventListener("test",rt,rt),p.window.removeEventListener("test",rt,rt)}catch(i){Le=!1}U.addEventListener=function(i,u,o,h){h===void 0&&(h={}),i.addEventListener(u,o,"passive"in h&&Le?h:h.capture)},U.removeEventListener=function(i,u,o,h){h===void 0&&(h={}),i.removeEventListener(u,o,"passive"in h&&Le?h:h.capture)};var $t=function(i){i.preventDefault(),i.stopPropagation(),p.window.removeEventListener("click",$t,!0)};function zt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}U.suppressClick=function(){p.window.addEventListener("click",$t,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",$t,!0)},0)},U.mousePos=function(i,u){var o=i.getBoundingClientRect();return new p.Point(u.clientX-o.left-i.clientLeft,u.clientY-o.top-i.clientTop)},U.touchPos=function(i,u){for(var o=i.getBoundingClientRect(),h=[],_=0;_<u.length;_++)h.push(new p.Point(u[_].clientX-o.left-i.clientLeft,u[_].clientY-o.top-i.clientTop));return h},U.mouseButton=function(i){return p.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},U.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Lt=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,_=this.requestors;h<_.length;h+=1){var E=_[h];this._notify(E.ids,E.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),_=!1),_},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var _=0,E=0,T=o;E<T.length;E+=1){var k=T[E];if(k[0]<_||k[1]<k[0]||h<k[1])return!1;_=k[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var _=!0;if(!this.isLoaded())for(var E=0,T=o;E<T.length;E+=1)this.images[T[E]]||(_=!1);this.isLoaded()||_?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var _={},E=0,T=o;E<T.length;E+=1){var k=T[E];this.images[k]||this.fire(new p.Event("styleimagemissing",{id:k}));var K=this.images[k];K?_[k]={data:K.data.clone(),pixelRatio:K.pixelRatio,sdf:K.sdf,version:K.version,stretchX:K.stretchX,stretchY:K.stretchY,content:K.content,hasRenderCallback:Boolean(K.userImage&&K.userImage.render)}:p.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,_)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],_=this.getImage(o);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{var E={w:_.data.width+2,h:_.data.height+2,x:0,y:0},T=new p.ImagePosition(E,_);this.patterns[o]={bin:E,position:T}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var _=p.potpack(o),E=_.w,T=_.h,k=this.atlasImage;for(var K in k.resize({width:E||1,height:T||1}),this.patterns){var le=this.patterns[K].bin,Ce=le.x+1,we=le.y+1,Me=this.images[K].data,Ye=Me.width,Xe=Me.height;p.RGBAImage.copy(Me,k,{x:0,y:0},{x:Ce,y:we},{width:Ye,height:Xe}),p.RGBAImage.copy(Me,k,{x:0,y:Xe-1},{x:Ce,y:we-1},{width:Ye,height:1}),p.RGBAImage.copy(Me,k,{x:0,y:0},{x:Ce,y:we+Xe},{width:Ye,height:1}),p.RGBAImage.copy(Me,k,{x:Ye-1,y:0},{x:Ce-1,y:we},{width:1,height:Xe}),p.RGBAImage.copy(Me,k,{x:0,y:0},{x:Ce+Ye,y:we},{width:1,height:Xe})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,_=o;h<_.length;h+=1){var E=_[h];if(!this.callbackDispatchedThisFrame[E]){this.callbackDispatchedThisFrame[E]=!0;var T=this.images[E];zt(T)&&this.updateImage(E,T)}}},u}(p.Evented),Ht=ft,Ct=ft,yt=1e20;function ft(i,u,o,h,_,E){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=_||"sans-serif",this.fontWeight=E||"normal",this.radius=o||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function sr(i,u,o,h,_,E,T){for(var k=0;k<u;k++){for(var K=0;K<o;K++)h[K]=i[K*u+k];for(re(h,_,E,T,o),K=0;K<o;K++)i[K*u+k]=_[K]}for(K=0;K<o;K++){for(k=0;k<u;k++)h[k]=i[K*u+k];for(re(h,_,E,T,u),k=0;k<u;k++)i[K*u+k]=Math.sqrt(_[k])}}function re(i,u,o,h,_){o[0]=0,h[0]=-yt,h[1]=+yt;for(var E=1,T=0;E<_;E++){for(var k=(i[E]+E*E-(i[o[T]]+o[T]*o[T]))/(2*E-2*o[T]);k<=h[T];)T--,k=(i[E]+E*E-(i[o[T]]+o[T]*o[T]))/(2*E-2*o[T]);o[++T]=E,h[T]=k,h[T+1]=+yt}for(E=0,T=0;E<_;E++){for(;h[T+1]<E;)T++;u[E]=(E-o[T])*(E-o[T])+i[o[T]]}}ft.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var _=u.data[4*h+3]/255;this.gridOuter[h]=_===1?0:_===0?yt:Math.pow(Math.max(0,.5-_),2),this.gridInner[h]=_===1?yt:_===0?0:Math.pow(Math.max(0,_-.5),2)}for(sr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),sr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},Ht.default=Ct;var nr=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};nr.prototype.setURL=function(i){this.url=i},nr.prototype.getGlyphs=function(i,u){var o=this,h=[];for(var _ in i)for(var E=0,T=i[_];E<T.length;E+=1)h.push({stack:_,id:T[E]});p.asyncAll(h,function(k,K){var le=k.stack,Ce=k.id,we=o.entries[le];we||(we=o.entries[le]={glyphs:{},requests:{},ranges:{}});var Me=we.glyphs[Ce];if(Me===void 0){if(Me=o._tinySDF(we,le,Ce))return we.glyphs[Ce]=Me,void K(null,{stack:le,id:Ce,glyph:Me});var Ye=Math.floor(Ce/256);if(256*Ye>65535)K(new Error("glyphs > 65535 not supported"));else if(we.ranges[Ye])K(null,{stack:le,id:Ce,glyph:Me});else{var Xe=we.requests[Ye];Xe||(Xe=we.requests[Ye]=[],nr.loadGlyphRange(le,Ye,o.url,o.requestManager,function(st,je){if(je){for(var ut in je)o._doesCharSupportLocalGlyph(+ut)||(we.glyphs[+ut]=je[+ut]);we.ranges[Ye]=!0}for(var At=0,Yt=Xe;At<Yt.length;At+=1)(0,Yt[At])(st,je);delete we.requests[Ye]})),Xe.push(function(st,je){st?K(st):je&&K(null,{stack:le,id:Ce,glyph:je[Ce]||null})})}}else K(null,{stack:le,id:Ce,glyph:Me})},function(k,K){if(k)u(k);else if(K){for(var le={},Ce=0,we=K;Ce<we.length;Ce+=1){var Me=we[Ce],Ye=Me.stack,Xe=Me.id,st=Me.glyph;(le[Ye]||(le[Ye]={}))[Xe]=st&&{id:st.id,bitmap:st.bitmap.clone(),metrics:st.metrics}}u(null,le)}})},nr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](i)||p.isChar["Hangul Syllables"](i)||p.isChar.Hiragana(i)||p.isChar.Katakana(i))},nr.prototype._tinySDF=function(i,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var _=i.tinySDF;if(!_){var E="400";/bold/i.test(u)?E="900":/medium/i.test(u)?E="500":/light/i.test(u)&&(E="200"),_=i.tinySDF=new nr.TinySDF(24,3,8,.25,h,E)}return{id:o,bitmap:new p.AlphaImage({width:30,height:30},_.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},nr.loadGlyphRange=function(i,u,o,h,_){var E=256*u,T=E+255,k=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",E+"-"+T),p.ResourceType.Glyphs);p.getArrayBuffer(k,function(K,le){if(K)_(K);else if(le){for(var Ce={},we=0,Me=p.parseGlyphPBF(le);we<Me.length;we+=1){var Ye=Me[we];Ce[Ye.id]=Ye}_(null,Ce)}})},nr.TinySDF=Ht;var Tt=function(){this.specification=p.styleSpec.light.position};Tt.prototype.possiblyEvaluate=function(i,u){return p.sphericalToCartesian(i.expression.evaluate(u))},Tt.prototype.interpolate=function(i,u,o){return{x:p.number(i.x,u.x,o),y:p.number(i.y,u.y,o),z:p.number(i.z,u.z,o)}};var $e=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new Tt,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Mt=function(i){function u(o){i.call(this),this._transitionable=new p.Transitionable($e),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,o,h))for(var _ in o){var E=o[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-"-transition".length),E):this._transitionable.setValue(_,E)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,_){return(!_||_.validate!==!1)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Ve=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ve.prototype.getDash=function(i,u){var o=i.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(i,u)),this.dashEntry[o]},Ve.prototype.getDashRanges=function(i,u,o){var h=[],_=i.length%2==1?-i[i.length-1]*o:0,E=i[0]*o,T=!0;h.push({left:_,right:E,isDash:T,zeroLength:i[0]===0});for(var k=i[0],K=1;K<i.length;K++){var le=i[K];h.push({left:_=k*o,right:E=(k+=le)*o,isDash:T=!T,zeroLength:le===0})}return h},Ve.prototype.addRoundDash=function(i,u,o){for(var h=u/2,_=-o;_<=o;_++)for(var E=this.width*(this.nextRow+o+_),T=0,k=i[T],K=0;K<this.width;K++){K/k.right>1&&(k=i[++T]);var le=Math.abs(K-k.left),Ce=Math.abs(K-k.right),we=Math.min(le,Ce),Me=void 0,Ye=_/o*(h+1);if(k.isDash){var Xe=h-Math.abs(Ye);Me=Math.sqrt(we*we+Xe*Xe)}else Me=h-Math.sqrt(we*we+Ye*Ye);this.data[E+K]=Math.max(0,Math.min(255,Me+128))}},Ve.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var o=i[u],h=i[u+1];o.zeroLength?i.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,i.splice(u,1))}var _=i[0],E=i[i.length-1];_.isDash===E.isDash&&(_.left=E.left-this.width,E.right=_.right+this.width);for(var T=this.width*this.nextRow,k=0,K=i[k],le=0;le<this.width;le++){le/K.right>1&&(K=i[++k]);var Ce=Math.abs(le-K.left),we=Math.abs(le-K.right),Me=Math.min(Ce,we);this.data[T+le]=Math.max(0,Math.min(255,(K.isDash?Me:-Me)+128))}},Ve.prototype.addDash=function(i,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var _=0,E=0;E<i.length;E++)_+=i[E];if(_!==0){var T=this.width/_,k=this.getDashRanges(i,this.width,T);u?this.addRoundDash(k,T,o):this.addRegularDash(k)}var K={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:_};return this.nextRow+=h,this.dirty=!0,K},Ve.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Ot=function i(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),_=0;_<h.length;_++){var E=new i.Actor(h[_],o,this.id);E.name="Worker "+_,this.actors.push(E)}};function pr(i,u,o){var h=function(_,E){if(_)return o(_);if(E){var T=p.pick(p.extend(E,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(T.vectorLayers=E.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(k){return k.id})),T.tiles=u.canonicalizeTileset(T,i.url),o(null,T)}};return i.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,i)})}Ot.prototype.broadcast=function(i,u,o){p.asyncAll(this.actors,function(h,_){h.send(i,u,_)},o=o||function(){})},Ot.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ot.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Ot.Actor=p.Actor;var qt=function(i,u,o){this.bounds=p.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=o||24};qt.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},qt.prototype.contains=function(i){var u=Math.pow(2,i.z),o=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),_=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),E=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=o&&i.x<_&&i.y>=h&&i.y<E};var W=function(i){function u(o,h,_,E){if(i.call(this),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pr(this._options,this.map._requestManager,function(h,_){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):_&&(p.extend(o,_),_.bounds&&(o.tileBounds=new qt(_.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(_.tiles,o.map._requestManager._customAccessToken),p.postMapLoadEvent(_.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(o,h){var _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),E={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(k,K){return delete o.request,o.aborted?h(null):k&&k.status!==404?h(k):(K&&K.resourceTiming&&(o.resourceTiming=K.resourceTiming),this.map._refreshExpiredTiles&&K&&o.setExpiryData(K),o.loadVectorData(K,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}E.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",E,T.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",E,T.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),se=function(i){function u(o,h,_,E){i.call(this),this.id=o,this.dispatcher=_,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pr(this._options,this.map._requestManager,function(h,_){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):_&&(p.extend(o,_),_.bounds&&(o.tileBounds=new qt(_.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(_.tiles),p.postMapLoadEvent(_.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var _=this,E=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(E,p.ResourceType.Tile),function(T,k){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(k){_.map._refreshExpiredTiles&&o.setExpiryData(k),delete k.cacheControl,delete k.expires;var K=_.map.painter.context,le=K.gl;o.texture=_.map.painter.getTileTexture(k.width),o.texture?o.texture.update(k,{useMipmap:!0}):(o.texture=new p.Texture(K,k,le.RGBA,{useMipmap:!0}),o.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE,le.LINEAR_MIPMAP_NEAREST),K.extTextureFilterAnisotropic&&le.texParameterf(le.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(_.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ke=function(i){function u(o,h,_,E){i.call(this,o,h,_,E),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function E(T,k){T&&(o.state="errored",h(T)),k&&(o.dem=k,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=p.getImage(this.map._requestManager.transformRequest(_,p.ResourceType.Tile),function(T,k){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(k){this.map._refreshExpiredTiles&&o.setExpiryData(k),delete k.cacheControl,delete k.expires;var K=p.window.ImageBitmap&&k instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?k:p.browser.getImageData(k,1),le={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:K,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",le,E.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,_=Math.pow(2,h.z),E=(h.x-1+_)%_,T=h.x===0?o.wrap-1:o.wrap,k=(h.x+1+_)%_,K=h.x+1===_?o.wrap+1:o.wrap,le={};return le[new p.OverscaledTileID(o.overscaledZ,T,h.z,E,h.y).key]={backfilled:!1},le[new p.OverscaledTileID(o.overscaledZ,K,h.z,k,h.y).key]={backfilled:!1},h.y>0&&(le[new p.OverscaledTileID(o.overscaledZ,T,h.z,E,h.y-1).key]={backfilled:!1},le[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},le[new p.OverscaledTileID(o.overscaledZ,K,h.z,k,h.y-1).key]={backfilled:!1}),h.y+1<_&&(le[new p.OverscaledTileID(o.overscaledZ,T,h.z,E,h.y+1).key]={backfilled:!1},le[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},le[new p.OverscaledTileID(o.overscaledZ,K,h.z,k,h.y+1).key]={backfilled:!1}),le},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(se),_e=function(i){function u(o,h,_,E){i.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(E),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new p.ErrorEvent(h));else{var _={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(_.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new p.Event("data",_))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)h.fire(new p.ErrorEvent(_));else{var E={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(E.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",E))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,_,E){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:_},E),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var _=p.extend({},this.workerOptions),E=this._data;typeof E=="string"?(_.request=this.map._requestManager.transformRequest(p.browser.resolveURL(E),p.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(E),this.actor.send(this.type+".loadData",_,function(T,k){h._removed||k&&k.abandoned||(h._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[h.id]&&(h._resourceTiming=k.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:_.source},null),o(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var _=this,E=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(E,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,k){return delete o.request,o.unloadVectorData(),o.aborted?h(null):T?h(T):(o.loadVectorData(k,_.map.painter,E==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Et=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(i){function u(o,h,_,E){i.call(this),this.id=o,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(o,h){var _=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(E,T){_._loaded=!0,E?_.fire(new p.ErrorEvent(E)):T&&(_.image=T,o&&(_.coordinates=o),h&&h(),_._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var _=o.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var k=1/0,K=1/0,le=-1/0,Ce=-1/0,we=0,Me=T;we<Me.length;we+=1){var Ye=Me[we];k=Math.min(k,Ye.x),K=Math.min(K,Ye.y),le=Math.max(le,Ye.x),Ce=Math.max(Ce,Ye.y)}var Xe=Math.max(le-k,Ce-K),st=Math.max(0,Math.floor(-Math.log(Xe)/Math.LN2)),je=Math.pow(2,st);return new p.CanonicalTileID(st,Math.floor((k+le)/2*je),Math.floor((K+Ce)/2*je))}(_),this.minzoom=this.maxzoom=this.tileID.z;var E=_.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(E[0].x,E[0].y,0,0),this._boundsArray.emplaceBack(E[1].x,E[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(E[3].x,E[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(E[2].x,E[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var E=this.tiles[_];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),jt=function(i){function u(o,h,_,E){i.call(this,o,h,_,E),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var _=0,E=h.urls;_<E.length;_+=1)this.urls.push(this.map._requestManager.transformRequest(E[_],p.ResourceType.Source).url);p.getVideo(this.urls,function(T,k){o._loaded=!0,T?o.fire(new p.ErrorEvent(T)):k&&(o.video=k,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var E=this.tiles[_];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(gt),Ut=function(i){function u(o,h,_,E){i.call(this,o,h,_,E),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(k){return typeof k!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,_=h.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,_.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[E];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var _=h[o];if(isNaN(_)||_<=0)return!0}return!1},u}(gt),zr={vector:W,raster:se,"raster-dem":ke,geojson:_e,video:jt,image:gt,canvas:Ut};function dn(i,u){var o=p.identity([]);return p.translate(o,o,[1,1,0]),p.scale(o,o,[.5*i.width,.5*i.height,1]),p.multiply(o,o,i.calculatePosMatrix(u.toUnwrapped()))}function _n(i,u,o,h,_,E){var T=function(st,je,ut){if(st)for(var At=0,Yt=st;At<Yt.length;At+=1){var Sr=je[Yt[At]];if(Sr&&Sr.source===ut&&Sr.type==="fill-extrusion")return!0}else for(var dr in je){var wr=je[dr];if(wr.source===ut&&wr.type==="fill-extrusion")return!0}return!1}(_&&_.layers,u,i.id),k=E.maxPitchScaleFactor(),K=i.tilesIn(h,k,T);K.sort(Qi);for(var le=[],Ce=0,we=K;Ce<we.length;Ce+=1){var Me=we[Ce];le.push({wrappedTileID:Me.tileID.wrapped().key,queryResults:Me.tile.queryRenderedFeatures(u,o,i._state,Me.queryGeometry,Me.cameraQueryGeometry,Me.scale,_,E,k,dn(i.transform,Me.tileID))})}var Ye=function(st){for(var je={},ut={},At=0,Yt=st;At<Yt.length;At+=1){var Sr=Yt[At],dr=Sr.queryResults,wr=Sr.wrappedTileID,Wr=ut[wr]=ut[wr]||{};for(var fn in dr)for(var nn=dr[fn],jn=Wr[fn]=Wr[fn]||{},ui=je[fn]=je[fn]||[],li=0,mn=nn;li<mn.length;li+=1){var aa=mn[li];jn[aa.featureIndex]||(jn[aa.featureIndex]=!0,ui.push(aa))}}return je}(le);for(var Xe in Ye)Ye[Xe].forEach(function(st){var je=st.feature,ut=i.getFeatureState(je.layer["source-layer"],je.id);je.source=je.layer.source,je.layer["source-layer"]&&(je.sourceLayer=je.layer["source-layer"]),je.state=ut});return Ye}function Qi(i,u){var o=i.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var ur=function(i,u){this.max=i,this.onRemove=u,this.reset()};ur.prototype.reset=function(){for(var i in this.data)for(var u=0,o=this.data[i];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},ur.prototype.add=function(i,u,o){var h=this,_=i.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);var E={value:u,timeout:void 0};if(o!==void 0&&(E.timeout=setTimeout(function(){h.remove(i,E)},o)),this.data[_].push(E),this.order.push(_),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},ur.prototype.has=function(i){return i.wrapped().key in this.data},ur.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},ur.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},ur.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},ur.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},ur.prototype.remove=function(i,u){if(!this.has(i))return this;var o=i.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),_=this.data[o][h];return this.data[o].splice(h,1),_.timeout&&clearTimeout(_.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(_.value),this.order.splice(this.order.indexOf(o),1),this},ur.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},ur.prototype.filter=function(i){var u=[];for(var o in this.data)for(var h=0,_=this.data[o];h<_.length;h+=1){var E=_[h];i(E.value)||u.push(E)}for(var T=0,k=u;T<k.length;T+=1){var K=k[T];this.remove(K.value.tileID,K)}};var ge=function(i,u,o){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};ge.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ge.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},ge.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Pe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ge=function(i,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ge.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ge.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Ge.prototype.enableAttributes=function(i,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&i.enableVertexAttribArray(h)}},Ge.prototype.setVertexAttribPointers=function(i,u,o){for(var h=0;h<this.attributes.length;h++){var _=this.attributes[h],E=u.attributes[_.name];E!==void 0&&i.vertexAttribPointer(E,_.components,i[Pe[_.type]],!1,this.itemSize,_.offset+this.itemSize*(o||0))}},Ge.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Re=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Re.prototype.get=function(){return this.current},Re.prototype.set=function(i){},Re.prototype.getDefault=function(){return this.default},Re.prototype.setDefault=function(){this.set(this.default)};var Nt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Re),ar=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Re),yr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Re),Lr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Re),fr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Re),Fr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Re),C=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Re),G=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Re),Ze=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Re),tt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Re),lt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Re),Pt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Re),q=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Re),kt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Re),Er=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Re),Mr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Re),Je=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Re),ct=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Re),It=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Re),Bt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Re),br=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Re),Tr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Re),qe=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Re),Gr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Re),Yr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Re),An=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Re),vr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Re),Or=function(i){function u(o){i.call(this,o),this.vao=o.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Re),St=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Re),Kn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Re),Ln=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Re),Ur=function(i){function u(o,h){i.call(this,o),this.context=o,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Re),ee=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(Ur),fe=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Ur),me=function(i,u,o,h){this.context=i,this.width=u,this.height=o;var _=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new ee(i,_),h&&(this.depthAttachment=new fe(i,_))};me.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}i.deleteFramebuffer(this.framebuffer)};var N=function(i,u,o){this.func=i,this.mask=u,this.range=o};N.ReadOnly=!1,N.ReadWrite=!0,N.disabled=new N(519,N.ReadOnly,[0,1]);var ae=function(i,u,o,h,_,E){this.test=i,this.ref=u,this.mask=o,this.fail=h,this.depthFail=_,this.pass=E};ae.disabled=new ae({func:519,mask:0},0,0,7680,7680,7680);var de=function(i,u,o){this.blendFunction=i,this.blendColor=u,this.mask=o};de.disabled=new de(de.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,p.Color.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Te=function(i,u,o){this.enable=i,this.mode=u,this.frontFace=o};Te.disabled=new Te(!1,1029,2305),Te.backCCW=new Te(!0,1029,2305);var ue=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Nt(this),this.clearDepth=new ar(this),this.clearStencil=new yr(this),this.colorMask=new Lr(this),this.depthMask=new fr(this),this.stencilMask=new Fr(this),this.stencilFunc=new C(this),this.stencilOp=new G(this),this.stencilTest=new Ze(this),this.depthRange=new tt(this),this.depthTest=new lt(this),this.depthFunc=new Pt(this),this.blend=new q(this),this.blendFunc=new kt(this),this.blendColor=new Er(this),this.blendEquation=new Mr(this),this.cullFace=new Je(this),this.cullFaceSide=new ct(this),this.frontFace=new It(this),this.program=new Bt(this),this.activeTexture=new br(this),this.viewport=new Tr(this),this.bindFramebuffer=new qe(this),this.bindRenderbuffer=new Gr(this),this.bindTexture=new Yr(this),this.bindVertexBuffer=new An(this),this.bindElementBuffer=new vr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Or(this),this.pixelStoreUnpack=new St(this),this.pixelStoreUnpackPremultiplyAlpha=new Kn(this),this.pixelStoreUnpackFlipY=new Ln(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(i,u){return new ge(this,i,u)},ue.prototype.createVertexBuffer=function(i,u,o){return new Ge(this,i,u,o)},ue.prototype.createRenderbuffer=function(i,u,o){var h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,i,u,o),this.bindRenderbuffer.set(null),_},ue.prototype.createFramebuffer=function(i,u,o){return new me(this,i,u,o)},ue.prototype.clear=function(i){var u=i.color,o=i.depth,h=this.gl,_=0;u&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(_)},ue.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},ue.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(i){p.deepEqual(i.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var xe=function(i){function u(o,h,_){var E=this;i.call(this),this.id=o,this.dispatcher=_,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(E._sourceLoaded=!0),E._sourceLoaded&&!E._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(E.reload(),E.transform&&E.update(E.transform))}),this.on("error",function(){E._sourceErrored=!0}),this._source=function(T,k,K,le){var Ce=new zr[k.type](T,k,K,le);if(Ce.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+Ce.id);return p.bindAll(["load","abort","unload","serialize","prepare"],Ce),Ce}(o,h,_,this),this._tiles={},this._cache=new ur(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var _=this._tiles[h];_.upload(o),_.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(o){return o.tileID}).sort(pt).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,_=[];for(var E in this._tiles)this._isIdRenderable(E,o)&&_.push(this._tiles[E]);return o?_.sort(function(T,k){var K=T.tileID,le=k.tileID,Ce=new p.Point(K.canonical.x,K.canonical.y)._rotate(h.transform.angle),we=new p.Point(le.canonical.x,le.canonical.y)._rotate(h.transform.angle);return K.overscaledZ-le.overscaledZ||we.y-Ce.y||we.x-Ce.x}).map(function(T){return T.tileID.key}):_.map(function(T){return T.tileID}).sort(pt).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,o,h)))},u.prototype._tileLoaded=function(o,h,_,E){if(E)return o.state="errored",void(E.status!==404?this._source.fire(new p.ErrorEvent(E,{tile:o})):this.update(this.transform));o.timeAdded=p.browser.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),_=0;_<h.length;_++){var E=h[_];if(o.neighboringTiles&&o.neighboringTiles[E]){var T=this.getTileByID(E);k(o,T),k(T,o)}}function k(K,le){K.needsHillshadePrepare=!0;var Ce=le.tileID.canonical.x-K.tileID.canonical.x,we=le.tileID.canonical.y-K.tileID.canonical.y,Me=Math.pow(2,K.tileID.canonical.z),Ye=le.tileID.key;Ce===0&&we===0||Math.abs(we)>1||(Math.abs(Ce)>1&&(Math.abs(Ce+Me)===1?Ce+=Me:Math.abs(Ce-Me)===1&&(Ce-=Me)),le.dem&&K.dem&&(K.dem.backfillBorder(le.dem,Ce,we),K.neighboringTiles&&K.neighboringTiles[Ye]&&(K.neighboringTiles[Ye].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,_,E){for(var T in this._tiles){var k=this._tiles[T];if(!(E[T]||!k.hasData()||k.tileID.overscaledZ<=h||k.tileID.overscaledZ>_)){for(var K=k.tileID;k&&k.tileID.overscaledZ>h+1;){var le=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[le.key])&&k.hasData()&&(K=le)}for(var Ce=K;Ce.overscaledZ>h;)if(o[(Ce=Ce.scaledTo(Ce.overscaledZ-1)).key]){E[K.key]=K;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=h?_:null}for(var E=o.overscaledZ-1;E>=h;E--){var T=o.scaledTo(E),k=this._getLoadedTile(T);if(k)return k}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,_=Math.ceil(o.height/this._source.tileSize)+1,E=Math.floor(h*_*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var _={};for(var E in this._tiles){var T=this._tiles[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),_[T.tileID.key]=T}for(var k in this._tiles=_,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var K in this._tiles)this._setTileReloadTimer(K,this._tiles[K])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var _;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Wr){return new p.OverscaledTileID(Wr.canonical.z,Wr.wrap,Wr.canonical.z,Wr.canonical.x,Wr.canonical.y)}):(_=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(_=_.filter(function(Wr){return h._source.hasTile(Wr)}))):_=[];var E=o.coveringZoomLevel(this._source),T=Math.max(E-u.maxOverzooming,this._source.minzoom),k=Math.max(E+u.maxUnderzooming,this._source.minzoom),K=this._updateRetainedTiles(_,E);if(Cr(this._source.type)){for(var le={},Ce={},we=0,Me=Object.keys(K);we<Me.length;we+=1){var Ye=Me[we],Xe=K[Ye],st=this._tiles[Ye];if(st&&!(st.fadeEndTime&&st.fadeEndTime<=p.browser.now())){var je=this.findLoadedParent(Xe,T);je&&(this._addTile(je.tileID),le[je.tileID.key]=je.tileID),Ce[Ye]=Xe}}for(var ut in this._retainLoadedChildren(Ce,E,k,K),le)K[ut]||(this._coveredTiles[ut]=!0,K[ut]=le[ut])}for(var At in K)this._tiles[At].clearFadeHold();for(var Yt=0,Sr=p.keysDifference(this._tiles,K);Yt<Sr.length;Yt+=1){var dr=Sr[Yt],wr=this._tiles[dr];wr.hasSymbolBuckets&&!wr.holdingForFade()?wr.setHoldDuration(this.map._fadeDuration):wr.hasSymbolBuckets&&!wr.symbolFadeFinished()||this._removeTile(dr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var _={},E={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),k=Math.max(h+u.maxUnderzooming,this._source.minzoom),K={},le=0,Ce=o;le<Ce.length;le+=1){var we=Ce[le],Me=this._addTile(we);_[we.key]=we,Me.hasData()||h<this._source.maxzoom&&(K[we.key]=we)}this._retainLoadedChildren(K,h,k,_);for(var Ye=0,Xe=o;Ye<Xe.length;Ye+=1){var st=Xe[Ye],je=this._tiles[st.key];if(!je.hasData()){if(h+1>this._source.maxzoom){var ut=st.children(this._source.maxzoom)[0],At=this.getTile(ut);if(At&&At.hasData()){_[ut.key]=ut;continue}}else{var Yt=st.children(this._source.maxzoom);if(_[Yt[0].key]&&_[Yt[1].key]&&_[Yt[2].key]&&_[Yt[3].key])continue}for(var Sr=je.wasRequested(),dr=st.overscaledZ-1;dr>=T;--dr){var wr=st.scaledTo(dr);if(E[wr.key]||(E[wr.key]=!0,!(je=this.getTile(wr))&&Sr&&(je=this._addTile(wr)),je&&(_[wr.key]=wr,Sr=je.wasRequested(),je.hasData())))break}}}return _},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],_=void 0,E=this._tiles[o].tileID;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){_=this._loadedParentTiles[E.key];break}h.push(E.key);var T=E.scaledTo(E.overscaledZ-1);if(_=this._getLoadedTile(T))break;E=T}for(var k=0,K=h;k<K.length;k+=1)this._loadedParentTiles[K[k]]=_}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var _=Boolean(h);return _||(h=new p.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,_||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var _=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var E=h.getExpiryTimeout();E&&(this._timers[o]=setTimeout(function(){_._reloadTile(o,"expired"),delete _._timers[o]},E))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,_){var E=this,T=[],k=this.transform;if(!k)return T;for(var K=_?k.getCameraQueryGeometry(o):o,le=o.map(function(dr){return k.pointCoordinate(dr)}),Ce=K.map(function(dr){return k.pointCoordinate(dr)}),we=this.getIds(),Me=1/0,Ye=1/0,Xe=-1/0,st=-1/0,je=0,ut=Ce;je<ut.length;je+=1){var At=ut[je];Me=Math.min(Me,At.x),Ye=Math.min(Ye,At.y),Xe=Math.max(Xe,At.x),st=Math.max(st,At.y)}for(var Yt=function(dr){var wr=E._tiles[we[dr]];if(!wr.holdingForFade()){var Wr=wr.tileID,fn=Math.pow(2,k.zoom-wr.tileID.overscaledZ),nn=h*wr.queryPadding*p.EXTENT/wr.tileSize/fn,jn=[Wr.getTilePoint(new p.MercatorCoordinate(Me,Ye)),Wr.getTilePoint(new p.MercatorCoordinate(Xe,st))];if(jn[0].x-nn<p.EXTENT&&jn[0].y-nn<p.EXTENT&&jn[1].x+nn>=0&&jn[1].y+nn>=0){var ui=le.map(function(mn){return Wr.getTilePoint(mn)}),li=Ce.map(function(mn){return Wr.getTilePoint(mn)});T.push({tile:wr,tileID:Wr,queryGeometry:ui,cameraQueryGeometry:li,scale:fn})}}},Sr=0;Sr<we.length;Sr++)Yt(Sr);return T},u.prototype.getVisibleCoordinates=function(o){for(var h=this,_=this.getRenderableIds(o).map(function(K){return h._tiles[K].tileID}),E=0,T=_;E<T.length;E+=1){var k=T[E];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return _},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Cr(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,_){this._state.updateState(o=o||"_geojsonTileLayer",h,_)},u.prototype.removeFeatureState=function(o,h,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,_)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,_){var E=this._tiles[o];E&&E.setDependencies(h,_)},u.prototype.reloadTilesForDependencies=function(o,h){for(var _ in this._tiles)this._tiles[_].hasDependency(o,h)&&this._reloadTile(_,"reloading");this._cache.filter(function(E){return!E.hasDependency(o,h)})},u}(p.Evented);function pt(i,u){var o=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-o||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function Cr(i){return i==="raster"||i==="image"||i==="video"}function Kt(){return new p.window.Worker(ll.workerUrl)}xe.maxOverzooming=10,xe.maxUnderzooming=3;var rr="mapboxgl_preloaded_worker_pool",Zr=function(){this.active={}};Zr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Zr.workerCount;)this.workers.push(new Kt);return this.active[i]=!0,this.workers.slice()},Zr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Zr.prototype.isPreloaded=function(){return!!this.active[rr]},Zr.prototype.numActive=function(){return Object.keys(this.active).length};var Nn,Bn=Math.floor(p.browser.hardwareConcurrency/2);function tr(){return Nn||(Nn=new Zr),Nn}function In(i,u){var o={};for(var h in i)h!=="ref"&&(o[h]=i[h]);return p.refProperties.forEach(function(_){_ in u&&(o[_]=u[_])}),o}function hn(i){i=i.slice();for(var u=Object.create(null),o=0;o<i.length;o++)u[i[o].id]=i[o];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=In(i[h],u[i[h].ref]));return i}Zr.workerCount=Math.max(Math.min(Bn,6),1);var yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ni(i,u,o){o.push({command:yn.addSource,args:[i,u[i]]})}function Tn(i,u,o){u.push({command:yn.removeSource,args:[i]}),o[i]=!0}function Di(i,u,o,h){Tn(i,o,h),Ni(i,u,o)}function ra(i,u,o){var h;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[o][h],u[o][h]))return!1;return!0}function hi(i,u,o,h,_,E){var T;for(T in u=u||{},i=i||{})i.hasOwnProperty(T)&&(p.deepEqual(i[T],u[T])||o.push({command:E,args:[h,T,u[T],_]}));for(T in u)u.hasOwnProperty(T)&&!i.hasOwnProperty(T)&&(p.deepEqual(i[T],u[T])||o.push({command:E,args:[h,T,u[T],_]}))}function na(i){return i.id}function Xi(i,u){return i[u.id]=u,i}var Ii=function(i,u){this.reset(i,u)};Ii.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ii.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=p.clamp(i,0,1);for(var u=1,o=this._distances[u],h=i*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var _=u-1,E=this._distances[_],T=o-E,k=T>0?(h-E)/T:0;return this.points[_].mult(1-k).add(this.points[u].mult(k))};var ma=function(i,u,o){var h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/o),this.yCellCount=Math.ceil(u/o);for(var E=0;E<this.xCellCount*this.yCellCount;E++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Da(i,u,o,h,_){var E=p.create();return u?(p.scale(E,E,[1/_,1/_,1]),o||p.rotateZ(E,E,h.angle)):p.multiply(E,h.labelPlaneMatrix,i),E}function Yi(i,u,o,h,_){if(u){var E=p.clone(i);return p.scale(E,E,[_,_,1]),o||p.rotateZ(E,E,-h.angle),E}return h.glCoordMatrix}function zi(i,u){var o=[i.x,i.y,0,1];Wa(o,o,u);var h=o[3];return{point:new p.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function Ki(i,u){return .5+i/u*.5}function to(i,u){var o=i[0]/i[3],h=i[1]/i[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function $o(i,u,o,h,_,E,T,k){var K=h?i.textSizeData:i.iconSizeData,le=p.evaluateSizeForZoom(K,o.transform.zoom),Ce=[256/o.width*2+1,256/o.height*2+1],we=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;we.clear();for(var Me=i.lineVertexArray,Ye=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,Xe=o.transform.width/o.transform.height,st=!1,je=0;je<Ye.length;je++){var ut=Ye.get(je);if(ut.hidden||ut.writingMode===p.WritingMode.vertical&&!st)Ji(ut.numGlyphs,we);else{st=!1;var At=[ut.anchorX,ut.anchorY,0,1];if(p.transformMat4(At,At,u),to(At,Ce)){var Yt=Ki(o.transform.cameraToCenterDistance,At[3]),Sr=p.evaluateSizeForFeature(K,le,ut),dr=T?Sr/Yt:Sr*Yt,wr=new p.Point(ut.anchorX,ut.anchorY),Wr=zi(wr,_).point,fn={},nn=su(ut,dr,!1,k,u,_,E,i.glyphOffsetArray,Me,we,Wr,wr,fn,Xe);st=nn.useVertical,(nn.notEnoughRoom||st||nn.needsFlipping&&su(ut,dr,!0,k,u,_,E,i.glyphOffsetArray,Me,we,Wr,wr,fn,Xe).notEnoughRoom)&&Ji(ut.numGlyphs,we)}else Ji(ut.numGlyphs,we)}}h?i.text.dynamicLayoutVertexBuffer.updateData(we):i.icon.dynamicLayoutVertexBuffer.updateData(we)}function Ba(i,u,o,h,_,E,T,k,K,le,Ce){var we=k.glyphStartIndex+k.numGlyphs,Me=k.lineStartIndex,Ye=k.lineStartIndex+k.lineLength,Xe=u.getoffsetX(k.glyphStartIndex),st=u.getoffsetX(we-1),je=$i(i*Xe,o,h,_,E,T,k.segment,Me,Ye,K,le,Ce);if(!je)return null;var ut=$i(i*st,o,h,_,E,T,k.segment,Me,Ye,K,le,Ce);return ut?{first:je,last:ut}:null}function qi(i,u,o,h){return i===p.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(i===p.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function su(i,u,o,h,_,E,T,k,K,le,Ce,we,Me,Ye){var Xe,st=u/24,je=i.lineOffsetX*st,ut=i.lineOffsetY*st;if(i.numGlyphs>1){var At=i.glyphStartIndex+i.numGlyphs,Yt=i.lineStartIndex,Sr=i.lineStartIndex+i.lineLength,dr=Ba(st,k,je,ut,o,Ce,we,i,K,E,Me);if(!dr)return{notEnoughRoom:!0};var wr=zi(dr.first.point,T).point,Wr=zi(dr.last.point,T).point;if(h&&!o){var fn=qi(i.writingMode,wr,Wr,Ye);if(fn)return fn}Xe=[dr.first];for(var nn=i.glyphStartIndex+1;nn<At-1;nn++)Xe.push($i(st*k.getoffsetX(nn),je,ut,o,Ce,we,i.segment,Yt,Sr,K,E,Me));Xe.push(dr.last)}else{if(h&&!o){var jn=zi(we,_).point,ui=i.lineStartIndex+i.segment+1,li=new p.Point(K.getx(ui),K.gety(ui)),mn=zi(li,_),aa=mn.signedDistanceFromCamera>0?mn.point:Au(we,li,jn,1,_),Hn=qi(i.writingMode,jn,aa,Ye);if(Hn)return Hn}var xi=$i(st*k.getoffsetX(i.glyphStartIndex),je,ut,o,Ce,we,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,K,E,Me);if(!xi)return{notEnoughRoom:!0};Xe=[xi]}for(var Gi=0,vi=Xe;Gi<vi.length;Gi+=1){var Ci=vi[Gi];p.addDynamicAttributes(le,Ci.point,Ci.angle)}return{}}function Au(i,u,o,h,_){var E=zi(i.add(i.sub(u)._unit()),_).point,T=o.sub(E);return o.add(T._mult(h/T.mag()))}function $i(i,u,o,h,_,E,T,k,K,le,Ce,we){var Me=h?i-u:i+u,Ye=Me>0?1:-1,Xe=0;h&&(Ye*=-1,Xe=Math.PI),Ye<0&&(Xe+=Math.PI);for(var st=Ye>0?k+T:k+T+1,je=_,ut=_,At=0,Yt=0,Sr=Math.abs(Me),dr=[];At+Yt<=Sr;){if((st+=Ye)<k||st>=K)return null;if(ut=je,dr.push(je),(je=we[st])===void 0){var wr=new p.Point(le.getx(st),le.gety(st)),Wr=zi(wr,Ce);if(Wr.signedDistanceFromCamera>0)je=we[st]=Wr.point;else{var fn=st-Ye;je=Au(At===0?E:new p.Point(le.getx(fn),le.gety(fn)),wr,ut,Sr-At+1,Ce)}}At+=Yt,Yt=ut.dist(je)}var nn=(Sr-At)/Yt,jn=je.sub(ut),ui=jn.mult(nn)._add(ut);ui._add(jn._unit()._perp()._mult(o*Ye));var li=Xe+Math.atan2(je.y-ut.y,je.x-ut.x);return dr.push(ui),{point:ui,angle:li,path:dr}}ma.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ma.prototype.insert=function(i,u,o,h,_){this._forEachCell(u,o,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(_)},ma.prototype.insertCircle=function(i,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(o),this.circles.push(h)},ma.prototype._insertBoxCell=function(i,u,o,h,_,E){this.boxCells[_].push(E)},ma.prototype._insertCircleCell=function(i,u,o,h,_,E){this.circleCells[_].push(E)},ma.prototype._query=function(i,u,o,h,_,E){if(o<0||i>this.width||h<0||u>this.height)return!_&&[];var T=[];if(i<=0&&u<=0&&this.width<=o&&this.height<=h){if(_)return!0;for(var k=0;k<this.boxKeys.length;k++)T.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var K=0;K<this.circleKeys.length;K++){var le=this.circles[3*K],Ce=this.circles[3*K+1],we=this.circles[3*K+2];T.push({key:this.circleKeys[K],x1:le-we,y1:Ce-we,x2:le+we,y2:Ce+we})}return E?T.filter(E):T}return this._forEachCell(i,u,o,h,this._queryCell,T,{hitTest:_,seenUids:{box:{},circle:{}}},E),_?T.length>0:T},ma.prototype._queryCircle=function(i,u,o,h,_){var E=i-o,T=i+o,k=u-o,K=u+o;if(T<0||E>this.width||K<0||k>this.height)return!h&&[];var le=[];return this._forEachCell(E,k,T,K,this._queryCellCircle,le,{hitTest:h,circle:{x:i,y:u,radius:o},seenUids:{box:{},circle:{}}},_),h?le.length>0:le},ma.prototype.query=function(i,u,o,h,_){return this._query(i,u,o,h,!1,_)},ma.prototype.hitTest=function(i,u,o,h,_){return this._query(i,u,o,h,!0,_)},ma.prototype.hitTestCircle=function(i,u,o,h){return this._queryCircle(i,u,o,!0,h)},ma.prototype._queryCell=function(i,u,o,h,_,E,T,k){var K=T.seenUids,le=this.boxCells[_];if(le!==null)for(var Ce=this.bboxes,we=0,Me=le;we<Me.length;we+=1){var Ye=Me[we];if(!K.box[Ye]){K.box[Ye]=!0;var Xe=4*Ye;if(i<=Ce[Xe+2]&&u<=Ce[Xe+3]&&o>=Ce[Xe+0]&&h>=Ce[Xe+1]&&(!k||k(this.boxKeys[Ye]))){if(T.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Ye],x1:Ce[Xe],y1:Ce[Xe+1],x2:Ce[Xe+2],y2:Ce[Xe+3]})}}}var st=this.circleCells[_];if(st!==null)for(var je=this.circles,ut=0,At=st;ut<At.length;ut+=1){var Yt=At[ut];if(!K.circle[Yt]){K.circle[Yt]=!0;var Sr=3*Yt;if(this._circleAndRectCollide(je[Sr],je[Sr+1],je[Sr+2],i,u,o,h)&&(!k||k(this.circleKeys[Yt]))){if(T.hitTest)return E.push(!0),!0;var dr=je[Sr],wr=je[Sr+1],Wr=je[Sr+2];E.push({key:this.circleKeys[Yt],x1:dr-Wr,y1:wr-Wr,x2:dr+Wr,y2:wr+Wr})}}}},ma.prototype._queryCellCircle=function(i,u,o,h,_,E,T,k){var K=T.circle,le=T.seenUids,Ce=this.boxCells[_];if(Ce!==null)for(var we=this.bboxes,Me=0,Ye=Ce;Me<Ye.length;Me+=1){var Xe=Ye[Me];if(!le.box[Xe]){le.box[Xe]=!0;var st=4*Xe;if(this._circleAndRectCollide(K.x,K.y,K.radius,we[st+0],we[st+1],we[st+2],we[st+3])&&(!k||k(this.boxKeys[Xe])))return E.push(!0),!0}}var je=this.circleCells[_];if(je!==null)for(var ut=this.circles,At=0,Yt=je;At<Yt.length;At+=1){var Sr=Yt[At];if(!le.circle[Sr]){le.circle[Sr]=!0;var dr=3*Sr;if(this._circlesCollide(ut[dr],ut[dr+1],ut[dr+2],K.x,K.y,K.radius)&&(!k||k(this.circleKeys[Sr])))return E.push(!0),!0}}},ma.prototype._forEachCell=function(i,u,o,h,_,E,T,k){for(var K=this._convertToXCellCoord(i),le=this._convertToYCellCoord(u),Ce=this._convertToXCellCoord(o),we=this._convertToYCellCoord(h),Me=K;Me<=Ce;Me++)for(var Ye=le;Ye<=we;Ye++)if(_.call(this,i,u,o,h,this.xCellCount*Ye+Me,E,T,k))return},ma.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},ma.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},ma.prototype._circlesCollide=function(i,u,o,h,_,E){var T=h-i,k=_-u,K=o+E;return K*K>T*T+k*k},ma.prototype._circleAndRectCollide=function(i,u,o,h,_,E,T){var k=(E-h)/2,K=Math.abs(i-(h+k));if(K>k+o)return!1;var le=(T-_)/2,Ce=Math.abs(u-(_+le));if(Ce>le+o)return!1;if(K<=k||Ce<=le)return!0;var we=K-k,Me=Ce-le;return we*we+Me*Me<=o*o};var yo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ji(i,u){for(var o=0;o<i;o++){var h=u.length;u.resize(h+4),u.float32.set(yo,3*h)}}function Wa(i,u,o){var h=u[0],_=u[1];return i[0]=o[0]*h+o[4]*_+o[12],i[1]=o[1]*h+o[5]*_+o[13],i[3]=o[3]*h+o[7]*_+o[15],i}var Jo=function(i,u,o){u===void 0&&(u=new ma(i.width+200,i.height+200,25)),o===void 0&&(o=new ma(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function ba(i,u,o){return u*(p.EXTENT/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}Jo.prototype.placeCollisionBox=function(i,u,o,h,_){var E=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),T=o*E.perspectiveRatio,k=i.x1*T+E.point.x,K=i.y1*T+E.point.y,le=i.x2*T+E.point.x,Ce=i.y2*T+E.point.y;return!this.isInsideGrid(k,K,le,Ce)||!u&&this.grid.hitTest(k,K,le,Ce,_)?{box:[],offscreen:!1}:{box:[k,K,le,Ce],offscreen:this.isOffscreen(k,K,le,Ce)}},Jo.prototype.placeCollisionCircles=function(i,u,o,h,_,E,T,k,K,le,Ce,we,Me){var Ye=[],Xe=new p.Point(u.anchorX,u.anchorY),st=zi(Xe,E),je=Ki(this.transform.cameraToCenterDistance,st.signedDistanceFromCamera),ut=(le?_/je:_*je)/p.ONE_EM,At=zi(Xe,T).point,Yt=Ba(ut,h,u.lineOffsetX*ut,u.lineOffsetY*ut,!1,At,Xe,u,o,T,{}),Sr=!1,dr=!1,wr=!0;if(Yt){for(var Wr=.5*we*je+Me,fn=new p.Point(-100,-100),nn=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),jn=new Ii,ui=Yt.first,li=Yt.last,mn=[],aa=ui.path.length-1;aa>=1;aa--)mn.push(ui.path[aa]);for(var Hn=1;Hn<li.path.length;Hn++)mn.push(li.path[Hn]);var xi=2.5*Wr;if(k){var Gi=mn.map(function(mi){return zi(mi,k)});mn=Gi.some(function(mi){return mi.signedDistanceFromCamera<=0})?[]:Gi.map(function(mi){return mi.point})}var vi=[];if(mn.length>0){for(var Ci=mn[0].clone(),ie=mn[0].clone(),ne=1;ne<mn.length;ne++)Ci.x=Math.min(Ci.x,mn[ne].x),Ci.y=Math.min(Ci.y,mn[ne].y),ie.x=Math.max(ie.x,mn[ne].x),ie.y=Math.max(ie.y,mn[ne].y);vi=Ci.x>=fn.x&&ie.x<=nn.x&&Ci.y>=fn.y&&ie.y<=nn.y?[mn]:ie.x<fn.x||Ci.x>nn.x||ie.y<fn.y||Ci.y>nn.y?[]:p.clipLine([mn],fn.x,fn.y,nn.x,nn.y)}for(var L=0,B=vi;L<B.length;L+=1){var ce;jn.reset(B[L],.25*Wr),ce=jn.length<=.5*Wr?1:Math.ceil(jn.paddedLength/xi)+1;for(var Ae=0;Ae<ce;Ae++){var _t=Ae/Math.max(ce-1,1),Rt=jn.lerp(_t),wt=Rt.x+100,hr=Rt.y+100;Ye.push(wt,hr,Wr,0);var Xr=wt-Wr,Qn=hr-Wr,Wn=wt+Wr,fi=hr+Wr;if(wr=wr&&this.isOffscreen(Xr,Qn,Wn,fi),dr=dr||this.isInsideGrid(Xr,Qn,Wn,fi),!i&&this.grid.hitTestCircle(wt,hr,Wr,Ce)&&(Sr=!0,!K))return{circles:[],offscreen:!1,collisionDetected:Sr}}}}return{circles:!K&&Sr||!dr?[]:Ye,offscreen:wr,collisionDetected:Sr}},Jo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,_=-1/0,E=-1/0,T=0,k=i;T<k.length;T+=1){var K=k[T],le=new p.Point(K.x+100,K.y+100);o=Math.min(o,le.x),h=Math.min(h,le.y),_=Math.max(_,le.x),E=Math.max(E,le.y),u.push(le)}for(var Ce={},we={},Me=0,Ye=this.grid.query(o,h,_,E).concat(this.ignoredGrid.query(o,h,_,E));Me<Ye.length;Me+=1){var Xe=Ye[Me],st=Xe.key;if(Ce[st.bucketInstanceId]===void 0&&(Ce[st.bucketInstanceId]={}),!Ce[st.bucketInstanceId][st.featureIndex]){var je=[new p.Point(Xe.x1,Xe.y1),new p.Point(Xe.x2,Xe.y1),new p.Point(Xe.x2,Xe.y2),new p.Point(Xe.x1,Xe.y2)];p.polygonIntersectsPolygon(u,je)&&(Ce[st.bucketInstanceId][st.featureIndex]=!0,we[st.bucketInstanceId]===void 0&&(we[st.bucketInstanceId]=[]),we[st.bucketInstanceId].push(st.featureIndex))}}return we},Jo.prototype.insertCollisionBox=function(i,u,o,h,_){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:_},i[0],i[1],i[2],i[3])},Jo.prototype.insertCollisionCircles=function(i,u,o,h,_){for(var E=u?this.ignoredGrid:this.grid,T={bucketInstanceId:o,featureIndex:h,collisionGroupID:_},k=0;k<i.length;k+=4)E.insertCircle(T,i[k],i[k+1],i[k+2])},Jo.prototype.projectAndGetPerspectiveRatio=function(i,u,o){var h=[u,o,0,1];return Wa(h,h,i),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Jo.prototype.isOffscreen=function(i,u,o,h){return o<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Jo.prototype.isInsideGrid=function(i,u,o,h){return o>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Jo.prototype.getViewportMatrix=function(){var i=p.identity([]);return p.translate(i,i,[-100,-100,0]),i};var Lo=function(i,u,o,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&o?1:0,this.placed=o};Lo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ro=function(i,u,o,h,_){this.text=new Lo(i?i.text:null,u,o,_),this.icon=new Lo(i?i.icon:null,u,h,_)};Ro.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Rs=function(i,u,o){this.text=i,this.icon=u,this.skipFade=o},ho=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Vo=function(i,u,o,h,_){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=_},ka=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function so(i,u,o,h,_){var E=p.getAnchorAlignment(i),T=-(E.horizontalAlign-.5)*u,k=-(E.verticalAlign-.5)*o,K=p.evaluateVariableOffset(i,h);return new p.Point(T+K[0]*_,k+K[1]*_)}function as(i,u,o,h,_,E){var T=i.x1,k=i.x2,K=i.y1,le=i.y2,Ce=i.anchorPointX,we=i.anchorPointY,Me=new p.Point(u,o);return h&&Me._rotate(_?E:-E),{x1:T+Me.x,y1:K+Me.y,x2:k+Me.x,y2:le+Me.y,anchorPointX:Ce,anchorPointY:we}}ka.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[i]};var Do=function(i,u,o,h){this.transform=i.clone(),this.collisionIndex=new Jo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ka(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function Ee(i,u,o,h,_){i.emplaceBack(u?1:0,o?1:0,h||0,_||0),i.emplaceBack(u?1:0,o?1:0,h||0,_||0),i.emplaceBack(u?1:0,o?1:0,h||0,_||0),i.emplaceBack(u?1:0,o?1:0,h||0,_||0)}Do.prototype.getBucketParts=function(i,u,o,h){var _=o.getBucket(u),E=o.latestFeatureIndex;if(_&&E&&u.id===_.layerIds[0]){var T=o.collisionBoxArray,k=_.layers[0].layout,K=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),le=o.tileSize/p.EXTENT,Ce=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),we=k.get("text-pitch-alignment")==="map",Me=k.get("text-rotation-alignment")==="map",Ye=ba(o,1,this.transform.zoom),Xe=Da(Ce,we,Me,this.transform,Ye),st=null;if(we){var je=Yi(Ce,we,Me,this.transform,Ye);st=p.multiply([],this.transform.labelPlaneMatrix,je)}this.retainedQueryData[_.bucketInstanceId]=new Vo(_.bucketInstanceId,E,_.sourceLayerIndex,_.index,o.tileID);var ut={bucket:_,layout:k,posMatrix:Ce,textLabelPlaneMatrix:Xe,labelToScreenMatrix:st,scale:K,textPixelRatio:le,holdingForFade:o.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(var At=0,Yt=_.sortKeyRanges;At<Yt.length;At+=1){var Sr=Yt[At];i.push({sortKey:Sr.sortKey,symbolInstanceStart:Sr.symbolInstanceStart,symbolInstanceEnd:Sr.symbolInstanceEnd,parameters:ut})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ut})}},Do.prototype.attemptAnchorPlacement=function(i,u,o,h,_,E,T,k,K,le,Ce,we,Me,Ye,Xe){var st,je=[we.textOffset0,we.textOffset1],ut=so(i,o,h,je,_),At=this.collisionIndex.placeCollisionBox(as(u,ut.x,ut.y,E,T,this.transform.angle),Ce,k,K,le.predicate);if(!Xe||this.collisionIndex.placeCollisionBox(as(Xe,ut.x,ut.y,E,T,this.transform.angle),Ce,k,K,le.predicate).box.length!==0)return At.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(st=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:je,width:o,height:h,anchor:i,textBoxScale:_,prevAnchor:st},this.markUsedJustification(Me,i,we,Ye),Me.allowVerticalPlacement&&(this.markUsedOrientation(Me,Ye,we),this.placedOrientations[we.crossTileID]=Ye),{shift:ut,placedGlyphBoxes:At}):void 0},Do.prototype.placeLayerBucketPart=function(i,u,o){var h=this,_=i.parameters,E=_.bucket,T=_.layout,k=_.posMatrix,K=_.textLabelPlaneMatrix,le=_.labelToScreenMatrix,Ce=_.textPixelRatio,we=_.holdingForFade,Me=_.collisionBoxArray,Ye=_.partiallyEvaluatedTextSize,Xe=_.collisionGroup,st=T.get("text-optional"),je=T.get("icon-optional"),ut=T.get("text-allow-overlap"),At=T.get("icon-allow-overlap"),Yt=T.get("text-rotation-alignment")==="map",Sr=T.get("text-pitch-alignment")==="map",dr=T.get("icon-text-fit")!=="none",wr=T.get("symbol-z-order")==="viewport-y",Wr=ut&&(At||!E.hasIconData()||je),fn=At&&(ut||!E.hasTextData()||st);!E.collisionArrays&&Me&&E.deserializeCollisionBoxes(Me);var nn=function(Hn,xi){if(!u[Hn.crossTileID])if(we)h.placements[Hn.crossTileID]=new Rs(!1,!1,!1);else{var Gi,vi=!1,Ci=!1,ie=!0,ne=null,L={box:null,offscreen:null},B={box:null,offscreen:null},ce=null,Ae=null,_t=0,Rt=0,wt=0;xi.textFeatureIndex?_t=xi.textFeatureIndex:Hn.useRuntimeCollisionCircles&&(_t=Hn.featureIndex),xi.verticalTextFeatureIndex&&(Rt=xi.verticalTextFeatureIndex);var hr=xi.textBox;if(hr){var Xr=function(Mi){var ao=p.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Mi&&h.prevPlacement){var Ga=h.prevPlacement.placedOrientations[Hn.crossTileID];Ga&&(h.placedOrientations[Hn.crossTileID]=Ga,h.markUsedOrientation(E,ao=Ga,Hn))}return ao},Qn=function(Mi,ao){if(E.allowVerticalPlacement&&Hn.numVerticalGlyphVertices>0&&xi.verticalTextBox)for(var Ga=0,Gs=E.writingModes;Ga<Gs.length&&(Gs[Ga]===p.WritingMode.vertical?(L=ao(),B=L):L=Mi(),!(L&&L.box&&L.box.length));Ga+=1);else L=Mi()};if(T.get("text-variable-anchor")){var Wn=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Hn.crossTileID]){var fi=h.prevPlacement.variableOffsets[Hn.crossTileID];Wn.indexOf(fi.anchor)>0&&(Wn=Wn.filter(function(Mi){return Mi!==fi.anchor})).unshift(fi.anchor)}var mi=function(Mi,ao,Ga){for(var Gs=Mi.x2-Mi.x1,Zl=Mi.y2-Mi.y1,Bs=Hn.textBoxScale,Iu=dr&&!At?ao:null,Ou={box:[],offscreen:!1},jl=ut?2*Wn.length:Wn.length,cl=0;cl<jl;++cl){var Vl=h.attemptAnchorPlacement(Wn[cl%Wn.length],Mi,Gs,Zl,Bs,Yt,Sr,Ce,k,Xe,cl>=Wn.length,Hn,E,Ga,Iu);if(Vl&&(Ou=Vl.placedGlyphBoxes)&&Ou.box&&Ou.box.length){vi=!0,ne=Vl.shift;break}}return Ou};Qn(function(){return mi(hr,xi.iconBox,p.WritingMode.horizontal)},function(){var Mi=xi.verticalTextBox;return E.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&Hn.numVerticalGlyphVertices>0&&Mi?mi(Mi,xi.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),L&&(vi=L.box,ie=L.offscreen);var Li=Xr(L&&L.box);if(!vi&&h.prevPlacement){var oa=h.prevPlacement.variableOffsets[Hn.crossTileID];oa&&(h.variableOffsets[Hn.crossTileID]=oa,h.markUsedJustification(E,oa.anchor,Hn,Li))}}else{var pa=function(Mi,ao){var Ga=h.collisionIndex.placeCollisionBox(Mi,ut,Ce,k,Xe.predicate);return Ga&&Ga.box&&Ga.box.length&&(h.markUsedOrientation(E,ao,Hn),h.placedOrientations[Hn.crossTileID]=ao),Ga};Qn(function(){return pa(hr,p.WritingMode.horizontal)},function(){var Mi=xi.verticalTextBox;return E.allowVerticalPlacement&&Hn.numVerticalGlyphVertices>0&&Mi?pa(Mi,p.WritingMode.vertical):{box:null,offscreen:null}}),Xr(L&&L.box&&L.box.length)}}if(vi=(Gi=L)&&Gi.box&&Gi.box.length>0,ie=Gi&&Gi.offscreen,Hn.useRuntimeCollisionCircles){var Sa=E.text.placedSymbolArray.get(Hn.centerJustifiedTextSymbolIndex),vo=p.evaluateSizeForFeature(E.textSizeData,Ye,Sa),wa=T.get("text-padding");ce=h.collisionIndex.placeCollisionCircles(ut,Sa,E.lineVertexArray,E.glyphOffsetArray,vo,k,K,le,o,Sr,Xe.predicate,Hn.collisionCircleDiameter,wa),vi=ut||ce.circles.length>0&&!ce.collisionDetected,ie=ie&&ce.offscreen}if(xi.iconFeatureIndex&&(wt=xi.iconFeatureIndex),xi.iconBox){var Fo=function(Mi){var ao=dr&&ne?as(Mi,ne.x,ne.y,Yt,Sr,h.transform.angle):Mi;return h.collisionIndex.placeCollisionBox(ao,At,Ce,k,Xe.predicate)};Ci=B&&B.box&&B.box.length&&xi.verticalIconBox?(Ae=Fo(xi.verticalIconBox)).box.length>0:(Ae=Fo(xi.iconBox)).box.length>0,ie=ie&&Ae.offscreen}var Fa=st||Hn.numHorizontalGlyphVertices===0&&Hn.numVerticalGlyphVertices===0,ji=je||Hn.numIconVertices===0;if(Fa||ji?ji?Fa||(Ci=Ci&&vi):vi=Ci&&vi:Ci=vi=Ci&&vi,vi&&Gi&&Gi.box&&h.collisionIndex.insertCollisionBox(Gi.box,T.get("text-ignore-placement"),E.bucketInstanceId,B&&B.box&&Rt?Rt:_t,Xe.ID),Ci&&Ae&&h.collisionIndex.insertCollisionBox(Ae.box,T.get("icon-ignore-placement"),E.bucketInstanceId,wt,Xe.ID),ce&&(vi&&h.collisionIndex.insertCollisionCircles(ce.circles,T.get("text-ignore-placement"),E.bucketInstanceId,_t,Xe.ID),o)){var da=E.bucketInstanceId,Ka=h.collisionCircleArrays[da];Ka===void 0&&(Ka=h.collisionCircleArrays[da]=new ho);for(var mo=0;mo<ce.circles.length;mo+=4)Ka.circles.push(ce.circles[mo+0]),Ka.circles.push(ce.circles[mo+1]),Ka.circles.push(ce.circles[mo+2]),Ka.circles.push(ce.collisionDetected?1:0)}h.placements[Hn.crossTileID]=new Rs(vi||Wr,Ci||fn,ie||E.justReloaded),u[Hn.crossTileID]=!0}};if(wr)for(var jn=E.getSortedSymbolIndexes(this.transform.angle),ui=jn.length-1;ui>=0;--ui){var li=jn[ui];nn(E.symbolInstances.get(li),E.collisionArrays[li])}else for(var mn=i.symbolInstanceStart;mn<i.symbolInstanceEnd;mn++)nn(E.symbolInstances.get(mn),E.collisionArrays[mn]);if(o&&E.bucketInstanceId in this.collisionCircleArrays){var aa=this.collisionCircleArrays[E.bucketInstanceId];p.invert(aa.invProjMatrix,k),aa.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1},Do.prototype.markUsedJustification=function(i,u,o,h){var _;_=h===p.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var E=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];E<T.length;E+=1){var k=T[E];k>=0&&(i.text.placedSymbolArray.get(k).crossTileID=_>=0&&k!==_?0:o.crossTileID)}},Do.prototype.markUsedOrientation=function(i,u,o){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,_=u===p.WritingMode.vertical?u:0,E=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];E<T.length;E+=1)i.text.placedSymbolArray.get(T[E]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=_)},Do.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,_=u?u.opacities:{},E=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var k in this.placements){var K=this.placements[k],le=_[k];le?(this.opacities[k]=new Ro(le,h,K.text,K.icon),o=o||K.text!==le.text.placed||K.icon!==le.icon.placed):(this.opacities[k]=new Ro(null,h,K.text,K.icon,K.skipFade),o=o||K.text||K.icon)}for(var Ce in _){var we=_[Ce];if(!this.opacities[Ce]){var Me=new Ro(we,h,!1,!1);Me.isHidden()||(this.opacities[Ce]=Me,o=o||we.text.placed||we.icon.placed)}}for(var Ye in E)this.variableOffsets[Ye]||!this.opacities[Ye]||this.opacities[Ye].isHidden()||(this.variableOffsets[Ye]=E[Ye]);for(var Xe in T)this.placedOrientations[Xe]||!this.opacities[Xe]||this.opacities[Xe].isHidden()||(this.placedOrientations[Xe]=T[Xe]);o?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},Do.prototype.updateLayerOpacities=function(i,u){for(var o={},h=0,_=u;h<_.length;h+=1){var E=_[h],T=E.getBucket(i);T&&E.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,o,E.collisionBoxArray)}},Do.prototype.updateBucketOpacities=function(i,u,o){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var _=i.layers[0].layout,E=new Ro(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),k=_.get("icon-allow-overlap"),K=_.get("text-variable-anchor"),le=_.get("text-rotation-alignment")==="map",Ce=_.get("text-pitch-alignment")==="map",we=_.get("icon-text-fit")!=="none",Me=new Ro(null,0,T&&(k||!i.hasIconData()||_.get("icon-optional")),k&&(T||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);for(var Ye=function(ut,At,Yt){for(var Sr=0;Sr<At/4;Sr++)ut.opacityVertexArray.emplaceBack(Yt)},Xe=function(ut){var At=i.symbolInstances.get(ut),Yt=At.numHorizontalGlyphVertices,Sr=At.numVerticalGlyphVertices,dr=At.crossTileID,wr=h.opacities[dr];u[dr]?wr=E:wr||(h.opacities[dr]=wr=Me),u[dr]=!0;var Wr=At.numIconVertices>0,fn=h.placedOrientations[At.crossTileID],nn=fn===p.WritingMode.vertical,jn=fn===p.WritingMode.horizontal||fn===p.WritingMode.horizontalOnly;if(Yt>0||Sr>0){var ui=Xa(wr.text);Ye(i.text,Yt,nn?ja:ui),Ye(i.text,Sr,jn?ja:ui);var li=wr.text.isHidden();[At.rightJustifiedTextSymbolIndex,At.centerJustifiedTextSymbolIndex,At.leftJustifiedTextSymbolIndex].forEach(function(L){L>=0&&(i.text.placedSymbolArray.get(L).hidden=li||nn?1:0)}),At.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(At.verticalPlacedTextSymbolIndex).hidden=li||jn?1:0);var mn=h.variableOffsets[At.crossTileID];mn&&h.markUsedJustification(i,mn.anchor,At,fn);var aa=h.placedOrientations[At.crossTileID];aa&&(h.markUsedJustification(i,"left",At,aa),h.markUsedOrientation(i,aa,At))}if(Wr){var Hn=Xa(wr.icon),xi=!(we&&At.verticalPlacedIconSymbolIndex&&nn);At.placedIconSymbolIndex>=0&&(Ye(i.icon,At.numIconVertices,xi?Hn:ja),i.icon.placedSymbolArray.get(At.placedIconSymbolIndex).hidden=wr.icon.isHidden()),At.verticalPlacedIconSymbolIndex>=0&&(Ye(i.icon,At.numVerticalIconVertices,xi?ja:Hn),i.icon.placedSymbolArray.get(At.verticalPlacedIconSymbolIndex).hidden=wr.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var Gi=i.collisionArrays[ut];if(Gi){var vi=new p.Point(0,0);if(Gi.textBox||Gi.verticalTextBox){var Ci=!0;if(K){var ie=h.variableOffsets[dr];ie?(vi=so(ie.anchor,ie.width,ie.height,ie.textOffset,ie.textBoxScale),le&&vi._rotate(Ce?h.transform.angle:-h.transform.angle)):Ci=!1}Gi.textBox&&Ee(i.textCollisionBox.collisionVertexArray,wr.text.placed,!Ci||nn,vi.x,vi.y),Gi.verticalTextBox&&Ee(i.textCollisionBox.collisionVertexArray,wr.text.placed,!Ci||jn,vi.x,vi.y)}var ne=Boolean(!jn&&Gi.verticalIconBox);Gi.iconBox&&Ee(i.iconCollisionBox.collisionVertexArray,wr.icon.placed,ne,we?vi.x:0,we?vi.y:0),Gi.verticalIconBox&&Ee(i.iconCollisionBox.collisionVertexArray,wr.icon.placed,!ne,we?vi.x:0,we?vi.y:0)}}},st=0;st<i.symbolInstances.length;st++)Xe(st);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var je=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=je.invProjMatrix,i.placementViewportMatrix=je.viewportMatrix,i.collisionCircleArray=je.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},Do.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Do.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},Do.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},Do.prototype.stillRecent=function(i,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>i},Do.prototype.setStale=function(){this.stale=!0};var Be=Math.pow(2,25),mt=Math.pow(2,24),R=Math.pow(2,17),qr=Math.pow(2,16),oi=Math.pow(2,9),Ai=Math.pow(2,8),uo=Math.pow(2,1);function Xa(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,o=Math.floor(127*i.opacity);return o*Be+u*mt+o*R+u*qr+o*oi+u*Ai+o*uo+u}var ja=0,os=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};os.prototype.continuePlacement=function(i,u,o,h,_){for(var E=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(E,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort(function(T,k){return T.sortKey-k.sortKey}));this._currentPartIndex<E.length;)if(u.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,_())return!0;return!1};var uu=function(i,u,o,h,_,E,T){this.placement=new Do(i,_,E,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};uu.prototype.isDone=function(){return this._done},uu.prototype.continuePlacement=function(i,u,o){for(var h=this,_=p.browser.now(),E=function(){var K=p.browser.now()-_;return!h._forceFullPlacement&&K>2};this._currentPlacementIndex>=0;){var T=u[i[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=k)&&(!T.maxzoom||T.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new os(T)),this._inProgressLayer.continuePlacement(o[T.source],this.placement,this._showCollisionBoxes,T,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},uu.prototype.commit=function(i){return this.placement.commit(i),this.placement};var Tu=512/p.EXTENT/2,Ku=function(i,u,o){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var _=u.get(h),E=_.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,i)})}};Ku.prototype.getScaledCoordinates=function(i,u){var o=Tu/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+i.anchorX)*o),y:Math.floor((u.canonical.y*p.EXTENT+i.anchorY)*o)}},Ku.prototype.findMatches=function(i,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),_=0;_<i.length;_++){var E=i.get(_);if(!E.crossTileID){var T=this.indexedSymbolInstances[E.key];if(T)for(var k=this.getScaledCoordinates(E,u),K=0,le=T;K<le.length;K+=1){var Ce=le[K];if(Math.abs(Ce.coord.x-k.x)<=h&&Math.abs(Ce.coord.y-k.y)<=h&&!o[Ce.crossTileID]){o[Ce.crossTileID]=!0,E.crossTileID=Ce.crossTileID;break}}}}};var Qo=function(){this.maxCrossTileID=0};Qo.prototype.generate=function(){return++this.maxCrossTileID};var qo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};qo.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],_={};for(var E in h){var T=h[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),_[T.tileID.key]=T}this.indexes[o]=_}this.lng=i},qo.prototype.addBucket=function(i,u,o){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var _=this.usedCrossTileIDs[i.overscaledZ];for(var E in this.indexes){var T=this.indexes[E];if(Number(E)>i.overscaledZ)for(var k in T){var K=T[k];K.tileID.isChildOf(i)&&K.findMatches(u.symbolInstances,i,_)}else{var le=T[i.scaledTo(Number(E)).key];le&&le.findMatches(u.symbolInstances,i,_)}}for(var Ce=0;Ce<u.symbolInstances.length;Ce++){var we=u.symbolInstances.get(Ce);we.crossTileID||(we.crossTileID=o.generate(),_[we.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ku(i,u.symbolInstances,u.bucketInstanceId),!0},qo.prototype.removeBucketCrossTileIDs=function(i,u){for(var o in u.indexedSymbolInstances)for(var h=0,_=u.indexedSymbolInstances[o];h<_.length;h+=1)delete this.usedCrossTileIDs[i][_[h].crossTileID]},qo.prototype.removeStaleBuckets=function(i){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var _ in h)i[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[_]),delete h[_],u=!0)}return u};var ss=function(){this.layerIndexes={},this.crossTileIDs=new Qo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ss.prototype.addLayer=function(i,u,o){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new qo);var _=!1,E={};h.handleWrapJump(o);for(var T=0,k=u;T<k.length;T+=1){var K=k[T],le=K.getBucket(i);le&&i.id===le.layerIds[0]&&(le.bucketInstanceId||(le.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(K.tileID,le,this.crossTileIDs)&&(_=!0),E[le.bucketInstanceId]=!0)}return h.removeStaleBuckets(E)&&(_=!0),_},ss.prototype.pruneUnusedLayers=function(i){var u={};for(var o in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var ws=function(i,u){return p.emitValidationErrors(i,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},us=p.pick(yn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),zs=p.pick(yn,["setCenter","setZoom","setBearing","setPitch"]),Xs=function(){var i={},u=p.styleSpec.$version;for(var o in p.styleSpec.$root){var h,_=p.styleSpec.$root[o];_.required&&(h=o==="version"?u:_.type==="array"?[]:{})!=null&&(i[o]=h)}return i}(),As=function(i){function u(o,h){var _=this;h===void 0&&(h={}),i.call(this),this.map=o,this.dispatcher=new Ot(tr(),this),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new nr(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new ss,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var E=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){E.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(k,K){if(p.triggerPluginCompletionEvent(k),K&&K.every(function(Ce){return Ce}))for(var le in E.sourceCaches)E.sourceCaches[le].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var k=_.sourceCaches[T.sourceId];if(k){var K=k.getSource();if(K&&K.vectorLayerIds)for(var le in _._layers){var Ce=_._layers[le];Ce.source===K.id&&_._validateLayer(Ce)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var E=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var T=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(T,function(k,K){_._request=null,k?_.fire(new p.ErrorEvent(k)):K&&_._load(K,E)})},u.prototype.loadJSON=function(o,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){_._request=null,_._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Xs,!1)},u.prototype._load=function(o,h){if(!h||!ws(this,p.validateStyle(o))){for(var _ in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var E=hn(this.stylesheet.layers);this._order=E.map(function(le){return le.id}),this._layers={},this._serializedLayers={};for(var T=0,k=E;T<k.length;T+=1){var K=k[T];(K=p.createStyleLayer(K)).setEventedParent(this,{layer:{id:K.id}}),this._layers[K.id]=K,this._serializedLayers[K.id]=K.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Mt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(_,E,T){var k,K,le,Ce=p.browser.devicePixelRatio>1?"@2x":"",we=p.getJSON(E.transformRequest(E.normalizeSpriteURL(_,Ce,".json"),p.ResourceType.SpriteJSON),function(Xe,st){we=null,le||(le=Xe,k=st,Ye())}),Me=p.getImage(E.transformRequest(E.normalizeSpriteURL(_,Ce,".png"),p.ResourceType.SpriteImage),function(Xe,st){Me=null,le||(le=Xe,K=st,Ye())});function Ye(){if(le)T(le);else if(k&&K){var Xe=p.browser.getImageData(K),st={};for(var je in k){var ut=k[je],At=ut.width,Yt=ut.height,Sr=ut.x,dr=ut.y,wr=ut.sdf,Wr=ut.pixelRatio,fn=ut.stretchX,nn=ut.stretchY,jn=ut.content,ui=new p.RGBAImage({width:At,height:Yt});p.RGBAImage.copy(Xe,ui,{x:Sr,y:dr},{x:0,y:0},{width:At,height:Yt}),st[je]={data:ui,pixelRatio:Wr,sdf:wr,stretchX:fn,stretchY:nn,content:jn}}T(null,st)}}return{cancel:function(){we&&(we.cancel(),we=null),Me&&(Me.cancel(),Me=null)}}}(o,this.map._requestManager,function(_,E){if(h._spriteRequest=null,_)h.fire(new p.ErrorEvent(_));else if(E)for(var T in E)h.imageManager.addImage(T,E[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var _=o.sourceLayer;if(_){var E=h.getSource();(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(_)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+_+'" does not exist on source "'+E.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],_=0,E=o;_<E.length;_+=1){var T=this._layers[E[_]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var _=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);for(var T in(_.length||E.length)&&this._updateWorkerLayers(_,E),this._updatedSources){var k=this._updatedSources[T];k==="reload"?this._reloadSource(T):k==="clear"&&this._clearSource(T)}for(var K in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[K].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var le={};for(var Ce in this.sourceCaches){var we=this.sourceCaches[Ce];le[Ce]=we.used,we.used=!1}for(var Me=0,Ye=this._order;Me<Ye.length;Me+=1){var Xe=this._layers[Ye[Me]];Xe.recalculate(o,this._availableImages),!Xe.isHidden(o.zoom)&&Xe.source&&(this.sourceCaches[Xe.source].used=!0)}for(var st in le){var je=this.sourceCaches[st];le[st]!==je.used&&je.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:st}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),ws(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=hn(o.layers);var _=function(T,k){if(!T)return[{command:yn.setStyle,args:[k]}];var K=[];try{if(!p.deepEqual(T.version,k.version))return[{command:yn.setStyle,args:[k]}];p.deepEqual(T.center,k.center)||K.push({command:yn.setCenter,args:[k.center]}),p.deepEqual(T.zoom,k.zoom)||K.push({command:yn.setZoom,args:[k.zoom]}),p.deepEqual(T.bearing,k.bearing)||K.push({command:yn.setBearing,args:[k.bearing]}),p.deepEqual(T.pitch,k.pitch)||K.push({command:yn.setPitch,args:[k.pitch]}),p.deepEqual(T.sprite,k.sprite)||K.push({command:yn.setSprite,args:[k.sprite]}),p.deepEqual(T.glyphs,k.glyphs)||K.push({command:yn.setGlyphs,args:[k.glyphs]}),p.deepEqual(T.transition,k.transition)||K.push({command:yn.setTransition,args:[k.transition]}),p.deepEqual(T.light,k.light)||K.push({command:yn.setLight,args:[k.light]});var le={},Ce=[];(function(Me,Ye,Xe,st){var je;for(je in Ye=Ye||{},Me=Me||{})Me.hasOwnProperty(je)&&(Ye.hasOwnProperty(je)||Tn(je,Xe,st));for(je in Ye)Ye.hasOwnProperty(je)&&(Me.hasOwnProperty(je)?p.deepEqual(Me[je],Ye[je])||(Me[je].type==="geojson"&&Ye[je].type==="geojson"&&ra(Me,Ye,je)?Xe.push({command:yn.setGeoJSONSourceData,args:[je,Ye[je].data]}):Di(je,Ye,Xe,st)):Ni(je,Ye,Xe))})(T.sources,k.sources,Ce,le);var we=[];T.layers&&T.layers.forEach(function(Me){le[Me.source]?K.push({command:yn.removeLayer,args:[Me.id]}):we.push(Me)}),K=K.concat(Ce),function(Me,Ye,Xe){Ye=Ye||[];var st,je,ut,At,Yt,Sr,dr,wr=(Me=Me||[]).map(na),Wr=Ye.map(na),fn=Me.reduce(Xi,{}),nn=Ye.reduce(Xi,{}),jn=wr.slice(),ui=Object.create(null);for(st=0,je=0;st<wr.length;st++)nn.hasOwnProperty(ut=wr[st])?je++:(Xe.push({command:yn.removeLayer,args:[ut]}),jn.splice(jn.indexOf(ut,je),1));for(st=0,je=0;st<Wr.length;st++)jn[jn.length-1-st]!==(ut=Wr[Wr.length-1-st])&&(fn.hasOwnProperty(ut)?(Xe.push({command:yn.removeLayer,args:[ut]}),jn.splice(jn.lastIndexOf(ut,jn.length-je),1)):je++,Xe.push({command:yn.addLayer,args:[nn[ut],Sr=jn[jn.length-st]]}),jn.splice(jn.length-st,0,ut),ui[ut]=!0);for(st=0;st<Wr.length;st++)if(At=fn[ut=Wr[st]],Yt=nn[ut],!ui[ut]&&!p.deepEqual(At,Yt))if(p.deepEqual(At.source,Yt.source)&&p.deepEqual(At["source-layer"],Yt["source-layer"])&&p.deepEqual(At.type,Yt.type)){for(dr in hi(At.layout,Yt.layout,Xe,ut,null,yn.setLayoutProperty),hi(At.paint,Yt.paint,Xe,ut,null,yn.setPaintProperty),p.deepEqual(At.filter,Yt.filter)||Xe.push({command:yn.setFilter,args:[ut,Yt.filter]}),p.deepEqual(At.minzoom,Yt.minzoom)&&p.deepEqual(At.maxzoom,Yt.maxzoom)||Xe.push({command:yn.setLayerZoomRange,args:[ut,Yt.minzoom,Yt.maxzoom]}),At)At.hasOwnProperty(dr)&&dr!=="layout"&&dr!=="paint"&&dr!=="filter"&&dr!=="metadata"&&dr!=="minzoom"&&dr!=="maxzoom"&&(dr.indexOf("paint.")===0?hi(At[dr],Yt[dr],Xe,ut,dr.slice(6),yn.setPaintProperty):p.deepEqual(At[dr],Yt[dr])||Xe.push({command:yn.setLayerProperty,args:[ut,dr,Yt[dr]]}));for(dr in Yt)Yt.hasOwnProperty(dr)&&!At.hasOwnProperty(dr)&&dr!=="layout"&&dr!=="paint"&&dr!=="filter"&&dr!=="metadata"&&dr!=="minzoom"&&dr!=="maxzoom"&&(dr.indexOf("paint.")===0?hi(At[dr],Yt[dr],Xe,ut,dr.slice(6),yn.setPaintProperty):p.deepEqual(At[dr],Yt[dr])||Xe.push({command:yn.setLayerProperty,args:[ut,dr,Yt[dr]]}))}else Xe.push({command:yn.removeLayer,args:[ut]}),Sr=jn[jn.lastIndexOf(ut)+1],Xe.push({command:yn.addLayer,args:[Yt,Sr]})}(we,k.layers,K)}catch(Me){console.warn("Unable to compute style diff:",Me),K=[{command:yn.setStyle,args:[k]}]}return K}(this.serialize(),o).filter(function(T){return!(T.command in zs)});if(_.length===0)return!1;var E=_.filter(function(T){return!(T.command in us)});if(E.length>0)throw new Error("Unimplemented: "+E.map(function(T){return T.command}).join(", ")+".");return _.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,_){var E=this;if(_===void 0&&(_={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+o,h,null,_))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[o]=new xe(o,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:E.loaded(),source:T.serialize(),sourceId:o}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new p.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var _=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],_.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),_.setEventedParent(null),_.clearTiles(),_.onRemove&&_.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,_){_===void 0&&(_={}),this._checkLoaded();var E=o.id;if(this.getLayer(E))this.fire(new p.ErrorEvent(new Error('Layer with id "'+E+'" already exists on this map')));else{var T;if(o.type==="custom"){if(ws(this,p.validateCustomStyleLayer(o)))return;T=p.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(E,o.source),o=p.clone$1(o),o=p.extend(o,{source:E})),this._validate(p.validateStyle.layer,"layers."+E,o,{arrayIndex:-1},_))return;T=p.createStyleLayer(o),this._validateLayer(T),T.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[T.id]=T.serialize()}var k=h?this._order.indexOf(h):this._order.length;if(h&&k===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(k,0,E),this._layerOrderChanged=!0,this._layers[E]=T,this._removedLayers[E]&&T.source&&T.type!=="custom"){var K=this._removedLayers[E];delete this._removedLayers[E],K.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var _=this._order.indexOf(o);this._order.splice(_,1);var E=h?this._order.indexOf(h):this._order.length;h&&E===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(E,0,o),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,_){this._checkLoaded();var E=this.getLayer(o);E?E.minzoom===h&&E.maxzoom===_||(h!=null&&(E.minzoom=h),_!=null&&(E.maxzoom=_),this._updateLayer(E)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,_){_===void 0&&(_={}),this._checkLoaded();var E=this.getLayer(o);if(E){if(!p.deepEqual(E.filter,h))return h==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(p.validateStyle.filter,"layers."+E.id+".filter",h,null,_)||(E.filter=p.clone$1(h),this._updateLayer(E)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return p.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,_,E){E===void 0&&(E={}),this._checkLoaded();var T=this.getLayer(o);T?p.deepEqual(T.getLayoutProperty(h),_)||(T.setLayoutProperty(h,_,E),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var _=this.getLayer(o);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,_,E){E===void 0&&(E={}),this._checkLoaded();var T=this.getLayer(o);T?p.deepEqual(T.getPaintProperty(h),_)||(T.setPaintProperty(h,_,E)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var _=o.source,E=o.sourceLayer,T=this.sourceCaches[_];if(T!==void 0){var k=T.getSource().type;k==="geojson"&&E?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||E?(o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(E,o.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var _=o.source,E=this.sourceCaches[_];if(E!==void 0){var T=E.getSource().type,k=T==="vector"?o.sourceLayer:void 0;T!=="vector"||k?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):E.removeFeatureState(k,o.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,_=o.sourceLayer,E=this.sourceCaches[h];if(E!==void 0){if(E.getSource().type!=="vector"||_)return o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),E.getFeatureState(_,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,_=function(fn){return h._layers[fn].type==="fill-extrusion"},E={},T=[],k=this._order.length-1;k>=0;k--){var K=this._order[k];if(_(K)){E[K]=k;for(var le=0,Ce=o;le<Ce.length;le+=1){var we=Ce[le][K];if(we)for(var Me=0,Ye=we;Me<Ye.length;Me+=1)T.push(Ye[Me])}}}T.sort(function(fn,nn){return nn.intersectionZ-fn.intersectionZ});for(var Xe=[],st=this._order.length-1;st>=0;st--){var je=this._order[st];if(_(je))for(var ut=T.length-1;ut>=0;ut--){var At=T[ut].feature;if(E[At.layer.id]<st)break;Xe.push(At),T.pop()}else for(var Yt=0,Sr=o;Yt<Sr.length;Yt+=1){var dr=Sr[Yt][je];if(dr)for(var wr=0,Wr=dr;wr<Wr.length;wr+=1)Xe.push(Wr[wr].feature)}}return Xe},u.prototype.queryRenderedFeatures=function(o,h,_){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,k=h.layers;T<k.length;T+=1){var K=k[T],le=this._layers[K];if(!le)return this.fire(new p.ErrorEvent(new Error("The layer '"+K+"' does not exist in the map's style and cannot be queried for features."))),[];E[le.source]=!0}}var Ce=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!E[we]||Ce.push(_n(this.sourceCaches[we],this._layers,this._serializedLayers,o,h,_));return this.placement&&Ce.push(function(Me,Ye,Xe,st,je,ut,At){for(var Yt={},Sr=ut.queryRenderedSymbols(st),dr=[],wr=0,Wr=Object.keys(Sr).map(Number);wr<Wr.length;wr+=1)dr.push(At[Wr[wr]]);dr.sort(Qi);for(var fn=function(){var mn=jn[nn],aa=mn.featureIndex.lookupSymbolFeatures(Sr[mn.bucketInstanceId],Ye,mn.bucketIndex,mn.sourceLayerIndex,je.filter,je.layers,je.availableImages,Me);for(var Hn in aa){var xi=Yt[Hn]=Yt[Hn]||[],Gi=aa[Hn];Gi.sort(function(ie,ne){var L=mn.featureSortOrder;if(L){var B=L.indexOf(ie.featureIndex);return L.indexOf(ne.featureIndex)-B}return ne.featureIndex-ie.featureIndex});for(var vi=0,Ci=Gi;vi<Ci.length;vi+=1)xi.push(Ci[vi])}},nn=0,jn=dr;nn<jn.length;nn+=1)fn();var ui=function(mn){Yt[mn].forEach(function(aa){var Hn=aa.feature,xi=Xe[Me[mn].source].getFeatureState(Hn.layer["source-layer"],Hn.id);Hn.source=Hn.layer.source,Hn.layer["source-layer"]&&(Hn.sourceLayer=Hn.layer["source-layer"]),Hn.state=xi})};for(var li in Yt)ui(li);return Yt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ce)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var _=this.sourceCaches[o];return _?function(E,T){for(var k=E.getRenderableIds().map(function(Ye){return E.getTileByID(Ye)}),K=[],le={},Ce=0;Ce<k.length;Ce++){var we=k[Ce],Me=we.tileID.canonical.key;le[Me]||(le[Me]=!0,we.querySourceFeatures(K,T))}return K}(_,h):[]},u.prototype.addSourceType=function(o,h,_){return u.getSourceType(o)?_(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},_):_(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var _=this.light.getLight(),E=!1;for(var T in o)if(!p.deepEqual(o[T],_[T])){E=!0;break}if(E){var k={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(k)}},u.prototype._validate=function(o,h,_,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ws(this,o.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.styleSpec},E)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,_,E,T){T===void 0&&(T=!1);for(var k=!1,K=!1,le={},Ce=0,we=this._order;Ce<we.length;Ce+=1){var Me=this._layers[we[Ce]];if(Me.type==="symbol"){if(!le[Me.source]){var Ye=this.sourceCaches[Me.source];le[Me.source]=Ye.getRenderableIds(!0).map(function(At){return Ye.getTileByID(At)}).sort(function(At,Yt){return Yt.tileID.overscaledZ-At.tileID.overscaledZ||(At.tileID.isLessThan(Yt.tileID)?-1:1)})}var Xe=this.crossTileSymbolIndex.addLayer(Me,le[Me.source],o.center.lng);k=k||Xe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),o.zoom))&&(this.pauseablePlacement=new uu(o,this._order,T,h,_,E,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,le),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),K=!0),k&&this.pauseablePlacement.placement.setStale()),K||k)for(var st=0,je=this._order;st<je.length;st+=1){var ut=this._layers[je[st]];ut.type==="symbol"&&this.placement.updateLayerOpacities(ut,le[ut.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();var E=this.sourceCaches[h.source];E&&E.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,_){this.glyphManager.getGlyphs(h.stacks,_)},u.prototype.getResource=function(o,h,_){return p.makeRequest(h,_)},u}(p.Evented);As.getSourceType=function(i){return zr[i]},As.setSourceType=function(i,u){zr[i]=u},As.registerForPluginStateChange=p.registerForPluginStateChange;var Ca=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),Co=_i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),vl=_i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ml=_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),$u=_i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Jl=_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gl=_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Lu=_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Us=_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),yl=_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),w=_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),j=_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),I=_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),pe=_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),De=_i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ht=_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Vt=_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Wt=_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),kr=_i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Kr=_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),cn=_i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Oi=_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ei=_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ha=_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Pa=_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ga=_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function _i(i,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=E?E.concat(_):_,k={};return{fragmentSource:i=i.replace(o,function(K,le,Ce,we,Me){return k[Me]=!0,le==="define"?`
#ifndef HAS_UNIFORM_u_`+Me+`
varying `+Ce+" "+we+" "+Me+`;
#else
uniform `+Ce+" "+we+" u_"+Me+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Me+`
    `+Ce+" "+we+" "+Me+" = u_"+Me+`;
#endif
`}),vertexSource:u=u.replace(o,function(K,le,Ce,we,Me){var Ye=we==="float"?"vec2":"vec4",Xe=Me.match(/color/)?"color":Ye;return k[Me]?le==="define"?`
#ifndef HAS_UNIFORM_u_`+Me+`
uniform lowp float u_`+Me+`_t;
attribute `+Ce+" "+Ye+" a_"+Me+`;
varying `+Ce+" "+we+" "+Me+`;
#else
uniform `+Ce+" "+we+" u_"+Me+`;
#endif
`:Xe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+Me+" = a_"+Me+`;
#else
    `+Ce+" "+we+" "+Me+" = u_"+Me+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+Me+" = unpack_mix_"+Xe+"(a_"+Me+", u_"+Me+`_t);
#else
    `+Ce+" "+we+" "+Me+" = u_"+Me+`;
#endif
`:le==="define"?`
#ifndef HAS_UNIFORM_u_`+Me+`
uniform lowp float u_`+Me+`_t;
attribute `+Ce+" "+Ye+" a_"+Me+`;
#else
uniform `+Ce+" "+we+" u_"+Me+`;
#endif
`:Xe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+Ce+" "+we+" "+Me+" = a_"+Me+`;
#else
    `+Ce+" "+we+" "+Me+" = u_"+Me+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+Ce+" "+we+" "+Me+" = unpack_mix_"+Xe+"(a_"+Me+", u_"+Me+`_t);
#else
    `+Ce+" "+we+" "+Me+" = u_"+Me+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var po=Object.freeze({__proto__:null,prelude:Co,background:vl,backgroundPattern:ml,circle:$u,clippingMask:Jl,heatmap:gl,heatmapTexture:Lu,collisionBox:Us,collisionCircle:yl,debug:m,fill:w,fillOutline:j,fillOutlinePattern:I,fillPattern:pe,fillExtrusion:De,fillExtrusionPattern:ht,hillshadePrepare:Vt,hillshade:Wt,line:kr,lineGradient:Kr,linePattern:cn,lineSDF:Oi,raster:Ei,symbolIcon:ha,symbolSDF:Pa,symbolTextAndIcon:ga}),wo=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ys(i){for(var u=[],o=0;o<i.length;o++)if(i[o]!==null){var h=i[o].split(" ");u.push(h.pop())}return u}wo.prototype.bind=function(i,u,o,h,_,E,T,k){this.context=i;for(var K=this.boundPaintVertexBuffers.length!==h.length,le=0;!K&&le<h.length;le++)this.boundPaintVertexBuffers[le]!==h[le]&&(K=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!K&&this.boundIndexBuffer===_&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===k?(i.bindVertexArrayOES.set(this.vao),T&&T.bind(),_&&_.dynamicDraw&&_.bind(),k&&k.bind()):this.freshBind(u,o,h,_,E,T,k)},wo.prototype.freshBind=function(i,u,o,h,_,E,T){var k,K=i.numAttributes,le=this.context,Ce=le.gl;if(le.extVertexArrayObject)this.vao&&this.destroy(),this.vao=le.extVertexArrayObject.createVertexArrayOES(),le.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=T;else{k=le.currentNumAttributes||0;for(var we=K;we<k;we++)Ce.disableVertexAttribArray(we)}u.enableAttributes(Ce,i);for(var Me=0,Ye=o;Me<Ye.length;Me+=1)Ye[Me].enableAttributes(Ce,i);E&&E.enableAttributes(Ce,i),T&&T.enableAttributes(Ce,i),u.bind(),u.setVertexAttribPointers(Ce,i,_);for(var Xe=0,st=o;Xe<st.length;Xe+=1){var je=st[Xe];je.bind(),je.setVertexAttribPointers(Ce,i,_)}E&&(E.bind(),E.setVertexAttribPointers(Ce,i,_)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(Ce,i,_)),le.currentNumAttributes=K},wo.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var lu=function(i,u,o,h,_,E){var T=i.gl;this.program=T.createProgram();for(var k=Ys(o.staticAttributes),K=h?h.getBinderAttributes():[],le=k.concat(K),Ce=o.staticUniforms?Ys(o.staticUniforms):[],we=h?h.getBinderUniforms():[],Me=[],Ye=0,Xe=Ce.concat(we);Ye<Xe.length;Ye+=1){var st=Xe[Ye];Me.indexOf(st)<0&&Me.push(st)}var je=h?h.defines():[];E&&je.push("#define OVERDRAW_INSPECTOR;");var ut=je.concat(Co.fragmentSource,o.fragmentSource).join(`
`),At=je.concat(Co.vertexSource,o.vertexSource).join(`
`),Yt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Yt,ut),T.compileShader(Yt),T.attachShader(this.program,Yt);var Sr=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Sr,At),T.compileShader(Sr),T.attachShader(this.program,Sr),this.attributes={};var dr={};this.numAttributes=le.length;for(var wr=0;wr<this.numAttributes;wr++)le[wr]&&(T.bindAttribLocation(this.program,wr,le[wr]),this.attributes[le[wr]]=wr);T.linkProgram(this.program),T.deleteShader(Sr),T.deleteShader(Yt);for(var Wr=0;Wr<Me.length;Wr++){var fn=Me[Wr];if(fn&&!dr[fn]){var nn=T.getUniformLocation(this.program,fn);nn&&(dr[fn]=nn)}}this.fixedUniforms=_(i,dr),this.binderUniforms=h?h.getUniforms(i,dr):[]}}};function Ks(i,u,o){var h=1/ba(o,1,u.transform.tileZoom),_=Math.pow(2,o.tileID.overscaledZ),E=o.tileSize*Math.pow(2,u.transform.tileZoom)/_,T=E*(o.tileID.canonical.x+o.tileID.wrap*_),k=E*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[T>>16,k>>16],u_pixel_coord_lower:[65535&T,65535&k]}}lu.prototype.draw=function(i,u,o,h,_,E,T,k,K,le,Ce,we,Me,Ye,Xe,st){var je,ut=i.gl;if(!this.failedToCreate){for(var At in i.program.set(this.program),i.setDepthMode(o),i.setStencilMode(h),i.setColorMode(_),i.setCullFace(E),this.fixedUniforms)this.fixedUniforms[At].set(T[At]);Ye&&Ye.setUniforms(i,this.binderUniforms,we,{zoom:Me});for(var Yt=(je={},je[ut.LINES]=2,je[ut.TRIANGLES]=3,je[ut.LINE_STRIP]=1,je)[u],Sr=0,dr=Ce.get();Sr<dr.length;Sr+=1){var wr=dr[Sr],Wr=wr.vaos||(wr.vaos={});(Wr[k]||(Wr[k]=new wo)).bind(i,this,K,Ye?Ye.getPaintVertexBuffers():[],le,wr.vertexOffset,Xe,st),ut.drawElements(u,wr.primitiveLength*Yt,ut.UNSIGNED_SHORT,wr.primitiveOffset*Yt*2)}}};var Ru=function(i,u,o,h){var _=u.style.light,E=_.properties.get("position"),T=[E.x,E.y,E.z],k=p.create$1();_.properties.get("anchor")==="viewport"&&p.fromRotation(k,-u.transform.angle),p.transformMat3(T,T,k);var K=_.properties.get("color");return{u_matrix:i,u_lightpos:T,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+o,u_opacity:h}},Go=function(i,u,o,h,_,E,T){return p.extend(Ru(i,u,o,h),Ks(E,u,T),{u_height_factor:-Math.pow(2,_.overscaledZ)/T.tileSize/8})},ys=function(i){return{u_matrix:i}},ro=function(i,u,o,h){return p.extend(ys(i),Ks(o,u,h))},Ia=function(i,u){return{u_matrix:i,u_world:u}},$s=function(i,u,o,h,_){return p.extend(ro(i,u,o,h),{u_world:_})},_l=function(i,u,o,h){var _,E,T=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var k=ba(o,1,T.zoom);_=!0,E=[k,k]}else _=!1,E=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:E}},_s=function(i,u,o){var h=ba(o,1,u.zoom),_=Math.pow(2,u.zoom-o.tileID.overscaledZ),E=o.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*_),u.pixelsToGLUnits[1]/(h*_)],u_overscale_factor:E}},Dl=function(i,u,o){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},Js=function(i,u,o){return o===void 0&&(o=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:o}},Qs=function(i){return{u_matrix:i}},yc=function(i,u,o,h){return{u_matrix:i,u_extrude_scale:ba(u,1,o),u_intensity:h}},Du=function(i,u,o){var h=i.transform;return{u_matrix:bl(i,u,o),u_ratio:1/ba(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Oa=function(i,u,o,h){return p.extend(Du(i,u,o),{u_image:0,u_image_height:h})},xl=function(i,u,o,h){var _=i.transform,E=ku(u,_);return{u_matrix:bl(i,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/ba(u,1,_.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[E,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Kc=function(i,u,o,h,_){var E=i.lineAtlas,T=ku(u,i.transform),k=o.layout.get("line-cap")==="round",K=E.getDash(h.from,k),le=E.getDash(h.to,k),Ce=K.width*_.fromScale,we=le.width*_.toScale;return p.extend(Du(i,u,o),{u_patternscale_a:[T/Ce,-K.height/2],u_patternscale_b:[T/we,-le.height/2],u_sdfgamma:E.width/(256*Math.min(Ce,we)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:K.y,u_tex_y_b:le.y,u_mix:_.t})};function ku(i,u){return 1/ba(i,1,u.tileZoom)}function bl(i,u,o){return i.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var $c=function(i,u,o,h,_){return{u_matrix:i,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(E=_.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ju(_.paint.get("raster-hue-rotate"))};var E,T};function Ju(i){i*=Math.PI/180;var u=Math.sin(i),o=Math.cos(i);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var Ql,Pu=function(i,u,o,h,_,E,T,k,K,le){var Ce=_.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_pitch:Ce.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:T,u_coord_matrix:k,u_is_text:+K,u_pitch_with_map:+h,u_texsize:le,u_texture:0}},Qu=function(i,u,o,h,_,E,T,k,K,le,Ce){var we=_.transform;return p.extend(Pu(i,u,o,h,_,E,T,k,K,le),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+Ce})},Sl=function(i,u,o,h,_,E,T,k,K,le){return p.extend(Qu(i,u,o,h,_,E,T,k,!0,K,!0),{u_texsize_icon:le,u_texture_icon:1})},El=function(i,u,o){return{u_matrix:i,u_opacity:u,u_color:o}},qu=function(i,u,o,h,_,E){return p.extend(function(T,k,K,le){var Ce=K.imageManager.getPattern(T.from.toString()),we=K.imageManager.getPattern(T.to.toString()),Me=K.imageManager.getPixelSize(),Ye=Me.width,Xe=Me.height,st=Math.pow(2,le.tileID.overscaledZ),je=le.tileSize*Math.pow(2,K.transform.tileZoom)/st,ut=je*(le.tileID.canonical.x+le.tileID.wrap*st),At=je*le.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ce.tl,u_pattern_br_a:Ce.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[Ye,Xe],u_mix:k.t,u_pattern_size_a:Ce.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/ba(le,1,K.transform.tileZoom),u_pixel_coord_upper:[ut>>16,At>>16],u_pixel_coord_lower:[65535&ut,65535&At]}}(h,E,o,_),{u_matrix:i,u_opacity:u})},Cl={fillExtrusion:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(i,u.u_height_factor),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new p.UniformColor(i,u.u_color),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_overlay:new p.Uniform1i(i,u.u_overlay),u_overlay_scale:new p.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new p.Uniform1f(i,u.u_extrude_scale),u_intensity:new p.Uniform1f(i,u.u_intensity),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_color_ramp:new p.Uniform1i(i,u.u_color_ramp),u_opacity:new p.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_latrange:new p.Uniform2f(i,u.u_latrange),u_light:new p.Uniform2f(i,u.u_light),u_shadow:new p.UniformColor(i,u.u_shadow),u_highlight:new p.UniformColor(i,u.u_highlight),u_accent:new p.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_dimension:new p.Uniform2f(i,u.u_dimension),u_zoom:new p.Uniform1f(i,u.u_zoom),u_unpack:new p.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_image:new p.Uniform1i(i,u.u_image),u_image_height:new p.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_texsize:new p.Uniform2f(i,u.u_texsize),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_image:new p.Uniform1i(i,u.u_image),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(i,u.u_sdfgamma),u_image:new p.Uniform1i(i,u.u_image),u_tex_y_a:new p.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(i,u.u_tex_y_b),u_mix:new p.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new p.Uniform2f(i,u.u_tl_parent),u_scale_parent:new p.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(i,u.u_buffer_scale),u_fade_t:new p.Uniform1f(i,u.u_fade_t),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image0:new p.Uniform1i(i,u.u_image0),u_image1:new p.Uniform1i(i,u.u_image1),u_brightness_low:new p.Uniform1f(i,u.u_brightness_low),u_brightness_high:new p.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texsize_icon:new p.Uniform2f(i,u.u_texsize_icon),u_texture:new p.Uniform1i(i,u.u_texture),u_texture_icon:new p.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_color:new p.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image:new p.Uniform1i(i,u.u_image),u_pattern_tl_a:new p.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(i,u.u_pattern_br_b),u_texsize:new p.Uniform2f(i,u.u_texsize),u_mix:new p.Uniform1f(i,u.u_mix),u_pattern_size_a:new p.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(i,u.u_scale_a),u_scale_b:new p.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(i,u.u_tile_units_to_pixels)}}};function el(i,u,o,h,_,E,T){for(var k=i.context,K=k.gl,le=i.useProgram("collisionBox"),Ce=[],we=0,Me=0,Ye=0;Ye<h.length;Ye++){var Xe=h[Ye],st=u.getTile(Xe),je=st.getBucket(o);if(je){var ut=Xe.posMatrix;_[0]===0&&_[1]===0||(ut=i.translatePosMatrix(Xe.posMatrix,st,_,E));var At=T?je.textCollisionBox:je.iconCollisionBox,Yt=je.collisionCircleArray;if(Yt.length>0){var Sr=p.create(),dr=ut;p.mul(Sr,je.placementInvProjMatrix,i.transform.glCoordMatrix),p.mul(Sr,Sr,je.placementViewportMatrix),Ce.push({circleArray:Yt,circleOffset:Me,transform:dr,invTransform:Sr}),Me=we+=Yt.length/4}At&&le.draw(k,K.LINES,N.disabled,ae.disabled,i.colorModeForRenderPass(),Te.disabled,_s(ut,i.transform,st),o.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,null,i.transform.zoom,null,null,At.collisionVertexBuffer)}}if(T&&Ce.length){var wr=i.useProgram("collisionCircle"),Wr=new p.StructArrayLayout2f1f2i16;Wr.resize(4*we),Wr._trim();for(var fn=0,nn=0,jn=Ce;nn<jn.length;nn+=1)for(var ui=jn[nn],li=0;li<ui.circleArray.length/4;li++){var mn=4*li,aa=ui.circleArray[mn+0],Hn=ui.circleArray[mn+1],xi=ui.circleArray[mn+2],Gi=ui.circleArray[mn+3];Wr.emplace(fn++,aa,Hn,xi,Gi,0),Wr.emplace(fn++,aa,Hn,xi,Gi,1),Wr.emplace(fn++,aa,Hn,xi,Gi,2),Wr.emplace(fn++,aa,Hn,xi,Gi,3)}(!Ql||Ql.length<2*we)&&(Ql=function(ce){var Ae=2*ce,_t=new p.StructArrayLayout3ui6;_t.resize(Ae),_t._trim();for(var Rt=0;Rt<Ae;Rt++){var wt=6*Rt;_t.uint16[wt+0]=4*Rt+0,_t.uint16[wt+1]=4*Rt+1,_t.uint16[wt+2]=4*Rt+2,_t.uint16[wt+3]=4*Rt+2,_t.uint16[wt+4]=4*Rt+3,_t.uint16[wt+5]=4*Rt+0}return _t}(we));for(var vi=k.createIndexBuffer(Ql,!0),Ci=k.createVertexBuffer(Wr,p.collisionCircleLayout.members,!0),ie=0,ne=Ce;ie<ne.length;ie+=1){var L=ne[ie],B=Dl(L.transform,L.invTransform,i.transform);wr.draw(k,K.TRIANGLES,N.disabled,ae.disabled,i.colorModeForRenderPass(),Te.disabled,B,o.id,Ci,vi,p.SegmentVector.simpleSegment(0,2*L.circleOffset,L.circleArray.length,L.circleArray.length/2),null,i.transform.zoom,null,null,null)}Ci.destroy(),vi.destroy()}}var qs=p.identity(new Float32Array(16));function ql(i,u,o,h,_,E){var T=p.getAnchorAlignment(i),k=-(T.horizontalAlign-.5)*u,K=-(T.verticalAlign-.5)*o,le=p.evaluateVariableOffset(i,h);return new p.Point((k/_+le[0])*E,(K/_+le[1])*E)}function Fu(i,u,o,h,_,E,T,k,K,le,Ce){var we=i.text.placedSymbolArray,Me=i.text.dynamicLayoutVertexArray,Ye=i.icon.dynamicLayoutVertexArray,Xe={};Me.clear();for(var st=0;st<we.length;st++){var je=we.get(st),ut=je.hidden||!je.crossTileID||i.allowVerticalPlacement&&!je.placedOrientation?null:h[je.crossTileID];if(ut){var At=new p.Point(je.anchorX,je.anchorY),Yt=zi(At,o?k:T),Sr=Ki(E.cameraToCenterDistance,Yt.signedDistanceFromCamera),dr=_.evaluateSizeForFeature(i.textSizeData,le,je)*Sr/p.ONE_EM;o&&(dr*=i.tilePixelRatio/K);for(var wr=ql(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textBoxScale,dr),Wr=o?zi(At.add(wr),T).point:Yt.point.add(u?wr.rotate(-E.angle):wr),fn=i.allowVerticalPlacement&&je.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,nn=0;nn<je.numGlyphs;nn++)p.addDynamicAttributes(Me,Wr,fn);Ce&&je.associatedIconIndex>=0&&(Xe[je.associatedIconIndex]={shiftedAnchor:Wr,angle:fn})}else Ji(je.numGlyphs,Me)}if(Ce){Ye.clear();for(var jn=i.icon.placedSymbolArray,ui=0;ui<jn.length;ui++){var li=jn.get(ui);if(li.hidden)Ji(li.numGlyphs,Ye);else{var mn=Xe[ui];if(mn)for(var aa=0;aa<li.numGlyphs;aa++)p.addDynamicAttributes(Ye,mn.shiftedAnchor,mn.angle);else Ji(li.numGlyphs,Ye)}}i.icon.dynamicLayoutVertexBuffer.updateData(Ye)}i.text.dynamicLayoutVertexBuffer.updateData(Me)}function Oc(i,u,o){return o.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function tl(i,u,o,h,_,E,T,k,K,le,Ce,we){for(var Me=i.context,Ye=Me.gl,Xe=i.transform,st=k==="map",je=K==="map",ut=st&&o.layout.get("symbol-placement")!=="point",At=st&&!je&&!ut,Yt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,Sr=!1,dr=i.depthModeForSublayer(0,N.ReadOnly),wr=o.layout.get("text-variable-anchor"),Wr=[],fn=0,nn=h;fn<nn.length;fn+=1){var jn=nn[fn],ui=u.getTile(jn),li=ui.getBucket(o);if(li){var mn=_?li.text:li.icon;if(mn&&mn.segments.get().length){var aa=mn.programConfigurations.get(o.id),Hn=_||li.sdfIcons,xi=_?li.textSizeData:li.iconSizeData,Gi=je||Xe.pitch!==0,vi=i.useProgram(Oc(Hn,_,li),aa),Ci=p.evaluateSizeForZoom(xi,Xe.zoom),ie=void 0,ne=[0,0],L=void 0,B=void 0,ce=null,Ae=void 0;if(_)L=ui.glyphAtlasTexture,B=Ye.LINEAR,ie=ui.glyphAtlasTexture.size,li.iconsInText&&(ne=ui.imageAtlasTexture.size,ce=ui.imageAtlasTexture,Ae=Gi||i.options.rotating||i.options.zooming||xi.kind==="composite"||xi.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{var _t=o.layout.get("icon-size").constantOr(0)!==1||li.iconsNeedLinear;L=ui.imageAtlasTexture,B=Hn||i.options.rotating||i.options.zooming||_t||Gi?Ye.LINEAR:Ye.NEAREST,ie=ui.imageAtlasTexture.size}var Rt=ba(ui,1,i.transform.zoom),wt=Da(jn.posMatrix,je,st,i.transform,Rt),hr=Yi(jn.posMatrix,je,st,i.transform,Rt),Xr=wr&&li.hasTextData(),Qn=o.layout.get("icon-text-fit")!=="none"&&Xr&&li.hasIconData();ut&&$o(li,jn.posMatrix,i,_,wt,hr,je,le);var Wn=i.translatePosMatrix(jn.posMatrix,ui,E,T),fi=ut||_&&wr||Qn?qs:wt,mi=i.translatePosMatrix(hr,ui,E,T,!0),Li=Hn&&o.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,oa={program:vi,buffers:mn,uniformValues:Hn?li.iconsInText?Sl(xi.kind,Ci,At,je,i,Wn,fi,mi,ie,ne):Qu(xi.kind,Ci,At,je,i,Wn,fi,mi,_,ie,!0):Pu(xi.kind,Ci,At,je,i,Wn,fi,mi,_,ie),atlasTexture:L,atlasTextureIcon:ce,atlasInterpolation:B,atlasInterpolationIcon:Ae,isSDF:Hn,hasHalo:Li};if(Yt&&li.canOverlap){Sr=!0;for(var pa=0,Sa=mn.segments.get();pa<Sa.length;pa+=1){var vo=Sa[pa];Wr.push({segments:new p.SegmentVector([vo]),sortKey:vo.sortKey,state:oa})}}else Wr.push({segments:mn.segments,sortKey:0,state:oa})}}}Sr&&Wr.sort(function(Ka,mo){return Ka.sortKey-mo.sortKey});for(var wa=0,Fo=Wr;wa<Fo.length;wa+=1){var Fa=Fo[wa],ji=Fa.state;if(Me.activeTexture.set(Ye.TEXTURE0),ji.atlasTexture.bind(ji.atlasInterpolation,Ye.CLAMP_TO_EDGE),ji.atlasTextureIcon&&(Me.activeTexture.set(Ye.TEXTURE1),ji.atlasTextureIcon&&ji.atlasTextureIcon.bind(ji.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),ji.isSDF){var da=ji.uniformValues;ji.hasHalo&&(da.u_is_halo=1,wl(ji.buffers,Fa.segments,o,i,ji.program,dr,Ce,we,da)),da.u_is_halo=0}wl(ji.buffers,Fa.segments,o,i,ji.program,dr,Ce,we,ji.uniformValues)}}function wl(i,u,o,h,_,E,T,k,K){var le=h.context;_.draw(le,le.gl.TRIANGLES,E,T,k,Te.disabled,K,o.id,i.layoutVertexBuffer,i.indexBuffer,u,o.paint,h.transform.zoom,i.programConfigurations.get(o.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function kl(i,u,o,h,_,E,T){var k,K,le,Ce,we,Me=i.context.gl,Ye=o.paint.get("fill-pattern"),Xe=Ye&&Ye.constantOr(1),st=o.getCrossfadeParameters();T?(K=Xe&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=Me.LINES):(K=Xe?"fillPattern":"fill",k=Me.TRIANGLES);for(var je=0,ut=h;je<ut.length;je+=1){var At=ut[je],Yt=u.getTile(At);if(!Xe||Yt.patternsLoaded()){var Sr=Yt.getBucket(o);if(Sr){var dr=Sr.programConfigurations.get(o.id),wr=i.useProgram(K,dr);Xe&&(i.context.activeTexture.set(Me.TEXTURE0),Yt.imageAtlasTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),dr.updatePaintBuffers(st));var Wr=Ye.constantOr(null);if(Wr&&Yt.imageAtlas){var fn=Yt.imageAtlas,nn=fn.patternPositions[Wr.to.toString()],jn=fn.patternPositions[Wr.from.toString()];nn&&jn&&dr.setConstantPatternPositions(nn,jn)}var ui=i.translatePosMatrix(At.posMatrix,Yt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(T){Ce=Sr.indexBuffer2,we=Sr.segments2;var li=[Me.drawingBufferWidth,Me.drawingBufferHeight];le=K==="fillOutlinePattern"&&Xe?$s(ui,i,st,Yt,li):Ia(ui,li)}else Ce=Sr.indexBuffer,we=Sr.segments,le=Xe?ro(ui,i,st,Yt):ys(ui);wr.draw(i.context,k,_,i.stencilModeForClipping(At),E,Te.disabled,le,o.id,Sr.layoutVertexBuffer,Ce,we,o.paint,i.transform.zoom,dr)}}}}function _c(i,u,o,h,_,E,T){for(var k=i.context,K=k.gl,le=o.paint.get("fill-extrusion-pattern"),Ce=le.constantOr(1),we=o.getCrossfadeParameters(),Me=o.paint.get("fill-extrusion-opacity"),Ye=0,Xe=h;Ye<Xe.length;Ye+=1){var st=Xe[Ye],je=u.getTile(st),ut=je.getBucket(o);if(ut){var At=ut.programConfigurations.get(o.id),Yt=i.useProgram(Ce?"fillExtrusionPattern":"fillExtrusion",At);Ce&&(i.context.activeTexture.set(K.TEXTURE0),je.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),At.updatePaintBuffers(we));var Sr=le.constantOr(null);if(Sr&&je.imageAtlas){var dr=je.imageAtlas,wr=dr.patternPositions[Sr.to.toString()],Wr=dr.patternPositions[Sr.from.toString()];wr&&Wr&&At.setConstantPatternPositions(wr,Wr)}var fn=i.translatePosMatrix(st.posMatrix,je,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),nn=o.paint.get("fill-extrusion-vertical-gradient"),jn=Ce?Go(fn,i,nn,Me,st,we,je):Ru(fn,i,nn,Me);Yt.draw(k,k.gl.TRIANGLES,_,E,T,Te.backCCW,jn,o.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,o.paint,i.transform.zoom,At)}}}function Fl(i,u,o,h,_,E){var T=i.context,k=T.gl,K=u.fbo;if(K){var le=i.useProgram("hillshade");T.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,K.colorAttachment.get());var Ce=function(we,Me,Ye){var Xe=Ye.paint.get("hillshade-shadow-color"),st=Ye.paint.get("hillshade-highlight-color"),je=Ye.paint.get("hillshade-accent-color"),ut=Ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ye.paint.get("hillshade-illumination-anchor")==="viewport"&&(ut-=we.transform.angle);var At,Yt,Sr,dr=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Me.tileID.toUnwrapped(),dr),u_image:0,u_latrange:(At=Me.tileID,Yt=Math.pow(2,At.canonical.z),Sr=At.canonical.y,[new p.MercatorCoordinate(0,Sr/Yt).toLngLat().lat,new p.MercatorCoordinate(0,(Sr+1)/Yt).toLngLat().lat]),u_light:[Ye.paint.get("hillshade-exaggeration"),ut],u_shadow:Xe,u_highlight:st,u_accent:je}}(i,u,o);le.draw(T,k.TRIANGLES,h,_,E,Te.disabled,Ce,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function Lc(i,u,o,h,_,E){var T=i.context,k=T.gl,K=u.dem;if(K&&K.data){var le=K.dim,Ce=K.stride,we=K.getPixels();if(T.activeTexture.set(k.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(Ce),u.demTexture){var Me=u.demTexture;Me.update(we,{premultiply:!1}),Me.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(T,we,k.RGBA,{premultiply:!1}),u.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);T.activeTexture.set(k.TEXTURE0);var Ye=u.fbo;if(!Ye){var Xe=new p.Texture(T,{width:le,height:le,data:null},k.RGBA);Xe.bind(k.LINEAR,k.CLAMP_TO_EDGE),(Ye=u.fbo=T.createFramebuffer(le,le,!0)).colorAttachment.set(Xe.texture)}T.bindFramebuffer.set(Ye.framebuffer),T.viewport.set([0,0,le,le]),i.useProgram("hillshadePrepare").draw(T,k.TRIANGLES,h,_,E,Te.disabled,function(st,je){var ut=je.stride,At=p.create();return p.ortho(At,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(At,At,[0,-p.EXTENT,0]),{u_matrix:At,u_image:1,u_dimension:[ut,ut],u_zoom:st.overscaledZ,u_unpack:je.getUnpackVector()}}(u.tileID,K),o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function ec(i,u,o,h,_){var E=h.paint.get("raster-fade-duration");if(E>0){var T=p.browser.now(),k=(T-i.timeAdded)/E,K=u?(T-u.timeAdded)/E:-1,le=o.getSource(),Ce=_.coveringZoomLevel({tileSize:le.tileSize,roundZoom:le.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-Ce)>Math.abs(i.tileID.overscaledZ-Ce),Me=we&&i.refreshedUponExpiration?1:p.clamp(we?k:1-K,0,1);return i.refreshedUponExpiration&&k>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Me}:{opacity:Me,mix:0}}return{opacity:1,mix:0}}var Zs=new p.Color(1,0,0,1),no=new p.Color(0,1,0,1),_o=new p.Color(0,0,1,1),Bu=new p.Color(1,0,1,1),Ds=new p.Color(0,1,1,1);function Bl(i,u,o,h){gu(i,0,u+o/2,i.transform.width,o,h)}function tc(i,u,o,h){gu(i,u-o/2,0,o,i.transform.height,h)}function gu(i,u,o,h,_,E){var T=i.context,k=T.gl;k.enable(k.SCISSOR_TEST),k.scissor(u*p.browser.devicePixelRatio,o*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,_*p.browser.devicePixelRatio),T.clear({color:E}),k.disable(k.SCISSOR_TEST)}function rc(i,u,o){var h=i.context,_=h.gl,E=o.posMatrix,T=i.useProgram("debug"),k=N.disabled,K=ae.disabled,le=i.colorModeForRenderPass();h.activeTexture.set(_.TEXTURE0),i.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),T.draw(h,_.LINE_STRIP,k,K,le,Te.disabled,Js(E,p.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var Ce=u.getTileByID(o.key).latestRawTileData,we=Math.floor((Ce&&Ce.byteLength||0)/1024),Me=u.getTile(o).tileSize,Ye=512/Math.min(Me,512)*(o.overscaledZ/i.transform.zoom)*.5,Xe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Xe+=" => "+o.overscaledZ),function(st,je){st.initDebugOverlayCanvas();var ut=st.debugOverlayCanvas,At=st.context.gl,Yt=st.debugOverlayCanvas.getContext("2d");Yt.clearRect(0,0,ut.width,ut.height),Yt.shadowColor="white",Yt.shadowBlur=2,Yt.lineWidth=1.5,Yt.strokeStyle="white",Yt.textBaseline="top",Yt.font="bold 36px Open Sans, sans-serif",Yt.fillText(je,5,5),Yt.strokeText(je,5,5),st.debugOverlayTexture.update(ut),st.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(i,Xe+" "+we+"kb"),T.draw(h,_.TRIANGLES,k,K,de.alphaBlended,Te.disabled,Js(E,p.Color.transparent,Ye),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var Nu={symbol:function(i,u,o,h,_){if(i.renderPass==="translucent"){var E=ae.disabled,T=i.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(k,K,le,Ce,we,Me,Ye){for(var Xe=K.transform,st=we==="map",je=Me==="map",ut=0,At=k;ut<At.length;ut+=1){var Yt=At[ut],Sr=Ce.getTile(Yt),dr=Sr.getBucket(le);if(dr&&dr.text&&dr.text.segments.get().length){var wr=p.evaluateSizeForZoom(dr.textSizeData,Xe.zoom),Wr=ba(Sr,1,K.transform.zoom),fn=Da(Yt.posMatrix,je,st,K.transform,Wr),nn=le.layout.get("icon-text-fit")!=="none"&&dr.hasIconData();if(wr){var jn=Math.pow(2,Xe.zoom-Sr.tileID.overscaledZ);Fu(dr,st,je,Ye,p.symbolSize,Xe,fn,Yt.posMatrix,jn,wr,nn)}}}}(h,i,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_),o.paint.get("icon-opacity").constantOr(1)!==0&&tl(i,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),E,T),o.paint.get("text-opacity").constantOr(1)!==0&&tl(i,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),E,T),u.map.showCollisionBoxes&&(el(i,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),el(i,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,o,h){if(i.renderPass==="translucent"){var _=o.paint.get("circle-opacity"),E=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),k=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)!==0||E.constantOr(1)!==0&&T.constantOr(1)!==0){for(var K=i.context,le=K.gl,Ce=i.depthModeForSublayer(0,N.ReadOnly),we=ae.disabled,Me=i.colorModeForRenderPass(),Ye=[],Xe=0;Xe<h.length;Xe++){var st=h[Xe],je=u.getTile(st),ut=je.getBucket(o);if(ut){var At=ut.programConfigurations.get(o.id),Yt={programConfiguration:At,program:i.useProgram("circle",At),layoutVertexBuffer:ut.layoutVertexBuffer,indexBuffer:ut.indexBuffer,uniformValues:_l(i,st,je,o)};if(k)for(var Sr=0,dr=ut.segments.get();Sr<dr.length;Sr+=1){var wr=dr[Sr];Ye.push({segments:new p.SegmentVector([wr]),sortKey:wr.sortKey,state:Yt})}else Ye.push({segments:ut.segments,sortKey:0,state:Yt})}}k&&Ye.sort(function(ui,li){return ui.sortKey-li.sortKey});for(var Wr=0,fn=Ye;Wr<fn.length;Wr+=1){var nn=fn[Wr],jn=nn.state;jn.program.draw(K,le.TRIANGLES,Ce,we,Me,Te.disabled,jn.uniformValues,o.id,jn.layoutVertexBuffer,jn.indexBuffer,nn.segments,o.paint,i.transform.zoom,jn.programConfiguration)}}}},heatmap:function(i,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var _=i.context,E=_.gl,T=ae.disabled,k=new de([E.ONE,E.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ye,Xe,st){var je=Ye.gl;Ye.activeTexture.set(je.TEXTURE1),Ye.viewport.set([0,0,Xe.width/4,Xe.height/4]);var ut=st.heatmapFbo;if(ut)je.bindTexture(je.TEXTURE_2D,ut.colorAttachment.get()),Ye.bindFramebuffer.set(ut.framebuffer);else{var At=je.createTexture();je.bindTexture(je.TEXTURE_2D,At),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MAG_FILTER,je.LINEAR),ut=st.heatmapFbo=Ye.createFramebuffer(Xe.width/4,Xe.height/4,!1),function(Yt,Sr,dr,wr){var Wr=Yt.gl;Wr.texImage2D(Wr.TEXTURE_2D,0,Wr.RGBA,Sr.width/4,Sr.height/4,0,Wr.RGBA,Yt.extRenderToTextureHalfFloat?Yt.extTextureHalfFloat.HALF_FLOAT_OES:Wr.UNSIGNED_BYTE,null),wr.colorAttachment.set(dr)}(Ye,Xe,At,ut)}})(_,i,o),_.clear({color:p.Color.transparent});for(var K=0;K<h.length;K++){var le=h[K];if(!u.hasRenderableParent(le)){var Ce=u.getTile(le),we=Ce.getBucket(o);if(we){var Me=we.programConfigurations.get(o.id);i.useProgram("heatmap",Me).draw(_,E.TRIANGLES,N.disabled,T,k,Te.disabled,yc(le.posMatrix,Ce,i.transform.zoom,o.paint.get("heatmap-intensity")),o.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,o.paint,i.transform.zoom,Me)}}}_.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(Ye,Xe){var st=Ye.context,je=st.gl,ut=Xe.heatmapFbo;if(ut){st.activeTexture.set(je.TEXTURE0),je.bindTexture(je.TEXTURE_2D,ut.colorAttachment.get()),st.activeTexture.set(je.TEXTURE1);var At=Xe.colorRampTexture;At||(At=Xe.colorRampTexture=new p.Texture(st,Xe.colorRamp,je.RGBA)),At.bind(je.LINEAR,je.CLAMP_TO_EDGE),Ye.useProgram("heatmapTexture").draw(st,je.TRIANGLES,N.disabled,ae.disabled,Ye.colorModeForRenderPass(),Te.disabled,function(Yt,Sr,dr,wr){var Wr=p.create();p.ortho(Wr,0,Yt.width,Yt.height,0,0,1);var fn=Yt.context.gl;return{u_matrix:Wr,u_world:[fn.drawingBufferWidth,fn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Sr.paint.get("heatmap-opacity")}}(Ye,Xe),Xe.id,Ye.viewportBuffer,Ye.quadTriangleIndexBuffer,Ye.viewportSegments,Xe.paint,Ye.transform.zoom)}}(i,o))},line:function(i,u,o,h){if(i.renderPass==="translucent"){var _=o.paint.get("line-opacity"),E=o.paint.get("line-width");if(_.constantOr(1)!==0&&E.constantOr(1)!==0)for(var T=i.depthModeForSublayer(0,N.ReadOnly),k=i.colorModeForRenderPass(),K=o.paint.get("line-dasharray"),le=o.paint.get("line-pattern"),Ce=le.constantOr(1),we=o.paint.get("line-gradient"),Me=o.getCrossfadeParameters(),Ye=Ce?"linePattern":K?"lineSDF":we?"lineGradient":"line",Xe=i.context,st=Xe.gl,je=!0,ut=0,At=h;ut<At.length;ut+=1){var Yt=At[ut],Sr=u.getTile(Yt);if(!Ce||Sr.patternsLoaded()){var dr=Sr.getBucket(o);if(dr){var wr=dr.programConfigurations.get(o.id),Wr=i.context.program.get(),fn=i.useProgram(Ye,wr),nn=je||fn.program!==Wr,jn=le.constantOr(null);if(jn&&Sr.imageAtlas){var ui=Sr.imageAtlas,li=ui.patternPositions[jn.to.toString()],mn=ui.patternPositions[jn.from.toString()];li&&mn&&wr.setConstantPatternPositions(li,mn)}var aa=Ce?xl(i,Sr,o,Me):K?Kc(i,Sr,o,K,Me):we?Oa(i,Sr,o,dr.lineClipsArray.length):Du(i,Sr,o);if(Ce)Xe.activeTexture.set(st.TEXTURE0),Sr.imageAtlasTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE),wr.updatePaintBuffers(Me);else if(K&&(nn||i.lineAtlas.dirty))Xe.activeTexture.set(st.TEXTURE0),i.lineAtlas.bind(Xe);else if(we){var Hn=dr.gradients[o.id],xi=Hn.texture;if(o.gradientVersion!==Hn.version){var Gi=256;if(o.stepInterpolant){var vi=u.getSource().maxzoom,Ci=Yt.canonical.z===vi?Math.ceil(1<<i.transform.maxZoom-Yt.canonical.z):1;Gi=p.clamp(p.nextPowerOfTwo(dr.maxLineLength/p.EXTENT*1024*Ci),256,Xe.maxTextureSize)}Hn.gradient=p.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Gi,image:Hn.gradient||void 0,clips:dr.lineClipsArray}),Hn.texture?Hn.texture.update(Hn.gradient):Hn.texture=new p.Texture(Xe,Hn.gradient,st.RGBA),Hn.version=o.gradientVersion,xi=Hn.texture}Xe.activeTexture.set(st.TEXTURE0),xi.bind(o.stepInterpolant?st.NEAREST:st.LINEAR,st.CLAMP_TO_EDGE)}fn.draw(Xe,st.TRIANGLES,T,i.stencilModeForClipping(Yt),k,Te.disabled,aa,o.id,dr.layoutVertexBuffer,dr.indexBuffer,dr.segments,o.paint,i.transform.zoom,wr,dr.layoutVertexBuffer2),je=!1}}}}},fill:function(i,u,o,h){var _=o.paint.get("fill-color"),E=o.paint.get("fill-opacity");if(E.constantOr(1)!==0){var T=i.colorModeForRenderPass(),k=o.paint.get("fill-pattern"),K=i.opaquePassEnabledForLayer()&&!k.constantOr(1)&&_.constantOr(p.Color.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===K){var le=i.depthModeForSublayer(1,i.renderPass==="opaque"?N.ReadWrite:N.ReadOnly);kl(i,u,o,h,le,T,!1)}if(i.renderPass==="translucent"&&o.paint.get("fill-antialias")){var Ce=i.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,N.ReadOnly);kl(i,u,o,h,Ce,T,!0)}}},"fill-extrusion":function(i,u,o,h){var _=o.paint.get("fill-extrusion-opacity");if(_!==0&&i.renderPass==="translucent"){var E=new N(i.context.gl.LEQUAL,N.ReadWrite,i.depthRangeFor3D);if(_!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))_c(i,u,o,h,E,ae.disabled,de.disabled),_c(i,u,o,h,E,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var T=i.colorModeForRenderPass();_c(i,u,o,h,E,ae.disabled,T)}}},hillshade:function(i,u,o,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var _=i.context,E=i.depthModeForSublayer(0,N.ReadOnly),T=i.colorModeForRenderPass(),k=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],K=k[0],le=0,Ce=k[1];le<Ce.length;le+=1){var we=Ce[le],Me=u.getTile(we);Me.needsHillshadePrepare&&i.renderPass==="offscreen"?Lc(i,Me,o,E,ae.disabled,T):i.renderPass==="translucent"&&Fl(i,Me,o,E,K[we.overscaledZ],T)}_.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,o,h){if(i.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var _=i.context,E=_.gl,T=u.getSource(),k=i.useProgram("raster"),K=i.colorModeForRenderPass(),le=T instanceof gt?[{},h]:i.stencilConfigForOverlap(h),Ce=le[0],we=le[1],Me=we[we.length-1].overscaledZ,Ye=!i.options.moving,Xe=0,st=we;Xe<st.length;Xe+=1){var je=st[Xe],ut=i.depthModeForSublayer(je.overscaledZ-Me,o.paint.get("raster-opacity")===1?N.ReadWrite:N.ReadOnly,E.LESS),At=u.getTile(je),Yt=i.transform.calculatePosMatrix(je.toUnwrapped(),Ye);At.registerFadeDuration(o.paint.get("raster-fade-duration"));var Sr=u.findLoadedParent(je,0),dr=ec(At,Sr,u,o,i.transform),wr=void 0,Wr=void 0,fn=o.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;_.activeTexture.set(E.TEXTURE0),At.texture.bind(fn,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(E.TEXTURE1),Sr?(Sr.texture.bind(fn,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),wr=Math.pow(2,Sr.tileID.overscaledZ-At.tileID.overscaledZ),Wr=[At.tileID.canonical.x*wr%1,At.tileID.canonical.y*wr%1]):At.texture.bind(fn,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);var nn=$c(Yt,Wr||[0,0],wr||1,dr,o);T instanceof gt?k.draw(_,E.TRIANGLES,ut,ae.disabled,K,Te.disabled,nn,o.id,T.boundsBuffer,i.quadTriangleIndexBuffer,T.boundsSegments):k.draw(_,E.TRIANGLES,ut,Ce[je.overscaledZ],K,Te.disabled,nn,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,o){var h=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_!==0){var E=i.context,T=E.gl,k=i.transform,K=k.tileSize,le=o.paint.get("background-pattern");if(!i.isPatternMissing(le)){var Ce=!le&&h.a===1&&_===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===Ce){var we=ae.disabled,Me=i.depthModeForSublayer(0,Ce==="opaque"?N.ReadWrite:N.ReadOnly),Ye=i.colorModeForRenderPass(),Xe=i.useProgram(le?"backgroundPattern":"background"),st=k.coveringTiles({tileSize:K});le&&(E.activeTexture.set(T.TEXTURE0),i.imageManager.bind(i.context));for(var je=o.getCrossfadeParameters(),ut=0,At=st;ut<At.length;ut+=1){var Yt=At[ut],Sr=i.transform.calculatePosMatrix(Yt.toUnwrapped()),dr=le?qu(Sr,_,i,le,{tileID:Yt,tileSize:K},je):El(Sr,_,h);Xe.draw(E,T.TRIANGLES,Me,we,Ye,Te.disabled,dr,o.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,o){for(var h=0;h<o.length;h++)rc(i,u,o[h])},custom:function(i,u,o){var h=i.context,_=o.implementation;if(i.renderPass==="offscreen"){var E=_.prerender;E&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),E.call(_,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(ae.disabled);var T=_.renderingMode==="3d"?new N(i.context.gl.LEQUAL,N.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,N.ReadOnly);h.setDepthMode(T),_.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},io=function(i,u){this.context=new ue(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=xe.maxUnderzooming+xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ss,this.gpuTimers={}};io.prototype.resize=function(i,u){if(this.width=i*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},io.prototype.setup=function(){var i=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,Ca.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var o=new p.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(p.EXTENT,0),o.emplaceBack(0,p.EXTENT),o.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=i.createVertexBuffer(o,Ca.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,Et.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,Ca.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var E=new p.StructArrayLayout1ui2;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(E);var T=new p.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new p.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new ae({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},io.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=p.create();p.ortho(o,0,this.width,this.height,0,0,1),p.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,N.disabled,this.stencilClearMode,de.disabled,Te.disabled,Qs(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},io.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(de.disabled),o.setDepthMode(N.disabled);var _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var E=0,T=u;E<T.length;E+=1){var k=T[E],K=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;_.draw(o,h.TRIANGLES,N.disabled,new ae({func:h.ALWAYS,mask:0},K,255,h.KEEP,h.KEEP,h.REPLACE),de.disabled,Te.disabled,Qs(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},io.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new ae({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},io.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new ae({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},io.prototype.stencilConfigForOverlap=function(i){var u,o=this.context.gl,h=i.sort(function(K,le){return le.overscaledZ-K.overscaledZ}),_=h[h.length-1].overscaledZ,E=h[0].overscaledZ-_+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();for(var T={},k=0;k<E;k++)T[k+_]=new ae({func:o.GEQUAL,mask:255},k+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=E,[T,h]}return[(u={},u[_]=ae.disabled,u),h]},io.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new de([i.CONSTANT_COLOR,i.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended},io.prototype.depthModeForSublayer=function(i,u,o){if(!this.opaquePassEnabledForLayer())return N.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new N(o||this.context.gl.LEQUAL,u,[h,h])},io.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},io.prototype.render=function(i,u){var o=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,_=this.style.sourceCaches;for(var E in _){var T=_[E];T.used&&T.prepare(this.context)}var k,K,le={},Ce={},we={};for(var Me in _){var Ye=_[Me];le[Me]=Ye.getVisibleCoordinates(),Ce[Me]=le[Me].slice().reverse(),we[Me]=Ye.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Xe=0;Xe<h.length;Xe++)if(this.style._layers[h[Xe]].is3D()){this.opaquePassCutoff=Xe;break}this.renderPass="offscreen";for(var st=0,je=h;st<je.length;st+=1){var ut=this.style._layers[je[st]];if(ut.hasOffscreenPass()&&!ut.isHidden(this.transform.zoom)){var At=Ce[ut.source];(ut.type==="custom"||At.length)&&this.renderLayer(this,_[ut.source],ut,At)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Yt=this.style._layers[h[this.currentLayer]],Sr=_[Yt.source],dr=le[Yt.source];this._renderTileClippingMasks(Yt,dr),this.renderLayer(this,Sr,Yt,dr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var wr=this.style._layers[h[this.currentLayer]],Wr=_[wr.source],fn=(wr.type==="symbol"?we:Ce)[wr.source];this._renderTileClippingMasks(wr,le[wr.source]),this.renderLayer(this,Wr,wr,fn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(nn){nn.source&&!nn.isHidden(o.transform.zoom)&&(nn.source!==(K&&K.id)&&(K=o.style.sourceCaches[nn.source]),(!k||k.getSource().maxzoom<K.getSource().maxzoom)&&(k=K))}),k&&Nu.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(nn){var jn=nn.transform.padding;Bl(nn,nn.transform.height-(jn.top||0),3,Zs),Bl(nn,jn.bottom||0,3,no),tc(nn,jn.left||0,3,_o),tc(nn,nn.transform.width-(jn.right||0),3,Bu);var ui=nn.transform.centerPoint;(function(li,mn,aa,Hn){gu(li,mn-1,aa-10,2,20,Hn),gu(li,mn-10,aa-1,20,2,Hn)})(nn,ui.x,nn.transform.height-ui.y,Ds)}(this),this.context.setDefault()},io.prototype.renderLayer=function(i,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),Nu[o.type](i,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},io.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[i.id];o||(o=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},io.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},io.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},io.prototype.queryGpuTimers=function(i){var u={};for(var o in i){var h=i[o],_=this.context.extTimerQuery,E=_.getQueryObjectEXT(h.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(h.query),u[o]=E}return u},io.prototype.translatePosMatrix=function(i,u,o,h,_){if(!o[0]&&!o[1])return i;var E=_?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(E){var T=Math.sin(E),k=Math.cos(E);o=[o[0]*k-o[1]*T,o[0]*T+o[1]*k]}var K=[_?o[0]:ba(u,o[0],this.transform.zoom),_?o[1]:ba(u,o[1],this.transform.zoom),0],le=new Float32Array(16);return p.translate(le,i,K),le},io.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},io.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},io.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),o=this.imageManager.getPattern(i.to.toString());return!u||!o},io.prototype.useProgram=function(i,u){this.cache=this.cache||{};var o=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new lu(this.context,i,po[i],u,Cl[i],this._showOverdrawInspector)),this.cache[o]},io.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},io.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},io.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},io.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Nl=function(i,u){this.points=i,this.planes=u};Nl.fromInvProjectionMatrix=function(i,u,o){var h=Math.pow(2,o),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return p.transformMat4([],T,i)}).map(function(T){return p.scale$1([],T,1/T[3]/u*h)}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var k=p.sub([],_[T[0]],_[T[1]]),K=p.sub([],_[T[2]],_[T[1]]),le=p.normalize([],p.cross([],k,K)),Ce=-p.dot(le,_[T[1]]);return le.concat(Ce)});return new Nl(_,E)};var js=function(i,u){this.min=i,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};js.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],o=p.clone$2(this.min),h=p.clone$2(this.max),_=0;_<u.length;_++)o[_]=u[_]?this.min[_]:this.center[_],h[_]=u[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new js(o,h)},js.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},js.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},js.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<i.planes.length;h++){for(var _=i.planes[h],E=0,T=0;T<u.length;T++)E+=p.dot$1(_,u[T])>=0;if(E===0)return 0;E!==u.length&&(o=!1)}if(o)return 2;for(var k=0;k<3;k++){for(var K=Number.MAX_VALUE,le=-Number.MAX_VALUE,Ce=0;Ce<i.points.length;Ce++){var we=i.points[Ce][k]-this.min[k];K=Math.min(K,we),le=Math.max(le,we)}if(le<0||K>this.max[k]-this.min[k])return 0}return 1};var cu=function(i,u,o,h){if(i===void 0&&(i=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=o,this.right=h};cu.prototype.interpolate=function(i,u,o){return u.top!=null&&i.top!=null&&(this.top=p.number(i.top,u.top,o)),u.bottom!=null&&i.bottom!=null&&(this.bottom=p.number(i.bottom,u.bottom,o)),u.left!=null&&i.left!=null&&(this.left=p.number(i.left,u.left,o)),u.right!=null&&i.right!=null&&(this.right=p.number(i.right,u.right,o)),this},cu.prototype.getCenter=function(i,u){var o=p.clamp((this.left+i-this.right)/2,0,i),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(o,h)},cu.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},cu.prototype.clone=function(){return new cu(this.top,this.bottom,this.left,this.right)},cu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var la=function(i,u,o,h,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};la.prototype.clone=function(){var i=new la(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Pi.minZoom.get=function(){return this._minZoom},Pi.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Pi.maxZoom.get=function(){return this._maxZoom},Pi.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Pi.minPitch.get=function(){return this._minPitch},Pi.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Pi.maxPitch.get=function(){return this._maxPitch},Pi.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Pi.renderWorldCopies.get=function(){return this._renderWorldCopies},Pi.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Pi.worldSize.get=function(){return this.tileSize*this.scale},Pi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pi.size.get=function(){return new p.Point(this.width,this.height)},Pi.bearing.get=function(){return-this.angle/Math.PI*180},Pi.bearing.set=function(i){var u=-p.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pi.pitch.get=function(){return this._pitch/Math.PI*180},Pi.pitch.set=function(i){var u=p.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Pi.fov.get=function(){return this._fov/Math.PI*180},Pi.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Pi.zoom.get=function(){return this._zoom},Pi.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Pi.center.get=function(){return this._center},Pi.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Pi.padding.get=function(){return this._edgeInsets.toJSON()},Pi.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Pi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},la.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},la.prototype.interpolatePadding=function(i,u,o){this._unmodified=!1,this._edgeInsets.interpolate(i,u,o),this._constrain(),this._calcMatrices()},la.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},la.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new p.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),_=this.pointCoordinate(new p.Point(this.width,this.height)),E=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(o.x,h.x,_.x,E.x)),k=Math.floor(Math.max(o.x,h.x,_.x,E.x)),K=T-1;K<=k+1;K++)K!==0&&u.push(new p.UnwrappedTileID(K,i));return u},la.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),o=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,u),E=[_*h.x,_*h.y,0],T=Nl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),k=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=u);var K=function(nn){return{aabb:new js([nn*_,0,0],[(nn+1)*_,_,0]),zoom:0,x:0,y:0,wrap:nn,fullyVisible:!1}},le=[],Ce=[],we=u,Me=i.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var Ye=1;Ye<=3;Ye++)le.push(K(-Ye)),le.push(K(Ye));for(le.push(K(0));le.length>0;){var Xe=le.pop(),st=Xe.x,je=Xe.y,ut=Xe.fullyVisible;if(!ut){var At=Xe.aabb.intersects(T);if(At===0)continue;ut=At===2}var Yt=Xe.aabb.distanceX(E),Sr=Xe.aabb.distanceY(E),dr=Math.max(Math.abs(Yt),Math.abs(Sr));if(Xe.zoom===we||dr>3+(1<<we-Xe.zoom)-2&&Xe.zoom>=k)Ce.push({tileID:new p.OverscaledTileID(Xe.zoom===we?Me:Xe.zoom,Xe.wrap,Xe.zoom,st,je),distanceSq:p.sqrLen([E[0]-.5-st,E[1]-.5-je])});else for(var wr=0;wr<4;wr++){var Wr=(st<<1)+wr%2,fn=(je<<1)+(wr>>1);le.push({aabb:Xe.aabb.quadrant(wr),zoom:Xe.zoom+1,x:Wr,y:fn,wrap:Xe.wrap,fullyVisible:ut})}}return Ce.sort(function(nn,jn){return nn.distanceSq-jn.distanceSq}).map(function(nn){return nn.tileID})},la.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Pi.unmodified.get=function(){return this._unmodified},la.prototype.zoomScale=function(i){return Math.pow(2,i)},la.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},la.prototype.project=function(i){var u=p.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(i.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},la.prototype.unproject=function(i){return new p.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Pi.point.get=function(){return this.project(this.center)},la.prototype.setLocationAtPoint=function(i,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),E=new p.MercatorCoordinate(_.x-(o.x-h.x),_.y-(o.y-h.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())},la.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},la.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},la.prototype.locationCoordinate=function(i){return p.MercatorCoordinate.fromLngLat(i)},la.prototype.coordinateLocation=function(i){return i.toLngLat()},la.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],o=[i.x,i.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],_=o[3],E=u[1]/h,T=o[1]/_,k=u[2]/h,K=o[2]/_,le=k===K?0:(0-k)/(K-k);return new p.MercatorCoordinate(p.number(u[0]/h,o[0]/_,le)/this.worldSize,p.number(E,T,le)/this.worldSize)},la.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},la.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},la.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},la.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},la.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var o=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var _=i.canonical,E=this.worldSize/this.zoomScale(_.z),T=_.x+Math.pow(2,_.z)*i.wrap,k=p.identity(new Float64Array(16));return p.translate(k,k,[T*E,_.y*E,0]),p.scale(k,k,[E/p.EXTENT,E/p.EXTENT,1]),p.multiply(k,u?this.alignedProjMatrix:this.projMatrix,k),h[o]=new Float32Array(k),h[o]},la.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},la.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,o,h,_=-90,E=90,T=-180,k=180,K=this.size,le=this._unmodified;if(this.latRange){var Ce=this.latRange;_=p.mercatorYfromLat(Ce[1])*this.worldSize,i=(E=p.mercatorYfromLat(Ce[0])*this.worldSize)-_<K.y?K.y/(E-_):0}if(this.lngRange){var we=this.lngRange;T=p.mercatorXfromLng(we[0])*this.worldSize,u=(k=p.mercatorXfromLng(we[1])*this.worldSize)-T<K.x?K.x/(k-T):0}var Me=this.point,Ye=Math.max(u||0,i||0);if(Ye)return this.center=this.unproject(new p.Point(u?(k+T)/2:Me.x,i?(E+_)/2:Me.y)),this.zoom+=this.scaleZoom(Ye),this._unmodified=le,void(this._constraining=!1);if(this.latRange){var Xe=Me.y,st=K.y/2;Xe-st<_&&(h=_+st),Xe+st>E&&(h=E-st)}if(this.lngRange){var je=Me.x,ut=K.x/2;je-ut<T&&(o=T+ut),je+ut>k&&(o=k-ut)}o===void 0&&h===void 0||(this.center=this.unproject(new p.Point(o!==void 0?o:Me.x,h!==void 0?h:Me.y))),this._unmodified=le,this._constraining=!1}},la.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+i.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-o,.01,Math.PI-.01)),_=this.point,E=_.x,T=_.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),K=this.height/50,le=new Float64Array(16);p.perspective(le,this._fov,this.width/this.height,K,k),le[8]=2*-i.x/this.width,le[9]=2*i.y/this.height,p.scale(le,le,[1,-1,1]),p.translate(le,le,[0,0,-this.cameraToCenterDistance]),p.rotateX(le,le,this._pitch),p.rotateZ(le,le,this.angle),p.translate(le,le,[-E,-T,0]),this.mercatorMatrix=p.scale([],le,[this.worldSize,this.worldSize,this.worldSize]),p.scale(le,le,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=le,this.invProjMatrix=p.invert([],this.projMatrix);var Ce=this.width%2/2,we=this.height%2/2,Me=Math.cos(this.angle),Ye=Math.sin(this.angle),Xe=E-Math.round(E)+Me*Ce+Ye*we,st=T-Math.round(T)+Me*we+Ye*Ce,je=new Float64Array(le);if(p.translate(je,je,[Xe>.5?Xe-1:Xe,st>.5?st-1:st,0]),this.alignedProjMatrix=je,le=p.create(),p.scale(le,le,[this.width/2,-this.height/2,1]),p.translate(le,le,[1,-1,0]),this.labelPlaneMatrix=le,le=p.create(),p.scale(le,le,[1,-1,1]),p.translate(le,le,[-1,-1,0]),p.scale(le,le,[2/this.width,2/this.height,1]),this.glCoordMatrix=le,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(le=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=le,this._posMatrixCache={},this._alignedPosMatrixCache={}}},la.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new p.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},la.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,i))},la.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var o=u.x,h=u.y,_=u.x,E=u.y,T=0,k=i;T<k.length;T+=1){var K=k[T];o=Math.min(o,K.x),h=Math.min(h,K.y),_=Math.max(_,K.x),E=Math.max(E,K.y)}return[new p.Point(o,h),new p.Point(_,h),new p.Point(_,E),new p.Point(o,E),new p.Point(o,h)]},Object.defineProperties(la.prototype,Pi);var xs=function(i){var u,o,h,_;this._hashName=i&&encodeURIComponent(i),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,_=function(){h=null,o&&(u(),h=setTimeout(_,300),o=!1)},function(){return o=!0,h||_(),h})};xs.prototype.addTo=function(i){return this._map=i,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},xs.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},xs.prototype.getHashString=function(i){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),E=Math.round(u.lng*_)/_,T=Math.round(u.lat*_)/_,k=this._map.getBearing(),K=this._map.getPitch(),le="";if(le+=i?"/"+E+"/"+T+"/"+o:o+"/"+T+"/"+E,(k||K)&&(le+="/"+Math.round(10*k)/10),K&&(le+="/"+Math.round(K)),this._hashName){var Ce=this._hashName,we=!1,Me=p.window.location.hash.slice(1).split("&").map(function(Ye){var Xe=Ye.split("=")[0];return Xe===Ce?(we=!0,Xe+"="+le):Ye}).filter(function(Ye){return Ye});return we||Me.push(Ce+"="+le),"#"+Me.join("&")}return"#"+le},xs.prototype._getCurrentHash=function(){var i,u=this,o=p.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):o.split("/")},xs.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},xs.prototype._updateHashUnthrottled=function(){var i=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,i)}catch(u){}};var fu={linearity:.3,easing:p.bezier(0,0,.3,1)},rl=p.extend({deceleration:2500,maxSpeed:1400},fu),es=p.extend({deceleration:20,maxSpeed:1400},fu),Jc=p.extend({deceleration:1e3,maxSpeed:360},fu),Rc=p.extend({deceleration:1e3,maxSpeed:90},fu),Al=function(i){this._map=i,this.clear()};function zl(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function yu(i,u,o){var h=o.maxSpeed,_=o.linearity,E=o.deceleration,T=p.clamp(i*_/(u/1e3),-h,h),k=Math.abs(T)/(E*_);return{easing:o.easing,duration:1e3*k,amount:T*(k/2)}}Al.prototype.clear=function(){this._inertiaBuffer=[]},Al.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:i})},Al.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=p.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},Al.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var _=h[o].settings;u.zoom+=_.zoomDelta||0,u.bearing+=_.bearingDelta||0,u.pitch+=_.pitchDelta||0,_.panDelta&&u.pan._add(_.panDelta),_.around&&(u.around=_.around),_.pinchAround&&(u.pinchAround=_.pinchAround)}var E=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var k=yu(u.pan.mag(),E,p.extend({},rl,i||{}));T.offset=u.pan.mult(k.amount/u.pan.mag()),T.center=this._map.transform.center,zl(T,k)}if(u.zoom){var K=yu(u.zoom,E,es);T.zoom=this._map.transform.zoom+K.amount,zl(T,K)}if(u.bearing){var le=yu(u.bearing,E,Jc);T.bearing=this._map.transform.bearing+p.clamp(le.amount,-179,179),zl(T,le)}if(u.pitch){var Ce=yu(u.pitch,E,Rc);T.pitch=this._map.transform.pitch+Ce.amount,zl(T,Ce)}if(T.zoom||T.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;T.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),p.extend(T,{noMoveStart:!0})}};var Ao=function(i){function u(h,_,E,T){T===void 0&&(T={});var k=U.mousePos(_.getCanvasContainer(),E),K=_.unproject(k);i.call(this,h,p.extend({point:k,lngLat:K,originalEvent:E},T)),this._defaultPrevented=!1,this.target=_}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),zu=function(i){function u(h,_,E){var T=h==="touchend"?E.changedTouches:E.touches,k=U.touchPos(_.getCanvasContainer(),T),K=k.map(function(we){return _.unproject(we)}),le=k.reduce(function(we,Me,Ye,Xe){return we.add(Me.div(Xe.length))},new p.Point(0,0)),Ce=_.unproject(le);i.call(this,h,{points:k,point:le,lngLats:K,lngLat:Ce,originalEvent:E}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Tl=function(i){function u(h,_,E){i.call(this,h,{originalEvent:E}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),To=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};To.prototype.reset=function(){delete this._mousedownPos},To.prototype.wheel=function(i){return this._firePreventable(new Tl(i.type,this._map,i))},To.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new Ao(i.type,this._map,i))},To.prototype.mouseup=function(i){this._map.fire(new Ao(i.type,this._map,i))},To.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ao(i.type,this._map,i))},To.prototype.dblclick=function(i){return this._firePreventable(new Ao(i.type,this._map,i))},To.prototype.mouseover=function(i){this._map.fire(new Ao(i.type,this._map,i))},To.prototype.mouseout=function(i){this._map.fire(new Ao(i.type,this._map,i))},To.prototype.touchstart=function(i){return this._firePreventable(new zu(i.type,this._map,i))},To.prototype.touchmove=function(i){this._map.fire(new zu(i.type,this._map,i))},To.prototype.touchend=function(i){this._map.fire(new zu(i.type,this._map,i))},To.prototype.touchcancel=function(i){this._map.fire(new zu(i.type,this._map,i))},To.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},To.prototype.isEnabled=function(){return!0},To.prototype.isActive=function(){return!1},To.prototype.enable=function(){},To.prototype.disable=function(){};var Rn=function(i){this._map=i};Rn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Rn.prototype.mousemove=function(i){this._map.fire(new Ao(i.type,this._map,i))},Rn.prototype.mousedown=function(){this._delayContextMenu=!0},Rn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Rn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ao(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Rn.prototype.isEnabled=function(){return!0},Rn.prototype.isActive=function(){return!1},Rn.prototype.enable=function(){},Rn.prototype.disable=function(){};var lo=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function _u(i,u){for(var o={},h=0;h<i.length;h++)o[i[h].identifier]=u[h];return o}lo.prototype.isEnabled=function(){return!!this._enabled},lo.prototype.isActive=function(){return!!this._active},lo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},lo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},lo.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(U.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},lo.prototype.mousemoveWindow=function(i,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=U.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var _=Math.min(h.x,o.x),E=Math.max(h.x,o.x),T=Math.min(h.y,o.y),k=Math.max(h.y,o.y);U.setTransform(this._box,"translate("+_+"px,"+T+"px)"),this._box.style.width=E-_+"px",this._box.style.height=k-T+"px"}}},lo.prototype.mouseupWindow=function(i,u){var o=this;if(this._active&&i.button===0){var h=this._startPos,_=u;if(this.reset(),U.suppressClick(),h.x!==_.x||h.y!==_.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(E){return E.fitScreenCoordinates(h,_,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},lo.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},lo.prototype.blur=function(){this.reset()},lo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos},lo.prototype._fireEvent=function(i,u){return this._map.fire(new p.Event(i,{originalEvent:u}))};var Uu=function(i){this.reset(),this.numTouches=i.numTouches};Uu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Uu.prototype.touchstart=function(i,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var _=new p.Point(0,0),E=0,T=h;E<T.length;E+=1)_._add(T[E]);return _.div(h.length)}(u),this.touches=_u(o,u)))},Uu.prototype.touchmove=function(i,u,o){if(!this.aborted&&this.centroid){var h=_u(o,u);for(var _ in this.touches){var E=h[_];(!E||E.dist(this.touches[_])>30)&&(this.aborted=!0)}}},Uu.prototype.touchend=function(i,u,o){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Ya=function(i){this.singleTap=new Uu(i),this.numTaps=i.numTaps,this.reset()};Ya.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ya.prototype.touchstart=function(i,u,o){this.singleTap.touchstart(i,u,o)},Ya.prototype.touchmove=function(i,u,o){this.singleTap.touchmove(i,u,o)},Ya.prototype.touchend=function(i,u,o){var h=this.singleTap.touchend(i,u,o);if(h){var _=i.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(h)<30;if(_&&E||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var ks=function(){this._zoomIn=new Ya({numTouches:1,numTaps:2}),this._zoomOut=new Ya({numTouches:2,numTaps:1}),this.reset()};ks.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ks.prototype.touchstart=function(i,u,o){this._zoomIn.touchstart(i,u,o),this._zoomOut.touchstart(i,u,o)},ks.prototype.touchmove=function(i,u,o){this._zoomIn.touchmove(i,u,o),this._zoomOut.touchmove(i,u,o)},ks.prototype.touchend=function(i,u,o){var h=this,_=this._zoomIn.touchend(i,u,o),E=this._zoomOut.touchend(i,u,o);return _?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:i})}}):E?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(E)},{originalEvent:i})}}):void 0},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var xc={0:1,2:2},Sn=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};Sn.prototype.blur=function(){this.reset()},Sn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Sn.prototype._correctButton=function(i,u){return!1},Sn.prototype._move=function(i,u){return{}},Sn.prototype.mousedown=function(i,u){if(!this._lastPoint){var o=U.mouseButton(i);this._correctButton(i,o)&&(this._lastPoint=u,this._eventButton=o)}},Sn.prototype.mousemoveWindow=function(i,u){var o=this._lastPoint;if(o){if(i.preventDefault(),function(h,_){var E=xc[_];return h.buttons===void 0||(h.buttons&E)!==E}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},Sn.prototype.mouseupWindow=function(i){this._lastPoint&&U.mouseButton(i)===this._eventButton&&(this._moved&&U.suppressClick(),this.reset())},Sn.prototype.enable=function(){this._enabled=!0},Sn.prototype.disable=function(){this._enabled=!1,this.reset()},Sn.prototype.isEnabled=function(){return this._enabled},Sn.prototype.isActive=function(){return this._active};var Mu=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(o,h){i.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(Sn),bc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var _=.8*(h.x-o.x);if(_)return this._active=!0,{bearingDelta:_}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(Sn),eu=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var _=-.5*(h.y-o.y);if(_)return this._active=!0,{pitchDelta:_}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(Sn),Ua=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};Ua.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},Ua.prototype.touchstart=function(i,u,o){return this._calculateTransform(i,u,o)},Ua.prototype.touchmove=function(i,u,o){if(this._active&&!(o.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,o)},Ua.prototype.touchend=function(i,u,o){this._calculateTransform(i,u,o),this._active&&o.length<this._minTouches&&this.reset()},Ua.prototype.touchcancel=function(){this.reset()},Ua.prototype._calculateTransform=function(i,u,o){o.length>0&&(this._active=!0);var h=_u(o,u),_=new p.Point(0,0),E=new p.Point(0,0),T=0;for(var k in h){var K=h[k],le=this._touches[k];le&&(_._add(K),E._add(K.sub(le)),T++,h[k]=K)}if(this._touches=h,!(T<this._minTouches)&&E.mag()){var Ce=E.div(T);if(this._sum._add(Ce),!(this._sum.mag()<this._clickTolerance))return{around:_.div(T),panDelta:Ce}}},Ua.prototype.enable=function(){this._enabled=!0},Ua.prototype.disable=function(){this._enabled=!1,this.reset()},Ua.prototype.isEnabled=function(){return this._enabled},Ua.prototype.isActive=function(){return this._active};var bs=function(){this.reset()};function Pl(i,u,o){for(var h=0;h<i.length;h++)if(i[h].identifier===o)return u[h]}function tu(i,u){return Math.log(i/u)/Math.LN2}bs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},bs.prototype._start=function(i){},bs.prototype._move=function(i,u,o){return{}},bs.prototype.touchstart=function(i,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},bs.prototype.touchmove=function(i,u,o){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,_=h[1],E=Pl(o,u,h[0]),T=Pl(o,u,_);if(E&&T){var k=this._aroundCenter?null:E.add(T).div(2);return this._move([E,T],k,i)}}},bs.prototype.touchend=function(i,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,_=h[1],E=Pl(o,u,h[0]),T=Pl(o,u,_);E&&T||(this._active&&U.suppressClick(),this.reset())}},bs.prototype.touchcancel=function(){this.reset()},bs.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},bs.prototype.disable=function(){this._enabled=!1,this.reset()},bs.prototype.isEnabled=function(){return this._enabled},bs.prototype.isActive=function(){return this._active};var Ts=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(tu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tu(this._distance,_),pinchAround:h}},u}(bs);function xu(i,u){return 180*i.angleWith(u)/Math.PI}var Qc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var _=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xu(this._vector,_),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,_=xu(o,this._startVector);return Math.abs(_)<h},u}(bs);function nc(i){return Math.abs(i.y)>Math.abs(i.x)}var ic=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,nc(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,_){var E=o[0].sub(this._lastPoints[0]),T=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(E,T,_.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(E.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,_){if(this._valid!==void 0)return this._valid;var E=o.mag()>=2,T=h.mag()>=2;if(E||T){if(!E||!T)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;var k=o.y>0==h.y>0;return nc(o)&&nc(h)&&k}},u}(bs),ko={panStep:100,bearingStep:15,pitchStep:10},Vs=function(){var i=ko;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Po(i){return i*(2-i)}Vs.prototype.blur=function(){this.reset()},Vs.prototype.reset=function(){this._active=!1},Vs.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0,h=0,_=0,E=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),E=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),E=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,_=0),{cameraAnimation:function(k){var K=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Po,zoom:o?Math.round(K)+o*(i.shiftKey?2:1):K,bearing:k.getBearing()+h*u._bearingStep,pitch:k.getPitch()+_*u._pitchStep,offset:[-E*u._panStep,-T*u._panStep],center:k.getCenter()},{originalEvent:i})}}}},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active},Vs.prototype.disableRotation=function(){this._rotationDisabled=!0},Vs.prototype.enableRotation=function(){this._rotationDisabled=!1};var ta=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};ta.prototype.setZoomRate=function(i){this._defaultZoomRate=i},ta.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},ta.prototype.isEnabled=function(){return!!this._enabled},ta.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ta.prototype.isZooming=function(){return!!this._zooming},ta.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},ta.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ta.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,o=p.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},ta.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},ta.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=U.mousePos(this._el,i);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ta.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var _=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(_*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var E,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,k=this._startZoom,K=this._easing,le=!1;if(this._type==="wheel"&&k&&K){var Ce=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),we=K(Ce);E=p.number(k,T,we),Ce<1?this._frameId||(this._frameId=!0):le=!0}else E=T,le=!0;return this._active=!0,le&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!le,zoomDelta:E-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ta.prototype._smoothOutEasing=function(i){var u=p.ease;if(this._prevEase){var o=this._prevEase,h=(p.browser.now()-o.start)/o.duration,_=o.easing(h+.01)-o.easing(h),E=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-E*E);u=p.bezier(E,T,.25,1)}return this._prevEase={start:p.browser.now(),duration:i,easing:u},u},ta.prototype.blur=function(){this.reset()},ta.prototype.reset=function(){this._active=!1};var Zu=function(i,u){this._clickZoom=i,this._tapZoom=u};Zu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Zu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Zu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Zu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(i.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:i})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Ho=function(){this._tap=new Ya({numTouches:1,numTaps:1}),this.reset()};Ho.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ho.prototype.touchstart=function(i,u,o){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(i,u,o))},Ho.prototype.touchmove=function(i,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,u,o)},Ho.prototype.touchend=function(i,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(i,u,o)&&(this._tapTime=i.timeStamp)},Ho.prototype.touchcancel=function(){this.reset()},Ho.prototype.enable=function(){this._enabled=!0},Ho.prototype.disable=function(){this._enabled=!1,this.reset()},Ho.prototype.isEnabled=function(){return this._enabled},Ho.prototype.isActive=function(){return this._active};var nl=function(i,u,o){this._el=i,this._mousePan=u,this._touchPan=o};nl.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},nl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},nl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},nl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var bu=function(i,u,o){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};bu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},bu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},bu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},bu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var bi=function(i,u,o,h){this._el=i,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};bi.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},bi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},bi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},bi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},bi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},bi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var co=function(i){return i.zoom||i.drag||i.pitch||i.rotate},Ml=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(p.Event);function Vn(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var Gn=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Al(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,_=this._listeners;h<_.length;h+=1){var E=_[h],T=E[0];U.addEventListener(T,E[1],T===p.window.document?this.handleWindowEvent:this.handleEvent,E[2])}};Gn.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var o=u[i],h=o[0];U.removeEventListener(h,o[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},Gn.prototype._addDefaultHandlers=function(i){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new To(u,i));var h=u.boxZoom=new lo(u,i);this._add("boxZoom",h);var _=new ks,E=new hu;u.doubleClickZoom=new Zu(E,_),this._add("tapZoom",_),this._add("clickZoom",E);var T=new Ho;this._add("tapDragZoom",T);var k=u.touchPitch=new ic;this._add("touchPitch",k);var K=new bc(i),le=new eu(i);u.dragRotate=new bu(i,K,le),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",le,["mouseRotate"]);var Ce=new Mu(i),we=new Ua(i);u.dragPan=new nl(o,Ce,we),this._add("mousePan",Ce),this._add("touchPan",we,["touchZoom","touchRotate"]);var Me=new Qc,Ye=new Ts;u.touchZoomRotate=new bi(o,Ye,Me,T),this._add("touchRotate",Me,["touchPan","touchZoom"]),this._add("touchZoom",Ye,["touchPan","touchRotate"]);var Xe=u.scrollZoom=new ta(u,this);this._add("scrollZoom",Xe,["mousePan"]);var st=u.keyboard=new Vs;this._add("keyboard",st),this._add("blockableMapEvent",new Rn(u));for(var je=0,ut=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];je<ut.length;je+=1){var At=ut[je];i.interactive&&i[At]&&u[At].enable(i[At])}},Gn.prototype._add=function(i,u,o){this._handlers.push({handlerName:i,handler:u,allowed:o}),this._handlersById[i]=u},Gn.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},Gn.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},Gn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Gn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Gn.prototype.isMoving=function(){return Boolean(co(this._eventsInProgress))||this.isZooming()},Gn.prototype._blockedByActive=function(i,u,o){for(var h in i)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},Gn.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},Gn.prototype._getMapTouches=function(i){for(var u=[],o=0,h=i;o<h.length;o+=1){var _=h[o];this._el.contains(_.target)&&u.push(_)}return u},Gn.prototype.handleEvent=function(i,u){this._updatingCamera=!0;for(var o=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},_={},E={},T=i.touches?this._getMapTouches(i.touches):void 0,k=T?U.touchPos(this._el,T):U.mousePos(this._el,i),K=0,le=this._handlers;K<le.length;K+=1){var Ce=le[K],we=Ce.handlerName,Me=Ce.handler,Ye=Ce.allowed;if(Me.isEnabled()){var Xe=void 0;this._blockedByActive(E,Ye,we)?Me.reset():Me[u||i.type]&&(Xe=Me[u||i.type](i,k,T),this.mergeHandlerResult(h,_,Xe,we,o),Xe&&Xe.needsRenderFrame&&this._triggerRenderFrame()),(Xe||Me.isActive())&&(E[we]=Me)}}var st={};for(var je in this._previousActiveHandlers)E[je]||(st[je]=o);this._previousActiveHandlers=E,(Object.keys(st).length||Vn(h))&&(this._changes.push([h,_,st]),this._triggerRenderFrame()),(Object.keys(E).length||Vn(h))&&this._map._stop(!0),this._updatingCamera=!1;var ut=h.cameraAnimation;ut&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ut(this._map))},Gn.prototype.mergeHandlerResult=function(i,u,o,h,_){if(o){p.extend(i,o);var E={handlerName:h,originalEvent:o.originalEvent||_};o.zoomDelta!==void 0&&(u.zoom=E),o.panDelta!==void 0&&(u.drag=E),o.pitchDelta!==void 0&&(u.pitch=E),o.bearingDelta!==void 0&&(u.rotate=E)}},Gn.prototype._applyChanges=function(){for(var i={},u={},o={},h=0,_=this._changes;h<_.length;h+=1){var E=_[h],T=E[0],k=E[1],K=E[2];T.panDelta&&(i.panDelta=(i.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(i.around=T.around),T.pinchAround!==void 0&&(i.pinchAround=T.pinchAround),T.noInertia&&(i.noInertia=T.noInertia),p.extend(u,k),p.extend(o,K)}this._updateMapTransform(i,u,o),this._changes=[]},Gn.prototype._updateMapTransform=function(i,u,o){var h=this._map,_=h.transform;if(!Vn(i))return this._fireEvents(u,o,!0);var E=i.panDelta,T=i.zoomDelta,k=i.bearingDelta,K=i.pitchDelta,le=i.around,Ce=i.pinchAround;Ce!==void 0&&(le=Ce),h._stop(!0),le=le||h.transform.centerPoint;var we=_.pointLocation(E?le.sub(E):le);k&&(_.bearing+=k),K&&(_.pitch+=K),T&&(_.zoom+=T),_.setLocationAtPoint(we,le),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,o,!0)},Gn.prototype._fireEvents=function(i,u,o){var h=this,_=co(this._eventsInProgress),E=co(i),T={};for(var k in i)this._eventsInProgress[k]||(T[k+"start"]=i[k].originalEvent),this._eventsInProgress[k]=i[k];for(var K in!_&&E&&this._fireEvent("movestart",E.originalEvent),T)this._fireEvent(K,T[K]);for(var le in E&&this._fireEvent("move",E.originalEvent),i)this._fireEvent(le,i[le].originalEvent);var Ce,we={};for(var Me in this._eventsInProgress){var Ye=this._eventsInProgress[Me],Xe=Ye.handlerName,st=Ye.originalEvent;this._handlersById[Xe].isActive()||(delete this._eventsInProgress[Me],we[Me+"end"]=Ce=u[Xe]||st)}for(var je in we)this._fireEvent(je,we[je]);var ut=co(this._eventsInProgress);if(o&&(_||E)&&!ut){this._updatingCamera=!0;var At=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Yt=function(Sr){return Sr!==0&&-h._bearingSnap<Sr&&Sr<h._bearingSnap};At?(Yt(At.bearing||this._map.getBearing())&&(At.bearing=0),this._map.easeTo(At,{originalEvent:Ce})):(this._map.fire(new p.Event("moveend",{originalEvent:Ce})),Yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Gn.prototype._fireEvent=function(i,u){this._map.fire(new p.Event(i,u?{originalEvent:u}:{}))},Gn.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new Ml("renderFrame",{timeStamp:u})),i._applyChanges()})},Gn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var il=function(i){function u(o,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,_){return o=p.Point.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},h),_)},u.prototype.panTo=function(o,h,_){return this.easeTo(p.extend({center:o},h),_)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,_){return this.easeTo(p.extend({zoom:o},h),_)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,_){return this.easeTo(p.extend({bearing:o},h),_)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,p.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=p.LngLatBounds.convert(o);var _=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,h)},u.prototype._cameraForBoxAndBearing=function(o,h,_,E){var T={top:0,bottom:0,right:0,left:0};if(typeof(E=p.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},E)).padding=="number"){var k=E.padding;E.padding={top:k,bottom:k,right:k,left:k}}E.padding=p.extend(T,E.padding);var K=this.transform,le=K.padding,Ce=K.project(p.LngLat.convert(o)),we=K.project(p.LngLat.convert(h)),Me=Ce.rotate(-_*Math.PI/180),Ye=we.rotate(-_*Math.PI/180),Xe=new p.Point(Math.max(Me.x,Ye.x),Math.max(Me.y,Ye.y)),st=new p.Point(Math.min(Me.x,Ye.x),Math.min(Me.y,Ye.y)),je=Xe.sub(st),ut=(K.width-(le.left+le.right+E.padding.left+E.padding.right))/je.x,At=(K.height-(le.top+le.bottom+E.padding.top+E.padding.bottom))/je.y;if(!(At<0||ut<0)){var Yt=Math.min(K.scaleZoom(K.scale*Math.min(ut,At)),E.maxZoom),Sr=typeof E.offset.x=="number"?new p.Point(E.offset.x,E.offset.y):p.Point.convert(E.offset),dr=new p.Point((E.padding.left-E.padding.right)/2,(E.padding.top-E.padding.bottom)/2).rotate(_*Math.PI/180),wr=Sr.add(dr).mult(K.scale/K.zoomScale(Yt));return{center:K.unproject(Ce.add(we).div(2).sub(wr)),zoom:Yt,bearing:_}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,_){return this._fitInternal(this.cameraForBounds(o,h),h,_)},u.prototype.fitScreenCoordinates=function(o,h,_,E,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(o)),this.transform.pointLocation(p.Point.convert(h)),_,E),E,T)},u.prototype._fitInternal=function(o,h,_){return o?(delete(h=p.extend(o,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this},u.prototype.jumpTo=function(o,h){this.stop();var _=this.transform,E=!1,T=!1,k=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(E=!0,_.zoom=+o.zoom),o.center!==void 0&&(_.center=p.LngLat.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(T=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(k=!0,_.pitch=+o.pitch),o.padding==null||_.isPaddingEqual(o.padding)||(_.padding=o.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),E&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),T&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),k&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(o,h){var _=this;this._stop(!1,o.easeId),((o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate===!1||!o.essential&&p.browser.prefersReducedMotion)&&(o.duration=0);var E=this.transform,T=this.getZoom(),k=this.getBearing(),K=this.getPitch(),le=this.getPadding(),Ce="zoom"in o?+o.zoom:T,we="bearing"in o?this._normalizeBearing(o.bearing,k):k,Me="pitch"in o?+o.pitch:K,Ye="padding"in o?o.padding:E.padding,Xe=p.Point.convert(o.offset),st=E.centerPoint.add(Xe),je=E.pointLocation(st),ut=p.LngLat.convert(o.center||je);this._normalizeCenter(ut);var At,Yt,Sr=E.project(je),dr=E.project(ut).sub(Sr),wr=E.zoomScale(Ce-T);o.around&&(At=p.LngLat.convert(o.around),Yt=E.locationPoint(At));var Wr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==T,this._rotating=this._rotating||k!==we,this._pitching=this._pitching||Me!==K,this._padding=!E.isPaddingEqual(Ye),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Wr),this._ease(function(fn){if(_._zooming&&(E.zoom=p.number(T,Ce,fn)),_._rotating&&(E.bearing=p.number(k,we,fn)),_._pitching&&(E.pitch=p.number(K,Me,fn)),_._padding&&(E.interpolatePadding(le,Ye,fn),st=E.centerPoint.add(Xe)),At)E.setLocationAtPoint(At,Yt);else{var nn=E.zoomScale(E.zoom-T),jn=Ce>T?Math.min(2,wr):Math.max(.5,wr),ui=Math.pow(jn,1-fn),li=E.unproject(Sr.add(dr.mult(fn*ui)).mult(nn));E.setLocationAtPoint(E.renderWorldCopies?li.wrap():li,st)}_._fireMoveEvents(h)},function(fn){_._afterEase(h,fn)},o),this},u.prototype._prepareEase=function(o,h,_){_===void 0&&(_={}),this._moving=!0,h||_.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var _=this._zooming,E=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",o)),E&&this.fire(new p.Event("rotateend",o)),T&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var _=this;if(!o.essential&&p.browser.prefersReducedMotion){var E=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(E,h)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);var T=this.transform,k=this.getZoom(),K=this.getBearing(),le=this.getPitch(),Ce=this.getPadding(),we="zoom"in o?p.clamp(+o.zoom,T.minZoom,T.maxZoom):k,Me="bearing"in o?this._normalizeBearing(o.bearing,K):K,Ye="pitch"in o?+o.pitch:le,Xe="padding"in o?o.padding:T.padding,st=T.zoomScale(we-k),je=p.Point.convert(o.offset),ut=T.centerPoint.add(je),At=T.pointLocation(ut),Yt=p.LngLat.convert(o.center||At);this._normalizeCenter(Yt);var Sr=T.project(At),dr=T.project(Yt).sub(Sr),wr=o.curve,Wr=Math.max(T.width,T.height),fn=Wr/st,nn=dr.mag();if("minZoom"in o){var jn=p.clamp(Math.min(o.minZoom,k,we),T.minZoom,T.maxZoom),ui=Wr/T.zoomScale(jn-k);wr=Math.sqrt(ui/nn*2)}var li=wr*wr;function mn(ne){var L=(fn*fn-Wr*Wr+(ne?-1:1)*li*li*nn*nn)/(2*(ne?fn:Wr)*li*nn);return Math.log(Math.sqrt(L*L+1)-L)}function aa(ne){return(Math.exp(ne)-Math.exp(-ne))/2}function Hn(ne){return(Math.exp(ne)+Math.exp(-ne))/2}var xi=mn(0),Gi=function(ne){return Hn(xi)/Hn(xi+wr*ne)},vi=function(ne){return Wr*((Hn(xi)*(aa(L=xi+wr*ne)/Hn(L))-aa(xi))/li)/nn;var L},Ci=(mn(1)-xi)/wr;if(Math.abs(nn)<1e-6||!isFinite(Ci)){if(Math.abs(Wr-fn)<1e-6)return this.easeTo(o,h);var ie=fn<Wr?-1:1;Ci=Math.abs(Math.log(fn/Wr))/wr,vi=function(){return 0},Gi=function(ne){return Math.exp(ie*wr*ne)}}return o.duration="duration"in o?+o.duration:1e3*Ci/("screenSpeed"in o?+o.screenSpeed/wr:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=K!==Me,this._pitching=Ye!==le,this._padding=!T.isPaddingEqual(Xe),this._prepareEase(h,!1),this._ease(function(ne){var L=ne*Ci,B=1/Gi(L);T.zoom=ne===1?we:k+T.scaleZoom(B),_._rotating&&(T.bearing=p.number(K,Me,ne)),_._pitching&&(T.pitch=p.number(le,Ye,ne)),_._padding&&(T.interpolatePadding(Ce,Xe,ne),ut=T.centerPoint.add(je));var ce=ne===1?Yt:T.unproject(Sr.add(dr.mult(vi(L))).mult(B));T.setLocationAtPoint(T.renderWorldCopies?ce.wrap():ce,ut),_._fireMoveEvents(h)},function(){return _._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!o){var E=this.handlers;E&&E.stop(!1)}return this},u.prototype._ease=function(o,h,_){_.animate===!1||_.duration===0?(o(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=p.wrap(o,-180,180);var _=Math.abs(o-h);return Math.abs(o-360-h)<_&&(o-=360),Math.abs(o+360-h)<_&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var _=o.lng-h.center.lng;o.lng+=_>180?-360:_<-180?360:0}},u}(p.Evented),ts=function(i){i===void 0&&(i={}),this.options=i,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ts.prototype.getDefaultPosition=function(){return"bottom-right"},ts.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ts.prototype.onRemove=function(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ts.prototype._setElementTitle=function(i,u){var o=this._map._getUIString("AttributionControl."+u);i.title=o,i.setAttribute("aria-label",o)},ts.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ts.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(i){var o=u.reduce(function(h,_,E){return _.value&&(h+=_.key+"="+_.value+(E<u.length-1?"&":"")),h},"?");i.href=p.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},ts.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ts.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var _=o[h];if(_.used){var E=_.getSource();E.attribution&&i.indexOf(E.attribution)<0&&i.push(E.attribution)}}i.sort(function(k,K){return k.length-K.length});var T=(i=i.filter(function(k,K){for(var le=K+1;le<i.length;le++)if(i[le].indexOf(k)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,i.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ts.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ls=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};ls.prototype.onAdd=function(i){this._map=i,this._container=U.create("div","mapboxgl-ctrl");var u=U.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ls.prototype.onRemove=function(){U.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ls.prototype.getDefaultPosition=function(){return"bottom-left"},ls.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ls.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},ls.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Mo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Mo.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},Mo.prototype.remove=function(i){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var _=h[o];if(_.id===i)return void(_.cancelled=!0)}},Mo.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var _=h[o];if(!_.cancelled&&(_.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Mo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Dc=p.window.HTMLImageElement,ac=p.window.HTMLElement,Wi=p.window.ImageBitmap,Zi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},qc=function(i){function u(h){var _=this;if((h=p.extend({},Zi,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var E=new la(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,E,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Mo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},ru,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof ac))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Gn(this,h),this._hash=h.hash&&new xs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ts({customAttribution:h.customAttribution})),this.addControl(new ls,h.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(T){_._update(T.dataType==="style"),_.fire(new p.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){_.fire(new p.Event(T.dataType+"dataloading",T))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,_){if(_===void 0&&(_=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var E=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[_];return _.indexOf("bottom")!==-1?T.insertBefore(E,T.firstChild):T.appendChild(E),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var _=this._controls.indexOf(h);return _>-1&&this._controls.splice(_,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var _=this._containerDimensions(),E=_[0],T=_[1];if(E===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(E,T),this.transform.resize(E,T),this.painter.resize(E,T);var k=!this._moving;return k&&this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),this.fire(new p.Event("resize",h)),k&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,_,E){var T,k=this;if(h==="mouseenter"||h==="mouseover"){var K=!1;return{layer:_,listener:E,delegates:{mousemove:function(Ce){var we=k.getLayer(_)?k.queryRenderedFeatures(Ce.point,{layers:[_]}):[];we.length?K||(K=!0,E.call(k,new Ao(h,k,Ce.originalEvent,{features:we}))):K=!1},mouseout:function(){K=!1}}}}if(h==="mouseleave"||h==="mouseout"){var le=!1;return{layer:_,listener:E,delegates:{mousemove:function(Ce){(k.getLayer(_)?k.queryRenderedFeatures(Ce.point,{layers:[_]}):[]).length?le=!0:le&&(le=!1,E.call(k,new Ao(h,k,Ce.originalEvent)))},mouseout:function(Ce){le&&(le=!1,E.call(k,new Ao(h,k,Ce.originalEvent)))}}}}return{layer:_,listener:E,delegates:(T={},T[h]=function(Ce){var we=k.getLayer(_)?k.queryRenderedFeatures(Ce.point,{layers:[_]}):[];we.length&&(Ce.features=we,E.call(k,Ce),delete Ce.features)},T)}},u.prototype.on=function(h,_,E){if(E===void 0)return i.prototype.on.call(this,h,_);var T=this._createDelegatedListener(h,_,E);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(k,T.delegates[k]);return this},u.prototype.once=function(h,_,E){if(E===void 0)return i.prototype.once.call(this,h,_);var T=this._createDelegatedListener(h,_,E);for(var k in T.delegates)this.once(k,T.delegates[k]);return this},u.prototype.off=function(h,_,E){var T=this;return E===void 0?i.prototype.off.call(this,h,_):(this._delegatedListeners&&this._delegatedListeners[h]&&function(k){for(var K=k[h],le=0;le<K.length;le++){var Ce=K[le];if(Ce.layer===_&&Ce.listener===E){for(var we in Ce.delegates)T.off(we,Ce.delegates[we]);return K.splice(le,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,_){if(!this.style)return[];var E;if(_!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(_=h,h=void 0),_=_||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")E=[p.Point.convert(h)];else{var T=p.Point.convert(h[0]),k=p.Point.convert(h[1]);E=[T,new p.Point(k.x,T.y),k,new p.Point(T.x,k.y),T]}return this.style.queryRenderedFeatures(E,_,this.transform)},u.prototype.querySourceFeatures=function(h,_){return this.style.querySourceFeatures(h,_)},u.prototype.setStyle=function(h,_){return(_=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},_)).diff!==!1&&_.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,_),this):(this._localIdeographFontFamily=_.localIdeographFontFamily,this._updateStyle(h,_))},u.prototype._getUIString=function(h){var _=this._locale[h];if(_==null)throw new Error("Missing UI string '"+h+"'");return _},u.prototype._updateStyle=function(h,_){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new As(this,_||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new As(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,_){var E=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),k=this._requestManager.transformRequest(T,p.ResourceType.Style);p.getJSON(k,function(K,le){K?E.fire(new p.ErrorEvent(K)):le&&E._updateDiff(le,_)})}else typeof h=="object"&&this._updateDiff(h,_)},u.prototype._updateDiff=function(h,_){try{this.style.setState(h)&&this._update(!0)}catch(E){p.warnOnce("Unable to perform style diff: "+(E.message||E.error||E)+".  Rebuilding the style from scratch."),this._updateStyle(h,_)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,_){return this._lazyInitEmptyStyle(),this.style.addSource(h,_),this._update(!0)},u.prototype.isSourceLoaded=function(h){var _=this.style&&this.style.sourceCaches[h];if(_!==void 0)return _.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var _ in h){var E=h[_]._tiles;for(var T in E){var k=E[T];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,_,E){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,_,E)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,_,E){E===void 0&&(E={});var T=E.pixelRatio;T===void 0&&(T=1);var k=E.sdf;k===void 0&&(k=!1);var K=E.stretchX,le=E.stretchY,Ce=E.content;if(this._lazyInitEmptyStyle(),_ instanceof Dc||Wi&&_ instanceof Wi){var we=p.browser.getImageData(_);this.style.addImage(h,{data:new p.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:T,stretchX:K,stretchY:le,content:Ce,sdf:k,version:0})}else{if(_.width===void 0||_.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Me=_;this.style.addImage(h,{data:new p.RGBAImage({width:_.width,height:_.height},new Uint8Array(_.data)),pixelRatio:T,stretchX:K,stretchY:le,content:Ce,sdf:k,version:0,userImage:Me}),Me.onAdd&&Me.onAdd(this,h)}},u.prototype.updateImage=function(h,_){var E=this.style.getImage(h);if(!E)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=_ instanceof Dc||Wi&&_ instanceof Wi?p.browser.getImageData(_):_,k=T.width,K=T.height,le=T.data;return k===void 0||K===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==E.data.width||K!==E.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(E.data.replace(le,!(_ instanceof Dc||Wi&&_ instanceof Wi)),void this.style.updateImage(h,E))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,_){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),_)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,_){return this._lazyInitEmptyStyle(),this.style.addLayer(h,_),this._update(!0)},u.prototype.moveLayer=function(h,_){return this.style.moveLayer(h,_),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,_,E){return this.style.setLayerZoomRange(h,_,E),this._update(!0)},u.prototype.setFilter=function(h,_,E){return E===void 0&&(E={}),this.style.setFilter(h,_,E),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,_,E,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,_,E,T),this._update(!0)},u.prototype.getPaintProperty=function(h,_){return this.style.getPaintProperty(h,_)},u.prototype.setLayoutProperty=function(h,_,E,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,_,E,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,_){return this.style.getLayoutProperty(h,_)},u.prototype.setLight=function(h,_){return _===void 0&&(_={}),this._lazyInitEmptyStyle(),this.style.setLight(h,_),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,_){return this.style.setFeatureState(h,_),this._update()},u.prototype.removeFeatureState=function(h,_){return this.style.removeFeatureState(h,_),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,_=0;return this._container&&(h=this._container.clientWidth||400,_=this._container.clientHeight||300),[h,_]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=U.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var _=this._canvasContainer=U.create("div","mapboxgl-canvas-container",h);this._interactive&&_.classList.add("mapboxgl-interactive"),this._canvas=U.create("canvas","mapboxgl-canvas",_),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var E=this._containerDimensions();this._resizeCanvas(E[0],E[1]);var T=this._controlContainer=U.create("div","mapboxgl-control-container",h),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(K){k[K]=U.create("div","mapboxgl-ctrl-"+K,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,_){var E=p.browser.devicePixelRatio||1;this._canvas.width=E*h,this._canvas.height=E*_,this._canvas.style.width=h+"px",this._canvas.style.height=_+"px"},u.prototype._setupPainter=function(){var h=p.extend({},X.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),_=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);_?(this.painter=new io(_,this.transform),p.webpSupported.testSupport(_)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var _,E=this,T=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(_=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,_),T=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var K=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var le=this.transform.zoom,Ce=p.browser.now();this.style.zoomHistory.update(le,Ce);var we=new p.EvaluationParameters(le,{now:Ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Me=we.crossFadingFactor();Me===1&&Me===this._crossFadingFactor||(K=!0,this._crossFadingFactor=Me),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||K)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ye=p.browser.now()-T;k.endQueryEXT(k.TIME_ELAPSED_EXT,_),setTimeout(function(){var je=k.getQueryObjectEXT(_,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(_),E.fire(new p.Event("gpu-timing-frame",{cpuTime:Ye,gpuTime:je}))},50)}if(this.listens("gpu-timing-layer")){var Xe=this.painter.collectGpuTimers();setTimeout(function(){var je=E.painter.queryGpuTimers(Xe);E.fire(new p.Event("gpu-timing-layer",{layerTimes:je}))},50)}var st=this._sourcesDirty||this._styleDirty||this._placementDirty;return st||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||st||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,_=this._controls;h<_.length;h+=1)_[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var E=this.painter.context.gl.getExtension("WEBGL_lose_context");E&&E.loseContext(),Ps(this._canvasContainer),Ps(this._controlContainer),Ps(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(_){h._frame=null,h._render(_)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,_){p.setCacheLimits(h,_)},o.version.get=function(){return p.version},Object.defineProperties(u.prototype,o),u}(il);function Ps(i){i.parentNode&&i.parentNode.removeChild(i)}var Il={showCompass:!0,showZoom:!0,visualizePitch:!1},Ms=function(i){var u=this;this.options=p.extend({},Il,i),this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),U.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),U.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=U.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ms.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),o=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Ms.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Ms.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Va(this._map,this._compass,this.options.visualizePitch)),this._container},Ms.prototype.onRemove=function(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ms.prototype._createButton=function(i,u){var o=U.create("button",i,this._container);return o.type="button",o.addEventListener("click",u),o},Ms.prototype._setButtonTitle=function(i,u){var o=this._map._getUIString("NavigationControl."+u);i.title=o,i.setAttribute("aria-label",o)};var Va=function(i,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new bc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,o&&(this.mousePitch=new eu({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),U.addEventListener(u,"mousedown",this.mousedown),U.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(u,"touchmove",this.touchmove),U.addEventListener(u,"touchend",this.touchend),U.addEventListener(u,"touchcancel",this.reset)};function nu(i,u,o){if(i=new p.LngLat(i.lng,i.lat),u){var h=new p.LngLat(i.lng-360,i.lat),_=new p.LngLat(i.lng+360,i.lat),E=o.locationPoint(i).distSqr(u);o.locationPoint(h).distSqr(u)<E?i=h:o.locationPoint(_).distSqr(u)<E&&(i=_)}for(;Math.abs(i.lng-o.center.lng)>180;){var T=o.locationPoint(i);if(T.x>=0&&T.y>=0&&T.x<=o.width&&T.y<=o.height)break;i.lng>o.center.lng?i.lng-=360:i.lng+=360}return i}Va.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),U.disableDrag()},Va.prototype.move=function(i,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var _=this.mousePitch.mousemoveWindow(i,u);_&&_.pitchDelta&&o.setPitch(o.getPitch()+_.pitchDelta)}},Va.prototype.off=function(){var i=this.element;U.removeEventListener(i,"mousedown",this.mousedown),U.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(i,"touchmove",this.touchmove),U.removeEventListener(i,"touchend",this.touchend),U.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},Va.prototype.offTemp=function(){U.enableDrag(),U.removeEventListener(p.window,"mousemove",this.mousemove),U.removeEventListener(p.window,"mouseup",this.mouseup)},Va.prototype.mousedown=function(i){this.down(p.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),U.mousePos(this.element,i)),U.addEventListener(p.window,"mousemove",this.mousemove),U.addEventListener(p.window,"mouseup",this.mouseup)},Va.prototype.mousemove=function(i){this.move(i,U.mousePos(this.element,i))},Va.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},Va.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},Va.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},Va.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Va.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ss={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ju(i,u,o){var h=i.classList;for(var _ in Ss)h.remove("mapboxgl-"+o+"-anchor-"+_);h.add("mapboxgl-"+o+"-anchor-"+u)}var al,Ol=function(i){function u(o,h){if(i.call(this),(o instanceof p.window.HTMLElement||h)&&(o=p.extend({element:o},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=p.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");var _=U.createNS("http://www.w3.org/2000/svg","svg");_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height","41px"),_.setAttributeNS(null,"width","27px"),_.setAttributeNS(null,"viewBox","0 0 27 41");var E=U.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");var T=U.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var k=U.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var K=0,le=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];K<le.length;K+=1){var Ce=le[K],we=U.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Ce.rx),we.setAttributeNS(null,"ry",Ce.ry),k.appendChild(we)}var Me=U.createNS("http://www.w3.org/2000/svg","g");Me.setAttributeNS(null,"fill",this._color);var Ye=U.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Me.appendChild(Ye);var Xe=U.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"opacity","0.25"),Xe.setAttributeNS(null,"fill","#000000");var st=U.createNS("http://www.w3.org/2000/svg","path");st.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Xe.appendChild(st);var je=U.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(6.0, 7.0)"),je.setAttributeNS(null,"fill","#FFFFFF");var ut=U.createNS("http://www.w3.org/2000/svg","g");ut.setAttributeNS(null,"transform","translate(8.0, 8.0)");var At=U.createNS("http://www.w3.org/2000/svg","circle");At.setAttributeNS(null,"fill","#000000"),At.setAttributeNS(null,"opacity","0.25"),At.setAttributeNS(null,"cx","5.5"),At.setAttributeNS(null,"cy","5.5"),At.setAttributeNS(null,"r","5.4999962");var Yt=U.createNS("http://www.w3.org/2000/svg","circle");Yt.setAttributeNS(null,"fill","#FFFFFF"),Yt.setAttributeNS(null,"cx","5.5"),Yt.setAttributeNS(null,"cy","5.5"),Yt.setAttributeNS(null,"r","5.4999962"),ut.appendChild(At),ut.appendChild(Yt),T.appendChild(k),T.appendChild(Me),T.appendChild(Xe),T.appendChild(je),T.appendChild(ut),_.appendChild(T),_.setAttributeNS(null,"height",41*this._scale+"px"),_.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(_),this._offset=p.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Sr){Sr.preventDefault()}),this._element.addEventListener("mousedown",function(Sr){Sr.preventDefault()}),ju(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,_=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=nu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,Ss[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+_+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=p.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ol=0,sl=!1,ul=function(i){function u(o){i.call(this),this.options=p.extend({},oc,o),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,al!==void 0?h(al):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(_){h(al=_.state!=="denied")}):h(al=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ol=0,sl=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),_=o.coords;return h&&(_.longitude<h.getWest()||_.longitude>h.getEast()||_.latitude<h.getSouth()||_.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude),_=o.coords.accuracy,E=this._map.getBearing(),T=p.extend({bearing:E},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(_),T,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),_=this._map.unproject([1,o]),E=h.distanceTo(_),T=Math.ceil(2*this._accuracy/E);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&sl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=U.create("button","mapboxgl-ctrl-geolocate",this._container),U.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{var E=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ol(this._dotElement),this._circleElement=U.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ol--,sl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ol>1?(o={maximumAge:6e5,timeout:0},sl=!0):(o=this.options.positionOptions,sl=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),Su={maxWidth:100,unit:"metric"},Vu=function(i){this.options=p.extend({},Su,i),p.bindAll(["_onMove","setUnit"],this)};function Sc(i,u,o){var h=o&&o.maxWidth||100,_=i._container.clientHeight/2,E=i.unproject([0,_]),T=i.unproject([h,_]),k=E.distanceTo(T);if(o&&o.unit==="imperial"){var K=3.2808*k;K>5280?Eu(u,h,K/5280,i._getUIString("ScaleControl.Miles")):Eu(u,h,K,i._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Eu(u,h,k/1852,i._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Eu(u,h,k/1e3,i._getUIString("ScaleControl.Kilometers")):Eu(u,h,k,i._getUIString("ScaleControl.Meters"))}function Eu(i,u,o,h){var _,E,T,k=(_=o,(E=Math.pow(10,(""+Math.floor(_)).length-1))*(T=(T=_/E)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(K){var le=Math.pow(10,Math.ceil(-Math.log(K)/Math.LN10));return Math.round(K*le)/le}(T)));i.style.width=u*(k/o)+"px",i.innerHTML=k+"&nbsp;"+h}Vu.prototype.getDefaultPosition=function(){return"bottom-left"},Vu.prototype._onMove=function(){Sc(this._map,this._container,this.options)},Vu.prototype.onAdd=function(i){return this._map=i,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Vu.prototype.onRemove=function(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Vu.prototype.setUnit=function(i){this.options.unit=i,Sc(this._map,this._container,this.options)};var Fs=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof p.window.HTMLElement?this._container=i.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};Fs.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Fs.prototype.onRemove=function(){U.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Fs.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},Fs.prototype._setupUI=function(){var i=this._fullscreenButton=U.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Fs.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},Fs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Fs.prototype._isFullscreen=function(){return this._fullscreen},Fs.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Fs.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var kc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ul=function(i){function u(o){i.call(this),this.options=p.extend(Object.create(kc),o),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(p.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,_=p.window.document.createDocumentFragment(),E=p.window.document.createElement("body");for(E.innerHTML=o;h=E.firstChild;)_.appendChild(h);return this.setDOMContent(_)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=U.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=U.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=U.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var _=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),E=this.options.anchor,T=function we(Me){if(Me){if(typeof Me=="number"){var Ye=Math.round(Math.sqrt(.5*Math.pow(Me,2)));return{center:new p.Point(0,0),top:new p.Point(0,Me),"top-left":new p.Point(Ye,Ye),"top-right":new p.Point(-Ye,Ye),bottom:new p.Point(0,-Me),"bottom-left":new p.Point(Ye,-Ye),"bottom-right":new p.Point(-Ye,-Ye),left:new p.Point(Me,0),right:new p.Point(-Me,0)}}if(Me instanceof p.Point||Array.isArray(Me)){var Xe=p.Point.convert(Me);return{center:Xe,top:Xe,"top-left":Xe,"top-right":Xe,bottom:Xe,"bottom-left":Xe,"bottom-right":Xe,left:Xe,right:Xe}}return{center:p.Point.convert(Me.center||[0,0]),top:p.Point.convert(Me.top||[0,0]),"top-left":p.Point.convert(Me["top-left"]||[0,0]),"top-right":p.Point.convert(Me["top-right"]||[0,0]),bottom:p.Point.convert(Me.bottom||[0,0]),"bottom-left":p.Point.convert(Me["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Me["bottom-right"]||[0,0]),left:p.Point.convert(Me.left||[0,0]),right:p.Point.convert(Me.right||[0,0])}}return we(new p.Point(0,0))}(this.options.offset);if(!E){var k,K=this._container.offsetWidth,le=this._container.offsetHeight;k=_.y+T.bottom.y<le?["top"]:_.y>this._map.transform.height-le?["bottom"]:[],_.x<K/2?k.push("left"):_.x>this._map.transform.width-K/2&&k.push("right"),E=k.length===0?"bottom":k.join("-")}var Ce=_.add(T[E]).round();U.setTransform(this._container,Ss[E]+" translate("+Ce.x+"px,"+Ce.y+"px)"),ju(this._container,E,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(sc);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),ll={version:p.version,supported:X,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:qc,NavigationControl:Ms,GeolocateControl:ul,AttributionControl:ts,ScaleControl:Vu,FullscreenControl:Fs,Popup:Ul,Marker:Ol,Style:As,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){tr().acquire(rr)},clearPrewarmedResources:function(){var i=Nn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(rr),Nn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(i){p.config.ACCESS_TOKEN=i},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(i){p.config.API_URL=i},get workerCount(){return Zr.workerCount},set workerCount(i){Zr.workerCount=i},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){p.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){p.clearTileCache(i)},workerUrl:""};return ll}),z})},28660:function(Qe,O,y){var z=y(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var b;(function(p){(function(X){var U=typeof y.g=="object"?y.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Y=$(p);typeof U.Reflect=="undefined"?U.Reflect=p:Y=$(U.Reflect,Y),X(Y);function $(he,Z){return function(Ie,Le){typeof he[Ie]!="function"&&Object.defineProperty(he,Ie,{configurable:!0,writable:!0,value:Le}),Z&&Z(Ie,Le)}}})(function(X){var U=Object.prototype.hasOwnProperty,Y=typeof Symbol=="function",$=Y&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",he=Y&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",Z=typeof Object.create=="function",Ie={__proto__:[]}instanceof Array,Le=!Z&&!Ie,rt={create:Z?function(){return Mr(Object.create(null))}:Ie?function(){return Mr({__proto__:null})}:function(){return Mr({})},has:Le?function(Je,ct){return U.call(Je,ct)}:function(Je,ct){return ct in Je},get:Le?function(Je,ct){return U.call(Je,ct)?Je[ct]:void 0}:function(Je,ct){return Je[ct]}},$t=Object.getPrototypeOf(Function),zt=typeof z=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Lt=!zt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:q(),Ht=!zt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:kt(),Ct=!zt&&typeof WeakMap=="function"?WeakMap:Er(),yt=new Ct;function ft(Je,ct,It,Bt){if(_n(It)){if(!yr(Je))throw new TypeError;if(!fr(ct))throw new TypeError;return qt(Je,ct)}else{if(!yr(Je))throw new TypeError;if(!ge(ct))throw new TypeError;if(!ge(Bt)&&!_n(Bt)&&!Qi(Bt))throw new TypeError;return Qi(Bt)&&(Bt=void 0),It=ar(It),W(Je,ct,It,Bt)}}X("decorate",ft);function sr(Je,ct){function It(Bt,br){if(!ge(Bt))throw new TypeError;if(!_n(br)&&!Fr(br))throw new TypeError;jt(Je,ct,Bt,br)}return It}X("metadata",sr);function re(Je,ct,It,Bt){if(!ge(It))throw new TypeError;return _n(Bt)||(Bt=ar(Bt)),jt(Je,ct,It,Bt)}X("defineMetadata",re);function nr(Je,ct,It){if(!ge(ct))throw new TypeError;return _n(It)||(It=ar(It)),ke(Je,ct,It)}X("hasMetadata",nr);function Tt(Je,ct,It){if(!ge(ct))throw new TypeError;return _n(It)||(It=ar(It)),_e(Je,ct,It)}X("hasOwnMetadata",Tt);function $e(Je,ct,It){if(!ge(ct))throw new TypeError;return _n(It)||(It=ar(It)),Et(Je,ct,It)}X("getMetadata",$e);function Mt(Je,ct,It){if(!ge(ct))throw new TypeError;return _n(It)||(It=ar(It)),gt(Je,ct,It)}X("getOwnMetadata",Mt);function Ve(Je,ct){if(!ge(Je))throw new TypeError;return _n(ct)||(ct=ar(ct)),Ut(Je,ct)}X("getMetadataKeys",Ve);function Ot(Je,ct){if(!ge(Je))throw new TypeError;return _n(ct)||(ct=ar(ct)),zr(Je,ct)}X("getOwnMetadataKeys",Ot);function pr(Je,ct,It){if(!ge(ct))throw new TypeError;_n(It)||(It=ar(It));var Bt=se(ct,It,!1);if(_n(Bt)||!Bt.delete(Je))return!1;if(Bt.size>0)return!0;var br=yt.get(ct);return br.delete(It),br.size>0||yt.delete(ct),!0}X("deleteMetadata",pr);function qt(Je,ct){for(var It=Je.length-1;It>=0;--It){var Bt=Je[It],br=Bt(ct);if(!_n(br)&&!Qi(br)){if(!fr(br))throw new TypeError;ct=br}}return ct}function W(Je,ct,It,Bt){for(var br=Je.length-1;br>=0;--br){var Tr=Je[br],qe=Tr(ct,It,Bt);if(!_n(qe)&&!Qi(qe)){if(!ge(qe))throw new TypeError;Bt=qe}}return Bt}function se(Je,ct,It){var Bt=yt.get(Je);if(_n(Bt)){if(!It)return;Bt=new Lt,yt.set(Je,Bt)}var br=Bt.get(ct);if(_n(br)){if(!It)return;br=new Lt,Bt.set(ct,br)}return br}function ke(Je,ct,It){var Bt=_e(Je,ct,It);if(Bt)return!0;var br=Pt(ct);return Qi(br)?!1:ke(Je,br,It)}function _e(Je,ct,It){var Bt=se(ct,It,!1);return _n(Bt)?!1:Re(Bt.has(Je))}function Et(Je,ct,It){var Bt=_e(Je,ct,It);if(Bt)return gt(Je,ct,It);var br=Pt(ct);if(!Qi(br))return Et(Je,br,It)}function gt(Je,ct,It){var Bt=se(ct,It,!1);if(!_n(Bt))return Bt.get(Je)}function jt(Je,ct,It,Bt){var br=se(It,Bt,!0);br.set(Je,ct)}function Ut(Je,ct){var It=zr(Je,ct),Bt=Pt(Je);if(Bt===null)return It;var br=Ut(Bt,ct);if(br.length<=0)return It;if(It.length<=0)return br;for(var Tr=new Ht,qe=[],Gr=0,Yr=It;Gr<Yr.length;Gr++){var An=Yr[Gr],vr=Tr.has(An);vr||(Tr.add(An),qe.push(An))}for(var Or=0,St=br;Or<St.length;Or++){var An=St[Or],vr=Tr.has(An);vr||(Tr.add(An),qe.push(An))}return qe}function zr(Je,ct){var It=[],Bt=se(Je,ct,!1);if(_n(Bt))return It;for(var br=Bt.keys(),Tr=G(br),qe=0;;){var Gr=tt(Tr);if(!Gr)return It.length=qe,It;var Yr=Ze(Gr);try{It[qe]=Yr}catch(An){try{lt(Tr)}finally{throw An}}qe++}}function dn(Je){if(Je===null)return 1;switch(typeof Je){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Je===null?1:6;default:return 6}}function _n(Je){return Je===void 0}function Qi(Je){return Je===null}function ur(Je){return typeof Je=="symbol"}function ge(Je){return typeof Je=="object"?Je!==null:typeof Je=="function"}function Pe(Je,ct){switch(dn(Je)){case 0:return Je;case 1:return Je;case 2:return Je;case 3:return Je;case 4:return Je;case 5:return Je}var It=ct===3?"string":ct===5?"number":"default",Bt=C(Je,$);if(Bt!==void 0){var br=Bt.call(Je,It);if(ge(br))throw new TypeError;return br}return Ge(Je,It==="default"?"number":It)}function Ge(Je,ct){if(ct==="string"){var It=Je.toString;if(Lr(It)){var Bt=It.call(Je);if(!ge(Bt))return Bt}var br=Je.valueOf;if(Lr(br)){var Bt=br.call(Je);if(!ge(Bt))return Bt}}else{var br=Je.valueOf;if(Lr(br)){var Bt=br.call(Je);if(!ge(Bt))return Bt}var Tr=Je.toString;if(Lr(Tr)){var Bt=Tr.call(Je);if(!ge(Bt))return Bt}}throw new TypeError}function Re(Je){return!!Je}function Nt(Je){return""+Je}function ar(Je){var ct=Pe(Je,3);return ur(ct)?ct:Nt(ct)}function yr(Je){return Array.isArray?Array.isArray(Je):Je instanceof Object?Je instanceof Array:Object.prototype.toString.call(Je)==="[object Array]"}function Lr(Je){return typeof Je=="function"}function fr(Je){return typeof Je=="function"}function Fr(Je){switch(dn(Je)){case 3:return!0;case 4:return!0;default:return!1}}function C(Je,ct){var It=Je[ct];if(It!=null){if(!Lr(It))throw new TypeError;return It}}function G(Je){var ct=C(Je,he);if(!Lr(ct))throw new TypeError;var It=ct.call(Je);if(!ge(It))throw new TypeError;return It}function Ze(Je){return Je.value}function tt(Je){var ct=Je.next();return ct.done?!1:ct}function lt(Je){var ct=Je.return;ct&&ct.call(Je)}function Pt(Je){var ct=Object.getPrototypeOf(Je);if(typeof Je!="function"||Je===$t||ct!==$t)return ct;var It=Je.prototype,Bt=It&&Object.getPrototypeOf(It);if(Bt==null||Bt===Object.prototype)return ct;var br=Bt.constructor;return typeof br!="function"||br===Je?ct:br}function q(){var Je={},ct=[],It=function(){function qe(Gr,Yr,An){this._index=0,this._keys=Gr,this._values=Yr,this._selector=An}return qe.prototype["@@iterator"]=function(){return this},qe.prototype[he]=function(){return this},qe.prototype.next=function(){var Gr=this._index;if(Gr>=0&&Gr<this._keys.length){var Yr=this._selector(this._keys[Gr],this._values[Gr]);return Gr+1>=this._keys.length?(this._index=-1,this._keys=ct,this._values=ct):this._index++,{value:Yr,done:!1}}return{value:void 0,done:!0}},qe.prototype.throw=function(Gr){throw this._index>=0&&(this._index=-1,this._keys=ct,this._values=ct),Gr},qe.prototype.return=function(Gr){return this._index>=0&&(this._index=-1,this._keys=ct,this._values=ct),{value:Gr,done:!0}},qe}();return function(){function qe(){this._keys=[],this._values=[],this._cacheKey=Je,this._cacheIndex=-2}return Object.defineProperty(qe.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),qe.prototype.has=function(Gr){return this._find(Gr,!1)>=0},qe.prototype.get=function(Gr){var Yr=this._find(Gr,!1);return Yr>=0?this._values[Yr]:void 0},qe.prototype.set=function(Gr,Yr){var An=this._find(Gr,!0);return this._values[An]=Yr,this},qe.prototype.delete=function(Gr){var Yr=this._find(Gr,!1);if(Yr>=0){for(var An=this._keys.length,vr=Yr+1;vr<An;vr++)this._keys[vr-1]=this._keys[vr],this._values[vr-1]=this._values[vr];return this._keys.length--,this._values.length--,Gr===this._cacheKey&&(this._cacheKey=Je,this._cacheIndex=-2),!0}return!1},qe.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Je,this._cacheIndex=-2},qe.prototype.keys=function(){return new It(this._keys,this._values,Bt)},qe.prototype.values=function(){return new It(this._keys,this._values,br)},qe.prototype.entries=function(){return new It(this._keys,this._values,Tr)},qe.prototype["@@iterator"]=function(){return this.entries()},qe.prototype[he]=function(){return this.entries()},qe.prototype._find=function(Gr,Yr){return this._cacheKey!==Gr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Gr)),this._cacheIndex<0&&Yr&&(this._cacheIndex=this._keys.length,this._keys.push(Gr),this._values.push(void 0)),this._cacheIndex},qe}();function Bt(qe,Gr){return qe}function br(qe,Gr){return Gr}function Tr(qe,Gr){return[qe,Gr]}}function kt(){return function(){function Je(){this._map=new Lt}return Object.defineProperty(Je.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Je.prototype.has=function(ct){return this._map.has(ct)},Je.prototype.add=function(ct){return this._map.set(ct,ct),this},Je.prototype.delete=function(ct){return this._map.delete(ct)},Je.prototype.clear=function(){this._map.clear()},Je.prototype.keys=function(){return this._map.keys()},Je.prototype.values=function(){return this._map.values()},Je.prototype.entries=function(){return this._map.entries()},Je.prototype["@@iterator"]=function(){return this.keys()},Je.prototype[he]=function(){return this.keys()},Je}()}function Er(){var Je=16,ct=rt.create(),It=Bt();return function(){function Yr(){this._key=Bt()}return Yr.prototype.has=function(An){var vr=br(An,!1);return vr!==void 0?rt.has(vr,this._key):!1},Yr.prototype.get=function(An){var vr=br(An,!1);return vr!==void 0?rt.get(vr,this._key):void 0},Yr.prototype.set=function(An,vr){var Or=br(An,!0);return Or[this._key]=vr,this},Yr.prototype.delete=function(An){var vr=br(An,!1);return vr!==void 0?delete vr[this._key]:!1},Yr.prototype.clear=function(){this._key=Bt()},Yr}();function Bt(){var Yr;do Yr="@@WeakMap@@"+Gr();while(rt.has(ct,Yr));return ct[Yr]=!0,Yr}function br(Yr,An){if(!U.call(Yr,It)){if(!An)return;Object.defineProperty(Yr,It,{value:rt.create()})}return Yr[It]}function Tr(Yr,An){for(var vr=0;vr<An;++vr)Yr[vr]=Math.random()*255|0;return Yr}function qe(Yr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Yr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Yr)):Tr(new Uint8Array(Yr),Yr):Tr(new Array(Yr),Yr)}function Gr(){var Yr=qe(Je);Yr[6]=Yr[6]&79|64,Yr[8]=Yr[8]&191|128;for(var An="",vr=0;vr<Je;++vr){var Or=Yr[vr];(vr===4||vr===6||vr===8)&&(An+="-"),Or<16&&(An+="0"),An+=Or.toString(16).toLowerCase()}return An}}function Mr(Je){return Je.__=void 0,delete Je.__,Je}})})(b||(b={}))},69848:function(Qe){(function(O,y){Qe.exports=y()})(this,function(){"use strict";function O(Tt,$e,Mt,Ve,Ot,pr){if(!(Ot-Ve<=Mt)){var qt=Ve+Ot>>1;y(Tt,$e,qt,Ve,Ot,pr%2),O(Tt,$e,Mt,Ve,qt-1,pr+1),O(Tt,$e,Mt,qt+1,Ot,pr+1)}}function y(Tt,$e,Mt,Ve,Ot,pr){for(;Ot>Ve;){if(Ot-Ve>600){var qt=Ot-Ve+1,W=Mt-Ve+1,se=Math.log(qt),ke=.5*Math.exp(2*se/3),_e=.5*Math.sqrt(se*ke*(qt-ke)/qt)*(W-qt/2<0?-1:1),Et=Math.max(Ve,Math.floor(Mt-W*ke/qt+_e)),gt=Math.min(Ot,Math.floor(Mt+(qt-W)*ke/qt+_e));y(Tt,$e,Mt,Et,gt,pr)}var jt=$e[2*Mt+pr],Ut=Ve,zr=Ot;for(z(Tt,$e,Ve,Mt),$e[2*Ot+pr]>jt&&z(Tt,$e,Ve,Ot);Ut<zr;){for(z(Tt,$e,Ut,zr),Ut++,zr--;$e[2*Ut+pr]<jt;)Ut++;for(;$e[2*zr+pr]>jt;)zr--}$e[2*Ve+pr]===jt?z(Tt,$e,Ve,zr):(zr++,z(Tt,$e,zr,Ot)),zr<=Mt&&(Ve=zr+1),Mt<=zr&&(Ot=zr-1)}}function z(Tt,$e,Mt,Ve){b(Tt,Mt,Ve),b($e,2*Mt,2*Ve),b($e,2*Mt+1,2*Ve+1)}function b(Tt,$e,Mt){var Ve=Tt[$e];Tt[$e]=Tt[Mt],Tt[Mt]=Ve}function p(Tt,$e,Mt,Ve,Ot,pr,qt){for(var W=[0,Tt.length-1,0],se=[],ke,_e;W.length;){var Et=W.pop(),gt=W.pop(),jt=W.pop();if(gt-jt<=qt){for(var Ut=jt;Ut<=gt;Ut++)ke=$e[2*Ut],_e=$e[2*Ut+1],ke>=Mt&&ke<=Ot&&_e>=Ve&&_e<=pr&&se.push(Tt[Ut]);continue}var zr=Math.floor((jt+gt)/2);ke=$e[2*zr],_e=$e[2*zr+1],ke>=Mt&&ke<=Ot&&_e>=Ve&&_e<=pr&&se.push(Tt[zr]);var dn=(Et+1)%2;(Et===0?Mt<=ke:Ve<=_e)&&(W.push(jt),W.push(zr-1),W.push(dn)),(Et===0?Ot>=ke:pr>=_e)&&(W.push(zr+1),W.push(gt),W.push(dn))}return se}function X(Tt,$e,Mt,Ve,Ot,pr){for(var qt=[0,Tt.length-1,0],W=[],se=Ot*Ot;qt.length;){var ke=qt.pop(),_e=qt.pop(),Et=qt.pop();if(_e-Et<=pr){for(var gt=Et;gt<=_e;gt++)U($e[2*gt],$e[2*gt+1],Mt,Ve)<=se&&W.push(Tt[gt]);continue}var jt=Math.floor((Et+_e)/2),Ut=$e[2*jt],zr=$e[2*jt+1];U(Ut,zr,Mt,Ve)<=se&&W.push(Tt[jt]);var dn=(ke+1)%2;(ke===0?Mt-Ot<=Ut:Ve-Ot<=zr)&&(qt.push(Et),qt.push(jt-1),qt.push(dn)),(ke===0?Mt+Ot>=Ut:Ve+Ot>=zr)&&(qt.push(jt+1),qt.push(_e),qt.push(dn))}return W}function U(Tt,$e,Mt,Ve){var Ot=Tt-Mt,pr=$e-Ve;return Ot*Ot+pr*pr}var Y=function(Tt){return Tt[0]},$=function(Tt){return Tt[1]},he=function($e,Mt,Ve,Ot,pr){Mt===void 0&&(Mt=Y),Ve===void 0&&(Ve=$),Ot===void 0&&(Ot=64),pr===void 0&&(pr=Float64Array),this.nodeSize=Ot,this.points=$e;for(var qt=$e.length<65536?Uint16Array:Uint32Array,W=this.ids=new qt($e.length),se=this.coords=new pr($e.length*2),ke=0;ke<$e.length;ke++)W[ke]=ke,se[2*ke]=Mt($e[ke]),se[2*ke+1]=Ve($e[ke]);O(W,se,Ot,0,W.length-1,0)};he.prototype.range=function($e,Mt,Ve,Ot){return p(this.ids,this.coords,$e,Mt,Ve,Ot,this.nodeSize)},he.prototype.within=function($e,Mt,Ve){return X(this.ids,this.coords,$e,Mt,Ve,this.nodeSize)};var Z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Tt){return Tt}},Ie=Math.fround||function(Tt){return function($e){return Tt[0]=+$e,Tt[0]}}(new Float32Array(1)),Le=function($e){this.options=sr(Object.create(Z),$e),this.trees=new Array(this.options.maxZoom+1)};Le.prototype.load=function($e){var Mt=this.options,Ve=Mt.log,Ot=Mt.minZoom,pr=Mt.maxZoom,qt=Mt.nodeSize;Ve&&console.time("total time");var W="prepare "+$e.length+" points";Ve&&console.time(W),this.points=$e;for(var se=[],ke=0;ke<$e.length;ke++)!$e[ke].geometry||se.push($t($e[ke],ke));this.trees[pr+1]=new he(se,re,nr,qt,Float32Array),Ve&&console.timeEnd(W);for(var _e=pr;_e>=Ot;_e--){var Et=+Date.now();se=this._cluster(se,_e),this.trees[_e]=new he(se,re,nr,qt,Float32Array),Ve&&console.log("z%d: %d clusters in %dms",_e,se.length,+Date.now()-Et)}return Ve&&console.timeEnd("total time"),this},Le.prototype.getClusters=function($e,Mt){var Ve=(($e[0]+180)%360+360)%360-180,Ot=Math.max(-90,Math.min(90,$e[1])),pr=$e[2]===180?180:(($e[2]+180)%360+360)%360-180,qt=Math.max(-90,Math.min(90,$e[3]));if($e[2]-$e[0]>=360)Ve=-180,pr=180;else if(Ve>pr){var W=this.getClusters([Ve,Ot,180,qt],Mt),se=this.getClusters([-180,Ot,pr,qt],Mt);return W.concat(se)}for(var ke=this.trees[this._limitZoom(Mt)],_e=ke.range(Ht(Ve),Ct(qt),Ht(pr),Ct(Ot)),Et=[],gt=0,jt=_e;gt<jt.length;gt+=1){var Ut=jt[gt],zr=ke.points[Ut];Et.push(zr.numPoints?zt(zr):this.points[zr.index])}return Et},Le.prototype.getChildren=function($e){var Mt=this._getOriginId($e),Ve=this._getOriginZoom($e),Ot="No cluster with the specified id.",pr=this.trees[Ve];if(!pr)throw new Error(Ot);var qt=pr.points[Mt];if(!qt)throw new Error(Ot);for(var W=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),se=pr.within(qt.x,qt.y,W),ke=[],_e=0,Et=se;_e<Et.length;_e+=1){var gt=Et[_e],jt=pr.points[gt];jt.parentId===$e&&ke.push(jt.numPoints?zt(jt):this.points[jt.index])}if(ke.length===0)throw new Error(Ot);return ke},Le.prototype.getLeaves=function($e,Mt,Ve){Mt=Mt||10,Ve=Ve||0;var Ot=[];return this._appendLeaves(Ot,$e,Mt,Ve,0),Ot},Le.prototype.getTile=function($e,Mt,Ve){var Ot=this.trees[this._limitZoom($e)],pr=Math.pow(2,$e),qt=this.options,W=qt.extent,se=qt.radius,ke=se/W,_e=(Ve-ke)/pr,Et=(Ve+1+ke)/pr,gt={features:[]};return this._addTileFeatures(Ot.range((Mt-ke)/pr,_e,(Mt+1+ke)/pr,Et),Ot.points,Mt,Ve,pr,gt),Mt===0&&this._addTileFeatures(Ot.range(1-ke/pr,_e,1,Et),Ot.points,pr,Ve,pr,gt),Mt===pr-1&&this._addTileFeatures(Ot.range(0,_e,ke/pr,Et),Ot.points,-1,Ve,pr,gt),gt.features.length?gt:null},Le.prototype.getClusterExpansionZoom=function($e){for(var Mt=this._getOriginZoom($e)-1;Mt<=this.options.maxZoom;){var Ve=this.getChildren($e);if(Mt++,Ve.length!==1)break;$e=Ve[0].properties.cluster_id}return Mt},Le.prototype._appendLeaves=function($e,Mt,Ve,Ot,pr){for(var qt=this.getChildren(Mt),W=0,se=qt;W<se.length;W+=1){var ke=se[W],_e=ke.properties;if(_e&&_e.cluster?pr+_e.point_count<=Ot?pr+=_e.point_count:pr=this._appendLeaves($e,_e.cluster_id,Ve,Ot,pr):pr<Ot?pr++:$e.push(ke),$e.length===Ve)break}return pr},Le.prototype._addTileFeatures=function($e,Mt,Ve,Ot,pr,qt){for(var W=0,se=$e;W<se.length;W+=1){var ke=se[W],_e=Mt[ke],Et=_e.numPoints,gt=void 0,jt=void 0,Ut=void 0;if(Et)gt=Lt(_e),jt=_e.x,Ut=_e.y;else{var zr=this.points[_e.index];gt=zr.properties,jt=Ht(zr.geometry.coordinates[0]),Ut=Ct(zr.geometry.coordinates[1])}var dn={type:1,geometry:[[Math.round(this.options.extent*(jt*pr-Ve)),Math.round(this.options.extent*(Ut*pr-Ot))]],tags:gt},_n=void 0;Et?_n=_e.id:this.options.generateId?_n=_e.index:this.points[_e.index].id&&(_n=this.points[_e.index].id),_n!==void 0&&(dn.id=_n),qt.features.push(dn)}},Le.prototype._limitZoom=function($e){return Math.max(this.options.minZoom,Math.min(+$e,this.options.maxZoom+1))},Le.prototype._cluster=function($e,Mt){for(var Ve=[],Ot=this.options,pr=Ot.radius,qt=Ot.extent,W=Ot.reduce,se=Ot.minPoints,ke=pr/(qt*Math.pow(2,Mt)),_e=0;_e<$e.length;_e++){var Et=$e[_e];if(!(Et.zoom<=Mt)){Et.zoom=Mt;for(var gt=this.trees[Mt+1],jt=gt.within(Et.x,Et.y,ke),Ut=Et.numPoints||1,zr=Ut,dn=0,_n=jt;dn<_n.length;dn+=1){var Qi=_n[dn],ur=gt.points[Qi];ur.zoom>Mt&&(zr+=ur.numPoints||1)}if(zr>Ut&&zr>=se){for(var ge=Et.x*Ut,Pe=Et.y*Ut,Ge=W&&Ut>1?this._map(Et,!0):null,Re=(_e<<5)+(Mt+1)+this.points.length,Nt=0,ar=jt;Nt<ar.length;Nt+=1){var yr=ar[Nt],Lr=gt.points[yr];if(!(Lr.zoom<=Mt)){Lr.zoom=Mt;var fr=Lr.numPoints||1;ge+=Lr.x*fr,Pe+=Lr.y*fr,Lr.parentId=Re,W&&(Ge||(Ge=this._map(Et,!0)),W(Ge,this._map(Lr)))}}Et.parentId=Re,Ve.push(rt(ge/zr,Pe/zr,Re,zr,Ge))}else if(Ve.push(Et),zr>1)for(var Fr=0,C=jt;Fr<C.length;Fr+=1){var G=C[Fr],Ze=gt.points[G];Ze.zoom<=Mt||(Ze.zoom=Mt,Ve.push(Ze))}}}return Ve},Le.prototype._getOriginId=function($e){return $e-this.points.length>>5},Le.prototype._getOriginZoom=function($e){return($e-this.points.length)%32},Le.prototype._map=function($e,Mt){if($e.numPoints)return Mt?sr({},$e.properties):$e.properties;var Ve=this.points[$e.index].properties,Ot=this.options.map(Ve);return Mt&&Ot===Ve?sr({},Ot):Ot};function rt(Tt,$e,Mt,Ve,Ot){return{x:Ie(Tt),y:Ie($e),zoom:Infinity,id:Mt,parentId:-1,numPoints:Ve,properties:Ot}}function $t(Tt,$e){var Mt=Tt.geometry.coordinates,Ve=Mt[0],Ot=Mt[1];return{x:Ie(Ht(Ve)),y:Ie(Ct(Ot)),zoom:Infinity,index:$e,parentId:-1}}function zt(Tt){return{type:"Feature",id:Tt.id,properties:Lt(Tt),geometry:{type:"Point",coordinates:[yt(Tt.x),ft(Tt.y)]}}}function Lt(Tt){var $e=Tt.numPoints,Mt=$e>=1e4?Math.round($e/1e3)+"k":$e>=1e3?Math.round($e/100)/10+"k":$e;return sr(sr({},Tt.properties),{cluster:!0,cluster_id:Tt.id,point_count:$e,point_count_abbreviated:Mt})}function Ht(Tt){return Tt/360+.5}function Ct(Tt){var $e=Math.sin(Tt*Math.PI/180),Mt=.5-.25*Math.log((1+$e)/(1-$e))/Math.PI;return Mt<0?0:Mt>1?1:Mt}function yt(Tt){return(Tt-.5)*360}function ft(Tt){var $e=(180-Tt*360)*Math.PI/180;return 360*Math.atan(Math.exp($e))/Math.PI-90}function sr(Tt,$e){for(var Mt in $e)Tt[Mt]=$e[Mt];return Tt}function re(Tt){return Tt.x}function nr(Tt){return Tt.y}return Le})},75752:function(Qe){Qe.exports.RADIUS=6378137,Qe.exports.FLATTENING=1/298.257223563,Qe.exports.POLAR_RADIUS=63567523142e-4}}]);
